\hypertarget{block__preconditioner_8cc_source}{}\doxysection{block\+\_\+preconditioner.\+cc}
\label{block__preconditioner_8cc_source}\index{block\_preconditioner.cc@{block\_preconditioner.cc}}
\mbox{\hyperlink{block__preconditioner_8cc}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00001}00001 \textcolor{comment}{// LIC// ====================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00002}00002 \textcolor{comment}{// LIC// This file forms part of oomph-\/lib, the object-\/oriented,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00003}00003 \textcolor{comment}{// LIC// multi-\/physics finite-\/element library, available}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00004}00004 \textcolor{comment}{// LIC// at http://www.oomph-\/lib.org.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00005}00005 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00006}00006 \textcolor{comment}{// LIC// Copyright (C) 2006-\/2021 Matthias Heil and Andrew Hazel}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00007}00007 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00008}00008 \textcolor{comment}{// LIC// This library is free software; you can redistribute it and/or}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00009}00009 \textcolor{comment}{// LIC// modify it under the terms of the GNU Lesser General Public}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00010}00010 \textcolor{comment}{// LIC// License as published by the Free Software Foundation; either}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00011}00011 \textcolor{comment}{// LIC// version 2.1 of the License, or (at your option) any later version.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00012}00012 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00013}00013 \textcolor{comment}{// LIC// This library is distributed in the hope that it will be useful,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00014}00014 \textcolor{comment}{// LIC// but WITHOUT ANY WARRANTY; without even the implied warranty of}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00015}00015 \textcolor{comment}{// LIC// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00016}00016 \textcolor{comment}{// LIC// Lesser General Public License for more details.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00017}00017 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00018}00018 \textcolor{comment}{// LIC// You should have received a copy of the GNU Lesser General Public}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00019}00019 \textcolor{comment}{// LIC// License along with this library; if not, write to the Free Software}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00020}00020 \textcolor{comment}{// LIC// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00021}00021 \textcolor{comment}{// LIC// 02110-\/1301  USA.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00022}00022 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00023}00023 \textcolor{comment}{// LIC// The authors may be contacted at oomph-\/lib@maths.man.ac.uk.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00024}00024 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00025}00025 \textcolor{comment}{// LIC//====================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00026}00026 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{block__preconditioner_8h}{block\_preconditioner.h}}"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00027}00027 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00028}00028 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceoomph}{oomph}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00029}00029 \{\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00030}00030 \textcolor{comment}{  /// Static boolean to allow block\_matrix\_test(...) to be run.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00031}00031 \textcolor{comment}{  /// Defaults to false.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00032}00032 \textcolor{comment}{}  \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00033}00033   \textcolor{keywordtype}{bool} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a6e6a40988711a64c622c2fd9104c56cf}{BlockPreconditioner<MATRIX>::Run\_block\_matrix\_test}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00034}00034 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00035}00035 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00036}00036   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00037}00037 \textcolor{comment}{  /// Determine the size of the matrix blocks and setup the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00038}00038 \textcolor{comment}{  /// lookup schemes relating the global degrees of freedom with}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00039}00039 \textcolor{comment}{  /// their "{}blocks"{} and their indices (row/column numbers) in those}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00040}00040 \textcolor{comment}{  /// blocks.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00041}00041 \textcolor{comment}{  /// The distributions of the preconditioner and the blocks are}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00042}00042 \textcolor{comment}{  /// automatically specified (and assumed to be uniform) at this}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00043}00043 \textcolor{comment}{  /// stage.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00044}00044 \textcolor{comment}{  /// This method should be used if any block contains more than one}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00045}00045 \textcolor{comment}{  /// type of DOF. The argument vector dof\_to\_block\_map should be of length}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00046}00046 \textcolor{comment}{  /// ndof. Each element should contain an integer indicating the block number}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00047}00047 \textcolor{comment}{  /// corresponding to that type of DOF.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00048}00048 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00049}00049   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00050}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a6b70b51b533002ff33a09013aa084e54}{00050}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_af704c4816469cef4fed9d35a9ad651ec}{BlockPreconditioner<MATRIX>::block\_setup}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00051}00051     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& dof\_to\_block\_map\_in)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00052}00052   \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00053}00053 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00054}00054     \textcolor{comment}{// Subsidiary preconditioners don't really need the meshes}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00055}00055     \textcolor{keywordflow}{if} (this-\/>is\_master\_block\_preconditioner())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00056}00056     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00057}00057       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00058}00058       \textcolor{keywordtype}{unsigned} n = nmesh();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00059}00059       \textcolor{keywordflow}{if} (n == 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00060}00060       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00061}00061         err\_msg << \textcolor{stringliteral}{"{}No meshes have been set for this block preconditioner!\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00062}00062                 << \textcolor{stringliteral}{"{}Set one with set\_nmesh(...), set\_mesh(...)"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00063}00063         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00064}00064           err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00065}00065         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n; m++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00066}00066         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00067}00067           \textcolor{keywordflow}{if} (Mesh\_pt[m] == 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00068}00068           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00069}00069             err\_msg << \textcolor{stringliteral}{"{}The mesh pointer to mesh "{}} << m << \textcolor{stringliteral}{"{} is null!\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00070}00070                     << \textcolor{stringliteral}{"{}Set a non-\/null one with set\_mesh(...)"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00071}00071             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00072}00072               err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00073}00073           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00074}00074         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00075}00075       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00076}00076     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00077}00077 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00078}00078 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00079}00079     \textcolor{comment}{// Create a copy of the vector input so that we can modify it below}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00080}00080     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} dof\_to\_block\_map = dof\_to\_block\_map\_in;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00081}00081 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00082}00082     \textcolor{keywordflow}{if} (is\_subsidiary\_block\_preconditioner())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00083}00083     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00084}00084 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00085}00085       \textcolor{comment}{// Get the size of the Doftype\_in\_master\_preconditioner\_coarse.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00086}00086       \textcolor{keywordtype}{unsigned} para\_doftype\_in\_master\_preconditioner\_coarse\_size =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00087}00087         Doftype\_in\_master\_preconditioner\_coarse.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00088}00088 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00089}00089       \textcolor{comment}{// Check that the Doftype\_in\_master\_preconditioner\_coarse vector is not}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00090}00090       \textcolor{comment}{// empty. This must be set (via the function}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00091}00091       \textcolor{comment}{// turn\_into\_subsidiary\_block\_preconditioner) if this is a}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00092}00092       \textcolor{comment}{// subsidiary block preconditioner.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00093}00093       \textcolor{keywordflow}{if} (para\_doftype\_in\_master\_preconditioner\_coarse\_size == 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00094}00094       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00095}00095         std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00096}00096         err\_msg << \textcolor{stringliteral}{"{}The mapping from the dof types of the master "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00097}00097                 << \textcolor{stringliteral}{"{}block preconditioner \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00098}00098                 << \textcolor{stringliteral}{"{}to the subsidiary block preconditioner is empty.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00099}00099                 << \textcolor{stringliteral}{"{}Doftype\_in\_master\_preconditioner\_coarse.size() == 0 \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00100}00100                 << \textcolor{stringliteral}{"{}has turn\_into\_subsidiary\_block\_preconditioner(...)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00101}00101                 << \textcolor{stringliteral}{"{}been called with the correct parameters?\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00102}00102                 << std::endl;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00103}00103         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00104}00104           err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00105}00105       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00106}00106 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00107}00107 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00108}00108       \textcolor{comment}{// PARANOID checks for Doftype\_coarsen\_map\_coarse}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00109}00109       \textcolor{comment}{// This is also set in the function}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00110}00110       \textcolor{comment}{// turn\_into\_subsidiary\_block\_preconditioner(...).}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00111}00111       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00112}00112       \textcolor{comment}{// The Doftype\_coarsen\_map\_coarse vector must satisfy two conditions}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00113}00113       \textcolor{comment}{// for it to be valid.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00114}00114       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00115}00115       \textcolor{comment}{// 1) The dof type numbers in the dof\_coarsen\_map vector must be}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00116}00116       \textcolor{comment}{//    unique. For example, it does not make sense to have the vector}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00117}00117       \textcolor{comment}{//    [[0,1][1,2]] because the first inner vector says}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00118}00118       \textcolor{comment}{//    "{}treat dof types 0 and 1 as dof type 0"{} and the second inner vector}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00119}00119       \textcolor{comment}{//    says "{}treat dof type 1 and 2 as dof type 1"{}, but dof type 1 is}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00120}00120       \textcolor{comment}{//    already being treated as dof type 0.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00121}00121       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00122}00122       \textcolor{comment}{// 2) Every SUBSIDIARY dof type must be mapped to a dof type in the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00123}00123       \textcolor{comment}{//    Doftype\_coarsen\_map\_coarse vector.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00124}00124       \textcolor{comment}{//    For example, if there are 5 dof types (passed down from the master}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00125}00125       \textcolor{comment}{//    block preconditioner), and this block subsidiary block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00126}00126       \textcolor{comment}{//    preconditioner only deals with 3 dof types, then all 5 dof types}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00127}00127       \textcolor{comment}{//    must be mapped to a dof type in the subsidiary preconditioner. For}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00128}00128       \textcolor{comment}{//    example if the dof\_map is [1,2,3,4,5], then the subsidiary block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00129}00129       \textcolor{comment}{//    preconditioner knows that 5 dof types have been passed down. But if}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00130}00130       \textcolor{comment}{//    it only works with three dof types, we MUST have three inner vectors}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00131}00131       \textcolor{comment}{//    in the doftype\_coarsen\_map vector (which corresponds to dof types 0,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00132}00132       \textcolor{comment}{//    1 and 2), the union of the dof types in the three inner vectors must}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00133}00133       \textcolor{comment}{//    contain dof types 0, 1, 2, 3 and 4 exactly once. It cannot contain,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00134}00134       \textcolor{comment}{//    say, 0, 1, 5, 7, 9, even though it passes the uniqueness check. We}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00135}00135       \textcolor{comment}{//    ensure this by two conditions:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00136}00136       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00137}00137       \textcolor{comment}{//    2.1) The Doftype\_coarsen\_map\_coarse vector must contain the same}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00138}00138       \textcolor{comment}{//         number of dof types as the dof\_map vector.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00139}00139       \textcolor{comment}{//         In other words, recall that Doftype\_coarsen\_map\_coarse is a}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00140}00140       \textcolor{comment}{//         2D vector, this must contain the same number of vectors as}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00141}00141       \textcolor{comment}{//         there are elements in the dof\_to\_block\_map\_in vector.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00142}00142       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00143}00143       \textcolor{comment}{//    2.2) The maximum element in the doftype\_coarsen\_map\_coarse vector}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00144}00144       \textcolor{comment}{//         is the length of the dof\_map vector minus 1.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00145}00145 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00146}00146       \textcolor{comment}{// A set is deal for checking the above three conditions, we shall insert}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00147}00147       \textcolor{comment}{// all the elements in the doftype\_coarsen\_map\_coarse vector into this}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00148}00148       \textcolor{comment}{// set.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00149}00149       std::set<unsigned> doftype\_map\_set;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00150}00150 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00151}00151       \textcolor{comment}{// Condition (1): Check for uniqueness by inserting all the values of}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00152}00152       \textcolor{comment}{// Doftype\_coarsen\_map\_coarse into a set.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00153}00153       \textcolor{keywordtype}{unsigned} para\_doftype\_coarsen\_map\_coarse\_size =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00154}00154         Doftype\_coarsen\_map\_coarse.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00155}00155 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00156}00156       \textcolor{comment}{// Loop through the outer vector of Doftype\_coarsen\_map\_coarse}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00157}00157       \textcolor{comment}{// then loop through the inner vectors and attempt to insert each}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00158}00158       \textcolor{comment}{// element of Doftype\_coarsen\_map\_coarse into doftype\_map\_set.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00159}00159       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00160}00160       \textcolor{comment}{// The inner for loop will throw an error if we cannot insert the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00161}00161       \textcolor{comment}{// element, this means that it is already inserted and thus not unique.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00162}00162       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < para\_doftype\_coarsen\_map\_coarse\_size; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00163}00163       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00164}00164         \textcolor{comment}{// Loop through the inner vector}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00165}00165         \textcolor{keywordtype}{unsigned} para\_doftype\_coarsen\_map\_coarse\_i\_size =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00166}00166           Doftype\_coarsen\_map\_coarse[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00167}00167         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < para\_doftype\_coarsen\_map\_coarse\_i\_size; j++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00168}00168         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00169}00169           \textcolor{comment}{// Attempt to insert all the values of the inner vector into a set.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00170}00170           std::pair<std::set<unsigned>::iterator, \textcolor{keywordtype}{bool}> doftype\_map\_ret =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00171}00171             doftype\_map\_set.insert(Doftype\_coarsen\_map\_coarse[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}][j]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00172}00172 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00173}00173           \textcolor{keywordflow}{if} (!doftype\_map\_ret.second)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00174}00174           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00175}00175             std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00176}00176             err\_msg << \textcolor{stringliteral}{"{}Error: the doftype number "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00177}00177                     << Doftype\_coarsen\_map\_coarse[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}][j]}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00178}00178                     << \textcolor{stringliteral}{"{} is already inserted."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00179}00179             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00180}00180               err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00181}00181           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00182}00182         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00183}00183       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00184}00184 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00185}00185       \textcolor{comment}{// Condition (2.1): Check that the doftype\_map\_set describes as many}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00186}00186       \textcolor{comment}{// values as doftype\_in\_master\_preconditioner\_coarse. I.e. if dof\_map}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00187}00187       \textcolor{comment}{// contains 5 dof types, then the doftype\_coarsen\_map\_coarse vector must}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00188}00188       \textcolor{comment}{// also contain 5 dof types.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00189}00189       \textcolor{keywordflow}{if} (para\_doftype\_in\_master\_preconditioner\_coarse\_size !=}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00190}00190           doftype\_map\_set.size())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00191}00191       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00192}00192         std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00193}00193         err\_msg << \textcolor{stringliteral}{"{}The size of doftype\_in\_master\_preconditioner\_coarse "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00194}00194                 << \textcolor{stringliteral}{"{}must be the same as the total\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00195}00195                 << \textcolor{stringliteral}{"{}number of values in the doftype\_coarsen\_map\_coarse vector."{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00196}00196                 << std::endl;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00197}00197         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00198}00198           err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00199}00199       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00200}00200 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00201}00201       \textcolor{comment}{// Condition (2.2): Check that the maximum element in the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00202}00202       \textcolor{comment}{// doftype\_coarsen\_map\_coarse vector is the length of the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00203}00203       \textcolor{comment}{// doftype\_in\_master\_preconditioner\_coarse minus 1.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00204}00204       \textcolor{keywordtype}{unsigned} para\_doftype\_in\_master\_preconditioner\_coarse\_size\_minus\_one =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00205}00205         para\_doftype\_in\_master\_preconditioner\_coarse\_size -\/ 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00206}00206       \textcolor{keywordflow}{if} (para\_doftype\_in\_master\_preconditioner\_coarse\_size\_minus\_one !=}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00207}00207           *doftype\_map\_set.rbegin())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00208}00208       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00209}00209         std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00210}00210         err\_msg << \textcolor{stringliteral}{"{}The maximum dof type number in the "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00211}00211                 << \textcolor{stringliteral}{"{}doftype\_coarsen\_map vector must be "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00212}00212                 << para\_doftype\_in\_master\_preconditioner\_coarse\_size\_minus\_one}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00213}00213                 << std::endl;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00214}00214         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00215}00215           err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00216}00216       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00217}00217 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00218}00218 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00219}00219       \textcolor{comment}{// Set the mapping from the master preconditioner DOF types to the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00220}00220       \textcolor{comment}{// subsidiary preconditioner DOF types.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00221}00221       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00222}00222       \textcolor{comment}{// IMPORTANT: Since DOF types may be coarsened in the master block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00223}00223       \textcolor{comment}{// preconditioner, this may no longer reflect the actual underlying dof}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00224}00224       \textcolor{comment}{// types. We must get the actual underlying dof types for the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00225}00225       \textcolor{comment}{// block\_setup(...) function to work properly so all the look up schemes}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00226}00226       \textcolor{comment}{// for this (subsidiary) block preconditioner is correct and works}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00227}00227       \textcolor{comment}{// properly, this is for backwards compatibility purposes and to make sure}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00228}00228       \textcolor{comment}{// Richard Muddle's still works at this (subsidiary) level, although it}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00229}00229       \textcolor{comment}{// may not be used.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00230}00230       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00231}00231       \textcolor{comment}{// If we do not want to make it backwards compatible, we may as well}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00232}00232       \textcolor{comment}{// kill the block\_setup(...) for subsidiary block preconditioners -\/}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00233}00233       \textcolor{comment}{// but other thing may break. Do it at your own risk (take time to}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00234}00234       \textcolor{comment}{// fully understand the whole block preconditioning framework code).}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00235}00235 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00236}00236       \textcolor{comment}{// Create the corresponding Doftype\_in\_master\_preconditioner\_fine and}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00237}00237       \textcolor{comment}{// Doftype\_coarsen\_map\_fine vectors.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00238}00238 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00239}00239       \textcolor{comment}{// First resize the vectors.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00240}00240       Doftype\_in\_master\_preconditioner\_fine.resize(0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00241}00241       Doftype\_coarsen\_map\_fine.resize(0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00242}00242 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00243}00243       \textcolor{comment}{// The Doftype\_in\_master\_preconditioner\_fine vector is easy.  We know that}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00244}00244       \textcolor{comment}{// the Doftype\_coarsen\_map\_fine in the master preconditioner must be}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00245}00245       \textcolor{comment}{// constructed already. So we simply loop through the values in}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00246}00246       \textcolor{comment}{// doftype\_in\_master\_preconditioner\_coarse, then get the most fine grain}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00247}00247       \textcolor{comment}{// dof types from the master preconditioner's Doftype\_coarsen\_map\_fine}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00248}00248       \textcolor{comment}{// vector.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00249}00249       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00250}00250       \textcolor{comment}{// For example, if the master preconditioner has the vector:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00251}00251       \textcolor{comment}{// Doftype\_coarsen\_map\_fine = [0,1,2,3][4,5,6,7][8,9,10,11][12,13][14,15]}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00252}00252       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00253}00253       \textcolor{comment}{// and passes the two vectors}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00254}00254       \textcolor{comment}{// doftype\_in\_master\_preconditioner\_coarse = [1,2,3]}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00255}00255       \textcolor{comment}{// doftype\_coarsen\_map\_coarse = [[0][1,2]]}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00256}00256       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00257}00257       \textcolor{comment}{// Then we want}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00258}00258       \textcolor{comment}{// Doftype\_in\_master\_preconditioner\_fine = [4,5,6,7,8,9,10,11,12,13]}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00259}00259       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00260}00260       \textcolor{comment}{// We achieve this by looking up the corresponding fine dof types in the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00261}00261       \textcolor{comment}{// masters' Doftype\_coarsen\_map\_fine vector which corresponds to the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00262}00262       \textcolor{comment}{// values in Doftype\_in\_master\_preconditioner\_coarse.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00263}00263       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00264}00264       \textcolor{comment}{// That is, the values in Doftype\_in\_master\_preconditioner\_coarse gives us}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00265}00265       \textcolor{comment}{// the index of sub vector we want in the master's}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00266}00266       \textcolor{comment}{// Doftype\_coarsen\_map\_fine vector.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00267}00267 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00268}00268 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00269}00269       \textcolor{comment}{// Check that the master block preconditioner's Doftype\_coarsen\_map\_fine}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00270}00270       \textcolor{comment}{// is set up. Under the current implementation, this would always be set}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00271}00271       \textcolor{comment}{// up properly, but we check it just in case!}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00272}00272       \textcolor{keywordflow}{if} (master\_block\_preconditioner\_pt()-\/>doftype\_coarsen\_map\_fine().size() ==}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00273}00273           0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00274}00274       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00275}00275         std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00276}00276         err\_msg << \textcolor{stringliteral}{"{}The master block preconditioner's "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00277}00277                 << \textcolor{stringliteral}{"{}Doftype\_coarsen\_map\_fine is not\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00278}00278                 << \textcolor{stringliteral}{"{}set up properly.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00279}00279                 << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00280}00280                 << \textcolor{stringliteral}{"{}This vector is constructed in the function "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00281}00281                 << \textcolor{stringliteral}{"{}block\_setup(...).\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00282}00282                 << std::endl;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00283}00283         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00284}00284           err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00285}00285       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00286}00286 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00287}00287 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00288}00288       \textcolor{keywordtype}{unsigned} doftype\_in\_master\_preconditioner\_coarse\_size =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00289}00289         Doftype\_in\_master\_preconditioner\_coarse.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00290}00290       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < doftype\_in\_master\_preconditioner\_coarse\_size;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00291}00291            \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00292}00292       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00293}00293         \textcolor{comment}{// The index of the sub vector we want.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00294}00294         \textcolor{keywordtype}{unsigned} subvec\_index = Doftype\_in\_master\_preconditioner\_coarse[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00295}00295 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00296}00296         \textcolor{comment}{// Get the corresponding most fine grain sub vector from the master}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00297}00297         \textcolor{comment}{// block preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00298}00298         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} tmp\_master\_dof\_subvec =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00299}00299           Master\_block\_preconditioner\_pt-\/>get\_fine\_grain\_dof\_types\_in(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00300}00300             subvec\_index);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00301}00301 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00302}00302         Doftype\_in\_master\_preconditioner\_fine.insert(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00303}00303           Doftype\_in\_master\_preconditioner\_fine.end(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00304}00304           tmp\_master\_dof\_subvec.begin(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00305}00305           tmp\_master\_dof\_subvec.end());}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00306}00306       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00307}00307 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00308}00308       \textcolor{comment}{// The Doftype\_coarsen\_map\_fine vector is a bit more tricky.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00309}00309       \textcolor{comment}{// The Doftype\_coarsen\_map\_coarse vector describes which coarse dof types}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00310}00310       \textcolor{comment}{// of THIS preconditioner are grouped together. We have to translate this}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00311}00311       \textcolor{comment}{// into the most fine grain dof types.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00312}00312       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00313}00313       \textcolor{comment}{// For example, if}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00314}00314       \textcolor{comment}{// Doftype\_coarsen\_map\_coarse = [[0][1,2]]}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00315}00315       \textcolor{comment}{// Doftype\_in\_master\_preconditioner\_coarse = [1,2,3]}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00316}00316       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00317}00317       \textcolor{comment}{// and the MASTER preconditioner has:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00318}00318       \textcolor{comment}{// Doftype\_coarsen\_map\_fine= [[0,1,2,3][4,5,6,7][8,9,10,11][12,13][14,15]]}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00319}00319       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00320}00320       \textcolor{comment}{// Then [[0][1,2]] tell us that the most fine grain DOF types 1 of the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00321}00321       \textcolor{comment}{// master preconditioner most be grouped together, and the most fine}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00322}00322       \textcolor{comment}{// grained dof types 2 and 3 of the master preconditioner must be grouped}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00323}00323       \textcolor{comment}{// together.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00324}00324       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00325}00325       \textcolor{comment}{// This gives the vector [[4,5,6,7] [8,9,10,11,12,13]], translating this}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00326}00326       \textcolor{comment}{// into the local DOF types of this preconditioner we have}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00327}00327       \textcolor{comment}{// Doftype\_coarsen\_map\_fine = [[0,1,2,3][4,5,6,7,8,9]]. This corresponds}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00328}00328       \textcolor{comment}{// with the Doftype\_in\_master\_preconditioner\_fine vector we created above:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00329}00329       \textcolor{comment}{// Doftype\_in\_master\_preconditioner\_fine = [4,5,6,7,8,9,10,11,12,13]}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00330}00330       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00331}00331       \textcolor{comment}{// Together, the master block preconditioner says to THIS subsidiary block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00332}00332       \textcolor{comment}{// preconditioner "{}work on my DOF types [4,5,6,7,8,9,10,11,12,13], but}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00333}00333       \textcolor{comment}{// group your DOF type [0,1,2,3] together as DOF type 0 and [4,5,6,7,8,9]}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00334}00334       \textcolor{comment}{// together together as DOF type 1"{}.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00335}00335       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00336}00336       \textcolor{comment}{// Think of it like this: For each DOF type in Doftype\_coarsen\_map\_coarse}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00337}00337       \textcolor{comment}{// we look at how many values this corresponds to in the master}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00338}00338       \textcolor{comment}{// preconditioner. In this case, Doftype\_coarsen\_map\_coarse:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00339}00339       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00340}00340       \textcolor{comment}{// 1 -\/ corresponds to fine DOF types 0,1,2,3 in this preconditioner,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00341}00341       \textcolor{comment}{// and 4,5,6,7 in the master preconditioner;}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00342}00342       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00343}00343       \textcolor{comment}{// 2 -\/ corresponds to fine DOF types 4,5,6,7 in this preconditioner,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00344}00344       \textcolor{comment}{// and 8,9,10,11 in the master preconditioner;}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00345}00345       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00346}00346       \textcolor{comment}{// 3 -\/ corresponds to fine DOF types 8,9 in this preconditioner,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00347}00347       \textcolor{comment}{// and 12,13 in the master preconditioner.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00348}00348       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00349}00349       \textcolor{comment}{// Thus Doftype\_coarsen\_map\_fine = [[0,1,2,3][4,5,6,7,8,9]]}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00350}00350       \textcolor{comment}{//}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00351}00351 \textcolor{comment}{      /// /////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00352}00352 \textcolor{comment}{}      \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00353}00353       \textcolor{comment}{// How to do this: First we create a 2D vector which has the corresponds}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00354}00354       \textcolor{comment}{// to the fine dof types in the master preconditioner but starting from}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00355}00355       \textcolor{comment}{// 0. For example, take the above example (repeated below):}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00356}00356       \textcolor{comment}{//   Passed to this prec by the master prec:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00357}00357       \textcolor{comment}{//   Doftype\_coarsen\_map\_coarse = [[0][1,2]]}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00358}00358       \textcolor{comment}{//   Doftype\_in\_master\_preconditioner\_coarse = [1,2,3]}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00359}00359       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00360}00360       \textcolor{comment}{// and the MASTER preconditioner has:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00361}00361       \textcolor{comment}{// Doftype\_coarsen\_map\_fine= [[0,1,2,3][4,5,6,7][8,9,10,11][12,13][14,15]]}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00362}00362       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00363}00363       \textcolor{comment}{// Step 1:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00364}00364       \textcolor{comment}{// Then, the temp 2D vector we want to create is:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00365}00365       \textcolor{comment}{// master\_fine\_doftype\_translated = [[0 1 2 3], [4,5,6,7], [8,9]]}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00366}00366       \textcolor{comment}{// This comes from using Doftype\_in\_master\_preconditioner\_coarse}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00367}00367       \textcolor{comment}{// then get the number of fine dof types in the master.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00368}00368       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00369}00369       \textcolor{comment}{// Step 2:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00370}00370       \textcolor{comment}{// Then:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00371}00371       \textcolor{comment}{//   Loop through the vector Doftype\_coarsen\_map\_coarse,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00372}00372       \textcolor{comment}{//     Loop over the inner vectors in Doftype\_coarsen\_map\_coarse}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00373}00373       \textcolor{comment}{//       Each element in the inner vector corresponds to a vector in}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00374}00374       \textcolor{comment}{//       master\_fine\_doftype\_translated. We push in the vectors of}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00375}00375       \textcolor{comment}{//       master\_fine\_doftype\_translated intp Doftype\_coarsen\_map\_fine}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00376}00376       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00377}00377 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00378}00378       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<unsigned>}}> master\_fine\_doftype\_translated;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00379}00379       \textcolor{keywordtype}{unsigned} dof\_type\_index = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00380}00380       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < doftype\_in\_master\_preconditioner\_coarse\_size;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00381}00381            \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00382}00382       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00383}00383         \textcolor{comment}{// How many fine DOF types are in the master's}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00384}00384         \textcolor{comment}{// Doftype\_in\_master\_preconditioner\_coarse[i]?}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00385}00385         \textcolor{keywordtype}{unsigned} coarse\_dof = Doftype\_in\_master\_preconditioner\_coarse[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00386}00386 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00387}00387         \textcolor{keywordtype}{unsigned} n\_master\_fine\_doftypes =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00388}00388           Master\_block\_preconditioner\_pt-\/>nfine\_grain\_dof\_types\_in(coarse\_dof);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00389}00389 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00390}00390         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} tmp\_sub\_vec;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00391}00391         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_master\_fine\_doftypes; j++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00392}00392         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00393}00393           tmp\_sub\_vec.push\_back(dof\_type\_index);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00394}00394           dof\_type\_index++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00395}00395         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00396}00396         master\_fine\_doftype\_translated.push\_back(tmp\_sub\_vec);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00397}00397       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00398}00398 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00399}00399 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00400}00400       \textcolor{comment}{// master\_fine\_doftype\_translated now contains vectors with values are}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00401}00401       \textcolor{comment}{// from 0, 1, 2, ..,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00402}00402       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00403}00403       \textcolor{comment}{// Now read out the values of master\_fine\_doftype\_translated and place}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00404}00404       \textcolor{comment}{// them in order according to Doftype\_coarsen\_map\_coarse.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00405}00405       \textcolor{keywordtype}{unsigned} doftype\_coarsen\_map\_coarse\_size =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00406}00406         Doftype\_coarsen\_map\_coarse.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00407}00407       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < doftype\_coarsen\_map\_coarse\_size; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00408}00408       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00409}00409         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} tmp\_vec;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00410}00410         \textcolor{keywordtype}{unsigned} doftype\_coarsen\_map\_coarse\_i\_size =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00411}00411           Doftype\_coarsen\_map\_coarse[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00412}00412         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < doftype\_coarsen\_map\_coarse\_i\_size; j++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00413}00413         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00414}00414           \textcolor{keywordtype}{unsigned} subvec\_i = Doftype\_coarsen\_map\_coarse[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}][j];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00415}00415 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00416}00416           tmp\_vec.insert(tmp\_vec.end(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00417}00417                          master\_fine\_doftype\_translated[subvec\_i].begin(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00418}00418                          master\_fine\_doftype\_translated[subvec\_i].end());}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00419}00419         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00420}00420 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00421}00421         Doftype\_coarsen\_map\_fine.push\_back(tmp\_vec);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00422}00422       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00423}00423 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00424}00424       \textcolor{comment}{// Get the number of block types (and DOF types) in this preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00425}00425       \textcolor{comment}{// from the length of the dof\_map vector.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00426}00426       Internal\_ndof\_types = Doftype\_in\_master\_preconditioner\_fine.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00427}00427 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00428}00428       \textcolor{comment}{// Nblock\_types is later updated in block\_setup(...)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00429}00429       Internal\_nblock\_types = Internal\_ndof\_types;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00430}00430 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00431}00431       \textcolor{comment}{// Compute number of rows in this (sub) preconditioner using data from}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00432}00432       \textcolor{comment}{// the master.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00433}00433       Nrow = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00434}00434       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < Internal\_ndof\_types; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00435}00435       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00436}00436         Nrow += this-\/>internal\_dof\_block\_dimension(b);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00437}00437       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00438}00438 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00439}00439 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00440}00440       \textcolor{keywordflow}{if} (Nrow == 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00441}00441       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00442}00442         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00443}00443         error\_message}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00444}00444           << \textcolor{stringliteral}{"{}Nrow=0 in subsidiary preconditioner. This seems fishy and\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00445}00445           << \textcolor{stringliteral}{"{}suggests that block\_setup() was not called for the \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00446}00446           << \textcolor{stringliteral}{"{}master block preconditioner yet."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00447}00447         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00448}00448                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00449}00449                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00450}00450       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00451}00451 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00452}00452     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00453}00453 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00454}00454     \textcolor{comment}{// If this is a master block preconditioner, then set the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00455}00455     \textcolor{comment}{// Doftype\_coarsen\_map\_fine and Doftype\_coarsen\_map\_coarse to the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00456}00456     \textcolor{comment}{// identity. Recall that the Doftype\_coarsen\_map\_fine maps the dof types}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00457}00457     \textcolor{comment}{// that this preconditioner requires with the most fine grain dof types (the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00458}00458     \textcolor{comment}{// internal dof types) and the Doftype\_coarsen\_map\_coarse maps the dof}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00459}00459     \textcolor{comment}{// types that this preconditioner requires with the dof types which this}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00460}00460     \textcolor{comment}{// preconditioner is given from a master preconditioner (these dof types may}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00461}00461     \textcolor{comment}{// or may not be coarsened). In the case of the master preconditioner, these}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00462}00462     \textcolor{comment}{// are the same (since dof types are not coarsened), furthermore the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00463}00463     \textcolor{comment}{// identity mapping is provided to say that dof type 0 maps to dof type 0,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00464}00464     \textcolor{comment}{// dof type 1 maps to dof type 1,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00465}00465     \textcolor{comment}{// dof type 2 maps to dof type 2,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00466}00466     \textcolor{comment}{// etc...}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00467}00467     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00468}00468     \textcolor{comment}{// If this is not a master block preconditioner, then the vectors}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00469}00469     \textcolor{comment}{// Doftype\_coarsen\_map\_fine and Doftype\_coarsen\_map\_coarse is handled}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00470}00470     \textcolor{comment}{// by the turn\_into\_subsidiary\_block\_preconditioner(...) function.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00471}00471     \textcolor{keywordflow}{if} (is\_master\_block\_preconditioner())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00472}00472     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00473}00473       \textcolor{comment}{// How many dof types does this preconditioner work with?}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00474}00474       \textcolor{keywordtype}{unsigned} n\_external\_dof\_types = dof\_to\_block\_map.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00475}00475 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00476}00476       \textcolor{comment}{// Note: at the master level, the n\_external\_dof\_types should be the same}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00477}00477       \textcolor{comment}{// as the internal\_ndof\_types(), since the dof\_to\_block\_map MUST describe}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00478}00478       \textcolor{comment}{// the mapping between every dof type (not yet coarsened -\/ so it is the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00479}00479       \textcolor{comment}{// same number as the internal dof types) to the block types. But we}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00480}00480       \textcolor{comment}{// distinguish them for clarity. We also check that this is the case.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00481}00481 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00482}00482       \textcolor{keywordtype}{unsigned} n\_internal\_dof\_types = internal\_ndof\_types();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00483}00483 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00484}00484       \textcolor{keywordflow}{if} (n\_internal\_dof\_types != n\_external\_dof\_types)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00485}00485       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00486}00486         std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00487}00487         err\_msg}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00488}00488           << \textcolor{stringliteral}{"{}The internal ndof types and the length of the dof\_to\_block\_map\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00489}00489           << \textcolor{stringliteral}{"{}vector is not the same. Since this is the master block "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00490}00490           << \textcolor{stringliteral}{"{}preconditioner,\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00491}00491           << \textcolor{stringliteral}{"{}you must describe which block each DOF type belongs to,\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00492}00492           << \textcolor{stringliteral}{"{}no more, no less."{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00493}00493           << \textcolor{stringliteral}{"{}internal\_ndof\_types = "{}} << n\_internal\_dof\_types << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00494}00494           << \textcolor{stringliteral}{"{}dof\_to\_block\_map.size() = "{}} << n\_external\_dof\_types << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00495}00495         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00496}00496           err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00497}00497       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00498}00498 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00499}00499 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00500}00500       \textcolor{comment}{// Clear and reserve space.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00501}00501       Doftype\_coarsen\_map\_fine.clear();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00502}00502       Doftype\_coarsen\_map\_coarse.clear();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00503}00503       Doftype\_coarsen\_map\_fine.reserve(n\_external\_dof\_types);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00504}00504       Doftype\_coarsen\_map\_coarse.reserve(n\_external\_dof\_types);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00505}00505 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00506}00506       \textcolor{comment}{// Now push back the identity mapping.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00507}00507       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_external\_dof\_types; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00508}00508       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00509}00509         \textcolor{comment}{// Create a vector and push it in.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00510}00510         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} tmp\_vec(1, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00511}00511         Doftype\_coarsen\_map\_fine.push\_back(tmp\_vec);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00512}00512         Doftype\_coarsen\_map\_coarse.push\_back(tmp\_vec);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00513}00513       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00514}00514     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00515}00515     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00516}00516     \textcolor{comment}{// Else this is a subsidiary block preconditioner.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00517}00517     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00518}00518       \textcolor{comment}{// Both the Doftype\_coarsen\_map\_fine and Doftype\_coarsen\_map\_coarse}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00519}00519       \textcolor{comment}{// vectors must be already be handled by the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00520}00520       \textcolor{comment}{// turn\_into\_subsidiary\_block\_preconditioner(...) function. We check this.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00521}00521 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00522}00522       \textcolor{keywordflow}{if} ((Doftype\_coarsen\_map\_fine.size() == 0) ||}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00523}00523           (Doftype\_coarsen\_map\_coarse.size() == 0))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00524}00524       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00525}00525         std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00526}00526         err\_msg << \textcolor{stringliteral}{"{}Either the Doftype\_coarsen\_map\_fine or the \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00527}00527                 << \textcolor{stringliteral}{"{}Doftype\_coarsen\_map\_coarse vectors is of size 0.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00528}00528                 << \textcolor{stringliteral}{"{}Did you remember to call the function "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00529}00529                 << \textcolor{stringliteral}{"{}turn\_into\_subsidiary\_block\_preconditioner(...)?"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00530}00530         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00531}00531           err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00532}00532       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00533}00533 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00534}00534     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00535}00535 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00536}00536 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00537}00537     \textcolor{comment}{// Now we create the vector Block\_to\_dof\_map\_coarse.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00538}00538     \textcolor{comment}{// Recall that the vector describe which dof types are in which block with}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00539}00539     \textcolor{comment}{// the relationship:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00540}00540     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00541}00541     \textcolor{comment}{// Block\_to\_dof\_map\_coarse[block\_number] = Vector[dof types];}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00542}00542     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00543}00543     \textcolor{comment}{// Note that this is not the internal (underlying) dof type.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00544}00544     \textcolor{comment}{// Nor is this in relation to the parent block preconditioner's dof type.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00545}00545     \textcolor{comment}{// The number of elements in it is the same as dof\_to\_block\_map vector.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00546}00546     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00547}00547     \textcolor{comment}{// Since the dof type coarsening feature is added later, we encapsulate this}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00548}00548     \textcolor{comment}{// bit of the code so it does not affect things below.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00549}00549     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00550}00550       \textcolor{comment}{// Check that the dof\_to\_block map "{}makes sense"{} for the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00551}00551       \textcolor{comment}{// Doftype\_coarsen\_map\_coarse.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00552}00552       \textcolor{comment}{// The Doftype\_coarsen\_map\_coarse describes which doftypes should be}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00553}00553       \textcolor{comment}{// considered as a single doftype in THIS preconditioner.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00554}00554       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00555}00555       \textcolor{comment}{// For example, if this preconditioner is the LSC block preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00556}00556       \textcolor{comment}{// applied to a 3D problem, it expects 4 doftypes:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00557}00557       \textcolor{comment}{// 3 velocity, [u, v, w] and 1 pressure [p],}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00558}00558       \textcolor{comment}{// giving us the dof type ordering}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00559}00559       \textcolor{comment}{// [u v w p].}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00560}00560       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00561}00561       \textcolor{comment}{// The LSC preconditioner groups the velocity and pressure doftypes}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00562}00562       \textcolor{comment}{// separately, thus the dof\_to\_block\_map will be:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00563}00563       \textcolor{comment}{// [0 0 0 1]}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00564}00564       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00565}00565       \textcolor{comment}{// Then the Doftype\_coarsen\_map\_coarse MUST have length 4, to identify}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00566}00566       \textcolor{comment}{// which of the OTHER (possibly coarsened) dof types should be grouped}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00567}00567       \textcolor{comment}{// together to be considered as a single dof types of THIS preconditioner.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00568}00568       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00569}00569       \textcolor{comment}{// For example, if the preconditioner above this one has the dof type}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00570}00570       \textcolor{comment}{// ordering:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00571}00571       \textcolor{comment}{// 0  1  2  3  4  5  6  7  8  9}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00572}00572       \textcolor{comment}{// ub vb wb up vp wp ut vt wt p}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00573}00573       \textcolor{comment}{// Then we want to tell THIS preconditioner which dof types belongs to}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00574}00574       \textcolor{comment}{// u, v, w and p, by providing the optional argument}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00575}00575       \textcolor{comment}{// Doftype\_coarsen\_map\_coarse to the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00576}00576       \textcolor{comment}{// turn\_into\_subsidiary\_block\_preconditioner(...) function}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00577}00577       \textcolor{comment}{// [[0 3 6] [1 4 7] [2 5 8] [9]]}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00578}00578       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00579}00579       \textcolor{comment}{// So, it is important that the length of dof\_to\_block\_map is the same as}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00580}00580       \textcolor{comment}{// the length of Doftype\_coarsen\_map\_coarse. We check this.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00581}00581       \textcolor{keywordtype}{unsigned} dof\_to\_block\_map\_size = dof\_to\_block\_map.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00582}00582 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00583}00583 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00584}00584       \textcolor{keywordflow}{if} (dof\_to\_block\_map\_size != Doftype\_coarsen\_map\_coarse.size())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00585}00585       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00586}00586         std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00587}00587         err\_msg}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00588}00588           << \textcolor{stringliteral}{"{}The size of dof\_to\_block\_map and Doftype\_coarsen\_map\_coarse is "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00589}00589              \textcolor{stringliteral}{"{}not "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00590}00590           << \textcolor{stringliteral}{"{}the same.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00591}00591           << \textcolor{stringliteral}{"{}dof\_to\_block\_map.size() = "{}} << dof\_to\_block\_map\_size << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00592}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_ab8e2478caa8370dd12462f17e1cc8082}{00592}}           << \textcolor{stringliteral}{"{}Doftype\_coarsen\_map\_coarse.size() = "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00593}00593           << Doftype\_coarsen\_map\_coarse.size() << \textcolor{stringliteral}{"{}.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00594}00594           << \textcolor{stringliteral}{"{}One of the two list is incorrect, please look at the comments\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00595}00595           << \textcolor{stringliteral}{"{}in the source code for more details."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00596}00596         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00597}00597           err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00598}00598       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00599}00599 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00600}00600 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00601}00601       \textcolor{comment}{// Create the Block\_to\_dof\_map\_coarse from}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00602}00602       \textcolor{comment}{// the dof\_to\_block\_map and Doftype\_coarsen\_map\_coarse.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00603}00603 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00604}00604       \textcolor{comment}{// find the maximum block number}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00605}00605       \textcolor{keywordtype}{unsigned} max\_block\_number =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00606}00606         *std::max\_element(dof\_to\_block\_map.begin(), dof\_to\_block\_map.end());}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00607}00607 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00608}00608       \textcolor{comment}{// Now we do the following:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00609}00609       \textcolor{comment}{// Lets say the Doftype\_coarsen\_map\_coarse is:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00610}00610       \textcolor{comment}{// [0 3 6]}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00611}00611       \textcolor{comment}{// [1 4 7]}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00612}00612       \textcolor{comment}{// [2 5 8]}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00613}00613       \textcolor{comment}{// [9]}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00614}00614       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00615}00615       \textcolor{comment}{// (this is the same as the above example)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00616}00616       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00617}00617       \textcolor{comment}{// and the dof\_to\_block\_map is [0 0 0 1].}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00618}00618       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00619}00619       \textcolor{comment}{// Then we need to form the Block\_to\_dof\_map\_coarse:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00620}00620       \textcolor{comment}{// [0 3 6 1 4 7 2 5 8]}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00621}00621       \textcolor{comment}{// [9]}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00622}00622 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00623}00623       \textcolor{comment}{// Clear anything in the Block\_to\_dof\_map\_coarse}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00624}00624       Block\_to\_dof\_map\_coarse.clear();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00625}00625 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00626}00626       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} tmp\_nblock = max\_block\_number + 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00627}00627 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00628}00628       Block\_to\_dof\_map\_coarse.resize(tmp\_nblock);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00629}00629 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00630}00630       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < dof\_to\_block\_map\_size; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00631}00631       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00632}00632         Block\_to\_dof\_map\_coarse[dof\_to\_block\_map[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]].push\_back(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00633}00633       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00634}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_ae9282acaaf19fa2cdb703d49f1a8de25}{00634}} }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00635}00635       Block\_to\_dof\_map\_fine.clear();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00636}00636       Block\_to\_dof\_map\_fine.resize(tmp\_nblock);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00637}00637       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_i = 0; block\_i < tmp\_nblock; block\_i++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00638}00638       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00639}00639         \textcolor{comment}{// get the dof types in this block.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00640}00640         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} ndof\_in\_block = Block\_to\_dof\_map\_coarse[block\_i].size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00641}00641         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_i = 0; dof\_i < ndof\_in\_block; dof\_i++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00642}00642         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00643}00643           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} coarsened\_dof\_i =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00644}00644             Block\_to\_dof\_map\_coarse[block\_i][dof\_i];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00645}00645 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00646}00646           \textcolor{comment}{// Insert the most fine grain dofs which this dof\_i corresponds to}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00647}00647           \textcolor{comment}{// into block\_i}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00648}00648           \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} dof\_i\_dofs =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00649}00649             Doftype\_coarsen\_map\_fine[coarsened\_dof\_i];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00650}00650 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00651}00651           Block\_to\_dof\_map\_fine[block\_i].insert(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00652}00652             Block\_to\_dof\_map\_fine[block\_i].end(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00653}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_af704c4816469cef4fed9d35a9ad651ec}{00653}}             dof\_i\_dofs.begin(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00654}00654             dof\_i\_dofs.end());}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00655}00655         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00656}00656       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00657}00657 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00658}00658       \textcolor{comment}{// Now set the dof\_to\_block\_map to the identify.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00659}00659       \textcolor{comment}{// NOTE: We are now using the internal n dof types. This is because the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00660}00660       \textcolor{comment}{// dof type coarsening feature was built on top of the existing block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00661}00661       \textcolor{comment}{// preconditioning framework which does not handle coarsening of dof}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00662}00662       \textcolor{comment}{// types. Hence, under the hood, it still works with the most fine grain}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00663}00663       \textcolor{comment}{// dof types and does not do any coarsening.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00664}00664 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00665}00665       \textcolor{comment}{// Locally cache the internal ndof types (using access function because}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00666}00666       \textcolor{comment}{// the Internal\_ndof\_type variable may not be set up yet if this is a}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00667}00667       \textcolor{comment}{// master preconditioner).}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00668}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a6b70b51b533002ff33a09013aa084e54}{00668}}       \textcolor{keywordtype}{unsigned} tmp\_internal\_ndof\_types = internal\_ndof\_types();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00669}00669 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00670}00670       dof\_to\_block\_map.resize(tmp\_internal\_ndof\_types, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00671}00671 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00672}00672       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < tmp\_internal\_ndof\_types; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00673}00673       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00674}00674         dof\_to\_block\_map[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00675}00675       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00676}00676     \} \textcolor{comment}{// end of Block\_to\_dof\_map\_coarse encapsulation}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00677}00677 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00678}00678 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00679}00679 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00680}00680     \textcolor{comment}{// Check that the meshes are ok. This only needs to be done in the master}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00681}00681     \textcolor{comment}{// because subsidiary preconditioners don't do anything with the meshes}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00682}00682     \textcolor{comment}{// here.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00683}00683     \textcolor{keywordflow}{if} (is\_master\_block\_preconditioner())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00684}00684     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00685}00685       \textcolor{comment}{// This is declared as local\_nmesh because there are other variables}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00686}00686       \textcolor{comment}{// called nmesh floating about... but this will not exist if PARANOID is}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00687}00687       \textcolor{comment}{// switched on.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00688}00688       \textcolor{keywordtype}{unsigned} local\_nmesh = nmesh();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00689}00689 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00690}00690       \textcolor{comment}{// Check that some mesh pointers have been assigned.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00691}00691       \textcolor{keywordflow}{if} (local\_nmesh == 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00692}00692       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00693}00693         std::ostringstream error\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00694}00694         error\_msg << \textcolor{stringliteral}{"{}Cannot setup blocks because no meshes have been set."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00695}00695         \textcolor{keywordflow}{throw} OomphLibError(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00696}00696           error\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00697}00697       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00698}00698 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00699}00699       \textcolor{comment}{// Each mesh must contain elements with the same number of dof.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00700}00700       \textcolor{comment}{// A stricter check is to ensure that the mesh contains only one type of}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00701}00701       \textcolor{comment}{// elements. This is relaxed in same cases.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00702}00702       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} mesh\_i = 0; mesh\_i < local\_nmesh; mesh\_i++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00703}00703       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00704}00704         \textcolor{comment}{// The number of elements in the current mesh.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00705}00705         \textcolor{keywordtype}{unsigned} n\_element = mesh\_pt(mesh\_i)-\/>nelement();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00706}00706 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00707}00707         \textcolor{comment}{// When the bulk mesh is distributed, there may not be any elements}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00708}00708         \textcolor{comment}{// in the surface mesh(es).}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00709}00709         \textcolor{keywordflow}{if} (n\_element > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00710}00710         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00711}00711           \textcolor{comment}{// The string of the first element in the current mesh.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00712}00712           \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} first\_element\_string =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00713}00713             \textcolor{keyword}{typeid}(*(mesh\_pt(mesh\_i)-\/>element\_pt(0))).name();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00714}00714 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00715}00715           \textcolor{comment}{// If there are multiple element types in the current mesh,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00716}00716           \textcolor{comment}{// we can at least make sure that they contain the same types of DOFs.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00717}00717           \textcolor{keywordflow}{if} (\textcolor{keywordtype}{bool}(Allow\_multiple\_element\_type\_in\_mesh[mesh\_i]))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00718}00718           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00719}00719             \textcolor{comment}{// The ndof types of the first element.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00720}00720             \textcolor{keywordtype}{unsigned} first\_element\_ndof\_type =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00721}00721               mesh\_pt(mesh\_i)-\/>element\_pt(0)-\/>ndof\_types();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00722}00722 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00723}00723             \textcolor{comment}{// Loop through the meshes and compare the number of types of DOFs.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00724}00724             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} el\_i = 1; el\_i < n\_element; el\_i++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00725}00725             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00726}00726               \textcolor{comment}{// The ndof type of the current element.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00727}00727               \textcolor{keywordtype}{unsigned} current\_element\_ndof\_type =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00728}00728                 mesh\_pt(mesh\_i)-\/>element\_pt(el\_i)-\/>ndof\_types();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00729}00729 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00730}00730               \textcolor{comment}{// The string of the current element.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00731}00731               \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} current\_element\_string =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00732}00732                 \textcolor{keyword}{typeid}(*(mesh\_pt(mesh\_i)-\/>element\_pt(el\_i))).name();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00733}00733 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00734}00734               \textcolor{comment}{// Compare against the first element.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00735}00735               \textcolor{keywordflow}{if} (current\_element\_ndof\_type != first\_element\_ndof\_type)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00736}00736               \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00737}00737                 std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00738}00738                 error\_message}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00739}00739                   << \textcolor{stringliteral}{"{}Elements in the same mesh MUST have the same number of "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00740}00740                      \textcolor{stringliteral}{"{}types "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00741}00741                   << \textcolor{stringliteral}{"{}of DOFs.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00742}00742                   << \textcolor{stringliteral}{"{}The element in mesh "{}} << mesh\_i << \textcolor{stringliteral}{"{}, at position "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00743}00743                   << el\_i << \textcolor{stringliteral}{"{} is: \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00744}00744                   << current\_element\_string << \textcolor{stringliteral}{"{}, \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00745}00745                   << \textcolor{stringliteral}{"{}with ndof types: "{}} << current\_element\_ndof\_type << \textcolor{stringliteral}{"{}.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00746}00746                   << \textcolor{stringliteral}{"{}The first element in the same mesh is: \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00747}00747                   << first\_element\_string << \textcolor{stringliteral}{"{}, \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00748}00748                   << \textcolor{stringliteral}{"{}with ndof types: "{}} << first\_element\_ndof\_type << \textcolor{stringliteral}{"{}.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00749}00749                 \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00750}00750                                     OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00751}00751                                     OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00752}00752               \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00753}00753             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00754}00754           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00755}00755           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00756}00756           \textcolor{comment}{// There should be only one type of elements in the current mesh.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00757}00757           \textcolor{comment}{// Check that this is the case!}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00758}00758           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00759}00759             \textcolor{comment}{// Loop through the elements in the current mesh.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00760}00760             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} el\_i = 1; el\_i < n\_element; el\_i++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00761}00761             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00762}00762               \textcolor{comment}{// The string of the current element.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00763}00763               \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} current\_element\_string =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00764}00764                 \textcolor{keyword}{typeid}(*(mesh\_pt(mesh\_i)-\/>element\_pt(el\_i))).name();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00765}00765 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00766}00766               \textcolor{comment}{// Compare against the first element.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00767}00767               \textcolor{keywordflow}{if} (current\_element\_string.compare(first\_element\_string) != 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00768}00768               \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00769}00769                 std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00770}00770                 error\_message}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00771}00771                   << \textcolor{stringliteral}{"{}By default, a mesh containing block preconditionable "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00772}00772                   << \textcolor{stringliteral}{"{}elements must contain only one type of element.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00773}00773                   << \textcolor{stringliteral}{"{}The element in mesh "{}} << mesh\_i << \textcolor{stringliteral}{"{}, at position "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00774}00774                   << el\_i << \textcolor{stringliteral}{"{} is: \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00775}00775                   << current\_element\_string << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00776}00776                   << \textcolor{stringliteral}{"{}The first element in the same mesh is: \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00777}00777                   << first\_element\_string << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00778}00778                   << \textcolor{stringliteral}{"{}If this is correct, consider calling the set\_mesh(...) "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00779}00779                      \textcolor{stringliteral}{"{}with\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00780}00780                   << \textcolor{stringliteral}{"{}the optional argument set true to allow multiple "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00781}00781                      \textcolor{stringliteral}{"{}element\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00782}00782                   << \textcolor{stringliteral}{"{}types in the same mesh.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00783}00783                   << \textcolor{stringliteral}{"{}Note: A minimal requirement is that the elements in the "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00784}00784                      \textcolor{stringliteral}{"{}same\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00785}00785                   << \textcolor{stringliteral}{"{}mesh MUST have the same number of DOF types."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00786}00786                 \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00787}00787                                     OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00788}00788                                     OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00789}00789               \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00790}00790             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00791}00791           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00792}00792         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00793}00793       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00794}00794     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00795}00795 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00796}00796 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00797}00797     \textcolor{comment}{// clear the memory}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00798}00798     this-\/>clear\_block\_preconditioner\_base();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00799}00799 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00800}00800     \textcolor{comment}{// get my\_rank and nproc}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00801}00801 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00802}00802     \textcolor{keywordtype}{unsigned} my\_rank = comm\_pt()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00803}00803     \textcolor{keywordtype}{unsigned} nproc = comm\_pt()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00804}00804 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00805}00805 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00806}00806 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00807}00807 \textcolor{comment}{    /// //////////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00808}00808 \textcolor{comment}{}    \textcolor{comment}{// start of master block preconditioner only operations}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00809}00809 \textcolor{comment}{    /// //////////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00810}00810 \textcolor{comment}{}\textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00811}00811     \textcolor{keywordtype}{unsigned}* nreq\_sparse = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}[nproc]();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00812}00812     \textcolor{keywordtype}{unsigned}* nreq\_sparse\_for\_proc = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}[nproc]();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00813}00813     \textcolor{keywordtype}{unsigned}** index\_in\_dof\_block\_sparse\_send = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}*[nproc]();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00814}00814     \textcolor{keywordtype}{unsigned}** dof\_number\_sparse\_send = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}*[nproc]();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00815}00815     Vector<MPI\_Request> send\_requests\_sparse;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00816}00816     Vector<MPI\_Request> recv\_requests\_sparse;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00817}00817 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00818}00818 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00819}00819     \textcolor{comment}{// If this preconditioner is the master preconditioner then we need}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00820}00820     \textcolor{comment}{// to assemble the vectors : Dof\_number}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00821}00821     \textcolor{comment}{//                           Index\_in\_dof\_block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00822}00822     \textcolor{keywordflow}{if} (is\_master\_block\_preconditioner())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00823}00823     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00824}00824       \textcolor{comment}{// Get the number of dof types in each mesh.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00825}00825       Ndof\_types\_in\_mesh.assign(nmesh(), 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00826}00826       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nmesh(); \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00827}00827       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00828}00828         Ndof\_types\_in\_mesh[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = mesh\_pt(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>ndof\_types();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00829}00829       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00830}00830       \textcolor{comment}{// Setup the distribution of this preconditioner, assumed to be the same}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00831}00831       \textcolor{comment}{// as the matrix if the matrix is distributable.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00832}00832       \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}DistributableLinearAlgebraObject*\textcolor{keyword}{>}(matrix\_pt()))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00833}00833       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00834}00834         this-\/>build\_distribution(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00835}00835           \textcolor{keyword}{dynamic\_cast<}DistributableLinearAlgebraObject*\textcolor{keyword}{>}(matrix\_pt())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00836}00836             -\/>distribution\_pt());}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00837}00837       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00838}00838       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00839}00839       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00840}00840         LinearAlgebraDistribution dist(comm\_pt(), matrix\_pt()-\/>nrow(), \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00841}00841         this-\/>build\_distribution(dist);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00842}00842       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00843}00843       Nrow = matrix\_pt()-\/>nrow();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00844}00844 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00845}00845       \textcolor{comment}{// Boolean to indicate whether the matrix is actually distributed,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00846}00846       \textcolor{comment}{// ie distributed and on more than one processor.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00847}00847       \textcolor{keywordtype}{bool} matrix\_distributed =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00848}00848         (this-\/>distribution\_pt()-\/>distributed() \&\&}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00849}00849          this-\/>distribution\_pt()-\/>communicator\_pt()-\/>nproc() > 1);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00850}00850 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00851}00851 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00852}00852       \textcolor{comment}{// Matrix must be a CR matrix.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00853}00853       CRDoubleMatrix* cr\_matrix\_pt = \textcolor{keyword}{dynamic\_cast<}CRDoubleMatrix*\textcolor{keyword}{>}(matrix\_pt());}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00854}00854 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00855}00855       \textcolor{keywordflow}{if} (cr\_matrix\_pt == 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00856}00856       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00857}00857         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00858}00858         error\_message << \textcolor{stringliteral}{"{}Block setup for distributed matrices only works "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00859}00859                       << \textcolor{stringliteral}{"{}for CRDoubleMatrices"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00860}00860         \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00861}00861                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00862}00862                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00863}00863       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00864}00864 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00865}00865 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00866}00866       \textcolor{comment}{// Get distribution.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00867}00867       \textcolor{keywordtype}{unsigned} first\_row = this-\/>distribution\_pt()-\/>first\_row();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00868}00868       \textcolor{keywordtype}{unsigned} nrow\_local = this-\/>distribution\_pt()-\/>nrow\_local();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00869}00869       \textcolor{keywordtype}{unsigned} last\_row = first\_row + nrow\_local -\/ 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00870}00870 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00871}00871 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00872}00872       \textcolor{comment}{// storage for the rows required by each processor in the dense}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00873}00873       \textcolor{comment}{// block lookup storage scheme}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00874}00874       \textcolor{comment}{// dense\_required\_rows(p,0) is the minimum global index required by proc p}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00875}00875       \textcolor{comment}{//                 ...(p,1) is the maximum global index required by proc p}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00876}00876       DenseMatrix<unsigned> dense\_required\_rows(nproc, 2);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00877}00877       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00878}00878       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00879}00879         dense\_required\_rows(p, 0) = this-\/>distribution\_pt()-\/>first\_row(p);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00880}00880         dense\_required\_rows(p, 1) = this-\/>distribution\_pt()-\/>first\_row(p) +}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00881}00881                                     this-\/>distribution\_pt()-\/>nrow\_local(p) -\/ 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00882}00882       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00883}00883 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00884}00884       \textcolor{comment}{// determine the global rows That are not in the range first\_row to}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00885}00885       \textcolor{comment}{// first\_row+nrow\_local for which we should store the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00886}00886       \textcolor{comment}{// Dof\_index and Index\_in\_dof\_block for}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00887}00887       \textcolor{comment}{// then send the lists to other processors}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00888}00888       std::set<unsigned> sparse\_global\_rows\_for\_block\_lookup;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00889}00889       \textcolor{keywordflow}{if} (matrix\_distributed)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00890}00890       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00891}00891         \textcolor{keywordtype}{unsigned} nnz = cr\_matrix\_pt-\/>nnz();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00892}00892         \textcolor{keywordtype}{int}* column\_index = cr\_matrix\_pt-\/>column\_index();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00893}00893         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nnz; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00894}00894         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00895}00895           \textcolor{keywordtype}{unsigned} ci = column\_index[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00896}00896           \textcolor{keywordflow}{if} (ci < first\_row || ci > last\_row)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00897}00897           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00898}00898             sparse\_global\_rows\_for\_block\_lookup.insert(ci);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00899}00899           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00900}00900         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00901}00901       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00902}00902 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00903}00903       \textcolor{keywordtype}{int} nsparse = sparse\_global\_rows\_for\_block\_lookup.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00904}00904 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00905}00905       Global\_index\_sparse.resize(0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00906}00906       std::copy(sparse\_global\_rows\_for\_block\_lookup.begin(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00907}00907                 sparse\_global\_rows\_for\_block\_lookup.end(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00908}00908                 std::back\_inserter(Global\_index\_sparse));}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00909}00909 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00910}00910       Index\_in\_dof\_block\_sparse.resize(nsparse);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00911}00911       Dof\_number\_sparse.resize(nsparse);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00912}00912       sparse\_global\_rows\_for\_block\_lookup.clear();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00913}00913 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00914}00914       Vector<MPI\_Request> recv\_requests\_sparse\_nreq;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00915}00915       \textcolor{keywordflow}{if} (matrix\_distributed)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00916}00916       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00917}00917         MPI\_Aint base\_displacement\_sparse;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00918}00918         MPI\_Get\_address(nreq\_sparse, \&base\_displacement\_sparse);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00919}00919 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00920}00920         \textcolor{keywordtype}{int} zero = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00921}00921         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00922}00922         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00923}00923           \textcolor{comment}{// determine the global eqn numbers required by this processor}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00924}00924           \textcolor{comment}{// that can be classified by processor p}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00925}00925           \textcolor{keywordtype}{int} begin = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00926}00926           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nsparse; ++\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00927}00927           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00928}00928             \textcolor{keywordflow}{if} (Global\_index\_sparse[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] < dense\_required\_rows(p, 0))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00929}00929             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00930}00930               ++begin;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00931}00931             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00932}00932             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00933}00933             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00934}00934               \textcolor{keywordflow}{if} (Global\_index\_sparse[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] <= dense\_required\_rows(p, 1))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00935}00935               \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00936}00936                 ++nreq\_sparse[p];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00937}00937               \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00938}00938               \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00939}00939               \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00940}00940                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00941}00941               \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00942}00942             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00943}00943           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00944}00944 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00945}00945           \textcolor{comment}{// if this processor has rows to be classified by proc p}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00946}00946           \textcolor{keywordflow}{if} (nreq\_sparse[p] > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00947}00947           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00948}00948             \textcolor{comment}{// send the number of global eqn numbers}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00949}00949             MPI\_Request req1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00950}00950             MPI\_Isend(\&nreq\_sparse[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00951}00951                       1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00952}00952                       MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00953}00953                       p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00954}00954                       31,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00955}00955                       comm\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00956}00956                       \&req1);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00957}00957             send\_requests\_sparse.push\_back(req1);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00958}00958 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00959}00959             \textcolor{comment}{// send the global eqn numbers}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00960}00960             MPI\_Request req2;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00961}00961             MPI\_Isend(\&Global\_index\_sparse[begin],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00962}00962                       nreq\_sparse[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00963}00963                       MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00964}00964                       p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00965}00965                       32,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00966}00966                       comm\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00967}00967                       \&req2);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00968}00968             send\_requests\_sparse.push\_back(req2);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00969}00969 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00970}00970             \textcolor{comment}{// post the recvs for the data that will be returned}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00971}00971 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00972}00972             \textcolor{comment}{// the datatypes, displacements, lengths for the two datatypes}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00973}00973             MPI\_Datatype types[2];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00974}00974             MPI\_Aint displacements[2];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00975}00975             \textcolor{keywordtype}{int} lengths[2];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00976}00976 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00977}00977             \textcolor{comment}{// index in dof block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00978}00978             MPI\_Type\_contiguous(nreq\_sparse[p], MPI\_UNSIGNED, \&types[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00979}00979             MPI\_Type\_commit(\&types[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00980}00980             MPI\_Get\_address(\&Index\_in\_dof\_block\_sparse[begin],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00981}00981                             \&displacements[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00982}00982             displacements[0] -\/= base\_displacement\_sparse;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00983}00983             lengths[0] = 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00984}00984 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00985}00985             \textcolor{comment}{// dof number}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00986}00986             MPI\_Type\_contiguous(nreq\_sparse[p], MPI\_UNSIGNED, \&types[1]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00987}00987             MPI\_Type\_commit(\&types[1]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00988}00988             MPI\_Get\_address(\&Dof\_number\_sparse[begin], \&displacements[1]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00989}00989             displacements[1] -\/= base\_displacement\_sparse;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00990}00990             lengths[1] = 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00991}00991 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00992}00992             \textcolor{comment}{// build the final type}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00993}00993             MPI\_Datatype recv\_type;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00994}00994             MPI\_Type\_create\_struct(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00995}00995               2, lengths, displacements, types, \&recv\_type);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00996}00996             MPI\_Type\_commit(\&recv\_type);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00997}00997             MPI\_Type\_free(\&types[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00998}00998             MPI\_Type\_free(\&types[1]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l00999}00999 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01000}01000             \textcolor{comment}{// and recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01001}01001             MPI\_Request req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01002}01002             MPI\_Irecv(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01003}01003               nreq\_sparse, 1, recv\_type, p, 33, comm\_pt()-\/>mpi\_comm(), \&req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01004}01004             recv\_requests\_sparse.push\_back(req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01005}01005             MPI\_Type\_free(\&recv\_type);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01006}01006           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01007}01007 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01008}01008           \textcolor{comment}{// if no communication required, confirm this}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01009}01009           \textcolor{keywordflow}{if} (nreq\_sparse[p] == 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01010}01010           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01011}01011             MPI\_Request req1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01012}01012             MPI\_Isend(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01013}01013               \&zero, 1, MPI\_UNSIGNED, p, 31, comm\_pt()-\/>mpi\_comm(), \&req1);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01014}01014             send\_requests\_sparse.push\_back(req1);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01015}01015           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01016}01016 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01017}01017           \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01018}01018           MPI\_Request req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01019}01019           MPI\_Irecv(\&nreq\_sparse\_for\_proc[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01020}01020                     1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01021}01021                     MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01022}01022                     p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01023}01023                     31,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01024}01024                     comm\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01025}01025                     \&req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01026}01026           recv\_requests\_sparse\_nreq.push\_back(req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01027}01027         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01028}01028       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01029}01029 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01030}01030 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01031}01031       \textcolor{comment}{// resize the storage}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01032}01032       Dof\_number\_dense.resize(nrow\_local);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01033}01033       Index\_in\_dof\_block\_dense.resize(nrow\_local);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01034}01034 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01035}01035       \textcolor{comment}{// zero the number of dof types}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01036}01036       Internal\_ndof\_types = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01037}01037 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01038}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a69fa79db7073f39a1ac5333c8bd9c1d5}{01038}} \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01039}01039       \textcolor{comment}{// Vector to keep track of previously assigned block numbers}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01040}01040       \textcolor{comment}{// to check consistency between multiple assignments.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01041}01041       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} previously\_assigned\_block\_number(nrow\_local,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01042}01042                                                    \mbox{\hyperlink{classoomph_1_1Data_ac56011da9a923069793ecc3cb54f5e20}{Data::Is\_unclassified}});}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01043}01043 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01044}01044 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01045}01045       \textcolor{comment}{// determine whether the problem is distribution}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01046}01046       \textcolor{keywordtype}{bool} problem\_distributed = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01047}01047 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01048}01048       \textcolor{comment}{// the problem method distributed() is only accessible with MPI}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01049}01049 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01050}01050       problem\_distributed = any\_mesh\_distributed();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01051}01051 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01052}01052 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01053}01053       \textcolor{comment}{// if the problem is not distributed}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01054}01054       \textcolor{keywordflow}{if} (!problem\_distributed)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01055}01055       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01056}01056         \textcolor{comment}{// Offset for the block type in the overall system.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01057}01057         \textcolor{comment}{// Different meshes contain different block-\/preconditionable}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01058}01058         \textcolor{comment}{// elements -\/-\/ their blocks are added one after the other.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01059}01059         \textcolor{keywordtype}{unsigned} dof\_offset = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01060}01060 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01061}01061         \textcolor{comment}{// Loop over all meshes.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01062}01062         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < nmesh(); m++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01063}01063         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01064}01064           \textcolor{comment}{// Number of elements in this mesh.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01065}01065           \textcolor{keywordtype}{unsigned} n\_element = mesh\_pt(m)-\/>nelement();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01066}01066 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01067}01067           \textcolor{comment}{// Find the number of block types that the elements in this mesh}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01068}01068           \textcolor{comment}{// are in charge of.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01069}01069           \textcolor{keywordtype}{unsigned} ndof\_in\_element = ndof\_types\_in\_mesh(m);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01070}01070           Internal\_ndof\_types += ndof\_in\_element;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01071}01071 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01072}01072           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01073}01073           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01074}01074             \textcolor{comment}{// List containing pairs of global equation number and}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01075}01075             \textcolor{comment}{// dof number for each global dof in an element.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01076}01076             std::list<std::pair<unsigned long, unsigned>> dof\_lookup\_list;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01077}01077 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01078}01078             \textcolor{comment}{// Get list of blocks associated with the element's global unknowns.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01079}01079             mesh\_pt(m)-\/>element\_pt(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}})-\/>get\_dof\_numbers\_for\_unknowns(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01080}01080               dof\_lookup\_list);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01081}01081 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01082}01082             \textcolor{comment}{// Loop over all entries in the list}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01083}01083             \textcolor{comment}{// and store the block number.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01084}01084             \textcolor{keyword}{typedef} std::list<std::pair<unsigned long, unsigned>>::iterator IT;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01085}01085             \textcolor{keywordflow}{for} (IT it = dof\_lookup\_list.begin(); it != dof\_lookup\_list.end();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01086}01086                  it++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01087}01087             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01088}01088               \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} global\_dof = it-\/>first;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01089}01089               \textcolor{keywordflow}{if} (global\_dof >= \textcolor{keywordtype}{unsigned}(first\_row) \&\&}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01090}01090                   global\_dof <= \textcolor{keywordtype}{unsigned}(last\_row))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01091}01091               \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01092}01092                 \textcolor{keywordtype}{unsigned} dof\_number = (it-\/>second) + dof\_offset;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01093}01093                 Dof\_number\_dense[global\_dof -\/ first\_row] = dof\_number;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01094}01094 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01095}01095 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01096}01096                 \textcolor{comment}{// Check consistency of block numbers if assigned multiple times}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01097}01097                 \textcolor{keywordflow}{if} (previously\_assigned\_block\_number[global\_dof -\/ first\_row] <}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01098}01098                     0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01099}01099                 \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01100}01100                   previously\_assigned\_block\_number[global\_dof -\/ first\_row] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01101}01101                     dof\_number;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01102}01102                 \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01103}01103 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01104}01104               \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01105}01105             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01106}01106           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01107}01107 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01108}01108           \textcolor{comment}{// About to do the next mesh which contains block preconditionable}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01109}01109           \textcolor{comment}{// elements of a different type; all the dofs that these elements are}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01110}01110           \textcolor{comment}{// "{}in charge of"{} differ from the ones considered so far.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01111}01111           \textcolor{comment}{// Bump up the block counter to make sure we're not overwriting}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01112}01112           \textcolor{comment}{// anything here}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01113}01113           dof\_offset += ndof\_in\_element;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01114}01114         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01115}01115 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01116}01116 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01117}01117         \textcolor{comment}{// check that every global equation number has been allocated a dof type}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01118}01118         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nrow\_local; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01119}01119         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01120}01120           \textcolor{keywordflow}{if} (previously\_assigned\_block\_number[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] < 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01121}01121           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01122}01122             std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01123}01123             error\_message << \textcolor{stringliteral}{"{}Not all degrees of freedom have had DOF type "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01124}01124                           << \textcolor{stringliteral}{"{}numbers allocated. Dof number "{}} << \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01125}01125                           << \textcolor{stringliteral}{"{} is unallocated."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01126}01126             \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01127}01127                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01128}01128                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01129}01129           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01130}01130         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01131}01131 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01132}01132       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01133}01133       \textcolor{comment}{// else the problem is distributed}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01134}01134       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01135}01135       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01136}01136 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01137}01137         \textcolor{comment}{// Offset for the block type in the overall system.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01138}01138         \textcolor{comment}{// Different meshes contain different block-\/preconditionable}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01139}01139         \textcolor{comment}{// elements -\/-\/ their blocks are added one after the other...}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01140}01140         \textcolor{keywordtype}{unsigned} dof\_offset = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01141}01141 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01142}01142         \textcolor{comment}{// the set of global degrees of freedom and their corresponding dof}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01143}01143         \textcolor{comment}{// number on this processor}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01144}01144         std::map<unsigned long, unsigned> my\_dof\_map;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01145}01145 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01146}01146         \textcolor{comment}{// Loop over all meshes}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01147}01147         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < nmesh(); m++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01148}01148         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01149}01149           \textcolor{comment}{// Number of elements in this mesh}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01150}01150           \textcolor{keywordtype}{unsigned} n\_element = this-\/>mesh\_pt(m)-\/>nelement();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01151}01151 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01152}01152           \textcolor{comment}{// Find the number of block types that the elements in this mesh}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01153}01153           \textcolor{comment}{// are in charge of}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01154}01154           \textcolor{keywordtype}{unsigned} ndof\_in\_element = ndof\_types\_in\_mesh(m);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01155}01155           Internal\_ndof\_types += ndof\_in\_element;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01156}01156 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01157}01157           \textcolor{comment}{// Loop over all elements}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01158}01158           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01159}01159           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01160}01160             \textcolor{comment}{// if the element is not a halo element}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01161}01161             \textcolor{keywordflow}{if} (!this-\/>mesh\_pt(m)-\/>element\_pt(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}})-\/>is\_halo())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01162}01162             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01163}01163               \textcolor{comment}{// List containing pairs of global equation number and}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01164}01164               \textcolor{comment}{// dof number for each global dof in an element}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01165}01165               std::list<std::pair<unsigned long, unsigned>> dof\_lookup\_list;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01166}01166 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01167}01167               \textcolor{comment}{// Get list of blocks associated with the element's global}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01168}01168               \textcolor{comment}{// unknowns}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01169}01169               this-\/>mesh\_pt(m)-\/>element\_pt(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}})-\/>get\_dof\_numbers\_for\_unknowns(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01170}01170                 dof\_lookup\_list);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01171}01171 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01172}01172               \textcolor{comment}{// update the block numbers and put it in the map.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01173}01173               \textcolor{keyword}{typedef} std::list<std::pair<unsigned long, unsigned>>::iterator}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01174}01174                 IT;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01175}01175               \textcolor{keywordflow}{for} (IT it = dof\_lookup\_list.begin(); it != dof\_lookup\_list.end();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01176}01176                    it++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01177}01177               \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01178}01178                 it-\/>second = (it-\/>second) + dof\_offset;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01179}01179                 my\_dof\_map[it-\/>first] = it-\/>second;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01180}01180               \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01181}01181             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01182}01182           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01183}01183 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01184}01184           \textcolor{comment}{// About to do the next mesh which contains block preconditionable}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01185}01185           \textcolor{comment}{// elements of a different type; all the dofs that these elements are}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01186}01186           \textcolor{comment}{// "{}in charge of"{} differ from the ones considered so far.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01187}01187           \textcolor{comment}{// Bump up the block counter to make sure we're not overwriting}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01188}01188           \textcolor{comment}{// anything here}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01189}01189           dof\_offset += ndof\_in\_element;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01190}01190         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01191}01191 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01192}01192         \textcolor{comment}{// next copy the map of my dofs to two vectors to send}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01193}01193         \textcolor{keywordtype}{unsigned} my\_ndof = my\_dof\_map.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01194}01194         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long}* my\_global\_dofs = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long}[my\_ndof];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01195}01195         \textcolor{keywordtype}{unsigned}* my\_dof\_numbers = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}[my\_ndof];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01196}01196         \textcolor{keyword}{typedef} std::map<unsigned long, unsigned>::iterator IT;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01197}01197         \textcolor{keywordtype}{unsigned} pt = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01198}01198         \textcolor{keywordflow}{for} (IT it = my\_dof\_map.begin(); it != my\_dof\_map.end(); it++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01199}01199         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01200}01200           my\_global\_dofs[pt] = it-\/>first;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01201}01201           my\_dof\_numbers[pt] = it-\/>second;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01202}01202           pt++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01203}01203         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01204}01204 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01205}01205         \textcolor{comment}{// and then clear the map}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01206}01206         my\_dof\_map.clear();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01207}01207 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01208}01208         \textcolor{comment}{// count up how many DOFs need to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01209}01209         \textcolor{keywordtype}{int}* first\_dof\_to\_send = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nproc];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01210}01210         \textcolor{keywordtype}{int}* ndof\_to\_send = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nproc];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01211}01211         \textcolor{keywordtype}{unsigned} ptr = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01212}01212         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01213}01213         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01214}01214           first\_dof\_to\_send[p] = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01215}01215           ndof\_to\_send[p] = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01216}01216           \textcolor{keywordflow}{while} (ptr < my\_ndof \&\&}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01217}01217                  my\_global\_dofs[ptr] < dense\_required\_rows(p, 0))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01218}01218           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01219}01219             ptr++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01220}01220           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01221}01221           first\_dof\_to\_send[p] = ptr;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01222}01222           \textcolor{keywordflow}{while} (ptr < my\_ndof \&\&}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01223}01223                  my\_global\_dofs[ptr] <= dense\_required\_rows(p, 1))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01224}01224           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01225}01225             ndof\_to\_send[p]++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01226}01226             ptr++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01227}01227           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01228}01228         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01229}01229 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01230}01230         \textcolor{comment}{// next communicate to each processor how many dofs it expects to recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01231}01231         \textcolor{keywordtype}{int}* ndof\_to\_recv = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nproc];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01232}01232         MPI\_Alltoall(ndof\_to\_send,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01233}01233                      1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01234}01234                      MPI\_INT,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01235}01235                      ndof\_to\_recv,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01236}01236                      1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01237}01237                      MPI\_INT,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01238}01238                      comm\_pt()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01239}01239 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01240}01240         \textcolor{comment}{// the base displacements for the sends}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01241}01241         MPI\_Aint base\_displacement;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01242}01242         MPI\_Get\_address(my\_global\_dofs, \&base\_displacement);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01243}01243 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01244}01244 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01245}01245         \textcolor{comment}{// storage for paranoid check to ensure that every row as been}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01246}01246         \textcolor{comment}{// imported}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01247}01247         std::vector<bool> dof\_recv(nrow\_local, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01248}01248 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01249}01249 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01250}01250         \textcolor{comment}{// next send and recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01251}01251         Vector<MPI\_Request> send\_requests;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01252}01252         Vector<MPI\_Request> recv\_requests;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01253}01253         Vector<unsigned long*> global\_dofs\_recv(nproc, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01254}01254         Vector<unsigned*> dof\_numbers\_recv(nproc, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01255}01255         Vector<unsigned> proc;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01256}01256         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01257}01257         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01258}01258           \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01259}01259           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01260}01260             \textcolor{comment}{// send}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01261}01261             \textcolor{keywordflow}{if} (ndof\_to\_send[p] > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01262}01262             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01263}01263               \textcolor{comment}{// the datatypes, displacements, lengths for the two datatypes}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01264}01264               MPI\_Datatype types[2];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01265}01265               MPI\_Aint displacements[2];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01266}01266               \textcolor{keywordtype}{int} lengths[2];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01267}01267 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01268}01268               \textcolor{comment}{// my global dofs}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01269}01269               MPI\_Type\_contiguous(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01270}01270                 ndof\_to\_send[p], MPI\_UNSIGNED\_LONG, \&types[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01271}01271               MPI\_Type\_commit(\&types[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01272}01272               MPI\_Get\_address(my\_global\_dofs + first\_dof\_to\_send[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01273}01273                               \&displacements[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01274}01274               displacements[0] -\/= base\_displacement;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01275}01275               lengths[0] = 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01276}01276 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01277}01277               \textcolor{comment}{// my dof numbers}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01278}01278               MPI\_Type\_contiguous(ndof\_to\_send[p], MPI\_UNSIGNED, \&types[1]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01279}01279               MPI\_Type\_commit(\&types[1]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01280}01280               MPI\_Get\_address(my\_dof\_numbers + first\_dof\_to\_send[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01281}01281                               \&displacements[1]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01282}01282               displacements[1] -\/= base\_displacement;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01283}01283               lengths[1] = 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01284}01284 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01285}01285               \textcolor{comment}{// build the final type}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01286}01286               MPI\_Datatype send\_type;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01287}01287               MPI\_Type\_create\_struct(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01288}01288                 2, lengths, displacements, types, \&send\_type);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01289}01289               MPI\_Type\_commit(\&send\_type);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01290}01290               MPI\_Type\_free(\&types[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01291}01291               MPI\_Type\_free(\&types[1]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01292}01292 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01293}01293               \textcolor{comment}{// and send}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01294}01294               MPI\_Request req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01295}01295               MPI\_Isend(my\_global\_dofs,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01296}01296                         1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01297}01297                         send\_type,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01298}01298                         p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01299}01299                         2,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01300}01300                         comm\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01301}01301                         \&req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01302}01302               send\_requests.push\_back(req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01303}01303               MPI\_Type\_free(\&send\_type);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01304}01304             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01305}01305 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01306}01306             \textcolor{comment}{// and recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01307}01307             \textcolor{keywordflow}{if} (ndof\_to\_recv[p] > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01308}01308             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01309}01309               \textcolor{comment}{// resize the storage}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01310}01310               global\_dofs\_recv[p] = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long}[ndof\_to\_recv[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01311}01311               dof\_numbers\_recv[p] = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}[ndof\_to\_recv[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01312}01312               proc.push\_back(p);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01313}01313 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01314}01314               \textcolor{comment}{// the datatypes, displacements, lengths for the two datatypes}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01315}01315               MPI\_Datatype types[2];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01316}01316               MPI\_Aint displacements[2];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01317}01317               \textcolor{keywordtype}{int} lengths[2];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01318}01318 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01319}01319               \textcolor{comment}{// my global dofs}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01320}01320               MPI\_Type\_contiguous(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01321}01321                 ndof\_to\_recv[p], MPI\_UNSIGNED\_LONG, \&types[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01322}01322               MPI\_Type\_commit(\&types[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01323}01323               MPI\_Get\_address(global\_dofs\_recv[p], \&displacements[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01324}01324               displacements[0] -\/= base\_displacement;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01325}01325               lengths[0] = 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01326}01326 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01327}01327               \textcolor{comment}{// my dof numbers}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01328}01328               MPI\_Type\_contiguous(ndof\_to\_recv[p], MPI\_UNSIGNED, \&types[1]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01329}01329               MPI\_Type\_commit(\&types[1]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01330}01330               MPI\_Get\_address(dof\_numbers\_recv[p], \&displacements[1]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01331}01331               displacements[1] -\/= base\_displacement;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01332}01332               lengths[1] = 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01333}01333 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01334}01334               \textcolor{comment}{// build the final type}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01335}01335               MPI\_Datatype recv\_type;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01336}01336               MPI\_Type\_create\_struct(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01337}01337                 2, lengths, displacements, types, \&recv\_type);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01338}01338               MPI\_Type\_commit(\&recv\_type);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01339}01339               MPI\_Type\_free(\&types[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01340}01340               MPI\_Type\_free(\&types[1]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01341}01341 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01342}01342               \textcolor{comment}{// and recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01343}01343               MPI\_Request req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01344}01344               MPI\_Irecv(my\_global\_dofs,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01345}01345                         1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01346}01346                         recv\_type,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01347}01347                         p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01348}01348                         2,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01349}01349                         comm\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01350}01350                         \&req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01351}01351               recv\_requests.push\_back(req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01352}01352               MPI\_Type\_free(\&recv\_type);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01353}01353             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01354}01354           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01355}01355           \textcolor{comment}{// send to self}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01356}01356           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01357}01357           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01358}01358             \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{namespaceoomph_ac0ed65f6db53d9ad737e1d2a69767d25}{u}} = first\_dof\_to\_send[p] + ndof\_to\_recv[p];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01359}01359             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = first\_dof\_to\_send[p]; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < \mbox{\hyperlink{namespaceoomph_ac0ed65f6db53d9ad737e1d2a69767d25}{u}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01360}01360             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01361}01361 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01362}01362               \textcolor{comment}{// indicate that this dof has ben recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01363}01363               dof\_recv[my\_global\_dofs[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] -\/ first\_row] = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01364}01364 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01365}01365               Dof\_number\_dense[my\_global\_dofs[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] -\/ first\_row] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01366}01366                 my\_dof\_numbers[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01367}01367             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01368}01368           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01369}01369         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01370}01370 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01371}01371         \textcolor{comment}{// recv and store the data}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01372}01372         \textcolor{keywordtype}{unsigned} c\_recv = recv\_requests.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01373}01373         \textcolor{keywordflow}{while} (c\_recv > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01374}01374         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01375}01375           \textcolor{comment}{// wait for any communication to finish}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01376}01376           \textcolor{keywordtype}{int} req\_number;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01377}01377           MPI\_Waitany(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01378}01378             c\_recv, \&recv\_requests[0], \&req\_number, MPI\_STATUS\_IGNORE);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01379}01379           recv\_requests.erase(recv\_requests.begin() + req\_number);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01380}01380           c\_recv-\/-\/;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01381}01381 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01382}01382           \textcolor{comment}{// determine the source processor}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01383}01383           \textcolor{keywordtype}{unsigned} p = proc[req\_number];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01384}01384           proc.erase(proc.begin() + req\_number);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01385}01385 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01386}01386           \textcolor{comment}{// import the data}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01387}01387           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < ndof\_to\_recv[p]; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01388}01388           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01389}01389 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01390}01390             \textcolor{comment}{// indicate that this dof has ben recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01391}01391             dof\_recv[global\_dofs\_recv[p][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] -\/ first\_row] = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01392}01392 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01393}01393             Dof\_number\_dense[global\_dofs\_recv[p][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] -\/ first\_row] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01394}01394               dof\_numbers\_recv[p][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01395}01395           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01396}01396 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01397}01397           \textcolor{comment}{// delete the data}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01398}01398           \textcolor{keyword}{delete}[] global\_dofs\_recv[p];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01399}01399           \textcolor{keyword}{delete}[] dof\_numbers\_recv[p];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01400}01400         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01401}01401 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01402}01402         \textcolor{comment}{// finally wait for the send requests to complete as we are leaving}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01403}01403         \textcolor{comment}{// an MPI block of code}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01404}01404         \textcolor{keywordtype}{unsigned} csr = send\_requests.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01405}01405         \textcolor{keywordflow}{if} (csr)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01406}01406         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01407}01407           MPI\_Waitall(csr, \&send\_requests[0], MPI\_STATUS\_IGNORE);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01408}01408         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01409}01409 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01410}01410         \textcolor{comment}{// clean up}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01411}01411         \textcolor{keyword}{delete}[] ndof\_to\_send;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01412}01412         \textcolor{keyword}{delete}[] first\_dof\_to\_send;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01413}01413         \textcolor{keyword}{delete}[] ndof\_to\_recv;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01414}01414         \textcolor{keyword}{delete}[] my\_global\_dofs;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01415}01415         \textcolor{keyword}{delete}[] my\_dof\_numbers;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01416}01416 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01417}01417         \textcolor{keywordtype}{unsigned} all\_recv = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01418}01418         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nrow\_local; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01419}01419         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01420}01420           \textcolor{keywordflow}{if} (!dof\_recv[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}])}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01421}01421           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01422}01422             all\_recv = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01423}01423           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01424}01424         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01425}01425         \textcolor{keywordflow}{if} (!all\_recv)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01426}01426         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01427}01427           std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01428}01428           error\_message << \textcolor{stringliteral}{"{}Not all the DOF numbers required were received"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01429}01429           \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01430}01430                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01431}01431                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01432}01432         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01433}01433 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01434}01434 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01435}01435         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01436}01436         error\_message}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01437}01437           << \textcolor{stringliteral}{"{}The problem appears to be distributed, MPI is required"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01438}01438         \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01439}01439                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01440}01440                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01441}01441 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01442}01442       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01443}01443 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01444}01444       Vector<unsigned*> sparse\_rows\_for\_proc(nproc, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01445}01445       Vector<MPI\_Request> sparse\_rows\_for\_proc\_requests;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01446}01446       \textcolor{keywordflow}{if} (matrix\_distributed)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01447}01447       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01448}01448         \textcolor{comment}{// wait for number of sparse rows each processor requires}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01449}01449         \textcolor{comment}{// post recvs for that data}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01450}01450         \textcolor{keywordflow}{if} (recv\_requests\_sparse\_nreq.size() > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01451}01451         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01452}01452           MPI\_Waitall(recv\_requests\_sparse\_nreq.size(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01453}01453                       \&recv\_requests\_sparse\_nreq[0],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01454}01454                       MPI\_STATUS\_IGNORE);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01455}01455         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01456}01456         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; ++p)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01457}01457         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01458}01458           \textcolor{keywordflow}{if} (nreq\_sparse\_for\_proc[p] > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01459}01459           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01460}01460             MPI\_Request req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01461}01461             sparse\_rows\_for\_proc[p] = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}[nreq\_sparse\_for\_proc[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01462}01462             MPI\_Irecv(sparse\_rows\_for\_proc[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01463}01463                       nreq\_sparse\_for\_proc[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01464}01464                       MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01465}01465                       p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01466}01466                       32,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01467}01467                       comm\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01468}01468                       \&req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01469}01469             sparse\_rows\_for\_proc\_requests.push\_back(req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01470}01470           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01471}01471         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01472}01472       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01473}01473 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01474}01474 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01475}01475 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01476}01476       \textcolor{comment}{// for every global degree of freedom required by this processor we now}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01477}01477       \textcolor{comment}{// have the corresponding dof number}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01478}01478 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01479}01479       \textcolor{comment}{// clear the Ndof\_in\_dof\_block storage}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01480}01480       Dof\_dimension.assign(Internal\_ndof\_types, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01481}01481 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01482}01482       \textcolor{comment}{// first consider a non distributed matrix}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01483}01483       \textcolor{keywordflow}{if} (!matrix\_distributed)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01484}01484       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01485}01485         \textcolor{comment}{// set the Index\_in\_dof\_block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01486}01486         \textcolor{keywordtype}{unsigned} nrow = this-\/>distribution\_pt()-\/>nrow();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01487}01487         Index\_in\_dof\_block\_dense.resize(nrow);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01488}01488         Index\_in\_dof\_block\_dense.initialise(0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01489}01489         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nrow; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01490}01490         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01491}01491           Index\_in\_dof\_block\_dense[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = Dof\_dimension[Dof\_number\_dense[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01492}01492           Dof\_dimension[Dof\_number\_dense[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]]++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01493}01493         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01494}01494       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01495}01495 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01496}01496       \textcolor{comment}{// next a distributed matrix}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01497}01497       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01498}01498       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01499}01499 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01500}01500 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01501}01501 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01502}01502         \textcolor{comment}{// first compute how many instances of each dof are on this}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01503}01503         \textcolor{comment}{// processor}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01504}01504         \textcolor{keywordtype}{unsigned}* my\_nrows\_in\_dof\_block = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}[Internal\_ndof\_types];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01505}01505         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < Internal\_ndof\_types; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01506}01506         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01507}01507           my\_nrows\_in\_dof\_block[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01508}01508         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01509}01509         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nrow\_local; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01510}01510         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01511}01511           my\_nrows\_in\_dof\_block[Dof\_number\_dense[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]]++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01512}01512         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01513}01513 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01514}01514         \textcolor{comment}{// next share the data}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01515}01515         \textcolor{keywordtype}{unsigned}* nrow\_in\_dof\_block\_recv =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01516}01516           \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}[Internal\_ndof\_types * nproc];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01517}01517         MPI\_Allgather(my\_nrows\_in\_dof\_block,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01518}01518                       Internal\_ndof\_types,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01519}01519                       MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01520}01520                       nrow\_in\_dof\_block\_recv,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01521}01521                       Internal\_ndof\_types,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01522}01522                       MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01523}01523                       comm\_pt()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01524}01524         \textcolor{keyword}{delete}[] my\_nrows\_in\_dof\_block;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01525}01525 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01526}01526         \textcolor{comment}{// compute my first dof index and Nrows\_in\_dof\_block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01527}01527         Vector<unsigned> my\_first\_dof\_index(Internal\_ndof\_types, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01528}01528         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < Internal\_ndof\_types; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01529}01529         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01530}01530           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < my\_rank; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01531}01531           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01532}01532             my\_first\_dof\_index[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] +=}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01533}01533               nrow\_in\_dof\_block\_recv[p * Internal\_ndof\_types + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01534}01534           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01535}01535           Dof\_dimension[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = my\_first\_dof\_index[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01536}01536           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = my\_rank; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01537}01537           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01538}01538             Dof\_dimension[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] +=}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01539}01539               nrow\_in\_dof\_block\_recv[p * Internal\_ndof\_types + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01540}01540           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01541}01541         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01542}01542         \textcolor{keyword}{delete}[] nrow\_in\_dof\_block\_recv;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01543}01543 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01544}01544         \textcolor{comment}{// next compute Index in dof block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01545}01545         Index\_in\_dof\_block\_dense.resize(nrow\_local);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01546}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_af9321cdab3f506ab95fe51cd9b93deab}{01546}}         Index\_in\_dof\_block\_dense.initialise(0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01547}01547         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} dof\_counter(Internal\_ndof\_types, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01548}01548         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nrow\_local; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01549}01549         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01550}01550           Index\_in\_dof\_block\_dense[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01551}01551             my\_first\_dof\_index[Dof\_number\_dense[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]] +}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01552}01552             dof\_counter[Dof\_number\_dense[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01553}01553           dof\_counter[Dof\_number\_dense[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]]++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01554}01554         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01555}01555 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01556}01556         \textcolor{comment}{// the base displacements for the sends}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01557}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a6d5106c0b9dca23aa1cc7f7fd8e696cb}{01557}}         \textcolor{keywordflow}{if} (sparse\_rows\_for\_proc\_requests.size() > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01558}01558         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01559}01559           MPI\_Waitall(sparse\_rows\_for\_proc\_requests.size(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01560}01560                       \&sparse\_rows\_for\_proc\_requests[0],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01561}01561                       MPI\_STATUS\_IGNORE);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01562}01562         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01563}01563         MPI\_Aint base\_displacement;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01564}01564         MPI\_Get\_address(dof\_number\_sparse\_send, \&base\_displacement);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01565}01565         \textcolor{keywordtype}{unsigned} first\_row = this-\/>distribution\_pt()-\/>first\_row();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01566}01566         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; ++p)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01567}01567         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01568}01568           \textcolor{keywordflow}{if} (nreq\_sparse\_for\_proc[p] > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01569}01569           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01570}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_ad356946d5de4f0817cdf8793fa3cdc74}{01570}}             \textcolor{comment}{// construct the data}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01571}01571             index\_in\_dof\_block\_sparse\_send[p] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01572}01572               \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}[nreq\_sparse\_for\_proc[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01573}01573             dof\_number\_sparse\_send[p] = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}[nreq\_sparse\_for\_proc[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01574}01574             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nreq\_sparse\_for\_proc[p]; ++\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01575}01575             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01576}01576               \textcolor{keywordtype}{unsigned} r = sparse\_rows\_for\_proc[p][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01577}01577               r -\/= first\_row;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01578}01578               index\_in\_dof\_block\_sparse\_send[p][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01579}01579                 Index\_in\_dof\_block\_dense[r];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01580}01580               dof\_number\_sparse\_send[p][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = Dof\_number\_dense[r];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01581}01581             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01582}01582             \textcolor{keyword}{delete}[] sparse\_rows\_for\_proc[p];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01583}01583 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01584}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a0517a3678def8b89ae69840345a8f838}{01584}}             \textcolor{comment}{// send the data}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01585}01585             \textcolor{comment}{// the datatypes, displacements, lengths for the two datatypes}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01586}01586             MPI\_Datatype types[2];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01587}01587             MPI\_Aint displacements[2];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01588}01588             \textcolor{keywordtype}{int} lengths[2];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01589}01589 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01590}01590             \textcolor{comment}{// index in dof block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01591}01591             MPI\_Type\_contiguous(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01592}01592               nreq\_sparse\_for\_proc[p], MPI\_UNSIGNED, \&types[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01593}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a71d48d8a70151ef0febd4537a2214c53}{01593}}             MPI\_Type\_commit(\&types[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01594}01594             MPI\_Get\_address(index\_in\_dof\_block\_sparse\_send[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01595}01595                             \&displacements[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01596}01596             displacements[0] -\/= base\_displacement;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01597}01597             lengths[0] = 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01598}01598 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01599}01599             \textcolor{comment}{// dof number}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01600}01600             MPI\_Type\_contiguous(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01601}01601               nreq\_sparse\_for\_proc[p], MPI\_UNSIGNED, \&types[1]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01602}01602             MPI\_Type\_commit(\&types[1]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01603}01603             MPI\_Get\_address(dof\_number\_sparse\_send[p], \&displacements[1]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01604}01604             displacements[1] -\/= base\_displacement;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01605}01605             lengths[1] = 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01606}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a628f3ab6c3c41ccb449da642fb7e1feb}{01606}} }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01607}01607             \textcolor{comment}{// build the final type}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01608}01608             MPI\_Datatype send\_type;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01609}01609             MPI\_Type\_create\_struct(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01610}01610               2, lengths, displacements, types, \&send\_type);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01611}01611             MPI\_Type\_commit(\&send\_type);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01612}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a7efc9f2f0209764902e4e45fcb2556d1}{01612}}             MPI\_Type\_free(\&types[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01613}01613             MPI\_Type\_free(\&types[1]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01614}01614 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01615}01615             \textcolor{comment}{// and recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01616}01616             MPI\_Request req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01617}01617             MPI\_Isend(dof\_number\_sparse\_send,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01618}01618                       1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01619}01619                       send\_type,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01620}01620                       p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01621}01621                       33,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01622}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a1dd4d3cd6b64fa64e1ff6730b0deecc7}{01622}}                       comm\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01623}01623                       \&req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01624}01624             send\_requests\_sparse.push\_back(req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01625}01625             MPI\_Type\_free(\&send\_type);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01626}01626           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01627}01627           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01628}01628           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01629}01629             index\_in\_dof\_block\_sparse\_send[p] = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01630}01630             dof\_number\_sparse\_send[p] = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01631}01631           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01632}01632         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01633}01633 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01634}01634       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01635}01635     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01636}01636 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01637}01637 \textcolor{comment}{    /// //////////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01638}01638 \textcolor{comment}{}    \textcolor{comment}{// end of master block preconditioner only operations}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01639}01639 \textcolor{comment}{    /// //////////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01640}01640 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01641}01641     \textcolor{comment}{// compute the number of rows in each block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01642}01642 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01643}01643 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01644}01644     \textcolor{comment}{// check the vector is the correct length}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01645}01645     \textcolor{keywordflow}{if} (dof\_to\_block\_map.size() != Internal\_ndof\_types)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01646}01646     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01647}01647       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01648}01648       error\_message << \textcolor{stringliteral}{"{}The dof\_to\_block\_map vector (size="{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01649}01649                     << dof\_to\_block\_map.size()}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01650}01650                     << \textcolor{stringliteral}{"{}) must be of size Internal\_ndof\_types="{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01651}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_afd37323d2b5ba31e2d14f3ce8e6e474d}{01651}}                     << Internal\_ndof\_types;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01652}01652       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01653}01653         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01654}01654     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01655}01655 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01656}01656 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01657}01657     \textcolor{comment}{// find the maximum block number RAYAY use std::max\_element}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01658}01658     \textcolor{keywordtype}{unsigned} max\_block\_number = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01659}01659     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < Internal\_ndof\_types; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01660}01660     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01661}01661       \textcolor{keywordflow}{if} (dof\_to\_block\_map[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] > max\_block\_number)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01662}01662       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01663}01663         max\_block\_number = dof\_to\_block\_map[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01664}01664       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01665}01665     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01666}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a98e920e003f085b02dbb30510fb23a0f}{01666}} }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01667}01667     \textcolor{comment}{// resize the storage the the block to dof map}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01668}01668     Block\_number\_to\_dof\_number\_lookup.clear();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01669}01669     Block\_number\_to\_dof\_number\_lookup.resize(max\_block\_number + 1);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01670}01670     Ndof\_in\_block.clear();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01671}01671     Ndof\_in\_block.resize(max\_block\_number + 1);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01672}01672 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01673}01673     \textcolor{comment}{// resize storage}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01674}01674     Dof\_number\_to\_block\_number\_lookup.resize(Internal\_ndof\_types);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01675}01675 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01676}01676     \textcolor{comment}{// build the storage for the two maps (block to dof) and (dof to block)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01677}01677     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < Internal\_ndof\_types; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01678}01678     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01679}01679       Dof\_number\_to\_block\_number\_lookup[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = dof\_to\_block\_map[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01680}01680       Block\_number\_to\_dof\_number\_lookup[dof\_to\_block\_map[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]].push\_back(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01681}01681       Ndof\_in\_block[dof\_to\_block\_map[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]]++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01682}01682     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01683}01683 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01684}01684 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01685}01685     \textcolor{comment}{// paranoid check that every block number has at least one DOF associated}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01686}01686     \textcolor{comment}{// with it}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01687}01687     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < max\_block\_number + 1; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01688}01688     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01689}01689       \textcolor{keywordflow}{if} (Block\_number\_to\_dof\_number\_lookup[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].size() == 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01690}01690       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01691}01691         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01692}01692         error\_message << \textcolor{stringliteral}{"{}block number "{}} << \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01693}01693                       << \textcolor{stringliteral}{"{} does not have any DOFs associated with it"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01694}01694         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01695}01695                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01696}01696                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01697}01697       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01698}01698     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01699}01699 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01700}01700 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01701}01701     \textcolor{comment}{// Update the number of blocks types.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01702}01702     Internal\_nblock\_types = max\_block\_number + 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01703}01703 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01704}01704     \textcolor{comment}{// Distributed or not, depends on if we have more than one processor.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01705}01705     \textcolor{keywordtype}{bool} distributed = this-\/>master\_distribution\_pt()-\/>distributed();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01706}01706 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01707}01707     \textcolor{comment}{// Create the new block distributions.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01708}01708     Internal\_block\_distribution\_pt.resize(Internal\_nblock\_types);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01709}01709     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < Internal\_nblock\_types; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01710}01710     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01711}01711       \textcolor{keywordtype}{unsigned} block\_dim = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01712}01712       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < Ndof\_in\_block[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]; j++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01713}01713       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01714}01714         block\_dim +=}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01715}01715           internal\_dof\_block\_dimension(Block\_number\_to\_dof\_number\_lookup[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}][j]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01716}01716       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01717}01717       Internal\_block\_distribution\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01718}01718         \textcolor{keyword}{new} LinearAlgebraDistribution(comm\_pt(), block\_dim, distributed);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01719}01719     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01720}01720 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01721}01721     \textcolor{comment}{// Work out the distribution of the dof-\/level blocks.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01722}01722     \textcolor{comment}{// Since several dof types may be coarsened into a single dof type.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01723}01723     \textcolor{comment}{// We get the dof-\/level block distributions from the parent preconditioner.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01724}01724 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01725}01725     \textcolor{comment}{// How many dof types are there?}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01726}01726     \textcolor{keywordflow}{if} (is\_subsidiary\_block\_preconditioner())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01727}01727     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01728}01728       \textcolor{comment}{// Delete any pre-\/existing distributions.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01729}01729       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} dof\_block\_distribution\_size =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01730}01730         Dof\_block\_distribution\_pt.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01731}01731       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_i = 0; dof\_i < dof\_block\_distribution\_size; dof\_i++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01732}01732       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01733}01733         \textcolor{keyword}{delete} Dof\_block\_distribution\_pt[dof\_i];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01734}01734       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01735}01735       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} ndofs = this-\/>ndof\_types();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01736}01736       Dof\_block\_distribution\_pt.resize(ndofs, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01737}01737 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01738}01738       \textcolor{comment}{// For each dof type, work out how many parent preconditioner dof types}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01739}01739       \textcolor{comment}{// are in it.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01740}01740       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_i = 0; dof\_i < ndofs; dof\_i++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01741}01741       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01742}01742         \textcolor{comment}{// For each external dof, we get the dofs coarsened into it (from the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01743}01743         \textcolor{comment}{// parent preconditioner level, not the most fine grain level).}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01744}01744         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} ncoarsened\_dofs\_in\_dof\_i =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01745}01745           Doftype\_coarsen\_map\_coarse[dof\_i].size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01746}01746         Vector<LinearAlgebraDistribution*> tmp\_dist\_pt(ncoarsened\_dofs\_in\_dof\_i,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01747}01747                                                        0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01748}01748         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} parent\_dof\_i = 0; parent\_dof\_i < ncoarsened\_dofs\_in\_dof\_i;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01749}01749              parent\_dof\_i++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01750}01750         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01751}01751           tmp\_dist\_pt[parent\_dof\_i] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01752}01752             master\_block\_preconditioner\_pt()-\/>dof\_block\_distribution\_pt(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01753}01753               Doftype\_in\_master\_preconditioner\_coarse}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01754}01754                 [Doftype\_coarsen\_map\_coarse[dof\_i][parent\_dof\_i]]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01755}01755         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01756}01756 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01757}01757         Dof\_block\_distribution\_pt[dof\_i] = \textcolor{keyword}{new} LinearAlgebraDistribution;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01758}01758 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01759}01759 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01760}01760         \mbox{\hyperlink{namespaceoomph_1_1LinearAlgebraDistributionHelpers_af11187289196182ce650da88cfe37fc2}{LinearAlgebraDistributionHelpers::concatenate}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01761}01761           tmp\_dist\_pt, *Dof\_block\_distribution\_pt[dof\_i]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01762}01762       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01763}01763     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01764}01764 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01765}01765     \textcolor{comment}{// Create Block\_distribution\_pt}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01766}01766     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01767}01767       \textcolor{comment}{// Delete any existing distributions in Block\_distribution\_pt.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01768}01768       \textcolor{comment}{// (This should already be deleted in clear\_block\_preconditioner\_base(...)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01769}01769       \textcolor{comment}{// but we are just being extra safe!).}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01770}01770       \textcolor{keywordtype}{unsigned} n\_existing\_block\_dist = Block\_distribution\_pt.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01771}01771       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dist\_i = 0; dist\_i < n\_existing\_block\_dist; dist\_i++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01772}01772       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01773}01773         \textcolor{keyword}{delete} Block\_distribution\_pt[dist\_i];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01774}01774       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01775}01775 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01776}01776       Block\_distribution\_pt.clear();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01777}01777 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01778}01778       \textcolor{comment}{// Work out the distributions of the concatenated blocks.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01779}01779       \textcolor{keywordtype}{unsigned} super\_block\_size = Block\_to\_dof\_map\_coarse.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01780}01780       Block\_distribution\_pt.resize(super\_block\_size, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01781}01781       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} super\_block\_i = 0; super\_block\_i < super\_block\_size;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01782}01782            super\_block\_i++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01783}01783       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01784}01784         \textcolor{keywordtype}{unsigned} sub\_block\_size = Block\_to\_dof\_map\_coarse[super\_block\_i].size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01785}01785         Vector<LinearAlgebraDistribution*> tmp\_dist\_pt(sub\_block\_size, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01786}01786 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01787}01787         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} sub\_block\_i = 0; sub\_block\_i < sub\_block\_size;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01788}01788              sub\_block\_i++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01789}01789         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01790}01790           tmp\_dist\_pt[sub\_block\_i] = dof\_block\_distribution\_pt(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01791}01791             Block\_to\_dof\_map\_coarse[super\_block\_i][sub\_block\_i]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01792}01792         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01793}01793 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01794}01794         Block\_distribution\_pt[super\_block\_i] = \textcolor{keyword}{new} LinearAlgebraDistribution;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01795}01795 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01796}01796         \mbox{\hyperlink{namespaceoomph_1_1LinearAlgebraDistributionHelpers_af11187289196182ce650da88cfe37fc2}{LinearAlgebraDistributionHelpers::concatenate}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01797}01797           tmp\_dist\_pt, *Block\_distribution\_pt[super\_block\_i]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01798}01798       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01799}01799 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01800}01800     \} \textcolor{comment}{// Creating Block\_distribution\_pt.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01801}01801 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01802}01802 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01803}01803     \textcolor{comment}{// Create the distribution of the preconditioner matrix,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01804}01804     \textcolor{comment}{// if this preconditioner is a subsidiary preconditioner then it stored}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01805}01805     \textcolor{comment}{// at Distribution\_pt;}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01806}01806     \textcolor{comment}{// if this preconditioner is a master preconditioner then it is stored}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01807}01807     \textcolor{comment}{// at Internal\_preconditioner\_matrix\_distribution\_pt.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01808}01808     LinearAlgebraDistribution dist;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01809}01809     \mbox{\hyperlink{namespaceoomph_1_1LinearAlgebraDistributionHelpers_af11187289196182ce650da88cfe37fc2}{LinearAlgebraDistributionHelpers::concatenate}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01810}01810       Internal\_block\_distribution\_pt, dist);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01811}01811 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01812}01812     \textcolor{comment}{// Build the distribution.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01813}01813     \textcolor{keywordflow}{if} (is\_subsidiary\_block\_preconditioner())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01814}01814     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01815}01815       this-\/>build\_distribution(dist);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01816}01816     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01817}01817     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01818}01818     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01819}01819       Internal\_preconditioner\_matrix\_distribution\_pt =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01820}01820         \textcolor{keyword}{new} LinearAlgebraDistribution(dist);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01821}01821     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01822}01822 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01823}01823     Preconditioner\_matrix\_distribution\_pt = \textcolor{keyword}{new} LinearAlgebraDistribution;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01824}01824     \mbox{\hyperlink{namespaceoomph_1_1LinearAlgebraDistributionHelpers_af11187289196182ce650da88cfe37fc2}{LinearAlgebraDistributionHelpers::concatenate}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01825}01825       Block\_distribution\_pt, *Preconditioner\_matrix\_distribution\_pt);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01826}01826 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01827}01827     \textcolor{comment}{// Clear all distributions in Auxiliary\_block\_distribution\_pt, except for}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01828}01828     \textcolor{comment}{// the one which corresponds to the preconditioner matrix distribution. This}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01829}01829     \textcolor{comment}{// is already deleted by clear\_block\_preconditioner\_base(...)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01830}01830 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01831}01831     \textcolor{comment}{// Create the key which corresponds to}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01832}01832     \textcolor{comment}{// preconditioner\_matrix\_distribution\_pt.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01833}01833     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01834}01834       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nblocks = Block\_distribution\_pt.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01835}01835       Vector<unsigned> preconditioner\_matrix\_key(nblocks, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01836}01836       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nblocks; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01837}01837       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01838}01838         preconditioner\_matrix\_key[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01839}01839       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01840}01840 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01841}01841       \textcolor{comment}{// Now iterate through Auxiliary\_block\_distribution\_pt and delete}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01842}01842       \textcolor{comment}{// everything except for the value which corresponds to}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01843}01843       \textcolor{comment}{// preconditioner\_matrix\_key.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01844}01844       std::map<Vector<unsigned>, LinearAlgebraDistribution*>::iterator iter =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01845}01845         Auxiliary\_block\_distribution\_pt.begin();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01846}01846       \textcolor{keywordflow}{while} (iter != Auxiliary\_block\_distribution\_pt.end())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01847}01847       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01848}01848         \textcolor{keywordflow}{if} (iter-\/>first != preconditioner\_matrix\_key)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01849}01849         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01850}01850           \textcolor{keyword}{delete} iter-\/>second;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01851}01851           iter++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01852}01852         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01853}01853         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01854}01854         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01855}01855           ++iter;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01856}01856         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01857}01857       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01858}01858 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01859}01859       \textcolor{comment}{// Clear it just to be safe!}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01860}01860       Auxiliary\_block\_distribution\_pt.clear();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01861}01861 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01862}01862       \textcolor{comment}{// Insert the preconditioner matrix distribution.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01863}01863       insert\_auxiliary\_block\_distribution(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01864}01864         preconditioner\_matrix\_key, Preconditioner\_matrix\_distribution\_pt);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01865}01865     \} \textcolor{comment}{// End of Auxiliary\_block\_distribution\_pt encapsulation.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01866}01866 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01867}01867     \textcolor{comment}{// Clearing up after comm to assemble sparse lookup schemes.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01868}01868 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01869}01869     \textcolor{keywordflow}{if} (send\_requests\_sparse.size() > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01870}01870     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01871}01871       MPI\_Waitall(send\_requests\_sparse.size(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01872}01872                   \&send\_requests\_sparse[0],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01873}01873                   MPI\_STATUS\_IGNORE);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01874}01874     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01875}01875     \textcolor{keywordflow}{if} (recv\_requests\_sparse.size() > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01876}01876     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01877}01877       MPI\_Waitall(recv\_requests\_sparse.size(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01878}01878                   \&recv\_requests\_sparse[0],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01879}01879                   MPI\_STATUS\_IGNORE);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01880}01880     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01881}01881     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01882}01882     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01883}01883       \textcolor{keyword}{delete}[] index\_in\_dof\_block\_sparse\_send[p];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01884}01884       \textcolor{keyword}{delete}[] dof\_number\_sparse\_send[p];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01885}01885     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01886}01886     \textcolor{keyword}{delete}[] index\_in\_dof\_block\_sparse\_send;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01887}01887     \textcolor{keyword}{delete}[] dof\_number\_sparse\_send;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01888}01888     \textcolor{keyword}{delete}[] nreq\_sparse;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01889}01889     \textcolor{keyword}{delete}[] nreq\_sparse\_for\_proc;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01890}01890 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01891}01891 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01892}01892     \textcolor{comment}{// Next we assemble the lookup schemes for the rows}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01893}01893     \textcolor{comment}{// if the matrix is not distributed then we assemble Global\_index}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01894}01894     \textcolor{comment}{// if the matrix is distributed then Rows\_to\_send\_..., Rows\_to\_recv\_... etc.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01895}01895     \textcolor{keywordflow}{if} (!distributed)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01896}01896     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01897}01897       \textcolor{comment}{// Resize the storage.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01898}01898       Global\_index.resize(Internal\_nblock\_types);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01899}01899       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < Internal\_nblock\_types; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01900}01900       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01901}01901         Global\_index[b].resize(Internal\_block\_distribution\_pt[b]-\/>nrow());}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01902}01902       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01903}01903 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01904}01904       \textcolor{comment}{// Compute:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01905}01905       \textcolor{keywordtype}{unsigned} nrow = this-\/>master\_nrow();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01906}01906       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nrow; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01907}01907       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01908}01908         \textcolor{comment}{// the dof type number;}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01909}01909         \textcolor{keywordtype}{int} dof\_number = this-\/>internal\_dof\_number(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01910}01910         \textcolor{keywordflow}{if} (dof\_number >= 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01911}01911         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01912}01912           \textcolor{comment}{// the block number;}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01913}01913           \textcolor{keywordtype}{unsigned} block\_number = Dof\_number\_to\_block\_number\_lookup[dof\_number];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01914}01914 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01915}01915           \textcolor{comment}{// the index in the block.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01916}01916           \textcolor{keywordtype}{unsigned} index\_in\_block = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01917}01917           \textcolor{keywordtype}{unsigned} ptr = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01918}01918           \textcolor{keywordflow}{while} (\textcolor{keywordtype}{int}(Block\_number\_to\_dof\_number\_lookup[block\_number][ptr]) !=}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01919}01919                  dof\_number)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01920}01920           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01921}01921             index\_in\_block += internal\_dof\_block\_dimension(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01922}01922               Block\_number\_to\_dof\_number\_lookup[block\_number][ptr]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01923}01923             ptr++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01924}01924           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01925}01925           index\_in\_block += internal\_index\_in\_dof(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01926}01926           Global\_index[block\_number][index\_in\_block] = \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01927}01927         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01928}01928       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01929}01929     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01930}01930     \textcolor{comment}{// otherwise the matrix is distributed}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01931}01931     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01932}01932     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01933}01933 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01934}01934 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01935}01935       \textcolor{comment}{// the pointer to the master distribution}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01936}01936       \textcolor{keyword}{const} LinearAlgebraDistribution* master\_distribution\_pt =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01937}01937         this-\/>master\_distribution\_pt();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01938}01938 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01939}01939       \textcolor{comment}{// resize the nrows... storage}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01940}01940       Nrows\_to\_send\_for\_get\_block.resize(Internal\_nblock\_types, nproc);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01941}01941       Nrows\_to\_send\_for\_get\_block.initialise(0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01942}01942       Nrows\_to\_send\_for\_get\_ordered.resize(nproc);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01943}01943       Nrows\_to\_send\_for\_get\_ordered.initialise(0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01944}01944 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01945}01945       \textcolor{comment}{// loop over my rows}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01946}01946       \textcolor{keywordtype}{unsigned} nrow\_local = master\_distribution\_pt-\/>nrow\_local();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01947}01947       \textcolor{keywordtype}{unsigned} first\_row = master\_distribution\_pt-\/>first\_row();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01948}01948       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nrow\_local; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01949}01949       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01950}01950         \textcolor{comment}{// the block number}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01951}01951         \textcolor{keywordtype}{int} b = this-\/>internal\_block\_number(first\_row + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01952}01952 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01953}01953         \textcolor{comment}{// check that the DOF i is associated with this preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01954}01954         \textcolor{keywordflow}{if} (b >= 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01955}01955         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01956}01956           \textcolor{comment}{// the block index}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01957}01957           \textcolor{keywordtype}{unsigned} j = this-\/>internal\_index\_in\_block(first\_row + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01958}01958 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01959}01959           \textcolor{comment}{// the processor this row will be sent to}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01960}01960           \textcolor{keywordtype}{unsigned} block\_p = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01961}01961           \textcolor{keywordflow}{while} (!(Internal\_block\_distribution\_pt[b]-\/>first\_row(block\_p) <= j \&\&}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01962}01962                    (Internal\_block\_distribution\_pt[b]-\/>first\_row(block\_p) +}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01963}01963                       Internal\_block\_distribution\_pt[b]-\/>nrow\_local(block\_p) >}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01964}01964                     j)))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01965}01965           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01966}01966             block\_p++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01967}01967           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01968}01968 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01969}01969           \textcolor{comment}{// and increment the counter}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01970}01970           Nrows\_to\_send\_for\_get\_block(b, block\_p)++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01971}01971           Nrows\_to\_send\_for\_get\_ordered[block\_p]++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01972}01972         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01973}01973       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01974}01974 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01975}01975       \textcolor{comment}{// resize the storage for Nrows\_to\_recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01976}01976       Nrows\_to\_recv\_for\_get\_block.resize(Internal\_nblock\_types, nproc);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01977}01977       Nrows\_to\_recv\_for\_get\_block.initialise(0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01978}01978       Nrows\_to\_recv\_for\_get\_ordered.resize(nproc);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01979}01979       Nrows\_to\_recv\_for\_get\_ordered.initialise(0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01980}01980 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01981}01981       \textcolor{comment}{// next we send the number of rows that will be sent by this processor}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01982}01982       Vector<unsigned*> nrows\_to\_send(nproc, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01983}01983       Vector<unsigned*> nrows\_to\_recv(nproc, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01984}01984       Vector<MPI\_Request> send\_requests\_nrow;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01985}01985       Vector<MPI\_Request> recv\_requests\_nrow;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01986}01986       Vector<unsigned> proc;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01987}01987       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01988}01988       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01989}01989         \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01990}01990         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01991}01991           \textcolor{comment}{// send}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01992}01992           proc.push\_back(p);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01993}01993           nrows\_to\_send[p] = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}[Internal\_nblock\_types];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01994}01994           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < Internal\_nblock\_types; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01995}01995           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01996}01996             nrows\_to\_send[p][b] = Nrows\_to\_send\_for\_get\_block(b, p);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01997}01997           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01998}01998           MPI\_Request s\_req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l01999}01999           MPI\_Isend(nrows\_to\_send[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02000}02000                     Internal\_nblock\_types,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02001}02001                     MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02002}02002                     p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02003}02003                     3,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02004}02004                     comm\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02005}02005                     \&s\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02006}02006           send\_requests\_nrow.push\_back(s\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02007}02007 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02008}02008           \textcolor{comment}{// recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02009}02009           nrows\_to\_recv[p] = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}[Internal\_nblock\_types];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02010}02010           MPI\_Request r\_req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02011}02011           MPI\_Irecv(nrows\_to\_recv[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02012}02012                     Internal\_nblock\_types,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02013}02013                     MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02014}02014                     p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02015}02015                     3,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02016}02016                     comm\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02017}02017                     \&r\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02018}02018           recv\_requests\_nrow.push\_back(r\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02019}02019         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02020}02020         \textcolor{comment}{// send to self}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02021}02021         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02022}02022         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02023}02023           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < Internal\_nblock\_types; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02024}02024           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02025}02025             Nrows\_to\_recv\_for\_get\_block(b, p) =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02026}02026               Nrows\_to\_send\_for\_get\_block(b, p);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02027}02027           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02028}02028           Nrows\_to\_recv\_for\_get\_ordered[p] = Nrows\_to\_send\_for\_get\_ordered[p];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02029}02029         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02030}02030       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02031}02031 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02032}02032       \textcolor{comment}{// create some temporary storage for the global row indices that will}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02033}02033       \textcolor{comment}{// be received from another processor.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02034}02034       DenseMatrix<int*> block\_rows\_to\_send(Internal\_nblock\_types, nproc, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02035}02035       Vector<int*> ordered\_rows\_to\_send(nproc, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02036}02036 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02037}02037       \textcolor{comment}{// resize the rows... storage}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02038}02038       Rows\_to\_send\_for\_get\_block.resize(Internal\_nblock\_types, nproc);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02039}02039       Rows\_to\_send\_for\_get\_block.initialise(0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02040}02040       Rows\_to\_send\_for\_get\_ordered.resize(nproc);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02041}02041       Rows\_to\_send\_for\_get\_ordered.initialise(0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02042}02042       Rows\_to\_recv\_for\_get\_block.resize(Internal\_nblock\_types, nproc);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02043}02043       Rows\_to\_recv\_for\_get\_block.initialise(0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02044}02044 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02045}02045       \textcolor{comment}{// resize the storage}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02046}02046       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02047}02047       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02048}02048         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < Internal\_nblock\_types; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02049}02049         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02050}02050           Rows\_to\_send\_for\_get\_block(b, p) =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02051}02051             \textcolor{keyword}{new} \textcolor{keywordtype}{int}[Nrows\_to\_send\_for\_get\_block(b, p)];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02052}02052           \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02053}02053           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02054}02054             block\_rows\_to\_send(b, p) =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02055}02055               \textcolor{keyword}{new} \textcolor{keywordtype}{int}[Nrows\_to\_send\_for\_get\_block(b, p)];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02056}02056           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02057}02057           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02058}02058           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02059}02059             Rows\_to\_recv\_for\_get\_block(b, p) =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02060}02060               \textcolor{keyword}{new} \textcolor{keywordtype}{int}[Nrows\_to\_send\_for\_get\_block(b, p)];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02061}02061           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02062}02062         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02063}02063         Rows\_to\_send\_for\_get\_ordered[p] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02064}02064           \textcolor{keyword}{new} \textcolor{keywordtype}{int}[Nrows\_to\_send\_for\_get\_ordered[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02065}02065       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02066}02066 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02067}02067 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02068}02068       \textcolor{comment}{// loop over my rows to allocate the nrows}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02069}02069       DenseMatrix<unsigned> ptr\_block(Internal\_nblock\_types, nproc, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02070}02070       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nrow\_local; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02071}02071       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02072}02072         \textcolor{comment}{// the block number}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02073}02073         \textcolor{keywordtype}{int} b = this-\/>internal\_block\_number(first\_row + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02074}02074 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02075}02075         \textcolor{comment}{// check that the DOF i is associated with this preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02076}02076         \textcolor{keywordflow}{if} (b >= 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02077}02077         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02078}02078           \textcolor{comment}{// the block index}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02079}02079           \textcolor{keywordtype}{unsigned} j = this-\/>internal\_index\_in\_block(first\_row + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02080}02080 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02081}02081           \textcolor{comment}{// the processor this row will be sent to}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02082}02082           \textcolor{keywordtype}{unsigned} block\_p = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02083}02083           \textcolor{keywordflow}{while} (!(Internal\_block\_distribution\_pt[b]-\/>first\_row(block\_p) <= j \&\&}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02084}02084                    (Internal\_block\_distribution\_pt[b]-\/>first\_row(block\_p) +}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02085}02085                       Internal\_block\_distribution\_pt[b]-\/>nrow\_local(block\_p) >}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02086}02086                     j)))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02087}02087           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02088}02088             block\_p++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02089}02089           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02090}02090 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02091}02091           \textcolor{comment}{// and store the row}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02092}02092           Rows\_to\_send\_for\_get\_block(b, block\_p)[ptr\_block(b, block\_p)] = \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02093}02093           \textcolor{keywordflow}{if} (block\_p != my\_rank)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02094}02094           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02095}02095             block\_rows\_to\_send(b, block\_p)[ptr\_block(b, block\_p)] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02096}02096               j -\/ Internal\_block\_distribution\_pt[b]-\/>first\_row(block\_p);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02097}02097           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02098}02098           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02099}02099           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02100}02100             Rows\_to\_recv\_for\_get\_block(b, block\_p)[ptr\_block(b, block\_p)] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02101}02101               j -\/ Internal\_block\_distribution\_pt[b]-\/>first\_row(block\_p);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02102}02102           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02103}02103           ptr\_block(b, block\_p)++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02104}02104         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02105}02105       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02106}02106 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02107}02107       \textcolor{comment}{// next block ordered}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02108}02108       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; ++p)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02109}02109       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02110}02110         \textcolor{keywordtype}{int} pt = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02111}02111         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < Internal\_nblock\_types; ++b)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02112}02112         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02113}02113           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < Nrows\_to\_send\_for\_get\_block(b, p); ++\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02114}02114           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02115}02115             Rows\_to\_send\_for\_get\_ordered[p][pt] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02116}02116               Rows\_to\_send\_for\_get\_block(b, p)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02117}02117             pt++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02118}02118           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02119}02119         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02120}02120       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02121}02121 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02122}02122       \textcolor{comment}{// next process the nrow recvs as they complete}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02123}02123 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02124}02124       \textcolor{comment}{// recv and store the data}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02125}02125       \textcolor{keywordtype}{unsigned} c = recv\_requests\_nrow.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02126}02126       \textcolor{keywordflow}{while} (c > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02127}02127       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02128}02128         \textcolor{comment}{// wait for any communication to finish}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02129}02129         \textcolor{keywordtype}{int} req\_number;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02130}02130         MPI\_Waitany(c, \&recv\_requests\_nrow[0], \&req\_number, MPI\_STATUS\_IGNORE);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02131}02131         recv\_requests\_nrow.erase(recv\_requests\_nrow.begin() + req\_number);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02132}02132         c-\/-\/;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02133}02133 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02134}02134         \textcolor{comment}{// determine the source processor}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02135}02135         \textcolor{keywordtype}{unsigned} p = proc[req\_number];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02136}02136         proc.erase(proc.begin() + req\_number);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02137}02137 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02138}02138         \textcolor{comment}{// copy the data to its final storage}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02139}02139         Nrows\_to\_recv\_for\_get\_ordered[p] = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02140}02140         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < Internal\_nblock\_types; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02141}02141         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02142}02142           Nrows\_to\_recv\_for\_get\_block(b, p) = nrows\_to\_recv[p][b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02143}02143           Nrows\_to\_recv\_for\_get\_ordered[p] += nrows\_to\_recv[p][b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02144}02144         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02145}02145 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02146}02146         \textcolor{comment}{// and clear}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02147}02147         \textcolor{keyword}{delete}[] nrows\_to\_recv[p];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02148}02148       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02149}02149 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02150}02150       \textcolor{comment}{// resize the storage for the incoming rows data}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02151}02151       Rows\_to\_recv\_for\_get\_ordered.resize(nproc, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02152}02152       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02153}02153       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02154}02154         \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02155}02155         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02156}02156           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < Internal\_nblock\_types; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02157}02157           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02158}02158             Rows\_to\_recv\_for\_get\_block(b, p) =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02159}02159               \textcolor{keyword}{new} \textcolor{keywordtype}{int}[Nrows\_to\_recv\_for\_get\_block(b, p)];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02160}02160           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02161}02161         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02162}02162       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02163}02163 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02164}02164       \textcolor{comment}{// compute the number of sends and recv from this processor}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02165}02165       \textcolor{comment}{// to each other processor}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02166}02166       Vector<unsigned> nsend\_for\_rows(nproc, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02167}02167       Vector<unsigned> nrecv\_for\_rows(nproc, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02168}02168       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02169}02169       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02170}02170         \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02171}02171         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02172}02172           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < Internal\_nblock\_types; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02173}02173           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02174}02174             \textcolor{keywordflow}{if} (Nrows\_to\_send\_for\_get\_block(b, p) > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02175}02175             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02176}02176               nsend\_for\_rows[p]++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02177}02177             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02178}02178             \textcolor{keywordflow}{if} (Nrows\_to\_recv\_for\_get\_block(b, p) > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02179}02179             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02180}02180               nrecv\_for\_rows[p]++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02181}02181             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02182}02182           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02183}02183         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02184}02184       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02185}02185 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02186}02186       \textcolor{comment}{// finally post the sends and recvs}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02187}02187       MPI\_Aint base\_displacement;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02188}02188       MPI\_Get\_address(matrix\_pt(), \&base\_displacement);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02189}02189       Vector<MPI\_Request> req\_rows;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02190}02190       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02191}02191       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02192}02192         \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02193}02193         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02194}02194           \textcolor{comment}{// send}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02195}02195           \textcolor{keywordflow}{if} (nsend\_for\_rows[p] > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02196}02196           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02197}02197             MPI\_Datatype send\_types[nsend\_for\_rows[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02198}02198             MPI\_Aint send\_displacements[nsend\_for\_rows[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02199}02199             \textcolor{keywordtype}{int} send\_sz[nsend\_for\_rows[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02200}02200             \textcolor{keywordtype}{unsigned} send\_ptr = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02201}02201             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < Internal\_nblock\_types; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02202}02202             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02203}02203               \textcolor{keywordflow}{if} (Nrows\_to\_send\_for\_get\_block(b, p) > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02204}02204               \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02205}02205                 MPI\_Type\_contiguous(Nrows\_to\_send\_for\_get\_block(b, p),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02206}02206                                     MPI\_INT,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02207}02207                                     \&send\_types[send\_ptr]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02208}02208                 MPI\_Type\_commit(\&send\_types[send\_ptr]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02209}02209                 MPI\_Get\_address(block\_rows\_to\_send(b, p),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02210}02210                                 \&send\_displacements[send\_ptr]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02211}02211                 send\_displacements[send\_ptr] -\/= base\_displacement;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02212}02212                 send\_sz[send\_ptr] = 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02213}02213                 send\_ptr++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02214}02214               \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02215}02215             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02216}02216             MPI\_Datatype final\_send\_type;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02217}02217             MPI\_Type\_create\_struct(nsend\_for\_rows[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02218}02218                                    send\_sz,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02219}02219                                    send\_displacements,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02220}02220                                    send\_types,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02221}02221                                    \&final\_send\_type);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02222}02222             MPI\_Type\_commit(\&final\_send\_type);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02223}02223             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nsend\_for\_rows[p]; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02224}02224             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02225}02225               MPI\_Type\_free(\&send\_types[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02226}02226             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02227}02227             MPI\_Request send\_req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02228}02228             MPI\_Isend(matrix\_pt(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02229}02229                       1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02230}02230                       final\_send\_type,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02231}02231                       p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02232}02232                       4,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02233}02233                       comm\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02234}02234                       \&send\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02235}02235             req\_rows.push\_back(send\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02236}02236             MPI\_Type\_free(\&final\_send\_type);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02237}02237           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02238}02238 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02239}02239           \textcolor{comment}{// recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02240}02240           \textcolor{keywordflow}{if} (nrecv\_for\_rows[p] > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02241}02241           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02242}02242             MPI\_Datatype recv\_types[nrecv\_for\_rows[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02243}02243             MPI\_Aint recv\_displacements[nrecv\_for\_rows[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02244}02244             \textcolor{keywordtype}{int} recv\_sz[nrecv\_for\_rows[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02245}02245             \textcolor{keywordtype}{unsigned} recv\_ptr = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02246}02246             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < Internal\_nblock\_types; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02247}02247             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02248}02248               \textcolor{keywordflow}{if} (Nrows\_to\_recv\_for\_get\_block(b, p) > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02249}02249               \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02250}02250                 MPI\_Type\_contiguous(Nrows\_to\_recv\_for\_get\_block(b, p),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02251}02251                                     MPI\_INT,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02252}02252                                     \&recv\_types[recv\_ptr]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02253}02253                 MPI\_Type\_commit(\&recv\_types[recv\_ptr]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02254}02254                 MPI\_Get\_address(Rows\_to\_recv\_for\_get\_block(b, p),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02255}02255                                 \&recv\_displacements[recv\_ptr]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02256}02256                 recv\_displacements[recv\_ptr] -\/= base\_displacement;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02257}02257                 recv\_sz[recv\_ptr] = 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02258}02258                 recv\_ptr++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02259}02259               \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02260}02260             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02261}02261             MPI\_Datatype final\_recv\_type;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02262}02262             MPI\_Type\_create\_struct(nrecv\_for\_rows[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02263}02263                                    recv\_sz,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02264}02264                                    recv\_displacements,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02265}02265                                    recv\_types,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02266}02266                                    \&final\_recv\_type);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02267}02267             MPI\_Type\_commit(\&final\_recv\_type);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02268}02268             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nrecv\_for\_rows[p]; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02269}02269             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02270}02270               MPI\_Type\_free(\&recv\_types[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02271}02271             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02272}02272             MPI\_Request recv\_req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02273}02273             MPI\_Irecv(matrix\_pt(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02274}02274                       1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02275}02275                       final\_recv\_type,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02276}02276                       p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02277}02277                       4,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02278}02278                       comm\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02279}02279                       \&recv\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02280}02280             req\_rows.push\_back(recv\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02281}02281             MPI\_Type\_free(\&final\_recv\_type);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02282}02282           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02283}02283         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02284}02284       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02285}02285 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02286}02286       \textcolor{comment}{// cleaning up Waitalls}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02287}02287 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02288}02288 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02289}02289       \textcolor{comment}{// wait for the recv requests so we can compute}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02290}02290       \textcolor{comment}{// Nrows\_to\_recv\_for\_get\_ordered}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02291}02291       \textcolor{keywordtype}{unsigned} n\_req\_rows = req\_rows.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02292}02292       \textcolor{keywordflow}{if} (n\_req\_rows)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02293}02293       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02294}02294         MPI\_Waitall(n\_req\_rows, \&req\_rows[0], MPI\_STATUS\_IGNORE);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02295}02295       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02296}02296 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02297}02297       \textcolor{comment}{// resize the storage}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02298}02298       Rows\_to\_recv\_for\_get\_ordered.resize(nproc);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02299}02299       Rows\_to\_recv\_for\_get\_ordered.initialise(0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02300}02300 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02301}02301       \textcolor{comment}{// construct block offset}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02302}02302       Vector<int> vec\_offset(Internal\_nblock\_types, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02303}02303       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 1; b < Internal\_nblock\_types; ++b)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02304}02304       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02305}02305         vec\_offset[b] = vec\_offset[b -\/ 1] +}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02306}02306                         Internal\_block\_distribution\_pt[b -\/ 1]-\/>nrow\_local();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02307}02307       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02308}02308 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02309}02309       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02310}02310       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02311}02311       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02312}02312         \textcolor{keywordtype}{int} pt = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02313}02313         Rows\_to\_recv\_for\_get\_ordered[p] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02314}02314           \textcolor{keyword}{new} \textcolor{keywordtype}{int}[Nrows\_to\_recv\_for\_get\_ordered[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02315}02315         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < Internal\_nblock\_types; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02316}02316         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02317}02317           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < Nrows\_to\_recv\_for\_get\_block(b, p); \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02318}02318           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02319}02319             Rows\_to\_recv\_for\_get\_ordered[p][pt] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02320}02320               Rows\_to\_recv\_for\_get\_block(b, p)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] + vec\_offset[b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02321}02321             pt++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02322}02322           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02323}02323         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02324}02324       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02325}02325 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02326}02326       \textcolor{comment}{// clean up}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02327}02327       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02328}02328       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02329}02329         \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02330}02330         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02331}02331           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < Internal\_nblock\_types; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02332}02332           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02333}02333             \textcolor{keyword}{delete}[] block\_rows\_to\_send(b, p);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02334}02334           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02335}02335           \textcolor{keywordflow}{if} (Nrows\_to\_send\_for\_get\_ordered[p] > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02336}02336           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02337}02337             \textcolor{keyword}{delete}[] ordered\_rows\_to\_send[p];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02338}02338           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02339}02339         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02340}02340       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02341}02341 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02342}02342       \textcolor{comment}{// and the send reqs}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02343}02343       \textcolor{keywordtype}{unsigned} n\_req\_send\_nrow = send\_requests\_nrow.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02344}02344       \textcolor{keywordflow}{if} (n\_req\_send\_nrow)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02345}02345       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02346}02346         MPI\_Waitall(n\_req\_send\_nrow, \&send\_requests\_nrow[0], MPI\_STATUS\_IGNORE);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02347}02347       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02348}02348       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02349}02349       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02350}02350         \textcolor{keyword}{delete}[] nrows\_to\_send[p];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02351}02351       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02352}02352 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02353}02353     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02354}02354 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02355}02355     \textcolor{comment}{// If we asked for output of blocks to a file then do it.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02356}02356     \textcolor{keywordflow}{if} (block\_output\_on()) output\_blocks\_to\_files(Output\_base\_filename);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02357}02357   \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02358}02358 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02359}02359   \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02360}02360   \textcolor{comment}{//??ds}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02361}02361 \textcolor{comment}{  /// Function to turn this preconditioner into a}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02362}02362 \textcolor{comment}{  /// subsidiary preconditioner that operates within a bigger}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02363}02363 \textcolor{comment}{  /// "{}master block preconditioner (e.g. a Navier-\/Stokes 2x2 block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02364}02364 \textcolor{comment}{  /// preconditioner dealing with the fluid sub-\/blocks within a}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02365}02365 \textcolor{comment}{  /// 3x3 FSI preconditioner. Once this is done the master block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02366}02366 \textcolor{comment}{  /// preconditioner deals with the block setup etc.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02367}02367 \textcolor{comment}{  /// The vector block\_map must specify the dof number in the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02368}02368 \textcolor{comment}{  /// master preconditioner that corresponds to a block number in this}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02369}02369 \textcolor{comment}{  /// preconditioner. ??ds horribly misleading comment!}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02370}02370 \textcolor{comment}{  /// The length of the vector is used to determine the number of}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02371}02371 \textcolor{comment}{  /// blocks in this preconditioner therefore it must be correctly sized.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02372}02372 \textcolor{comment}{  /// This calls the other turn\_into\_subsidiary\_block\_preconditioner(...)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02373}02373 \textcolor{comment}{  /// function providing an empty doftype\_to\_doftype\_map vector.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02374}02374 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02375}02375   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02376}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_ab8e2478caa8370dd12462f17e1cc8082}{02376}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_ab8e2478caa8370dd12462f17e1cc8082}{BlockPreconditioner<MATRIX>::turn\_into\_subsidiary\_block\_preconditioner}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02377}02377     \mbox{\hyperlink{classoomph_1_1BlockPreconditioner}{BlockPreconditioner<MATRIX>}}* master\_block\_prec\_pt,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02378}02378     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& doftype\_in\_master\_preconditioner\_coarse)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02379}02379   \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02380}02380     \textcolor{comment}{// Create the identity dof\_coarsen\_map}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02381}02381     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<unsigned>}}> doftype\_coarsen\_map\_coarse;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02382}02382     \textcolor{keywordtype}{unsigned} doftype\_in\_master\_preconditioner\_coarse\_size =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02383}02383       doftype\_in\_master\_preconditioner\_coarse.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02384}02384 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02385}02385     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_i = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02386}02386          dof\_i < doftype\_in\_master\_preconditioner\_coarse\_size;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02387}02387          dof\_i++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02388}02388     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02389}02389       \textcolor{comment}{// Create a vector of size 1 and value i,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02390}02390       \textcolor{comment}{// then push it into the dof\_coarsen\_map vector.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02391}02391       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} tmp\_vec(1, dof\_i);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02392}02392       doftype\_coarsen\_map\_coarse.push\_back(tmp\_vec);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02393}02393     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02394}02394 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02395}02395     \textcolor{comment}{// Call the other turn\_into\_subsidiary\_block\_preconditioner function.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02396}02396     turn\_into\_subsidiary\_block\_preconditioner(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02397}02397       master\_block\_prec\_pt,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02398}02398       doftype\_in\_master\_preconditioner\_coarse,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02399}02399       doftype\_coarsen\_map\_coarse);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02400}02400   \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02401}02401 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02402}02402 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02403}02403   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02404}02404 \textcolor{comment}{  /// Function to turn this block preconditioner into a}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02405}02405 \textcolor{comment}{  /// subsidiary block preconditioner that operates within a bigger}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02406}02406 \textcolor{comment}{  /// master block preconditioner (e.g. a Navier-\/Stokes 2x2 block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02407}02407 \textcolor{comment}{  /// preconditioner dealing with the fluid sub-\/blocks within a}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02408}02408 \textcolor{comment}{  /// 3x3 FSI preconditioner. Once this is done the master block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02409}02409 \textcolor{comment}{  /// preconditioner deals with the block setup etc.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02410}02410 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02411}02411 \textcolor{comment}{  /// The vector doftype\_map must specify the dof type in the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02412}02412 \textcolor{comment}{  /// master preconditioner that corresponds to a dof type in this block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02413}02413 \textcolor{comment}{  /// preconditioner.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02414}02414 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02415}02415 \textcolor{comment}{  /// In general, we want:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02416}02416 \textcolor{comment}{  /// doftype\_map[doftype in subsidiary prec] = doftype in master prec.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02417}02417 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02418}02418 \textcolor{comment}{  /// It tells this block preconditioner which dof types of the master}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02419}02419 \textcolor{comment}{  /// block preconditioner it is working with.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02420}02420 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02421}02421 \textcolor{comment}{  /// The length of the vector is used to determine the number of}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02422}02422 \textcolor{comment}{  /// dof types in THIS block preconditioner therefore it must be correctly}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02423}02423 \textcolor{comment}{  /// sized.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02424}02424 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02425}02425 \textcolor{comment}{  /// For example, let the master block preconditioner have 5 dof types in total}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02426}02426 \textcolor{comment}{  /// and a 1-\/4 dof type splitting where the block (0,0) corresponds to}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02427}02427 \textcolor{comment}{  /// dof type 0 and the block (1,1) corresponds to dof types 1, 2, 3 and 4}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02428}02428 \textcolor{comment}{  /// (i.e. it would have given to block\_setup the vector [0,1,1,1,1]).}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02429}02429 \textcolor{comment}{  /// Furthermore, it solves (1,1) block with subsidiary block preconditioner.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02430}02430 \textcolor{comment}{  /// Then the doftype\_map passed to this function of the subsidiary block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02431}02431 \textcolor{comment}{  /// preconditioner would be [1, 2, 3, 4].}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02432}02432 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02433}02433 \textcolor{comment}{  /// Dof type coarsening (following on from the example above):}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02434}02434 \textcolor{comment}{  /// Let the subsidiary block preconditioner (THIS block preconditioner)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02435}02435 \textcolor{comment}{  /// only works with two DOF types, then the master block preconditioner must}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02436}02436 \textcolor{comment}{  /// "{}coarsen"{} the dof types by providing the optional argument}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02437}02437 \textcolor{comment}{  /// doftype\_coarsen\_map vector.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02438}02438 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02439}02439 \textcolor{comment}{  /// The doftype\_coarsen\_map vector (in this case) might be [[0,1], [2,3]]}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02440}02440 \textcolor{comment}{  /// telling the subsidiary block preconditioner that the SUBSIDIARY dof types}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02441}02441 \textcolor{comment}{  /// 0 and 1 should be treated as dof type 0 and the subsidiary dof types 2}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02442}02442 \textcolor{comment}{  /// and 3 should be treated as subsidiary dof type 1.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02443}02443 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02444}02444 \textcolor{comment}{  /// If no doftype\_coarsen\_map vector is provided, then the identity is}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02445}02445 \textcolor{comment}{  /// used automatically (see the turn\_into\_subsidiary\_block\_preconditioner(...)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02446}02446 \textcolor{comment}{  /// function with only two arguments). In the above case, the identity}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02447}02447 \textcolor{comment}{  /// doftype\_coarsen\_map vector for the subsidiary block preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02448}02448 \textcolor{comment}{  /// would be the 2D vector [[0], [1], [2], [3]] which means}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02449}02449 \textcolor{comment}{  /// dof type 0 is treated as dof type 0,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02450}02450 \textcolor{comment}{  /// dof type 1 is treated as dof type 1,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02451}02451 \textcolor{comment}{  /// dof type 2 is treated as dof type 2, and}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02452}02452 \textcolor{comment}{  /// dof type 3 is treated as dof type 3.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02453}02453 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02454}02454   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02455}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_ae9282acaaf19fa2cdb703d49f1a8de25}{02455}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_ab8e2478caa8370dd12462f17e1cc8082}{BlockPreconditioner<MATRIX>::turn\_into\_subsidiary\_block\_preconditioner}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02456}02456     \mbox{\hyperlink{classoomph_1_1BlockPreconditioner}{BlockPreconditioner<MATRIX>}}* master\_block\_prec\_pt,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02457}02457     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& doftype\_in\_master\_preconditioner\_coarse,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02458}02458     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}>\& doftype\_coarsen\_map\_coarse)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02459}02459   \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02460}02460     \textcolor{comment}{// Set the master block preconditioner pointer}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02461}02461     Master\_block\_preconditioner\_pt = master\_block\_prec\_pt;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02462}02462 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02463}02463     \textcolor{comment}{// Set the Doftype\_coarsen\_map\_coarse.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02464}02464     Doftype\_coarsen\_map\_coarse = doftype\_coarsen\_map\_coarse;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02465}02465 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02466}02466     Doftype\_in\_master\_preconditioner\_coarse =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02467}02467       doftype\_in\_master\_preconditioner\_coarse;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02468}02468   \} \textcolor{comment}{// end of turn\_into\_subsidiary\_block\_preconditioner(...)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02469}02469 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02470}02470 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02471}02471   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02472}02472 \textcolor{comment}{  /// Determine the size of the matrix blocks and setup the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02473}02473 \textcolor{comment}{  /// lookup schemes relating the global degrees of freedom with}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02474}02474 \textcolor{comment}{  /// their "{}blocks"{} and their indices (row/column numbers) in those}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02475}02475 \textcolor{comment}{  /// blocks.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02476}02476 \textcolor{comment}{  /// The distributions of the preconditioner and the blocks are}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02477}02477 \textcolor{comment}{  /// automatically specified (and assumed to be uniform) at this}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02478}02478 \textcolor{comment}{  /// stage.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02479}02479 \textcolor{comment}{  /// This method should be used if each DOF type corresponds to a}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02480}02480 \textcolor{comment}{  /// unique block type.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02481}02481 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02482}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_afba1bef13cebdce65a0a49ff3381269a}{02482}}   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02483}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_af704c4816469cef4fed9d35a9ad651ec}{02483}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_af704c4816469cef4fed9d35a9ad651ec}{BlockPreconditioner<MATRIX>::block\_setup}}()}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02484}02484   \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02485}02485 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02486}02486 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02487}02487     \textcolor{comment}{// Subsidiary preconditioners don't really need the meshes}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02488}02488     \textcolor{keywordflow}{if} (this-\/>is\_master\_block\_preconditioner())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02489}02489     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02490}02490       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02491}02491       \textcolor{keywordtype}{unsigned} n = nmesh();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02492}02492       \textcolor{keywordflow}{if} (n == 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02493}02493       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02494}02494         err\_msg << \textcolor{stringliteral}{"{}No meshes have been set for this block preconditioner!\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02495}02495                 << \textcolor{stringliteral}{"{}Set one with set\_nmesh(...), set\_mesh(...)"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02496}02496         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02497}02497           err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02498}02498         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n; m++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02499}02499         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02500}02500           \textcolor{keywordflow}{if} (Mesh\_pt[m] == 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02501}02501           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02502}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a679a82067056628cc4bbc8bb68d088f2}{02502}}             err\_msg << \textcolor{stringliteral}{"{}The mesh pointer to mesh "{}} << m << \textcolor{stringliteral}{"{} is null!\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02503}02503                     << \textcolor{stringliteral}{"{}Set a non-\/null one with set\_mesh(...)"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02504}02504             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02505}02505               err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02506}02506           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02507}02507         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02508}02508       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02509}02509     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02510}02510 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02511}02511 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02512}02512     \textcolor{comment}{// Get the number of dof types.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02513}02513     \textcolor{keywordtype}{unsigned} internal\_n\_dof\_types = ndof\_types();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02514}02514 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02515}02515     \textcolor{comment}{// Build the dof to block map -\/ assume that each type of dof corresponds}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02516}02516     \textcolor{comment}{// to a different type of block.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02517}02517     Vector<unsigned> dof\_to\_block\_lookup(internal\_n\_dof\_types);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02518}02518     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < internal\_n\_dof\_types; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02519}02519     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02520}02520       dof\_to\_block\_lookup[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02521}02521     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02522}02522 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02523}02523     \textcolor{comment}{// call the block setup method}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02524}02524     this-\/>block\_setup(dof\_to\_block\_lookup);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02525}02525   \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02526}02526 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02527}02527 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02528}02528   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02529}02529 \textcolor{comment}{  /// Get the block matrices required for the block preconditioner. Takes a}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02530}02530 \textcolor{comment}{  /// pointer to a matrix of bools that indicate if a specified sub-\/block is}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02531}02531 \textcolor{comment}{  /// required for the preconditioning operation. Computes the required block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02532}02532 \textcolor{comment}{  /// matrices, and stores pointers to them in the matrix block\_matrix\_pt. If an}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02533}02533 \textcolor{comment}{  /// entry in block\_matrix\_pt is equal to NULL that sub-\/block has not been}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02534}02534 \textcolor{comment}{  /// requested and is therefore not available.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02535}02535 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02536}02536   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02537}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a69fa79db7073f39a1ac5333c8bd9c1d5}{02537}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a69fa79db7073f39a1ac5333c8bd9c1d5}{BlockPreconditioner<MATRIX>::get\_blocks}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02538}02538     \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<bool>}}\& required\_blocks,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02539}02539     \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<MATRIX*>}}\& block\_matrix\_pt)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02540}02540 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02541}02541     \textcolor{comment}{// Cache number of block types}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02542}02542     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_block\_types = nblock\_types();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02543}02543 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02544}02544 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02545}02545     \textcolor{comment}{// If required blocks matrix pointer is not the correct size then abort.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02546}02546     \textcolor{keywordflow}{if} ((required\_blocks.\mbox{\hyperlink{classoomph_1_1DenseMatrix_a1b425094510d833ffe91920747a0a962}{nrow}}() != n\_block\_types) ||}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02547}02547         (required\_blocks.\mbox{\hyperlink{classoomph_1_1DenseMatrix_a9937181f1cb4cfaed7aaf3b483c42456}{ncol}}() != n\_block\_types))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02548}02548     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02549}02549       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02550}02550       error\_message << \textcolor{stringliteral}{"{}The size of the matrix of bools required\_blocks "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02551}02551                     << \textcolor{stringliteral}{"{}(which indicates which blocks are required) is not the "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02552}02552                     << \textcolor{stringliteral}{"{}right size, required\_blocks is "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02553}02553                     << required\_blocks.\mbox{\hyperlink{classoomph_1_1DenseMatrix_a9937181f1cb4cfaed7aaf3b483c42456}{ncol}}() << \textcolor{stringliteral}{"{} x "{}} << required\_blocks.\mbox{\hyperlink{classoomph_1_1DenseMatrix_a1b425094510d833ffe91920747a0a962}{nrow}}()}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02554}02554                     << \textcolor{stringliteral}{"{}, whereas it should "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02555}02555                     << \textcolor{stringliteral}{"{}be "{}} << n\_block\_types << \textcolor{stringliteral}{"{} x "{}} << n\_block\_types;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02556}02556       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02557}02557         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02558}02558     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02559}02559 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02560}02560     \textcolor{comment}{// If block matrix pointer is not the correct size then abort.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02561}02561     \textcolor{keywordflow}{if} ((block\_matrix\_pt.\mbox{\hyperlink{classoomph_1_1DenseMatrix_a1b425094510d833ffe91920747a0a962}{nrow}}() != n\_block\_types) ||}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02562}02562         (block\_matrix\_pt.\mbox{\hyperlink{classoomph_1_1DenseMatrix_a9937181f1cb4cfaed7aaf3b483c42456}{ncol}}() != n\_block\_types))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02563}02563     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02564}02564       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02565}02565       error\_message << \textcolor{stringliteral}{"{}The size of the block matrix pt is not the "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02566}02566                     << \textcolor{stringliteral}{"{}right size, block\_matrix\_pt is "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02567}02567                     << block\_matrix\_pt.\mbox{\hyperlink{classoomph_1_1DenseMatrix_a9937181f1cb4cfaed7aaf3b483c42456}{ncol}}() << \textcolor{stringliteral}{"{} x "{}} << block\_matrix\_pt.\mbox{\hyperlink{classoomph_1_1DenseMatrix_a1b425094510d833ffe91920747a0a962}{nrow}}()}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02568}02568                     << \textcolor{stringliteral}{"{}, whereas it should "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02569}02569                     << \textcolor{stringliteral}{"{}be "{}} << n\_block\_types << \textcolor{stringliteral}{"{} x "{}} << n\_block\_types;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02570}02570       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02571}02571         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02572}02572     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02573}02573 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02574}02574 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02575}02575 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02576}02576     \textcolor{comment}{// Loop over the blocks}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02577}02577     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_block\_types; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02578}02578     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02579}02579       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_block\_types; j++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02580}02580       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02581}02581         \textcolor{comment}{// If block(i,j) is required then create a matrix and fill it in.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02582}02582         \textcolor{keywordflow}{if} (required\_blocks(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02583}02583         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02584}02584           \textcolor{comment}{//??ds might want to remove this use of new as well?}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02585}02585           block\_matrix\_pt(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j) = \textcolor{keyword}{new} MATRIX;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02586}02586           get\_block(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j, *block\_matrix\_pt(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j));}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02587}02587         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02588}02588 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02589}02589         \textcolor{comment}{// Otherwise set pointer to null.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02590}02590         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02591}02591         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02592}02592           block\_matrix\_pt(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j) = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02593}02593         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02594}02594       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02595}02595     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02596}02596   \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02597}02597 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02598}02598   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02599}02599 \textcolor{comment}{  /// Takes the naturally ordered vector and extracts the blocks}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02600}02600 \textcolor{comment}{  /// indicated by the block number (the values) in the Vector}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02601}02601 \textcolor{comment}{  /// block\_vec\_number all at once, then concatenates them without}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02602}02602 \textcolor{comment}{  /// communication. Here, the values in block\_vec\_number is the block number}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02603}02603 \textcolor{comment}{  /// in the current preconditioner.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02604}02604 \textcolor{comment}{  /// This is a non-\/const function because distributions may be created}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02605}02605 \textcolor{comment}{  /// and stored in Auxiliary\_block\_distribution\_pt for future use.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02606}02606 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02607}02607   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02608}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_af9321cdab3f506ab95fe51cd9b93deab}{02608}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_af9321cdab3f506ab95fe51cd9b93deab}{BlockPreconditioner<MATRIX>::get\_concatenated\_block\_vector}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02609}02609     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& block\_vec\_number,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02610}02610     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& v,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02611}02611     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& w)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02612}02612   \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02613}02613 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02614}02614 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02615}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a04e260cc4160a952db2d410109fb2684}{02615}}     \textcolor{comment}{// Check if v is built.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02616}02616     \textcolor{keywordflow}{if} (!v.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02617}02617     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02618}02618       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02619}02619       err\_msg << \textcolor{stringliteral}{"{}The distribution of the global vector v must be setup."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02620}02620       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02621}02621         err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02622}02622     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02623}02623 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02624}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_ae3cf61f61e1aa50e2315e999827e7d59}{02624}}     \textcolor{comment}{// v must have the same distribution as the upper-\/most master block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02625}02625     \textcolor{comment}{// preconditioner, since the upper-\/most master block preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02626}02626     \textcolor{comment}{// should have the same distribution as the matrix pointed to}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02627}02627     \textcolor{comment}{// by matrix\_pt().}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02628}02628     \textcolor{keywordflow}{if} (*(v.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()) != *(this-\/>master\_distribution\_pt()))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02629}02629     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02630}02630       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02631}02631       err\_msg << \textcolor{stringliteral}{"{}The distribution of the global vector v must match the "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02632}02632               << \textcolor{stringliteral}{"{} specified master\_distribution\_pt(). \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02633}02633               << \textcolor{stringliteral}{"{}i.e. Distribution\_pt in the master preconditioner"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02634}02634       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02635}02635         err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02636}02636     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02637}02637 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02638}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_ace6e9dbdfe9a1c3571452e2cd6ec9780}{02638}}     \textcolor{comment}{// Check to see if there are more blocks defined in the block\_vec\_number}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02639}02639     \textcolor{comment}{// vector than the number of block types. This is not allowed.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02640}02640     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} para\_nblock\_types = nblock\_types();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02641}02641     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} para\_block\_vec\_number\_size = block\_vec\_number.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02642}02642     \textcolor{keywordflow}{if} (para\_block\_vec\_number\_size > para\_nblock\_types)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02643}02643     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02644}02644       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02645}02645       err\_msg << \textcolor{stringliteral}{"{}You have requested "{}} << para\_block\_vec\_number\_size}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02646}02646               << \textcolor{stringliteral}{"{} number of blocks, (block\_vec\_number.size() is "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02647}02647               << para\_block\_vec\_number\_size << \textcolor{stringliteral}{"{}).\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02648}02648               << \textcolor{stringliteral}{"{}But there are only "{}} << para\_nblock\_types}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02649}02649               << \textcolor{stringliteral}{"{} nblock\_types.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02650}02650               << \textcolor{stringliteral}{"{}Please make sure that block\_vec\_number is correctly sized.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02651}02651       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02652}02652         err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02653}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a0cde8af922cd8054dbf352527dd682b1}{02653}}     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02654}02654 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02655}02655     \textcolor{comment}{// Check if any block numbers defined in block\_vec\_number is equal to or}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02656}02656     \textcolor{comment}{// greater than the number of block types.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02657}02657     \textcolor{comment}{// E.g. if there are 5 block types, we can only have block numbers:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02658}02658     \textcolor{comment}{//  0, 1, 2, 3 and 4.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02659}02659     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < para\_block\_vec\_number\_size; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02660}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a2ca7f125e50493073d116ba8da271af5}{02660}}     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02661}02661       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} para\_required\_block = block\_vec\_number[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02662}02662       \textcolor{keywordflow}{if} (para\_required\_block >= para\_nblock\_types)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02663}02663       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02664}02664         std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02665}02665         err\_msg << \textcolor{stringliteral}{"{}block\_vec\_number["{}} << \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} << \textcolor{stringliteral}{"{}] is "{}} << para\_required\_block}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02666}02666                 << \textcolor{stringliteral}{"{}.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02667}02667                 << \textcolor{stringliteral}{"{}But there are only "{}} << para\_nblock\_types}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02668}02668                 << \textcolor{stringliteral}{"{} nblock\_types.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02669}02669         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02670}02670           err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02671}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a9e2ce77e3efbcdd465f7ad7252936dfd}{02671}}       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02672}02672     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02673}02673 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02674}02674     \textcolor{comment}{// Check that no block number is inserted twice.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02675}02675     std::set<unsigned> para\_set;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02676}02676     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < para\_block\_vec\_number\_size; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02677}02677     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02678}02678       std::pair<std::set<unsigned>::iterator, \textcolor{keywordtype}{bool}> para\_set\_ret;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02679}02679       para\_set\_ret = para\_set.insert(block\_vec\_number[b]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02680}02680 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02681}02681       \textcolor{keywordflow}{if} (!para\_set\_ret.second)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02682}02682       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02683}02683         std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02684}02684         err\_msg << \textcolor{stringliteral}{"{}Error: the block number "{}} << block\_vec\_number[b]}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02685}02685                 << \textcolor{stringliteral}{"{} appears twice.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02686}02686         \textcolor{keywordflow}{throw} OomphLibError(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02687}02687           err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02688}02688       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02689}02689     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02690}02690 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02691}02691 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02692}02692     \textcolor{comment}{// Number of blocks to get.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02693}02693     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_block = block\_vec\_number.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02694}02694 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02695}02695     \textcolor{comment}{// Each block is made of dof types. We get the most fine grain dof types.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02696}02696     \textcolor{comment}{// Most fine grain in the sense that these are the dof types that belongs}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02697}02697     \textcolor{comment}{// in this block before any coarsening of dof types has taken place.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02698}02698     \textcolor{comment}{// The ordering of the dof types matters, this is handled properly when}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02699}02699     \textcolor{comment}{// creating the Block\_to\_dof\_map\_fine vector and must be respected here.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02700}02700     \textcolor{comment}{// I.e. we cannot arbitrarily insert dof types (even if they are correct)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02701}02701     \textcolor{comment}{// in the vector most\_fine\_grain\_dof.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02702}02702     Vector<unsigned> most\_fine\_grain\_dof;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02703}02703     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < n\_block; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02704}02704     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02705}02705       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} mapped\_b = block\_vec\_number[b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02706}02706       most\_fine\_grain\_dof.insert(most\_fine\_grain\_dof.end(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02707}02707                                  Block\_to\_dof\_map\_fine[mapped\_b].begin(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02708}02708                                  Block\_to\_dof\_map\_fine[mapped\_b].end());}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02709}02709     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02710}02710 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02711}02711     \textcolor{comment}{// Get all the dof level vectors in one go.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02712}02712     Vector<DoubleVector> dof\_block\_vector;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02713}02713     internal\_get\_block\_vectors(most\_fine\_grain\_dof, v, dof\_block\_vector);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02714}02714 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02715}02715     \textcolor{comment}{// Next we need to build the output DoubleVector w with the correct}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02716}02716     \textcolor{comment}{// distribution: the concatenation of the distributions of all the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02717}02717     \textcolor{comment}{// dof-\/level vectors. This is the same as the concatenation of the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02718}02718     \textcolor{comment}{// distributions of the blocks within this preconditioner.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02719}02719     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02720}02720     \textcolor{comment}{// So we first check if it exists already, if not, we create it and}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02721}02721     \textcolor{comment}{// store it for future use. We store it because concatenation of}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02722}02722     \textcolor{comment}{// distributions requires communication, so concatenation of}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02723}02723     \textcolor{comment}{// distributions on-\/the-\/fly should be avoided.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02724}02724     std::map<Vector<unsigned>, LinearAlgebraDistribution*>::const\_iterator iter;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02725}02725 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02726}02726     \textcolor{comment}{// Attempt to get an iterator pointing to the pair with the value}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02727}02727     \textcolor{comment}{// block\_vec\_number.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02728}02728     iter = Auxiliary\_block\_distribution\_pt.find(block\_vec\_number);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02729}02729 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02730}02730     \textcolor{keywordflow}{if} (iter != Auxiliary\_block\_distribution\_pt.end())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02731}02731     \textcolor{comment}{// If it exists, build w with the distribution pointed to}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02732}02732     \textcolor{comment}{// by pair::second.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02733}02733     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02734}02734       w.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(iter-\/>second);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02735}02735     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02736}02736     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02737}02737     \textcolor{comment}{// Else, we need to create the distribution and store it in}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02738}02738     \textcolor{comment}{// Auxiliary\_block\_distribution\_pt.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02739}02739     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02740}02740       Vector<LinearAlgebraDistribution*> tmp\_vec\_dist\_pt(n\_block, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02741}02741       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < n\_block; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02742}02742       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02743}02743         tmp\_vec\_dist\_pt[b] = Block\_distribution\_pt[block\_vec\_number[b]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02744}02744       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02745}02745 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02746}02746       \textcolor{comment}{// Note that the distribution is created with new but not deleted here.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02747}02747       \textcolor{comment}{// This is handled in the clean up functions.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02748}02748       LinearAlgebraDistribution* tmp\_dist\_pt = \textcolor{keyword}{new} LinearAlgebraDistribution;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02749}02749       \mbox{\hyperlink{namespaceoomph_1_1LinearAlgebraDistributionHelpers_af11187289196182ce650da88cfe37fc2}{LinearAlgebraDistributionHelpers::concatenate}}(tmp\_vec\_dist\_pt,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02750}02750                                                     *tmp\_dist\_pt);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02751}02751 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02752}02752       \textcolor{comment}{// Store the pair of Vector<unsigned> and LinearAlgebraDistribution*}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02753}02753       insert\_auxiliary\_block\_distribution(block\_vec\_number, tmp\_dist\_pt);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02754}02754 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02755}02755       \textcolor{comment}{// Build w.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02756}02756       w.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(tmp\_dist\_pt);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02757}02757     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02758}02758 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02759}02759     \textcolor{comment}{// Now concatenate all the dof level vectors into the vector w.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02760}02760     \mbox{\hyperlink{namespaceoomph_1_1DoubleVectorHelpers_a3ea9f7c40548e1a88402312e6f15d1fc}{DoubleVectorHelpers::concatenate\_without\_communication}}(dof\_block\_vector, w);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02761}02761 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02762}02762   \} \textcolor{comment}{// get\_concatenated\_block\_vector(...)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02763}02763 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02764}02764   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02765}02765 \textcolor{comment}{  /// Takes concatenated block ordered vector, b, and copies its}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02766}02766 \textcolor{comment}{}  \textcolor{comment}{// entries to the appropriate entries in the naturally ordered vector, v.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02767}02767   \textcolor{comment}{// Here the values in block\_vec\_number indicates which blocks the vector}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02768}02768   \textcolor{comment}{// b is a concatenation of. The block number are those in the current}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02769}02769   \textcolor{comment}{// preconditioner. If the preconditioner is a subsidiary block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02770}02770   \textcolor{comment}{// preconditioner the other entries in v that are not associated with it}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02771}02771   \textcolor{comment}{// are left alone.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02772}02772   \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02773}02773   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02774}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a6d5106c0b9dca23aa1cc7f7fd8e696cb}{02774}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a6d5106c0b9dca23aa1cc7f7fd8e696cb}{BlockPreconditioner<MATRIX>::return\_concatenated\_block\_vector}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02775}02775     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& block\_vec\_number,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02776}02776     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& w,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02777}02777     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& v)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02778}02778 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02779}02779 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02780}02780 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02781}02781     \textcolor{comment}{// Check if v is built.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02782}02782     \textcolor{keywordflow}{if} (!v.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02783}02783     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02784}02784       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02785}02785       err\_msg << \textcolor{stringliteral}{"{}The distribution of the global vector v must be setup."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02786}02786       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02787}02787         err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02788}02788     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02789}02789 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02790}02790     \textcolor{comment}{// v must have the same distribution as the upper-\/most master block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02791}02791     \textcolor{comment}{// preconditioner, since the upper-\/most master block preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02792}02792     \textcolor{comment}{// should have the same distribution as the matrix pointed to}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02793}02793     \textcolor{comment}{// by matrix\_pt().}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02794}02794     \textcolor{keywordflow}{if} (*(v.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()) != *(this-\/>master\_distribution\_pt()))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02795}02795     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02796}02796       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02797}02797       err\_msg << \textcolor{stringliteral}{"{}The distribution of the global vector v must match the "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02798}02798               << \textcolor{stringliteral}{"{} specified master\_distribution\_pt(). \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02799}02799               << \textcolor{stringliteral}{"{}i.e. Distribution\_pt in the master preconditioner"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02800}02800       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02801}02801         err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02802}02802     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02803}02803 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02804}02804     \textcolor{comment}{// Check to see if there are more blocks defined in the block\_vec\_number}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02805}02805     \textcolor{comment}{// vector than the number of block types. This is not allowed.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02806}02806     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} para\_block\_vec\_number\_size = block\_vec\_number.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02807}02807     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} para\_n\_block = nblock\_types();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02808}02808     \textcolor{keywordflow}{if} (para\_block\_vec\_number\_size > para\_n\_block)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02809}02809     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02810}02810       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02811}02811       err\_msg << \textcolor{stringliteral}{"{}Trying to return "{}} << para\_block\_vec\_number\_size}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02812}02812               << \textcolor{stringliteral}{"{} block vectors.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02813}02813               << \textcolor{stringliteral}{"{}But there are only "{}} << para\_n\_block << \textcolor{stringliteral}{"{} block types.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02814}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a4d8ff67e34e85a71c0f9bb68c0b10496}{02814}}       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02815}02815         err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02816}02816     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02817}02817 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02818}02818     \textcolor{comment}{// Check if any block numbers defined in block\_vec\_number is equal to or}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02819}02819     \textcolor{comment}{// greater than the number of block types.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02820}02820     \textcolor{comment}{// E.g. if there are 5 block types, we can only have block numbers:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02821}02821     \textcolor{comment}{//  0, 1, 2, 3 and 4.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02822}02822     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < para\_block\_vec\_number\_size; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02823}02823     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02824}02824       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} para\_required\_block = block\_vec\_number[b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02825}02825       \textcolor{keywordflow}{if} (para\_required\_block > para\_n\_block)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02826}02826       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02827}02827         std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02828}02828         err\_msg << \textcolor{stringliteral}{"{}block\_vec\_number["{}} << b << \textcolor{stringliteral}{"{}] is "{}} << para\_required\_block}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02829}02829                 << \textcolor{stringliteral}{"{}.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02830}02830                 << \textcolor{stringliteral}{"{}But there are only "{}} << para\_n\_block << \textcolor{stringliteral}{"{} block types.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02831}02831         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02832}02832           err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02833}02833       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02834}02834     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02835}02835 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02836}02836     \textcolor{comment}{// Check that no block number is inserted twice.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02837}02837     std::set<unsigned> para\_set;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02838}02838     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < para\_block\_vec\_number\_size; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02839}02839     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02840}02840       std::pair<std::set<unsigned>::iterator, \textcolor{keywordtype}{bool}> para\_set\_ret;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02841}02841       para\_set\_ret = para\_set.insert(block\_vec\_number[b]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02842}02842 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02843}02843       \textcolor{keywordflow}{if} (!para\_set\_ret.second)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02844}02844       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02845}02845         std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02846}02846         err\_msg << \textcolor{stringliteral}{"{}Error: the block number "{}} << block\_vec\_number[b]}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02847}02847                 << \textcolor{stringliteral}{"{} appears twice.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02848}02848         \textcolor{keywordflow}{throw} OomphLibError(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02849}02849           err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02850}02850       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02851}02851     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02852}02852 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02853}02853     \textcolor{comment}{// Check that w is built.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02854}02854     \textcolor{keywordflow}{if} (!w.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02855}02855     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02856}02856       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02857}02857       err\_msg << \textcolor{stringliteral}{"{}The distribution of the block vector w must be setup."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02858}02858       \textcolor{keywordflow}{throw} OomphLibError(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02859}02859         err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02860}02860     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02861}02861 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02862}02862     \textcolor{comment}{// Check that the distributions defined by block\_vec\_number is correct for}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02863}02863     \textcolor{comment}{// the distribution from w.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02864}02864     \textcolor{comment}{// Recall that w is the concatenation of the block vectors defined by}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02865}02865     \textcolor{comment}{// the values in block\_vec\_number. We check that this is the case.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02866}02866     Vector<LinearAlgebraDistribution*> para\_vec\_dist\_pt(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02867}02867       para\_block\_vec\_number\_size, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02868}02868 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02869}02869     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < para\_block\_vec\_number\_size; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02870}02870     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02871}02871       para\_vec\_dist\_pt[b] = Block\_distribution\_pt[block\_vec\_number[b]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02872}02872     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02873}02873 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02874}02874     LinearAlgebraDistribution para\_tmp\_dist;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02875}02875 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02876}02876     \mbox{\hyperlink{namespaceoomph_1_1LinearAlgebraDistributionHelpers_af11187289196182ce650da88cfe37fc2}{LinearAlgebraDistributionHelpers::concatenate}}(para\_vec\_dist\_pt,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02877}02877                                                   para\_tmp\_dist);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02878}02878 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02879}02879     \textcolor{keywordflow}{if} (*w.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() != para\_tmp\_dist)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02880}02880     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02881}02881       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02882}02882       err\_msg << \textcolor{stringliteral}{"{}The distribution of the block vector w does not match \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02883}02883               << \textcolor{stringliteral}{"{}the concatenation of the block distributions defined in \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02884}02884               << \textcolor{stringliteral}{"{}block\_vec\_number.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02885}02885       \textcolor{keywordflow}{throw} OomphLibError(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02886}02886         err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02887}02887     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02888}02888 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02889}02889 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02890}02890     \textcolor{comment}{// Number of blocks to return.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02891}02891     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_block = block\_vec\_number.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02892}02892 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02893}02893     \textcolor{comment}{// Each block is made of dof types. We get the most fine grain dof types.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02894}02894     \textcolor{comment}{// Most fine grain in the sense that these are the dof types that belongs}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02895}02895     \textcolor{comment}{// in this block before any coarsening of dof types has taken place.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02896}02896     \textcolor{comment}{// The ordering of the dof types matters, this is handled properly when}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02897}02897     \textcolor{comment}{// creating the Block\_to\_dof\_map\_fine vector and must be respected here.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02898}02898     \textcolor{comment}{// I.e. we cannot arbitrarily insert dof types (even if they are correct)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02899}02899     \textcolor{comment}{// in the vector most\_fine\_grain\_dof.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02900}02900     Vector<unsigned> most\_fine\_grain\_dof;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02901}02901     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < n\_block; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02902}02902     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02903}02903       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} mapped\_b = block\_vec\_number[b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02904}02904       most\_fine\_grain\_dof.insert(most\_fine\_grain\_dof.end(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02905}02905                                  Block\_to\_dof\_map\_fine[mapped\_b].begin(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02906}02906                                  Block\_to\_dof\_map\_fine[mapped\_b].end());}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02907}02907     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02908}02908 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02909}02909     \textcolor{comment}{// The number of most fine grain dof types associated with the blocks}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02910}02910     \textcolor{comment}{// defined by block\_vec\_number.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02911}02911     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} ndof = most\_fine\_grain\_dof.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02912}02912 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02913}02913     \textcolor{comment}{// Build each dof level vector with the correct distribution.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02914}02914     Vector<DoubleVector> dof\_vector(ndof);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02915}02915     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} d = 0; d < ndof; d++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02916}02916     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02917}02917       dof\_vector[d].build(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02918}02918         internal\_block\_distribution\_pt(most\_fine\_grain\_dof[d]));}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02919}02919     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02920}02920 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02921}02921     \textcolor{comment}{// Perform the splitting of w into the most fine grain dof level vectors.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02922}02922     \mbox{\hyperlink{namespaceoomph_1_1DoubleVectorHelpers_aa87594da930b3eed12a27838972f10f8}{DoubleVectorHelpers::split\_without\_communication}}(w, dof\_vector);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02923}02923 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02924}02924     \textcolor{comment}{// Return all the dof level vectors in one go.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02925}02925     internal\_return\_block\_vectors(most\_fine\_grain\_dof, dof\_vector, v);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02926}02926   \} \textcolor{comment}{// return\_concatenated\_block\_vector(...)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02927}02927 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02928}02928   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02929}02929 \textcolor{comment}{  /// Takes the naturally ordered vector and rearranges it into a}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02930}02930 \textcolor{comment}{  /// vector of sub vectors corresponding to the blocks, so s[b][i] contains}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02931}02931 \textcolor{comment}{  /// the i-\/th entry in the vector associated with block b.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02932}02932 \textcolor{comment}{  /// Note: If the preconditioner is a subsidiary preconditioner then only the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02933}02933 \textcolor{comment}{  /// sub-\/vectors associated with the blocks of the subsidiary preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02934}02934 \textcolor{comment}{  /// will be included. Hence the length of v is master\_nrow() whereas the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02935}02935 \textcolor{comment}{  /// total length of the s vectors is the sum of the lengths of the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02936}02936 \textcolor{comment}{  /// individual block vectors defined in block\_vec\_number.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02937}02937 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02938}02938   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02939}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_ad356946d5de4f0817cdf8793fa3cdc74}{02939}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_ad356946d5de4f0817cdf8793fa3cdc74}{BlockPreconditioner<MATRIX>::get\_block\_vectors}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02940}02940     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& block\_vec\_number,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02941}02941     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& v,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02942}02942     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}})\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02943}02943 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02944}02944 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02945}02945 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02946}02946     \textcolor{comment}{// Check if v is built.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02947}02947     \textcolor{keywordflow}{if} (!v.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02948}02948     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02949}02949       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02950}02950       err\_msg << \textcolor{stringliteral}{"{}The distribution of the global vector v must be setup."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02951}02951       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02952}02952         err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02953}02953     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02954}02954 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02955}02955     \textcolor{comment}{// v must have the same distribution as the upper-\/most master block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02956}02956     \textcolor{comment}{// preconditioner, since the upper-\/most master block preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02957}02957     \textcolor{comment}{// should have the same distribution as the matrix pointed to}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02958}02958     \textcolor{comment}{// by matrix\_pt().}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02959}02959     \textcolor{keywordflow}{if} (*(v.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()) != *(this-\/>master\_distribution\_pt()))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02960}02960     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02961}02961       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02962}02962       err\_msg << \textcolor{stringliteral}{"{}The distribution of the global vector v must match the "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02963}02963               << \textcolor{stringliteral}{"{} specified master\_distribution\_pt(). \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02964}02964               << \textcolor{stringliteral}{"{}i.e. Distribution\_pt in the master preconditioner"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02965}02965       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02966}02966         err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02967}02967     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02968}02968 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02969}02969     \textcolor{comment}{// Check to see if there are more blocks defined in the block\_vec\_number}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02970}02970     \textcolor{comment}{// vector than the number of block types. This is not allowed.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02971}02971     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} para\_nblock\_types = nblock\_types();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02972}02972     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} para\_block\_vec\_number\_size = block\_vec\_number.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02973}02973     \textcolor{keywordflow}{if} (para\_block\_vec\_number\_size > para\_nblock\_types)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02974}02974     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02975}02975       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02976}02976       err\_msg << \textcolor{stringliteral}{"{}You have requested "{}} << para\_block\_vec\_number\_size}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02977}02977               << \textcolor{stringliteral}{"{} number of blocks, (block\_vec\_number.size() is "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02978}02978               << para\_block\_vec\_number\_size << \textcolor{stringliteral}{"{}).\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02979}02979               << \textcolor{stringliteral}{"{}But there are only "{}} << para\_nblock\_types}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02980}02980               << \textcolor{stringliteral}{"{} nblock\_types.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02981}02981               << \textcolor{stringliteral}{"{}Please make sure that block\_vec\_number is correctly sized.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02982}02982       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02983}02983         err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02984}02984     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02985}02985 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02986}02986     \textcolor{comment}{// Check if any block numbers defined in block\_vec\_number is equal to or}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02987}02987     \textcolor{comment}{// greater than the number of block types.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02988}02988     \textcolor{comment}{// E.g. if there are 5 block types, we can only have block numbers:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02989}02989     \textcolor{comment}{//  0, 1, 2, 3 and 4.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02990}02990     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < para\_block\_vec\_number\_size; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02991}02991     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02992}02992       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} para\_required\_block = block\_vec\_number[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02993}02993       \textcolor{keywordflow}{if} (para\_required\_block > para\_nblock\_types)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02994}02994       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02995}02995         std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02996}02996         err\_msg << \textcolor{stringliteral}{"{}block\_vec\_number["{}} << \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} << \textcolor{stringliteral}{"{}] is "{}} << para\_required\_block}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02997}02997                 << \textcolor{stringliteral}{"{}.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02998}02998                 << \textcolor{stringliteral}{"{}But there are only "{}} << para\_nblock\_types}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l02999}02999                 << \textcolor{stringliteral}{"{} nblock\_types.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03000}03000         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03001}03001           err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03002}03002       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03003}03003     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03004}03004     \textcolor{comment}{// Check that no block number is inserted twice.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03005}03005     std::set<unsigned> para\_set;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03006}03006     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < para\_block\_vec\_number\_size; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03007}03007     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03008}03008       std::pair<std::set<unsigned>::iterator, \textcolor{keywordtype}{bool}> para\_set\_ret;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03009}03009       para\_set\_ret = para\_set.insert(block\_vec\_number[b]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03010}03010 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03011}03011       \textcolor{keywordflow}{if} (!para\_set\_ret.second)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03012}03012       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03013}03013         std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03014}03014         err\_msg << \textcolor{stringliteral}{"{}Error: the block number "{}} << block\_vec\_number[b]}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03015}03015                 << \textcolor{stringliteral}{"{} appears twice.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03016}03016         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03017}03017           err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03018}03018       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03019}03019     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03020}03020 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03021}03021 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03022}03022     \textcolor{comment}{// Number of blocks to get.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03023}03023     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_block = block\_vec\_number.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03024}03024     \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}.resize(n\_block);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03025}03025 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03026}03026     \textcolor{comment}{// Each block is made of dof types. We get the most fine grain dof types.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03027}03027     \textcolor{comment}{// Most fine grain in the sense that these are the dof types that belongs}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03028}03028     \textcolor{comment}{// in this block before any coarsening of dof types has taken place.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03029}03029     \textcolor{comment}{// The ordering of the dof types matters, this is handled properly when}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03030}03030     \textcolor{comment}{// creating the Block\_to\_dof\_map\_fine vector and must be respected here.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03031}03031     \textcolor{comment}{// I.e. we cannot arbitrarily insert dof types (even if they are correct)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03032}03032     \textcolor{comment}{// in the vector most\_fine\_grain\_dof.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03033}03033     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} most\_fine\_grain\_dof;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03034}03034     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < n\_block; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03035}03035     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03036}03036       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} mapped\_b = block\_vec\_number[b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03037}03037 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03038}03038       most\_fine\_grain\_dof.insert(most\_fine\_grain\_dof.end(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03039}03039                                  Block\_to\_dof\_map\_fine[mapped\_b].begin(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03040}03040                                  Block\_to\_dof\_map\_fine[mapped\_b].end());}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03041}03041     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03042}03042 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03043}03043     \textcolor{comment}{// Get all the dof level vectors in one go.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03044}03044     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}} dof\_vector;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03045}03045     internal\_get\_block\_vectors(most\_fine\_grain\_dof, v, dof\_vector);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03046}03046 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03047}03047     \textcolor{comment}{// For each block vector requested,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03048}03048     \textcolor{comment}{// build the block s[b],}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03049}03049     \textcolor{comment}{// concatenate the corresponding dof vector}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03050}03050 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03051}03051     \textcolor{comment}{// Since all the dof vectors are in dof\_vector,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03052}03052     \textcolor{comment}{// we need to loop through this.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03053}03053     \textcolor{comment}{// The offset helps us loop through this.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03054}03054     \textcolor{keywordtype}{unsigned} offset = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03055}03055 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03056}03056     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < n\_block; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03057}03057     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03058}03058       \textcolor{comment}{// The actual block number required.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03059}03059       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} mapped\_b = block\_vec\_number[b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03060}03060 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03061}03061       \textcolor{comment}{// How many most fine grain dofs are in this block?}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03062}03062       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_dof = Block\_to\_dof\_map\_fine[mapped\_b].size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03063}03063 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03064}03064       \textcolor{keywordflow}{if} (n\_dof == 1)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03065}03065       \textcolor{comment}{// No need to concatenate, just copy the DoubleVector.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03066}03066       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03067}03067         \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[b] = dof\_vector[offset];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03068}03068       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03069}03069       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03070}03070       \textcolor{comment}{// Concatenate the relevant dof vectors into s[b].}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03071}03071       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03072}03072         \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[b].build(Block\_distribution\_pt[mapped\_b], 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03073}03073         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector*>}} tmp\_vec\_pt(n\_dof, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03074}03074         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} vec\_i = 0; vec\_i < n\_dof; vec\_i++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03075}03075         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03076}03076           tmp\_vec\_pt[vec\_i] = \&dof\_vector[offset + vec\_i];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03077}03077         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03078}03078 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03079}03079         \mbox{\hyperlink{namespaceoomph_1_1DoubleVectorHelpers_a3ea9f7c40548e1a88402312e6f15d1fc}{DoubleVectorHelpers::concatenate\_without\_communication}}(tmp\_vec\_pt,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03080}03080                                                                \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[b]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03081}03081       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03082}03082 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03083}03083       \textcolor{comment}{// Update the offset.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03084}03084       offset += n\_dof;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03085}03085     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03086}03086   \} \textcolor{comment}{// get\_block\_vectors(...)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03087}03087 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03088}03088 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03089}03089   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03090}03090 \textcolor{comment}{  /// Takes the naturally ordered vector and rearranges it into a}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03091}03091 \textcolor{comment}{  /// vector of sub vectors corresponding to the blocks, so s[b][i] contains}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03092}03092 \textcolor{comment}{  /// the i-\/th entry in the vector associated with block b.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03093}03093 \textcolor{comment}{  /// Note: If the preconditioner is a subsidiary preconditioner then only the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03094}03094 \textcolor{comment}{  /// sub-\/vectors associated with the blocks of the subsidiary preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03095}03095 \textcolor{comment}{  /// will be included. Hence the length of v is master\_nrow() whereas the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03096}03096 \textcolor{comment}{  /// total length of the s vectors is Nrow.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03097}03097 \textcolor{comment}{  /// This is simply a wrapper around the other get\_block\_vectors(...) function}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03098}03098 \textcolor{comment}{  /// where the block\_vec\_number Vector is the identity, i.e.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03099}03099 \textcolor{comment}{  /// block\_vec\_number is [0, 1, ..., nblock\_types -\/ 1].}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03100}03100 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03101}03101   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03102}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a0517a3678def8b89ae69840345a8f838}{03102}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_ad356946d5de4f0817cdf8793fa3cdc74}{BlockPreconditioner<MATRIX>::get\_block\_vectors}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03103}03103     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& v, \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}})\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03104}03104 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03105}03105     \textcolor{comment}{// Get the number of blocks in this block preconditioner.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03106}03106     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_block = nblock\_types();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03107}03107 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03108}03108     \textcolor{comment}{// Create the identity vector.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03109}03109     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} required\_block(n\_block, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03110}03110     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_block; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03111}03111     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03112}03112       required\_block[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03113}03113     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03114}03114 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03115}03115     \textcolor{comment}{// Call the other function which does the work.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03116}03116     get\_block\_vectors(required\_block, v, \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}});}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03117}03117   \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03118}03118 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03119}03119   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03120}03120 \textcolor{comment}{  /// Takes the naturally ordered vector and}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03121}03121 \textcolor{comment}{  /// rearranges it into a vector of sub vectors corresponding to the blocks,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03122}03122 \textcolor{comment}{  /// so s[b][i] contains the i-\/th entry in the vector associated with block b.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03123}03123 \textcolor{comment}{  /// The block\_vec\_number indicates which blocks we want.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03124}03124 \textcolor{comment}{  /// These blocks and vectors are those corresponding to the internal blocks.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03125}03125 \textcolor{comment}{  /// Note: If the preconditioner is a subsidiary preconditioner then only the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03126}03126 \textcolor{comment}{  /// sub-\/vectors associated with the blocks of the subsidiary preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03127}03127 \textcolor{comment}{  /// will be included. Hence the length of v is master\_nrow() whereas the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03128}03128 \textcolor{comment}{  /// total length of the s vectors is the sum of the Nrow of the sub vectors.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03129}03129 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03130}03130   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03131}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_ace6e9dbdfe9a1c3571452e2cd6ec9780}{03131}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_ace6e9dbdfe9a1c3571452e2cd6ec9780}{BlockPreconditioner<MATRIX>::internal\_get\_block\_vectors}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03132}03132     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& block\_vec\_number,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03133}03133     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& v,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03134}03134     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}})\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03135}03135 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03136}03136 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03137}03137     \textcolor{keywordflow}{if} (!v.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03138}03138     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03139}03139       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03140}03140       error\_message << \textcolor{stringliteral}{"{}The distribution of the global vector v must be setup."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03141}03141       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03142}03142         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03143}03143     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03144}03144     \textcolor{keywordflow}{if} (*(v.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()) != *(this-\/>master\_distribution\_pt()))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03145}03145     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03146}03146       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03147}03147       error\_message << \textcolor{stringliteral}{"{}The distribution of the global vector v must match the "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03148}03148                     << \textcolor{stringliteral}{"{} specified master\_distribution\_pt(). \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03149}03149                     << \textcolor{stringliteral}{"{}i.e. Distribution\_pt in the master preconditioner"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03150}03150       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03151}03151         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03152}03152     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03153}03153 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03154}03154 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03155}03155     \textcolor{comment}{// Number of block types}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03156}03156     \textcolor{comment}{// const unsigned nblock = this-\/>internal\_nblock\_types();}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03157}03157     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nblock = block\_vec\_number.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03158}03158 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03159}03159     \textcolor{comment}{// if + only one processor}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03160}03160     \textcolor{comment}{//    + more than one processor but matrix\_pt is not distributed}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03161}03161     \textcolor{comment}{// then use the serial get\_block method}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03162}03162     \textcolor{keywordflow}{if} (this-\/>distribution\_pt()-\/>communicator\_pt()-\/>nproc() == 1 ||}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03163}03163         !this-\/>distribution\_pt()-\/>distributed())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03164}03164     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03165}03165       \textcolor{comment}{// Vector of vectors for each section of residual vector}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03166}03166       \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}.resize(nblock);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03167}03167 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03168}03168       \textcolor{comment}{// pointer to the data in v}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03169}03169       \textcolor{keyword}{const} \textcolor{keywordtype}{double}* v\_pt = v.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03170}03170 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03171}03171       \textcolor{comment}{// setup the block vector and then insert the data}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03172}03172       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < nblock; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03173}03173       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03174}03174         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} required\_block = block\_vec\_number[b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03175}03175         \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[b].build(Internal\_block\_distribution\_pt[required\_block], 0.0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03176}03176         \textcolor{keywordtype}{double}* s\_pt = \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[b].values\_pt();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03177}03177         \textcolor{keywordtype}{unsigned} nrow = \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[b].nrow();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03178}03178         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nrow; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03179}03179         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03180}03180           s\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = v\_pt[this-\/>Global\_index[required\_block][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03181}03181         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03182}03182       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03183}03183     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03184}03184     \textcolor{comment}{// otherwise use mpi}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03185}03185     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03186}03186     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03187}03187 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03188}03188       \textcolor{comment}{// my rank}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03189}03189       \textcolor{keywordtype}{unsigned} my\_rank = this-\/>distribution\_pt()-\/>communicator\_pt()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03190}03190 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03191}03191       \textcolor{comment}{// the number of processors}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03192}03192       \textcolor{keywordtype}{unsigned} nproc = this-\/>distribution\_pt()-\/>communicator\_pt()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03193}03193 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03194}03194       \textcolor{comment}{// build the vectors}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03195}03195       \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}.resize(nblock);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03196}03196       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < nblock; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03197}03197       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03198}03198         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} required\_block = block\_vec\_number[b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03199}03199         \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[b].build(Internal\_block\_distribution\_pt[required\_block], 0.0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03200}03200       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03201}03201 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03202}03202       \textcolor{comment}{// determine the maximum number of rows to be sent or recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03203}03203       \textcolor{comment}{// and determine the number of blocks each processor will send and recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03204}03204       \textcolor{comment}{// communication for}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03205}03205       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} nblock\_send(nproc, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03206}03206       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} nblock\_recv(nproc, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03207}03207       \textcolor{keywordtype}{unsigned} max\_n\_send\_or\_recv = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03208}03208       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03209}03209       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03210}03210         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < nblock; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03211}03211         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03212}03212           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} required\_block = block\_vec\_number[b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03213}03213           max\_n\_send\_or\_recv = std::max(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03214}03214             max\_n\_send\_or\_recv, Nrows\_to\_send\_for\_get\_block(required\_block, p));}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03215}03215           max\_n\_send\_or\_recv = std::max(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03216}03216             max\_n\_send\_or\_recv, Nrows\_to\_recv\_for\_get\_block(required\_block, p));}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03217}03217           \textcolor{keywordflow}{if} (Nrows\_to\_send\_for\_get\_block(required\_block, p) > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03218}03218           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03219}03219             nblock\_send[p]++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03220}03220           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03221}03221           \textcolor{keywordflow}{if} (Nrows\_to\_recv\_for\_get\_block(required\_block, p) > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03222}03222           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03223}03223             nblock\_recv[p]++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03224}03224           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03225}03225         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03226}03226       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03227}03227 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03228}03228       \textcolor{comment}{// create a vectors of 1s the size of the nblock for the mpi indexed}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03229}03229       \textcolor{comment}{// data types}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03230}03230       \textcolor{keywordtype}{int}* block\_lengths = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[max\_n\_send\_or\_recv];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03231}03231       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < max\_n\_send\_or\_recv; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03232}03232       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03233}03233         block\_lengths[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03234}03234       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03235}03235 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03236}03236       \textcolor{comment}{// perform the sends and receives}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03237}03237       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Request>}} requests;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03238}03238       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03239}03239       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03240}03240         \textcolor{comment}{// send and recv with other processors}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03241}03241         \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03242}03242         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03243}03243           \textcolor{comment}{// send}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03244}03244           \textcolor{keywordflow}{if} (nblock\_send[p] > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03245}03245           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03246}03246             \textcolor{comment}{// create the datatypes vector}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03247}03247             MPI\_Datatype block\_send\_types[nblock\_send[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03248}03248 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03249}03249             \textcolor{comment}{// create the datatypes}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03250}03250             \textcolor{keywordtype}{unsigned} ptr = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03251}03251             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < nblock; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03252}03252             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03253}03253               \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} required\_block = block\_vec\_number[b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03254}03254 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03255}03255               \textcolor{keywordflow}{if} (Nrows\_to\_send\_for\_get\_block(required\_block, p) > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03256}03256               \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03257}03257                 MPI\_Type\_indexed(Nrows\_to\_send\_for\_get\_block(required\_block, p),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03258}03258                                  block\_lengths,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03259}03259                                  Rows\_to\_send\_for\_get\_block(required\_block, p),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03260}03260                                  MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03261}03261                                  \&block\_send\_types[ptr]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03262}03262                 MPI\_Type\_commit(\&block\_send\_types[ptr]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03263}03263                 ptr++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03264}03264               \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03265}03265             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03266}03266 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03267}03267             \textcolor{comment}{// compute the displacements and lengths}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03268}03268             MPI\_Aint displacements[nblock\_send[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03269}03269             \textcolor{keywordtype}{int} lengths[nblock\_send[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03270}03270             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nblock\_send[p]; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03271}03271             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03272}03272               lengths[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03273}03273               displacements[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03274}03274             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03275}03275 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03276}03276             \textcolor{comment}{// build the final datatype}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03277}03277             MPI\_Datatype type\_send;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03278}03278             MPI\_Type\_create\_struct(nblock\_send[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03279}03279                                    lengths,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03280}03280                                    displacements,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03281}03281                                    block\_send\_types,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03282}03282                                    \&type\_send);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03283}03283             MPI\_Type\_commit(\&type\_send);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03284}03284 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03285}03285             \textcolor{comment}{// send}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03286}03286             MPI\_Request send\_req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03287}03287             MPI\_Isend(\textcolor{keyword}{const\_cast<}\textcolor{keywordtype}{double}*\textcolor{keyword}{>}(v.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}()),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03288}03288                       1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03289}03289                       type\_send,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03290}03290                       p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03291}03291                       0,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03292}03292                       this-\/>distribution\_pt()-\/>communicator\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03293}03293                       \&send\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03294}03294             MPI\_Type\_free(\&type\_send);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03295}03295             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nblock\_send[p]; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03296}03296             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03297}03297               MPI\_Type\_free(\&block\_send\_types[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03298}03298             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03299}03299             requests.push\_back(send\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03300}03300           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03301}03301 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03302}03302           \textcolor{comment}{// recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03303}03303           \textcolor{keywordflow}{if} (nblock\_recv[p] > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03304}03304           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03305}03305             \textcolor{comment}{// create the datatypes vector}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03306}03306             MPI\_Datatype block\_recv\_types[nblock\_recv[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03307}03307 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03308}03308             \textcolor{comment}{// and the displacements}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03309}03309             MPI\_Aint displacements[nblock\_recv[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03310}03310 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03311}03311             \textcolor{comment}{// and the lengths}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03312}03312             \textcolor{keywordtype}{int} lengths[nblock\_recv[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03313}03313 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03314}03314             \textcolor{comment}{// all displacements are computed relative to s[0] values}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03315}03315             MPI\_Aint displacements\_base;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03316}03316             MPI\_Get\_address(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[0].values\_pt(), \&displacements\_base);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03317}03317 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03318}03318             \textcolor{comment}{// now build}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03319}03319             \textcolor{keywordtype}{unsigned} ptr = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03320}03320             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < nblock; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03321}03321             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03322}03322               \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} required\_block = block\_vec\_number[b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03323}03323 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03324}03324               \textcolor{keywordflow}{if} (Nrows\_to\_recv\_for\_get\_block(required\_block, p) > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03325}03325               \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03326}03326                 MPI\_Type\_indexed(Nrows\_to\_recv\_for\_get\_block(required\_block, p),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03327}03327                                  block\_lengths,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03328}03328                                  Rows\_to\_recv\_for\_get\_block(required\_block, p),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03329}03329                                  MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03330}03330                                  \&block\_recv\_types[ptr]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03331}03331                 MPI\_Type\_commit(\&block\_recv\_types[ptr]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03332}03332                 MPI\_Get\_address(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[b].values\_pt(), \&displacements[ptr]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03333}03333                 displacements[ptr] -\/= displacements\_base;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03334}03334                 lengths[ptr] = 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03335}03335                 ptr++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03336}03336               \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03337}03337             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03338}03338 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03339}03339             \textcolor{comment}{// build the final data type}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03340}03340             MPI\_Datatype type\_recv;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03341}03341             MPI\_Type\_create\_struct(nblock\_recv[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03342}03342                                    lengths,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03343}03343                                    displacements,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03344}03344                                    block\_recv\_types,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03345}03345                                    \&type\_recv);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03346}03346             MPI\_Type\_commit(\&type\_recv);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03347}03347 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03348}03348             \textcolor{comment}{// recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03349}03349             MPI\_Request recv\_req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03350}03350             MPI\_Irecv(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[0].values\_pt(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03351}03351                       1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03352}03352                       type\_recv,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03353}03353                       p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03354}03354                       0,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03355}03355                       this-\/>distribution\_pt()-\/>communicator\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03356}03356                       \&recv\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03357}03357             MPI\_Type\_free(\&type\_recv);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03358}03358             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nblock\_recv[p]; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03359}03359             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03360}03360               MPI\_Type\_free(\&block\_recv\_types[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03361}03361             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03362}03362             requests.push\_back(recv\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03363}03363           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03364}03364         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03365}03365 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03366}03366         \textcolor{comment}{// communicate with self}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03367}03367         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03368}03368         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03369}03369           \textcolor{keyword}{const} \textcolor{keywordtype}{double}* v\_values\_pt = v.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03370}03370           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < nblock; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03371}03371           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03372}03372             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} required\_block = block\_vec\_number[b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03373}03373 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03374}03374             \textcolor{keywordtype}{double}* w\_values\_pt = \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[b].values\_pt();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03375}03375             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03376}03376                  \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < Nrows\_to\_send\_for\_get\_block(required\_block, p);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03377}03377                  \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03378}03378             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03379}03379               w\_values\_pt[Rows\_to\_recv\_for\_get\_block(required\_block, p)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03380}03380                 v\_values\_pt[Rows\_to\_send\_for\_get\_block(required\_block, p)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03381}03381             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03382}03382           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03383}03383         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03384}03384       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03385}03385 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03386}03386       \textcolor{comment}{// and then just wait}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03387}03387       \textcolor{keywordtype}{unsigned} c = requests.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03388}03388       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Status>}} stat(c);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03389}03389       \textcolor{keywordflow}{if} (c)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03390}03390       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03391}03391         MPI\_Waitall(c, \&requests[0], \&stat[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03392}03392       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03393}03393       \textcolor{keyword}{delete}[] block\_lengths;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03394}03394 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03395}03395 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03396}03396       \textcolor{comment}{// throw error}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03397}03397       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03398}03398       error\_message << \textcolor{stringliteral}{"{}The preconditioner is distributed and on more than one "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03399}03399                     << \textcolor{stringliteral}{"{}processor. MPI is required."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03400}03400       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03401}03401         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03402}03402 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03403}03403     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03404}03404   \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03405}03405 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03406}03406   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03407}03407 \textcolor{comment}{  /// A helper function, takes the naturally ordered vector and}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03408}03408 \textcolor{comment}{  /// rearranges it into a vector of sub vectors corresponding to the blocks,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03409}03409 \textcolor{comment}{  /// so s[b][i] contains the i-\/th entry in the vector associated with block b.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03410}03410 \textcolor{comment}{  /// The block\_vec\_number indicates which blocks we want.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03411}03411 \textcolor{comment}{  /// These blocks and vectors are those corresponding to the internal blocks.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03412}03412 \textcolor{comment}{  /// Note: If the preconditioner is a subsidiary preconditioner then only the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03413}03413 \textcolor{comment}{  /// sub-\/vectors associated with the blocks of the subsidiary preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03414}03414 \textcolor{comment}{  /// will be included. Hence the length of v is master\_nrow() whereas the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03415}03415 \textcolor{comment}{  /// total length of the s vectors is the sum of the Nrow of the sub vectors.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03416}03416 \textcolor{comment}{  /// This is simply a wrapper around the other internal\_get\_block\_vectors(...)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03417}03417 \textcolor{comment}{  /// function with the identity block\_vec\_number vector.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03418}03418 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03419}03419   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03420}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a0cde8af922cd8054dbf352527dd682b1}{03420}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_ace6e9dbdfe9a1c3571452e2cd6ec9780}{BlockPreconditioner<MATRIX>::internal\_get\_block\_vectors}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03421}03421     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& v, \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}})\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03422}03422 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03423}03423     \textcolor{comment}{// Number of block types}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03424}03424     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nblock = this-\/>internal\_nblock\_types();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03425}03425     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} block\_vec\_number(nblock, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03426}03426     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < nblock; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03427}03427     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03428}03428       block\_vec\_number[b] = b;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03429}03429     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03430}03430 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03431}03431     internal\_get\_block\_vectors(block\_vec\_number, v, \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}});}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03432}03432   \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03433}03433 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03434}03434   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03435}03435 \textcolor{comment}{  /// Takes the vector of block vectors, s, and copies its entries into}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03436}03436 \textcolor{comment}{  /// the naturally ordered vector, v. If this is a subsidiary block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03437}03437 \textcolor{comment}{  /// preconditioner only those entries in v that are associated with its}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03438}03438 \textcolor{comment}{  /// blocks are affected. The block\_vec\_number indicates which block the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03439}03439 \textcolor{comment}{  /// vectors in s came from. The block number corresponds to the block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03440}03440 \textcolor{comment}{  /// numbers in this preconditioner.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03441}03441 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03442}03442   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03443}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a71d48d8a70151ef0febd4537a2214c53}{03443}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a71d48d8a70151ef0febd4537a2214c53}{BlockPreconditioner<MATRIX>::return\_block\_vectors}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03444}03444     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& block\_vec\_number,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03445}03445     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}},}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03446}03446     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& v)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03447}03447 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03448}03448 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03449}03449 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03450}03450     \textcolor{comment}{// Check if v is built.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03451}03451     \textcolor{keywordflow}{if} (!v.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03452}03452     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03453}03453       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03454}03454       err\_msg << \textcolor{stringliteral}{"{}The distribution of the global vector v must be setup."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03455}03455       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03456}03456         err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03457}03457     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03458}03458 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03459}03459     \textcolor{comment}{// v must have the same distribution as the upper-\/most master block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03460}03460     \textcolor{comment}{// preconditioner, since the upper-\/most master block preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03461}03461     \textcolor{comment}{// should have the same distribution as the matrix pointed to}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03462}03462     \textcolor{comment}{// by matrix\_pt().}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03463}03463     \textcolor{keywordflow}{if} (*(v.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()) != *(this-\/>master\_distribution\_pt()))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03464}03464     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03465}03465       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03466}03466       err\_msg << \textcolor{stringliteral}{"{}The distribution of the global vector v must match the "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03467}03467               << \textcolor{stringliteral}{"{} specified master\_distribution\_pt(). \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03468}03468               << \textcolor{stringliteral}{"{}i.e. Distribution\_pt in the master preconditioner"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03469}03469       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03470}03470         err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03471}03471     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03472}03472 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03473}03473     \textcolor{comment}{// Check if the number of vectors in s is the same as the number of block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03474}03474     \textcolor{comment}{// numbers described in block\_vec\_number.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03475}03475     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} para\_block\_vec\_number\_size = block\_vec\_number.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03476}03476     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} para\_s\_size = \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03477}03477     \textcolor{keywordflow}{if} (para\_block\_vec\_number\_size != para\_s\_size)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03478}03478     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03479}03479       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03480}03480       err\_msg << \textcolor{stringliteral}{"{}block\_vec\_number.size() is "{}} << para\_block\_vec\_number\_size}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03481}03481               << \textcolor{stringliteral}{"{}\(\backslash\)n."{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03482}03482               << \textcolor{stringliteral}{"{}s.size() is "{}} << para\_s\_size << \textcolor{stringliteral}{"{}.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03483}03483               << \textcolor{stringliteral}{"{}But they must be the same size!\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03484}03484       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03485}03485         err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03486}03486     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03487}03487 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03488}03488     \textcolor{comment}{// Check to see if there are more blocks defined in the block\_vec\_number}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03489}03489     \textcolor{comment}{// vector than the number of block types. This is not allowed.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03490}03490     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} para\_n\_block = nblock\_types();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03491}03491     \textcolor{keywordflow}{if} (para\_block\_vec\_number\_size > para\_n\_block)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03492}03492     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03493}03493       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03494}03494       err\_msg << \textcolor{stringliteral}{"{}Trying to return "{}} << para\_block\_vec\_number\_size}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03495}03495               << \textcolor{stringliteral}{"{} block vectors.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03496}03496               << \textcolor{stringliteral}{"{}But there are only "{}} << para\_n\_block << \textcolor{stringliteral}{"{} block types.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03497}03497       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03498}03498         err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03499}03499     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03500}03500 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03501}03501     \textcolor{comment}{// Check if any block numbers defined in block\_vec\_number is equal to or}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03502}03502     \textcolor{comment}{// greater than the number of block types.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03503}03503     \textcolor{comment}{// E.g. if there are 5 block types, we can only have block numbers:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03504}03504     \textcolor{comment}{//  0, 1, 2, 3 and 4.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03505}03505     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < para\_block\_vec\_number\_size; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03506}03506     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03507}03507       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} para\_required\_block = block\_vec\_number[b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03508}03508       \textcolor{keywordflow}{if} (para\_required\_block > para\_n\_block)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03509}03509       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03510}03510         std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03511}03511         err\_msg << \textcolor{stringliteral}{"{}block\_vec\_number["{}} << b << \textcolor{stringliteral}{"{}] is "{}} << para\_required\_block}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03512}03512                 << \textcolor{stringliteral}{"{}.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03513}03513                 << \textcolor{stringliteral}{"{}But there are only "{}} << para\_n\_block << \textcolor{stringliteral}{"{} block types.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03514}03514         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03515}03515           err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03516}03516       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03517}03517     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03518}03518 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03519}03519     \textcolor{comment}{// Check that no block number is inserted twice.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03520}03520     std::set<unsigned> para\_set;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03521}03521     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < para\_block\_vec\_number\_size; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03522}03522     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03523}03523       std::pair<std::set<unsigned>::iterator, \textcolor{keywordtype}{bool}> para\_set\_ret;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03524}03524       para\_set\_ret = para\_set.insert(block\_vec\_number[b]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03525}03525 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03526}03526       \textcolor{keywordflow}{if} (!para\_set\_ret.second)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03527}03527       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03528}03528         std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03529}03529         err\_msg << \textcolor{stringliteral}{"{}Error: the block number "{}} << block\_vec\_number[b]}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03530}03530                 << \textcolor{stringliteral}{"{} appears twice.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03531}03531         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03532}03532           err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03533}03533       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03534}03534     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03535}03535 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03536}03536     \textcolor{comment}{// Check to see that all the vectors in s are built}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03537}03537     \textcolor{comment}{// (since we are trying to return them).}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03538}03538     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < para\_block\_vec\_number\_size; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03539}03539     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03540}03540       \textcolor{keywordflow}{if} (!\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[b].built())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03541}03541       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03542}03542         std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03543}03543         err\_msg << \textcolor{stringliteral}{"{}The distribution of the block vector s["{}} << b}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03544}03544                 << \textcolor{stringliteral}{"{}] must be setup.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03545}03545         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03546}03546           err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03547}03547       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03548}03548     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03549}03549 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03550}03550     \textcolor{comment}{// Since these are built, we check that the distributions are correct.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03551}03551     \textcolor{comment}{// This are incorrect if the block numbers in block\_vec\_number and}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03552}03552     \textcolor{comment}{// the vectors in s does not match.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03553}03553     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < para\_block\_vec\_number\_size; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03554}03554     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03555}03555       \textcolor{keywordflow}{if} (*(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[b].distribution\_pt()) !=}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03556}03556           *(Block\_distribution\_pt[block\_vec\_number[b]]))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03557}03557       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03558}03558         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03559}03559         error\_message}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03560}03560           << \textcolor{stringliteral}{"{}The distribution of the block vector "{}} << b << \textcolor{stringliteral}{"{} must match the"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03561}03561           << \textcolor{stringliteral}{"{} specified distribution at "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03562}03562           << \textcolor{stringliteral}{"{}Block\_distribution\_pt["{}} << block\_vec\_number[b] << \textcolor{stringliteral}{"{}].\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03563}03563           << \textcolor{stringliteral}{"{}The distribution of the Block\_distribution\_pt is determined by\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03564}03564           << \textcolor{stringliteral}{"{}the vector block\_vec\_number. Perhaps it is incorrect?\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03565}03565         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03566}03566                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03567}03567                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03568}03568       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03569}03569     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03570}03570 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03571}03571 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03572}03572     \textcolor{comment}{// Number of blocks to get.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03573}03573     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_block = block\_vec\_number.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03574}03574 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03575}03575     \textcolor{comment}{// Each block is made of dof types. We get the most fine grain dof types.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03576}03576     \textcolor{comment}{// Most fine grain in the sense that these are the dof types that belongs}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03577}03577     \textcolor{comment}{// in this block before any coarsening of dof types has taken place.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03578}03578     \textcolor{comment}{// The ordering of the dof types matters, this is handled properly when}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03579}03579     \textcolor{comment}{// creating the Block\_to\_dof\_map\_fine vector and must be respected here.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03580}03580     \textcolor{comment}{// I.e. we cannot arbitrarily insert dof types (even if they are correct)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03581}03581     \textcolor{comment}{// in the vector most\_fine\_grain\_dof.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03582}03582     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} most\_fine\_grain\_dof;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03583}03583     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < n\_block; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03584}03584     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03585}03585       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} mapped\_b = block\_vec\_number[b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03586}03586 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03587}03587       most\_fine\_grain\_dof.insert(most\_fine\_grain\_dof.end(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03588}03588                                  Block\_to\_dof\_map\_fine[mapped\_b].begin(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03589}03589                                  Block\_to\_dof\_map\_fine[mapped\_b].end());}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03590}03590     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03591}03591 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03592}03592     \textcolor{comment}{// Split all the blocks into it's most fine grain dof vector.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03593}03593     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}} dof\_vector(most\_fine\_grain\_dof.size());}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03594}03594 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03595}03595     \textcolor{keywordtype}{unsigned} offset = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03596}03596 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03597}03597     \textcolor{comment}{// Perform the splitting for each block.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03598}03598     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < n\_block; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03599}03599     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03600}03600       \textcolor{comment}{// The actual block number.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03601}03601       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} mapped\_b = block\_vec\_number[b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03602}03602 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03603}03603       \textcolor{comment}{// How many most fine grain dof types are associated with this block?}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03604}03604       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} ndof = Block\_to\_dof\_map\_fine[mapped\_b].size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03605}03605 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03606}03606       \textcolor{keywordflow}{if} (ndof == 1)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03607}03607       \textcolor{comment}{// No need to split, just copy.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03608}03608       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03609}03609         dof\_vector[offset] = \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03610}03610       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03611}03611       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03612}03612       \textcolor{comment}{// Need to split s[b] into it's most fine grain dof vectors}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03613}03613       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03614}03614         \textcolor{comment}{// To store pointers to the dof vectors associated with this block.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03615}03615         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector*>}} tmp\_dof\_vector\_pt(ndof, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03616}03616 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03617}03617         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} d = 0; d < ndof; d++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03618}03618         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03619}03619           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} offset\_plus\_d = offset + d;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03620}03620 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03621}03621           \textcolor{comment}{// build the dof vector.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03622}03622           dof\_vector[offset\_plus\_d].build(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03623}03623             Internal\_block\_distribution\_pt[most\_fine\_grain\_dof[offset\_plus\_d]]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03624}03624 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03625}03625           \textcolor{comment}{// Store the pointer.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03626}03626           tmp\_dof\_vector\_pt[d] = \&dof\_vector[offset\_plus\_d];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03627}03627         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03628}03628 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03629}03629         \textcolor{comment}{// Split without communication.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03630}03630         \mbox{\hyperlink{namespaceoomph_1_1DoubleVectorHelpers_aa87594da930b3eed12a27838972f10f8}{DoubleVectorHelpers::split\_without\_communication}}(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[b],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03631}03631                                                          tmp\_dof\_vector\_pt);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03632}03632       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03633}03633 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03634}03634       \textcolor{comment}{// Update the offset!}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03635}03635       offset += ndof;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03636}03636     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03637}03637 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03638}03638     \textcolor{comment}{// Return the block vectors all in one go.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03639}03639     internal\_return\_block\_vectors(most\_fine\_grain\_dof, dof\_vector, v);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03640}03640   \} \textcolor{comment}{// return\_block\_vectors(...)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03641}03641 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03642}03642 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03643}03643   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03644}03644 \textcolor{comment}{  /// Takes the vector of block vectors, s, and copies its entries into}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03645}03645 \textcolor{comment}{  /// the naturally ordered vector, v. If this is a subsidiary block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03646}03646 \textcolor{comment}{  /// preconditioner only those entries in v that are associated with its}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03647}03647 \textcolor{comment}{  /// blocks are affected. The block\_vec\_number indicates which block the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03648}03648 \textcolor{comment}{  /// vectors in s came from. The block number corresponds to the block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03649}03649 \textcolor{comment}{  /// numbers in this preconditioner.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03650}03650 \textcolor{comment}{  /// This is simply a wrapper around the other return\_block\_vectors(...)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03651}03651 \textcolor{comment}{  /// function where the block\_vec\_number Vector is the identity, i.e.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03652}03652 \textcolor{comment}{  /// block\_vec\_number is [0, 1, ..., nblock\_types -\/ 1].}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03653}03653 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03654}03654   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03655}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a628f3ab6c3c41ccb449da642fb7e1feb}{03655}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a71d48d8a70151ef0febd4537a2214c53}{BlockPreconditioner<MATRIX>::return\_block\_vectors}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03656}03656     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}, \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& v)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03657}03657 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03658}03658     \textcolor{comment}{// The number of block types in this preconditioner.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03659}03659     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_block = nblock\_types();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03660}03660 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03661}03661     \textcolor{comment}{// Create the identity vector.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03662}03662     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} required\_block(n\_block, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03663}03663     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_block; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03664}03664     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03665}03665       required\_block[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03666}03666     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03667}03667 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03668}03668     \textcolor{comment}{// Call the other return\_block\_vectors function which does the work.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03669}03669     return\_block\_vectors(required\_block, \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}, v);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03670}03670   \} \textcolor{comment}{// return\_block\_vectors(...)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03671}03671 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03672}03672   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03673}03673 \textcolor{comment}{  /// Takes the naturally ordered vector and}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03674}03674 \textcolor{comment}{  /// rearranges it into a vector of sub vectors corresponding to the blocks,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03675}03675 \textcolor{comment}{  /// so s[b][i] contains the i-\/th entry in the vector associated with block b.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03676}03676 \textcolor{comment}{  /// The block\_vec\_number indicates which blocks we want.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03677}03677 \textcolor{comment}{  /// These blocks and vectors are those corresponding to the internal blocks.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03678}03678 \textcolor{comment}{  /// Note: If the preconditioner is a subsidiary preconditioner then only the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03679}03679 \textcolor{comment}{  /// sub-\/vectors associated with the blocks of the subsidiary preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03680}03680 \textcolor{comment}{  /// will be included. Hence the length of v is master\_nrow() whereas the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03681}03681 \textcolor{comment}{  /// total length of the s vectors is the sum of the Nrow of the sub vectors.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03682}03682 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03683}03683   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03684}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a2ca7f125e50493073d116ba8da271af5}{03684}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a2ca7f125e50493073d116ba8da271af5}{BlockPreconditioner<MATRIX>::internal\_return\_block\_vectors}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03685}03685     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& block\_vec\_number,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03686}03686     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}},}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03687}03687     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& v)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03688}03688 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03689}03689     \textcolor{comment}{// the number of blocks}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03690}03690     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nblock = block\_vec\_number.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03691}03691 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03692}03692 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03693}03693     \textcolor{keywordflow}{if} (!v.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03694}03694     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03695}03695       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03696}03696       error\_message << \textcolor{stringliteral}{"{}The distribution of the global vector v must be setup."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03697}03697       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03698}03698         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03699}03699     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03700}03700     \textcolor{keywordflow}{if} (*(v.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()) != *(this-\/>master\_distribution\_pt()))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03701}03701     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03702}03702       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03703}03703       error\_message << \textcolor{stringliteral}{"{}The distribution of the global vector v must match the "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03704}03704                     << \textcolor{stringliteral}{"{} specified master\_distribution\_pt(). \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03705}03705                     << \textcolor{stringliteral}{"{}i.e. Distribution\_pt in the master preconditioner"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03706}03706       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03707}03707         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03708}03708     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03709}03709     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < nblock; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03710}03710     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03711}03711       \textcolor{keywordflow}{if} (!\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[b].built())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03712}03712       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03713}03713         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03714}03714         error\_message << \textcolor{stringliteral}{"{}The distribution of the block vector "{}} << b}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03715}03715                       << \textcolor{stringliteral}{"{} must be setup."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03716}03716         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03717}03717                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03718}03718                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03719}03719       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03720}03720       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} required\_block = block\_vec\_number[b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03721}03721       \textcolor{keywordflow}{if} (*(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[b].distribution\_pt()) !=}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03722}03722           *(Internal\_block\_distribution\_pt[required\_block]))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03723}03723       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03724}03724         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03725}03725         error\_message}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03726}03726           << \textcolor{stringliteral}{"{}The distribution of the block vector "{}} << b << \textcolor{stringliteral}{"{} must match the"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03727}03727           << \textcolor{stringliteral}{"{} specified distribution at Internal\_block\_distribution\_pt["{}} << b}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03728}03728           << \textcolor{stringliteral}{"{}]"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03729}03729         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03730}03730                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03731}03731                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03732}03732       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03733}03733     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03734}03734 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03735}03735 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03736}03736     \textcolor{comment}{// if + only one processor}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03737}03737     \textcolor{comment}{//    + more than one processor but matrix\_pt is not distributed}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03738}03738     \textcolor{comment}{// then use the serial get\_block method}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03739}03739     \textcolor{keywordflow}{if} (this-\/>distribution\_pt()-\/>communicator\_pt()-\/>nproc() == 1 ||}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03740}03740         !this-\/>distribution\_pt()-\/>distributed())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03741}03741     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03742}03742       \textcolor{keywordtype}{double}* v\_pt = v.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03743}03743       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < nblock; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03744}03744       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03745}03745         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} required\_block = block\_vec\_number[b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03746}03746 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03747}03747         \textcolor{keyword}{const} \textcolor{keywordtype}{double}* s\_pt = \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[b].values\_pt();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03748}03748         \textcolor{keywordtype}{unsigned} nrow = this-\/>internal\_block\_dimension(required\_block);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03749}03749         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nrow; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03750}03750         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03751}03751           v\_pt[this-\/>Global\_index[required\_block][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]] = s\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03752}03752         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03753}03753       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03754}03754     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03755}03755     \textcolor{comment}{// otherwise use mpi}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03756}03756     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03757}03757     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03758}03758 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03759}03759 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03760}03760       \textcolor{comment}{// my rank}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03761}03761       \textcolor{keywordtype}{unsigned} my\_rank = this-\/>distribution\_pt()-\/>communicator\_pt()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03762}03762 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03763}03763       \textcolor{comment}{// the number of processors}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03764}03764       \textcolor{keywordtype}{unsigned} nproc = this-\/>distribution\_pt()-\/>communicator\_pt()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03765}03765 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03766}03766       \textcolor{comment}{// determine the maximum number of rows to be sent or recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03767}03767       \textcolor{comment}{// and determine the number of blocks each processor will send and recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03768}03768       \textcolor{comment}{// communication for}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03769}03769       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} nblock\_send(nproc, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03770}03770       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} nblock\_recv(nproc, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03771}03771       \textcolor{keywordtype}{unsigned} max\_n\_send\_or\_recv = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03772}03772       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03773}03773       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03774}03774         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < nblock; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03775}03775         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03776}03776           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} required\_block = block\_vec\_number[b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03777}03777 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03778}03778           max\_n\_send\_or\_recv = std::max(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03779}03779             max\_n\_send\_or\_recv, Nrows\_to\_send\_for\_get\_block(required\_block, p));}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03780}03780           max\_n\_send\_or\_recv = std::max(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03781}03781             max\_n\_send\_or\_recv, Nrows\_to\_recv\_for\_get\_block(required\_block, p));}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03782}03782           \textcolor{keywordflow}{if} (Nrows\_to\_send\_for\_get\_block(required\_block, p) > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03783}03783           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03784}03784             nblock\_recv[p]++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03785}03785           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03786}03786           \textcolor{keywordflow}{if} (Nrows\_to\_recv\_for\_get\_block(required\_block, p) > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03787}03787           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03788}03788             nblock\_send[p]++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03789}03789           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03790}03790         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03791}03791       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03792}03792 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03793}03793       \textcolor{comment}{// create a vectors of 1s the size of the nblock for the mpi indexed}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03794}03794       \textcolor{comment}{// data types}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03795}03795       \textcolor{keywordtype}{int}* block\_lengths = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[max\_n\_send\_or\_recv];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03796}03796       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < max\_n\_send\_or\_recv; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03797}03797       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03798}03798         block\_lengths[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03799}03799       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03800}03800 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03801}03801       \textcolor{comment}{// perform the sends and receives}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03802}03802       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Request>}} requests;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03803}03803       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03804}03804       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03805}03805         \textcolor{comment}{// send and recv with other processors}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03806}03806         \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03807}03807         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03808}03808           \textcolor{comment}{// recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03809}03809           \textcolor{keywordflow}{if} (nblock\_recv[p] > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03810}03810           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03811}03811             \textcolor{comment}{// create the datatypes vector}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03812}03812             MPI\_Datatype block\_recv\_types[nblock\_recv[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03813}03813 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03814}03814             \textcolor{comment}{// create the datatypes}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03815}03815             \textcolor{keywordtype}{unsigned} ptr = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03816}03816             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < nblock; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03817}03817             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03818}03818               \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} required\_block = block\_vec\_number[b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03819}03819 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03820}03820               \textcolor{keywordflow}{if} (Nrows\_to\_send\_for\_get\_block(required\_block, p) > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03821}03821               \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03822}03822                 MPI\_Type\_indexed(Nrows\_to\_send\_for\_get\_block(required\_block, p),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03823}03823                                  block\_lengths,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03824}03824                                  Rows\_to\_send\_for\_get\_block(required\_block, p),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03825}03825                                  MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03826}03826                                  \&block\_recv\_types[ptr]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03827}03827                 MPI\_Type\_commit(\&block\_recv\_types[ptr]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03828}03828                 ptr++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03829}03829               \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03830}03830             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03831}03831 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03832}03832             \textcolor{comment}{// compute the displacements and lengths}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03833}03833             MPI\_Aint displacements[nblock\_recv[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03834}03834             \textcolor{keywordtype}{int} lengths[nblock\_recv[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03835}03835             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nblock\_recv[p]; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03836}03836             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03837}03837               lengths[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03838}03838               displacements[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03839}03839             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03840}03840 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03841}03841             \textcolor{comment}{// build the final datatype}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03842}03842             MPI\_Datatype type\_recv;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03843}03843             MPI\_Type\_create\_struct(nblock\_recv[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03844}03844                                    lengths,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03845}03845                                    displacements,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03846}03846                                    block\_recv\_types,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03847}03847                                    \&type\_recv);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03848}03848             MPI\_Type\_commit(\&type\_recv);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03849}03849 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03850}03850             \textcolor{comment}{// recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03851}03851             MPI\_Request recv\_req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03852}03852             MPI\_Irecv(v.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03853}03853                       1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03854}03854                       type\_recv,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03855}03855                       p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03856}03856                       0,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03857}03857                       this-\/>distribution\_pt()-\/>communicator\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03858}03858                       \&recv\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03859}03859             MPI\_Type\_free(\&type\_recv);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03860}03860             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nblock\_recv[p]; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03861}03861             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03862}03862               MPI\_Type\_free(\&block\_recv\_types[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03863}03863             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03864}03864             requests.push\_back(recv\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03865}03865           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03866}03866 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03867}03867           \textcolor{comment}{// send}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03868}03868           \textcolor{keywordflow}{if} (nblock\_send[p] > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03869}03869           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03870}03870             \textcolor{comment}{// create the datatypes vector}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03871}03871             MPI\_Datatype block\_send\_types[nblock\_send[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03872}03872 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03873}03873             \textcolor{comment}{// and the displacements}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03874}03874             MPI\_Aint displacements[nblock\_send[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03875}03875 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03876}03876             \textcolor{comment}{// and the lengths}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03877}03877             \textcolor{keywordtype}{int} lengths[nblock\_send[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03878}03878 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03879}03879             \textcolor{comment}{// all displacements are computed relative to s[0] values}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03880}03880             MPI\_Aint displacements\_base;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03881}03881             MPI\_Get\_address(\textcolor{keyword}{const\_cast<}\textcolor{keywordtype}{double}*\textcolor{keyword}{>}(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[0].values\_pt()),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03882}03882                             \&displacements\_base);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03883}03883 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03884}03884             \textcolor{comment}{// now build}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03885}03885             \textcolor{keywordtype}{unsigned} ptr = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03886}03886             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < nblock; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03887}03887             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03888}03888               \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} required\_block = block\_vec\_number[b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03889}03889 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03890}03890               \textcolor{keywordflow}{if} (Nrows\_to\_recv\_for\_get\_block(required\_block, p) > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03891}03891               \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03892}03892                 MPI\_Type\_indexed(Nrows\_to\_recv\_for\_get\_block(required\_block, p),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03893}03893                                  block\_lengths,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03894}03894                                  Rows\_to\_recv\_for\_get\_block(required\_block, p),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03895}03895                                  MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03896}03896                                  \&block\_send\_types[ptr]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03897}03897                 MPI\_Type\_commit(\&block\_send\_types[ptr]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03898}03898                 MPI\_Get\_address(\textcolor{keyword}{const\_cast<}\textcolor{keywordtype}{double}*\textcolor{keyword}{>}(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[b].values\_pt()),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03899}03899                                 \&displacements[ptr]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03900}03900                 displacements[ptr] -\/= displacements\_base;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03901}03901                 lengths[ptr] = 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03902}03902                 ptr++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03903}03903               \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03904}03904             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03905}03905 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03906}03906             \textcolor{comment}{// build the final data type}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03907}03907             MPI\_Datatype type\_send;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03908}03908             MPI\_Type\_create\_struct(nblock\_send[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03909}03909                                    lengths,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03910}03910                                    displacements,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03911}03911                                    block\_send\_types,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03912}03912                                    \&type\_send);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03913}03913             MPI\_Type\_commit(\&type\_send);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03914}03914 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03915}03915             \textcolor{comment}{// send}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03916}03916             MPI\_Request send\_req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03917}03917             MPI\_Isend(\textcolor{keyword}{const\_cast<}\textcolor{keywordtype}{double}*\textcolor{keyword}{>}(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[0].values\_pt()),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03918}03918                       1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03919}03919                       type\_send,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03920}03920                       p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03921}03921                       0,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03922}03922                       this-\/>distribution\_pt()-\/>communicator\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03923}03923                       \&send\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03924}03924             MPI\_Type\_free(\&type\_send);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03925}03925             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nblock\_send[p]; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03926}03926             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03927}03927               MPI\_Type\_free(\&block\_send\_types[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03928}03928             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03929}03929             requests.push\_back(send\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03930}03930           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03931}03931         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03932}03932 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03933}03933         \textcolor{comment}{// communicate wih self}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03934}03934         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03935}03935         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03936}03936           \textcolor{keywordtype}{double}* v\_values\_pt = v.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03937}03937           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < nblock; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03938}03938           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03939}03939             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} required\_block = block\_vec\_number[b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03940}03940 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03941}03941             \textcolor{keyword}{const} \textcolor{keywordtype}{double}* w\_values\_pt = \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[b].values\_pt();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03942}03942             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03943}03943                  \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < Nrows\_to\_send\_for\_get\_block(required\_block, p);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03944}03944                  \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03945}03945             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03946}03946               v\_values\_pt[Rows\_to\_send\_for\_get\_block(required\_block, p)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03947}03947                 w\_values\_pt[Rows\_to\_recv\_for\_get\_block(required\_block, p)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03948}03948             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03949}03949           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03950}03950         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03951}03951       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03952}03952 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03953}03953       \textcolor{comment}{// and then just wait}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03954}03954       \textcolor{keywordtype}{unsigned} c = requests.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03955}03955       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Status>}} stat(c);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03956}03956       \textcolor{keywordflow}{if} (c)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03957}03957       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03958}03958         MPI\_Waitall(c, \&requests[0], \&stat[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03959}03959       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03960}03960       \textcolor{keyword}{delete}[] block\_lengths;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03961}03961 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03962}03962 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03963}03963       \textcolor{comment}{// throw error}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03964}03964       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03965}03965       error\_message << \textcolor{stringliteral}{"{}The preconditioner is distributed and on more than one "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03966}03966                     << \textcolor{stringliteral}{"{}processor. MPI is required."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03967}03967       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03968}03968         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03969}03969 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03970}03970     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03971}03971   \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03972}03972 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03973}03973   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03974}03974 \textcolor{comment}{  /// A helper function, takes the naturally ordered vector and}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03975}03975 \textcolor{comment}{  /// rearranges it into a vector of sub vectors corresponding to the blocks,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03976}03976 \textcolor{comment}{  /// so s[b][i] contains the i-\/th entry in the vector associated with block b.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03977}03977 \textcolor{comment}{  /// The block\_vec\_number indicates which blocks we want.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03978}03978 \textcolor{comment}{  /// These blocks and vectors are those corresponding to the internal blocks.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03979}03979 \textcolor{comment}{  /// Note: If the preconditioner is a subsidiary preconditioner then only the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03980}03980 \textcolor{comment}{  /// sub-\/vectors associated with the blocks of the subsidiary preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03981}03981 \textcolor{comment}{  /// will be included. Hence the length of v is master\_nrow() whereas the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03982}03982 \textcolor{comment}{  /// total length of the s vectors is the sum of the Nrow of the sub vectors.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03983}03983 \textcolor{comment}{  /// This is simply a wrapper around the other internal\_get\_block\_vectors(...)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03984}03984 \textcolor{comment}{  /// function with the identity block\_vec\_number vector.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03985}03985 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03986}03986   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03987}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a9e2ce77e3efbcdd465f7ad7252936dfd}{03987}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a2ca7f125e50493073d116ba8da271af5}{BlockPreconditioner<MATRIX>::internal\_return\_block\_vectors}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03988}03988     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}, \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& v)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03989}03989 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03990}03990     \textcolor{comment}{// the number of blocks}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03991}03991     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nblock = this-\/>internal\_nblock\_types();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03992}03992     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} block\_vec\_number(nblock, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03993}03993     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < nblock; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03994}03994     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03995}03995       block\_vec\_number[b] = b;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03996}03996     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03997}03997 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03998}03998     internal\_return\_block\_vectors(block\_vec\_number, \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}, v);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l03999}03999   \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04000}04000 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04001}04001   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04002}04002 \textcolor{comment}{  /// A helper function, takes the naturally ordered vector, v,}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04003}04003 \textcolor{comment}{  /// and extracts the n-\/th block vector, b.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04004}04004 \textcolor{comment}{  /// Here n is the block number in the current preconditioner.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04005}04005 \textcolor{comment}{  /// NOTE: The ordering of the vector b is the same as the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04006}04006 \textcolor{comment}{  /// ordering of the block matrix from internal\_get\_block(...).}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04007}04007 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04008}04008   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04009}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_ae3cf61f61e1aa50e2315e999827e7d59}{04009}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_ae3cf61f61e1aa50e2315e999827e7d59}{BlockPreconditioner<MATRIX>::internal\_get\_block\_vector}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04010}04010     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& b, \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& v, \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& w)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04011}04011 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04012}04012 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04013}04013     \textcolor{comment}{// the number of blocks}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04014}04014     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_blocks = this-\/>internal\_nblock\_types();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04015}04015 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04016}04016     \textcolor{comment}{// paranoid check that block i is in this block preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04017}04017     \textcolor{keywordflow}{if} (b >= n\_blocks)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04018}04018     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04019}04019       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04020}04020       error\_message}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04021}04021         << \textcolor{stringliteral}{"{}Requested block  vector "{}} << b}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04022}04022         << \textcolor{stringliteral}{"{}, however this preconditioner has internal\_nblock\_types() "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04023}04023         << \textcolor{stringliteral}{"{}= "{}} << internal\_nblock\_types() << std::endl;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04024}04024       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04025}04025         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04026}04026     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04027}04027     \textcolor{keywordflow}{if} (!v.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04028}04028     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04029}04029       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04030}04030       error\_message << \textcolor{stringliteral}{"{}The distribution of the global vector v must be setup."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04031}04031       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04032}04032         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04033}04033     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04034}04034     \textcolor{keywordflow}{if} (*(v.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()) != *(this-\/>master\_distribution\_pt()))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04035}04035     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04036}04036       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04037}04037       error\_message << \textcolor{stringliteral}{"{}The distribution of the global vector v must match the "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04038}04038                     << \textcolor{stringliteral}{"{} specified master\_distribution\_pt(). \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04039}04039                     << \textcolor{stringliteral}{"{}i.e. Distribution\_pt in the master preconditioner"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04040}04040       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04041}04041         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04042}04042     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04043}04043 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04044}04044 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04045}04045     \textcolor{comment}{// rebuild the block vector}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04046}04046     w.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(Internal\_block\_distribution\_pt[b], 0.0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04047}04047 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04048}04048     \textcolor{comment}{// if + only one processor}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04049}04049     \textcolor{comment}{//    + more than one processor but matrix\_pt is not distributed}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04050}04050     \textcolor{comment}{// then use the serial get\_block method}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04051}04051     \textcolor{keywordflow}{if} (this-\/>distribution\_pt()-\/>communicator\_pt()-\/>nproc() == 1 ||}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04052}04052         !this-\/>distribution\_pt()-\/>distributed())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04053}04053     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04054}04054       \textcolor{keywordtype}{double}* w\_pt = w.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04055}04055       \textcolor{keyword}{const} \textcolor{keywordtype}{double}* v\_pt = v.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04056}04056       \textcolor{keywordtype}{unsigned} n\_row = w.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04057}04057       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_row; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04058}04058       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04059}04059         w\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = v\_pt[this-\/>Global\_index[b][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04060}04060       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04061}04061     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04062}04062     \textcolor{comment}{// otherwise use mpi}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04063}04063     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04064}04064     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04065}04065 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04066}04066 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04067}04067       \textcolor{comment}{// my rank}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04068}04068       \textcolor{keywordtype}{unsigned} my\_rank = this-\/>distribution\_pt()-\/>communicator\_pt()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04069}04069 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04070}04070       \textcolor{comment}{// the number of processors}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04071}04071       \textcolor{keywordtype}{unsigned} nproc = this-\/>distribution\_pt()-\/>communicator\_pt()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04072}04072 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04073}04073       \textcolor{comment}{// determine the maximum number of rows to be sent or recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04074}04074       \textcolor{keywordtype}{unsigned} max\_n\_send\_or\_recv = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04075}04075       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04076}04076       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04077}04077         max\_n\_send\_or\_recv =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04078}04078           std::max(max\_n\_send\_or\_recv, Nrows\_to\_send\_for\_get\_block(b, p));}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04079}04079         max\_n\_send\_or\_recv =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04080}04080           std::max(max\_n\_send\_or\_recv, Nrows\_to\_recv\_for\_get\_block(b, p));}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04081}04081       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04082}04082 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04083}04083       \textcolor{comment}{// create a vectors of 1s (the size of the nblock for the mpi indexed}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04084}04084       \textcolor{comment}{// data types}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04085}04085       \textcolor{keywordtype}{int}* block\_lengths = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[max\_n\_send\_or\_recv];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04086}04086       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < max\_n\_send\_or\_recv; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04087}04087       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04088}04088         block\_lengths[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04089}04089       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04090}04090 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04091}04091       \textcolor{comment}{// perform the sends and receives}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04092}04092       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Request>}} requests;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04093}04093       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04094}04094       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04095}04095         \textcolor{comment}{// send and recv with other processors}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04096}04096         \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04097}04097         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04098}04098           \textcolor{keywordflow}{if} (Nrows\_to\_send\_for\_get\_block(b, p) > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04099}04099           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04100}04100             \textcolor{comment}{// create the send datatype}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04101}04101             MPI\_Datatype type\_send;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04102}04102             MPI\_Type\_indexed(Nrows\_to\_send\_for\_get\_block(b, p),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04103}04103                              block\_lengths,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04104}04104                              Rows\_to\_send\_for\_get\_block(b, p),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04105}04105                              MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04106}04106                              \&type\_send);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04107}04107             MPI\_Type\_commit(\&type\_send);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04108}04108 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04109}04109             \textcolor{comment}{// send}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04110}04110             MPI\_Request send\_req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04111}04111             MPI\_Isend(\textcolor{keyword}{const\_cast<}\textcolor{keywordtype}{double}*\textcolor{keyword}{>}(v.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}()),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04112}04112                       1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04113}04113                       type\_send,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04114}04114                       p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04115}04115                       0,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04116}04116                       this-\/>distribution\_pt()-\/>communicator\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04117}04117                       \&send\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04118}04118             MPI\_Type\_free(\&type\_send);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04119}04119             requests.push\_back(send\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04120}04120           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04121}04121 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04122}04122           \textcolor{keywordflow}{if} (Nrows\_to\_recv\_for\_get\_block(b, p) > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04123}04123           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04124}04124             \textcolor{comment}{// create the recv datatype}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04125}04125             MPI\_Datatype type\_recv;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04126}04126             MPI\_Type\_indexed(Nrows\_to\_recv\_for\_get\_block(b, p),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04127}04127                              block\_lengths,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04128}04128                              Rows\_to\_recv\_for\_get\_block(b, p),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04129}04129                              MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04130}04130                              \&type\_recv);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04131}04131             MPI\_Type\_commit(\&type\_recv);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04132}04132 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04133}04133             \textcolor{comment}{// recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04134}04134             MPI\_Request recv\_req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04135}04135             MPI\_Irecv(w.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04136}04136                       1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04137}04137                       type\_recv,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04138}04138                       p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04139}04139                       0,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04140}04140                       this-\/>distribution\_pt()-\/>communicator\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04141}04141                       \&recv\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04142}04142             MPI\_Type\_free(\&type\_recv);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04143}04143             requests.push\_back(recv\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04144}04144           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04145}04145         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04146}04146 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04147}04147         \textcolor{comment}{// communicate with self}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04148}04148         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04149}04149         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04150}04150           \textcolor{keywordtype}{double}* w\_values\_pt = w.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04151}04151           \textcolor{keyword}{const} \textcolor{keywordtype}{double}* v\_values\_pt = v.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04152}04152           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < Nrows\_to\_send\_for\_get\_block(b, p); \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04153}04153           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04154}04154             w\_values\_pt[Rows\_to\_recv\_for\_get\_block(b, p)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04155}04155               v\_values\_pt[Rows\_to\_send\_for\_get\_block(b, p)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04156}04156           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04157}04157         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04158}04158       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04159}04159 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04160}04160       \textcolor{comment}{// and then just wait}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04161}04161       \textcolor{keywordtype}{unsigned} c = requests.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04162}04162       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Status>}} stat(c);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04163}04163       \textcolor{keywordflow}{if} (c)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04164}04164       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04165}04165         MPI\_Waitall(c, \&requests[0], \&stat[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04166}04166       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04167}04167       \textcolor{keyword}{delete}[] block\_lengths;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04168}04168 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04169}04169 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04170}04170       \textcolor{comment}{// throw error}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04171}04171       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04172}04172       error\_message << \textcolor{stringliteral}{"{}The preconditioner is distributed and on more than one "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04173}04173                     << \textcolor{stringliteral}{"{}processor. MPI is required."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04174}04174       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04175}04175         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04176}04176 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04177}04177     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04178}04178   \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04179}04179 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04180}04180   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04181}04181 \textcolor{comment}{  /// Takes the naturally ordered vector, v and returns the n-\/th}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04182}04182 \textcolor{comment}{  /// block vector, b. Here n is the block number in the current}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04183}04183 \textcolor{comment}{  /// preconditioner.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04184}04184 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04185}04185   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04186}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a7efc9f2f0209764902e4e45fcb2556d1}{04186}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a7efc9f2f0209764902e4e45fcb2556d1}{BlockPreconditioner<MATRIX>::get\_block\_vector}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& b,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04187}04187                                                      \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& v,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04188}04188                                                      \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& w)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04189}04189 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04190}04190 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04191}04191     \textcolor{comment}{// the number of blocks}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04192}04192     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} para\_n\_blocks = nblock\_types();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04193}04193 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04194}04194     \textcolor{comment}{// paranoid check that block i is in this block preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04195}04195     \textcolor{keywordflow}{if} (b >= para\_n\_blocks)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04196}04196     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04197}04197       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04198}04198       err\_msg << \textcolor{stringliteral}{"{}Requested block vector "{}} << b}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04199}04199               << \textcolor{stringliteral}{"{}, however this preconditioner has only "{}} << para\_n\_blocks}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04200}04200               << \textcolor{stringliteral}{"{} block types"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04201}04201               << \textcolor{stringliteral}{"{}.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04202}04202       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04203}04203         err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04204}04204     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04205}04205 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04206}04206     \textcolor{keywordflow}{if} (!v.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04207}04207     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04208}04208       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04209}04209       err\_msg << \textcolor{stringliteral}{"{}The distribution of the global vector v must be setup."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04210}04210       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04211}04211         err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04212}04212     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04213}04213     \textcolor{keywordflow}{if} (*(v.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()) != *(this-\/>master\_distribution\_pt()))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04214}04214     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04215}04215       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04216}04216       err\_msg << \textcolor{stringliteral}{"{}The distribution of the global vector v must match the "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04217}04217               << \textcolor{stringliteral}{"{} specified master\_distribution\_pt(). \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04218}04218               << \textcolor{stringliteral}{"{}i.e. Distribution\_pt in the master preconditioner"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04219}04219       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04220}04220         err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04221}04221     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04222}04222 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04223}04223 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04224}04224     \textcolor{comment}{// Recall that, the relationship between the external blocks and the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04225}04225     \textcolor{comment}{// external dof types, as seen by the preconditioner writer is stored in the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04226}04226     \textcolor{comment}{// mapping Block\_to\_dof\_map\_coarse.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04227}04227     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04228}04228     \textcolor{comment}{// However, each dof type could have been coarsened! The relationship}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04229}04229     \textcolor{comment}{// between the dof types of this preconditioner and the parent}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04230}04230     \textcolor{comment}{// preconditioner is stored in the mapping Doftype\_coarsen\_map\_coarse. The}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04231}04231     \textcolor{comment}{// dof numbers in this map is relative to this preconditioner.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04232}04232     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04233}04233     \textcolor{comment}{// Finally, the relationship between the dof types of this preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04234}04234     \textcolor{comment}{// and the most fine grain dof types is stored in the mapping}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04235}04235     \textcolor{comment}{// Doftype\_coarsen\_map\_fine. Again, the dof numbers in this map is relative}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04236}04236     \textcolor{comment}{// to this preconditioner.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04237}04237     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04238}04238     \textcolor{comment}{// Furthermore, we note that concatenation of vectors without communication}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04239}04239     \textcolor{comment}{//  is associative, but not commutative. I.e.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04240}04240     \textcolor{comment}{// (V1+V2)+V3 = V1 + (V2 + V3), where + is concatenation without}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04241}04241     \textcolor{comment}{// communication.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04242}04242     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04243}04243     \textcolor{comment}{// So all we need is the vectors listed in the correct order.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04244}04244     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04245}04245     \textcolor{comment}{// We need only Block\_to\_dof\_map\_coarse to tell us which external dof types}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04246}04246     \textcolor{comment}{// are in this block, then Doftype\_coarsen\_map\_fine to tell us which most}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04247}04247     \textcolor{comment}{// fine grain dofs to concatenate!}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04248}04248     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04249}04249     \textcolor{comment}{// All the mapping vectors are constructed to respect the ordering of}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04250}04250     \textcolor{comment}{// the dof types.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04251}04251 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04252}04252     \textcolor{comment}{// Get the most fine grain block to dof mapping.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04253}04253     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} most\_fine\_grain\_dof = Block\_to\_dof\_map\_fine[b];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04254}04254 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04255}04255     \textcolor{comment}{// How many vectors do we need to concatenate?}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04256}04256     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_dof\_vec = most\_fine\_grain\_dof.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04257}04257 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04258}04258     \textcolor{keywordflow}{if} (n\_dof\_vec == 1)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04259}04259     \textcolor{comment}{// No need to concatenate, just extract the vector.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04260}04260     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04261}04261       internal\_get\_block\_vector(most\_fine\_grain\_dof[0], v, w);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04262}04262     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04263}04263     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04264}04264     \textcolor{comment}{// Need to concatenate dof-\/level vectors.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04265}04265     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04266}04266       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}} dof\_vector(n\_dof\_vec);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04267}04267 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04268}04268       \textcolor{comment}{// Get all the dof-\/level vectors in one go}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04269}04269       internal\_get\_block\_vectors(most\_fine\_grain\_dof, v, dof\_vector);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04270}04270       \textcolor{comment}{// Build w with the correct distribution.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04271}04271       w.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(Block\_distribution\_pt[b], 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04272}04272 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04273}04273       \textcolor{comment}{// Concatenate the vectors.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04274}04274       \mbox{\hyperlink{namespaceoomph_1_1DoubleVectorHelpers_a3ea9f7c40548e1a88402312e6f15d1fc}{DoubleVectorHelpers::concatenate\_without\_communication}}(dof\_vector, w);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04275}04275 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04276}04276       dof\_vector.clear();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04277}04277     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04278}04278   \} \textcolor{comment}{// get\_block\_vector(...)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04279}04279 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04280}04280   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04281}04281 \textcolor{comment}{  /// Takes the n-\/th block ordered vector, b,  and copies its entries}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04282}04282 \textcolor{comment}{  /// to the appropriate entries in the naturally ordered vector, v.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04283}04283 \textcolor{comment}{  /// Here n is the block number in the current block preconditioner.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04284}04284 \textcolor{comment}{  /// If the preconditioner is a subsidiary block preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04285}04285 \textcolor{comment}{  /// the other entries in v  that are not associated with it}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04286}04286 \textcolor{comment}{  /// are left alone.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04287}04287 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04288}04288 \textcolor{comment}{  /// This version works with the internal block types. This is legacy code}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04289}04289 \textcolor{comment}{  /// but is kept alive, hence moved to private. Please use the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04290}04290 \textcolor{comment}{  /// function "{}return\_block\_vector(...)"{}.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04291}04291 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04292}04292   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04293}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a04e260cc4160a952db2d410109fb2684}{04293}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a04e260cc4160a952db2d410109fb2684}{BlockPreconditioner<MATRIX>::internal\_return\_block\_vector}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04294}04294     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& b, \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& w, \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& v)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04295}04295 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04296}04296 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04297}04297     \textcolor{comment}{// the number of blocks}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04298}04298     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_blocks = this-\/>internal\_nblock\_types();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04299}04299 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04300}04300     \textcolor{comment}{// paranoid check that block i is in this block preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04301}04301     \textcolor{keywordflow}{if} (b >= n\_blocks)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04302}04302     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04303}04303       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04304}04304       error\_message}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04305}04305         << \textcolor{stringliteral}{"{}Requested block  vector "{}} << b}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04306}04306         << \textcolor{stringliteral}{"{}, however this preconditioner has internal\_nblock\_types() "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04307}04307         << \textcolor{stringliteral}{"{}= "{}} << internal\_nblock\_types() << std::endl;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04308}04308       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04309}04309         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04310}04310     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04311}04311     \textcolor{keywordflow}{if} (!v.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04312}04312     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04313}04313       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04314}04314       error\_message << \textcolor{stringliteral}{"{}The distribution of the global vector v must be setup."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04315}04315       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04316}04316         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04317}04317     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04318}04318     \textcolor{keywordflow}{if} (*v.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() != *this-\/>master\_distribution\_pt())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04319}04319     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04320}04320       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04321}04321       error\_message << \textcolor{stringliteral}{"{}The distribution of the global vector v must match the "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04322}04322                     << \textcolor{stringliteral}{"{} specified master\_distribution\_pt(). \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04323}04323                     << \textcolor{stringliteral}{"{}i.e. Distribution\_pt in the master preconditioner"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04324}04324       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04325}04325         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04326}04326     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04327}04327     \textcolor{keywordflow}{if} (!w.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04328}04328     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04329}04329       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04330}04330       error\_message << \textcolor{stringliteral}{"{}The distribution of the block vector w must be setup."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04331}04331       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04332}04332         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04333}04333     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04334}04334     \textcolor{keywordflow}{if} (*w.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() != *Internal\_block\_distribution\_pt[b])}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04335}04335     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04336}04336       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04337}04337       error\_message}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04338}04338         << \textcolor{stringliteral}{"{}The distribution of the block vector w must match the "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04339}04339         << \textcolor{stringliteral}{"{} specified distribution at Internal\_block\_distribution\_pt[b]"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04340}04340       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04341}04341         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04342}04342     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04343}04343 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04344}04344 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04345}04345     \textcolor{comment}{// if + only one processor}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04346}04346     \textcolor{comment}{//    + more than one processor but matrix\_pt is not distributed}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04347}04347     \textcolor{comment}{// then use the serial get\_block method}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04348}04348     \textcolor{keywordflow}{if} (this-\/>distribution\_pt()-\/>communicator\_pt()-\/>nproc() == 1 ||}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04349}04349         !this-\/>distribution\_pt()-\/>distributed())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04350}04350     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04351}04351       \textcolor{comment}{// length of vector}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04352}04352       \textcolor{keywordtype}{unsigned} n\_row = this-\/>internal\_block\_dimension(b);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04353}04353 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04354}04354       \textcolor{comment}{// copy back from the block vector to the naturally ordered vector}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04355}04355       \textcolor{keywordtype}{double}* v\_pt = v.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04356}04356       \textcolor{keyword}{const} \textcolor{keywordtype}{double}* w\_pt = w.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04357}04357       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_row; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04358}04358       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04359}04359         v\_pt[this-\/>Global\_index[b][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]] = w\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04360}04360       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04361}04361     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04362}04362     \textcolor{comment}{// otherwise use mpi}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04363}04363     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04364}04364     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04365}04365 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04366}04366 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04367}04367       \textcolor{comment}{// my rank}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04368}04368       \textcolor{keywordtype}{unsigned} my\_rank = this-\/>distribution\_pt()-\/>communicator\_pt()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04369}04369 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04370}04370       \textcolor{comment}{// the number of processors}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04371}04371       \textcolor{keywordtype}{unsigned} nproc = this-\/>distribution\_pt()-\/>communicator\_pt()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04372}04372 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04373}04373       \textcolor{comment}{// determine the maximum number of rows to be sent or recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04374}04374       \textcolor{keywordtype}{unsigned} max\_n\_send\_or\_recv = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04375}04375       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04376}04376       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04377}04377         max\_n\_send\_or\_recv =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04378}04378           std::max(max\_n\_send\_or\_recv, Nrows\_to\_send\_for\_get\_block(b, p));}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04379}04379         max\_n\_send\_or\_recv =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04380}04380           std::max(max\_n\_send\_or\_recv, Nrows\_to\_recv\_for\_get\_block(b, p));}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04381}04381       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04382}04382 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04383}04383       \textcolor{comment}{// create a vectors of 1s (the size of the nblock for the mpi indexed}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04384}04384       \textcolor{comment}{// data types}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04385}04385       \textcolor{keywordtype}{int}* block\_lengths = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[max\_n\_send\_or\_recv];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04386}04386       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < max\_n\_send\_or\_recv; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04387}04387       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04388}04388         block\_lengths[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04389}04389       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04390}04390 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04391}04391       \textcolor{comment}{// perform the sends and receives}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04392}04392       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Request>}} requests;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04393}04393       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04394}04394       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04395}04395         \textcolor{comment}{// send and recv with other processors}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04396}04396         \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04397}04397         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04398}04398           \textcolor{keywordflow}{if} (Nrows\_to\_recv\_for\_get\_block(b, p) > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04399}04399           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04400}04400             \textcolor{comment}{// create the send datatype}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04401}04401             MPI\_Datatype type\_send;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04402}04402             MPI\_Type\_indexed(Nrows\_to\_recv\_for\_get\_block(b, p),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04403}04403                              block\_lengths,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04404}04404                              Rows\_to\_recv\_for\_get\_block(b, p),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04405}04405                              MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04406}04406                              \&type\_send);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04407}04407             MPI\_Type\_commit(\&type\_send);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04408}04408 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04409}04409             \textcolor{comment}{// send}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04410}04410             MPI\_Request send\_req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04411}04411             MPI\_Isend(\textcolor{keyword}{const\_cast<}\textcolor{keywordtype}{double}*\textcolor{keyword}{>}(w.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}()),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04412}04412                       1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04413}04413                       type\_send,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04414}04414                       p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04415}04415                       0,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04416}04416                       this-\/>distribution\_pt()-\/>communicator\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04417}04417                       \&send\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04418}04418             MPI\_Type\_free(\&type\_send);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04419}04419             requests.push\_back(send\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04420}04420           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04421}04421 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04422}04422           \textcolor{keywordflow}{if} (Nrows\_to\_send\_for\_get\_block(b, p) > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04423}04423           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04424}04424             \textcolor{comment}{// create the recv datatype}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04425}04425             MPI\_Datatype type\_recv;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04426}04426             MPI\_Type\_indexed(Nrows\_to\_send\_for\_get\_block(b, p),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04427}04427                              block\_lengths,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04428}04428                              Rows\_to\_send\_for\_get\_block(b, p),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04429}04429                              MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04430}04430                              \&type\_recv);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04431}04431             MPI\_Type\_commit(\&type\_recv);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04432}04432 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04433}04433             \textcolor{comment}{// recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04434}04434             MPI\_Request recv\_req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04435}04435             MPI\_Irecv(v.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04436}04436                       1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04437}04437                       type\_recv,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04438}04438                       p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04439}04439                       0,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04440}04440                       this-\/>distribution\_pt()-\/>communicator\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04441}04441                       \&recv\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04442}04442             MPI\_Type\_free(\&type\_recv);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04443}04443             requests.push\_back(recv\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04444}04444           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04445}04445         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04446}04446 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04447}04447         \textcolor{comment}{// communicate wih self}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04448}04448         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04449}04449         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04450}04450           \textcolor{keyword}{const} \textcolor{keywordtype}{double}* w\_values\_pt = w.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04451}04451           \textcolor{keywordtype}{double}* v\_values\_pt = v.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04452}04452           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < Nrows\_to\_send\_for\_get\_block(b, p); \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04453}04453           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04454}04454             v\_values\_pt[Rows\_to\_send\_for\_get\_block(b, p)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04455}04455               w\_values\_pt[Rows\_to\_recv\_for\_get\_block(b, p)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04456}04456           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04457}04457         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04458}04458       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04459}04459 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04460}04460       \textcolor{comment}{// and then just wait}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04461}04461       \textcolor{keywordtype}{unsigned} c = requests.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04462}04462       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Status>}} stat(c);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04463}04463       \textcolor{keywordflow}{if} (c)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04464}04464       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04465}04465         MPI\_Waitall(c, \&requests[0], \&stat[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04466}04466       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04467}04467       \textcolor{keyword}{delete}[] block\_lengths;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04468}04468 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04469}04469 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04470}04470       \textcolor{comment}{// throw error}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04471}04471       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04472}04472       error\_message << \textcolor{stringliteral}{"{}The preconditioner is distributed and on more than one "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04473}04473                     << \textcolor{stringliteral}{"{}processor. MPI is required."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04474}04474       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04475}04475         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04476}04476 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04477}04477     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04478}04478   \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04479}04479 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04480}04480   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04481}04481 \textcolor{comment}{  /// Takes the n-\/th block ordered vector, b,  and copies its entries}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04482}04482 \textcolor{comment}{  /// to the appropriate entries in the naturally ordered vector, v.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04483}04483 \textcolor{comment}{  /// Here n is the block number in the current block preconditioner.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04484}04484 \textcolor{comment}{  /// If the preconditioner is a subsidiary block preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04485}04485 \textcolor{comment}{  /// the other entries in v  that are not associated with it}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04486}04486 \textcolor{comment}{  /// are left alone.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04487}04487 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04488}04488   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04489}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a1dd4d3cd6b64fa64e1ff6730b0deecc7}{04489}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a1dd4d3cd6b64fa64e1ff6730b0deecc7}{BlockPreconditioner<MATRIX>::return\_block\_vector}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& n,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04490}04490                                                         \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& b,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04491}04491                                                         \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& v)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04492}04492 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04493}04493 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04494}04494     \textcolor{comment}{// the number of blocks}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04495}04495     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} para\_n\_blocks = nblock\_types();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04496}04496 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04497}04497     \textcolor{comment}{// paranoid check that block i is in this block preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04498}04498     \textcolor{keywordflow}{if} (n >= para\_n\_blocks)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04499}04499     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04500}04500       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04501}04501       err\_msg << \textcolor{stringliteral}{"{}Requested block vector "{}} << b}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04502}04502               << \textcolor{stringliteral}{"{}, however this preconditioner has "{}} << para\_n\_blocks}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04503}04503               << \textcolor{stringliteral}{"{} block types.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04504}04504       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04505}04505         err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04506}04506     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04507}04507     \textcolor{keywordflow}{if} (!v.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04508}04508     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04509}04509       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04510}04510       err\_msg << \textcolor{stringliteral}{"{}The distribution of the global vector v must be setup."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04511}04511       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04512}04512         err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04513}04513     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04514}04514     \textcolor{keywordflow}{if} (*v.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() != *this-\/>master\_distribution\_pt())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04515}04515     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04516}04516       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04517}04517       err\_msg << \textcolor{stringliteral}{"{}The distribution of the global vector v must match the "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04518}04518               << \textcolor{stringliteral}{"{} specified master\_distribution\_pt(). \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04519}04519               << \textcolor{stringliteral}{"{}i.e. Distribution\_pt in the master preconditioner"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04520}04520       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04521}04521         err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04522}04522     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04523}04523     \textcolor{keywordflow}{if} (!b.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04524}04524     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04525}04525       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04526}04526       err\_msg << \textcolor{stringliteral}{"{}The distribution of the block vector b must be setup."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04527}04527       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04528}04528         err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04529}04529     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04530}04530 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04531}04531 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04532}04532 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04533}04533     \textcolor{comment}{// Get the most fine grain dof}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04534}04534     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} most\_fine\_grain\_dof = Block\_to\_dof\_map\_fine[n];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04535}04535 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04536}04536     \textcolor{comment}{// How many dofs are in this block?}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04537}04537     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_dof\_vec = Block\_to\_dof\_map\_fine[n].size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04538}04538 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04539}04539     \textcolor{keywordflow}{if} (n\_dof\_vec == 1)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04540}04540     \textcolor{comment}{// There is only one dof, no need to split.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04541}04541     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04542}04542       internal\_return\_block\_vector(most\_fine\_grain\_dof[0], b, v);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04543}04543     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04544}04544     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04545}04545     \textcolor{comment}{// Need to split the vector up before we insert them all in one go.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04546}04546     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04547}04547       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}} dof\_vector(n\_dof\_vec);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04548}04548       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} d = 0; d < n\_dof\_vec; d++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04549}04549       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04550}04550         dof\_vector[d].build(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04551}04551           internal\_block\_distribution\_pt(most\_fine\_grain\_dof[d]));}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04552}04552       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04553}04553 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04554}04554       \mbox{\hyperlink{namespaceoomph_1_1DoubleVectorHelpers_aa87594da930b3eed12a27838972f10f8}{DoubleVectorHelpers::split\_without\_communication}}(b, dof\_vector);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04555}04555 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04556}04556       \textcolor{comment}{// return to v}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04557}04557       internal\_return\_block\_vectors(most\_fine\_grain\_dof, dof\_vector, v);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04558}04558     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04559}04559   \} \textcolor{comment}{// return\_block\_vector(...)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04560}04560 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04561}04561   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04562}04562 \textcolor{comment}{  /// Given the naturally ordered vector, v, return}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04563}04563 \textcolor{comment}{  /// the vector rearranged in block order in w. This is a legacy function}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04564}04564 \textcolor{comment}{  /// from the old block preconditioning framework. Kept alive in case it may}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04565}04565 \textcolor{comment}{  /// be needed again.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04566}04566 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04567}04567 \textcolor{comment}{  /// This uses the variables ending in "{}get\_ordered"{}. We no longer use this}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04568}04568 \textcolor{comment}{  /// type of method. This function copy values from v and re-\/order them}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04569}04569 \textcolor{comment}{  /// in "{}block order"{} and place them in w. Block order means that the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04570}04570 \textcolor{comment}{  /// values in w are the same as the concatenated block vectors.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04571}04571 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04572}04572 \textcolor{comment}{  /// I.e. -\/ v is naturally ordered.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04573}04573 \textcolor{comment}{  ///        v -\/> s\_b, v is ordered into blocks vectors}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04574}04574 \textcolor{comment}{  ///                  (requires communication)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04575}04575 \textcolor{comment}{  ///        concatenate\_without\_communication(s\_\{0,...,nblocks\},w) gives w.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04576}04576 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04577}04577 \textcolor{comment}{  /// But this function skips out the concatenation part and builds w directly}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04578}04578 \textcolor{comment}{  /// from v.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04579}04579 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04580}04580 \textcolor{comment}{  /// This is nice but the function is implemented in such a way that it}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04581}04581 \textcolor{comment}{  /// always use all the (internal) blocks and concatenated with the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04582}04582 \textcolor{comment}{  /// identity ordering. I.e. if this preconditioner has 3 block types, then}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04583}04583 \textcolor{comment}{  /// w will always be:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04584}04584 \textcolor{comment}{  /// concatenate\_without\_communication([s\_0, s\_1, s\_2], w). There is easy}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04585}04585 \textcolor{comment}{  /// way to change this.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04586}04586 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04587}04587 \textcolor{comment}{  /// Furthermore, it does not take into account the new dof type coarsening}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04588}04588 \textcolor{comment}{  /// feature. So this function will most likely produce the incorrect vector}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04589}04589 \textcolor{comment}{  /// w from what the user intended. It still works, but w will be the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04590}04590 \textcolor{comment}{  /// concatenation of the most fine grain dof block vectors with the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04591}04591 \textcolor{comment}{  /// "{}natural"{} dof type ordering.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04592}04592 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04593}04593 \textcolor{comment}{  /// This has been superseded by the function}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04594}04594 \textcolor{comment}{  /// get\_block\_ordered\_preconditioner\_vector(...) which does the correct}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04595}04595 \textcolor{comment}{  /// thing.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04596}04596 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04597}04597   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04598}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_afba1bef13cebdce65a0a49ff3381269a}{04598}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_afba1bef13cebdce65a0a49ff3381269a}{BlockPreconditioner<MATRIX>::}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04599}04599 \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_afba1bef13cebdce65a0a49ff3381269a}{    internal\_get\_block\_ordered\_preconditioner\_vector}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& v,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04600}04600                                                      \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& w)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04601}04601 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04602}04602 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04603}04603     \textcolor{keywordflow}{if} (!v.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04604}04604     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04605}04605       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04606}04606       error\_message << \textcolor{stringliteral}{"{}The distribution of the global vector v must be setup."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04607}04607       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04608}04608         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04609}04609     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04610}04610     \textcolor{keywordflow}{if} (*v.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() != *this-\/>master\_distribution\_pt())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04611}04611     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04612}04612       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04613}04613       error\_message << \textcolor{stringliteral}{"{}The distribution of the global vector v must match the "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04614}04614                     << \textcolor{stringliteral}{"{} specified master\_distribution\_pt(). \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04615}04615                     << \textcolor{stringliteral}{"{}i.e. Distribution\_pt in the master preconditioner"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04616}04616       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04617}04617         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04618}04618     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04619}04619 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04620}04620 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04621}04621     \textcolor{comment}{//  Cleared and resized w for reordered vector}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04622}04622     w.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>internal\_preconditioner\_matrix\_distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04623}04623 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04624}04624     \textcolor{comment}{// if + only one processor}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04625}04625     \textcolor{comment}{//    + more than one processor but matrix\_pt is not distributed}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04626}04626     \textcolor{comment}{// then use the serial get\_block method}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04627}04627     \textcolor{keywordflow}{if} (this-\/>distribution\_pt()-\/>communicator\_pt()-\/>nproc() == 1 ||}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04628}04628         !this-\/>distribution\_pt()-\/>distributed())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04629}04629     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04630}04630       \textcolor{comment}{// number of blocks}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04631}04631       \textcolor{keywordtype}{unsigned} nblock = this-\/>Internal\_nblock\_types;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04632}04632 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04633}04633       \textcolor{comment}{// copy to w}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04634}04634       \textcolor{keywordtype}{unsigned} block\_offset = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04635}04635       \textcolor{keywordtype}{double}* w\_pt = w.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04636}04636       \textcolor{keyword}{const} \textcolor{keywordtype}{double}* v\_pt = v.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04637}04637       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < nblock; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04638}04638       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04639}04639         \textcolor{keywordtype}{unsigned} block\_nrow = this-\/>internal\_block\_dimension(b);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04640}04640         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < block\_nrow; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04641}04641         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04642}04642           w\_pt[block\_offset + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = v\_pt[this-\/>Global\_index[b][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04643}04643         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04644}04644         block\_offset += block\_nrow;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04645}04645       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04646}04646     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04647}04647     \textcolor{comment}{// otherwise use mpi}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04648}04648     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04649}04649     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04650}04650 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04651}04651 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04652}04652       \textcolor{comment}{// my rank}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04653}04653       \textcolor{keywordtype}{unsigned} my\_rank = this-\/>distribution\_pt()-\/>communicator\_pt()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04654}04654 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04655}04655       \textcolor{comment}{// the number of processors}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04656}04656       \textcolor{keywordtype}{unsigned} nproc = this-\/>distribution\_pt()-\/>communicator\_pt()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04657}04657 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04658}04658       \textcolor{comment}{// determine the maximum number of rows to be sent or recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04659}04659       \textcolor{keywordtype}{unsigned} max\_n\_send\_or\_recv = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04660}04660       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04661}04661       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04662}04662         max\_n\_send\_or\_recv =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04663}04663           std::max(max\_n\_send\_or\_recv, Nrows\_to\_send\_for\_get\_ordered[p]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04664}04664         max\_n\_send\_or\_recv =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04665}04665           std::max(max\_n\_send\_or\_recv, Nrows\_to\_recv\_for\_get\_ordered[p]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04666}04666       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04667}04667 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04668}04668       \textcolor{comment}{// create a vectors of 1s (the size of the nblock for the mpi indexed}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04669}04669       \textcolor{comment}{// data types}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04670}04670       \textcolor{keywordtype}{int}* block\_lengths = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[max\_n\_send\_or\_recv];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04671}04671       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < max\_n\_send\_or\_recv; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04672}04672       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04673}04673         block\_lengths[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04674}04674       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04675}04675 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04676}04676       \textcolor{comment}{// perform the sends and receives}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04677}04677       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Request>}} requests;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04678}04678       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04679}04679       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04680}04680         \textcolor{comment}{// send and recv with other processors}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04681}04681         \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04682}04682         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04683}04683           \textcolor{keywordflow}{if} (Nrows\_to\_send\_for\_get\_ordered[p] > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04684}04684           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04685}04685             \textcolor{comment}{// create the send datatype}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04686}04686             MPI\_Datatype type\_send;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04687}04687             MPI\_Type\_indexed(Nrows\_to\_send\_for\_get\_ordered[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04688}04688                              block\_lengths,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04689}04689                              Rows\_to\_send\_for\_get\_ordered[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04690}04690                              MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04691}04691                              \&type\_send);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04692}04692             MPI\_Type\_commit(\&type\_send);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04693}04693 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04694}04694             \textcolor{comment}{// send}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04695}04695             MPI\_Request send\_req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04696}04696             MPI\_Isend(\textcolor{keyword}{const\_cast<}\textcolor{keywordtype}{double}*\textcolor{keyword}{>}(v.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}()),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04697}04697                       1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04698}04698                       type\_send,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04699}04699                       p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04700}04700                       0,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04701}04701                       this-\/>distribution\_pt()-\/>communicator\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04702}04702                       \&send\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04703}04703             MPI\_Type\_free(\&type\_send);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04704}04704             requests.push\_back(send\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04705}04705           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04706}04706 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04707}04707           \textcolor{keywordflow}{if} (Nrows\_to\_recv\_for\_get\_ordered[p] > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04708}04708           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04709}04709             \textcolor{comment}{// create the recv datatype}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04710}04710             MPI\_Datatype type\_recv;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04711}04711             MPI\_Type\_indexed(Nrows\_to\_recv\_for\_get\_ordered[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04712}04712                              block\_lengths,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04713}04713                              Rows\_to\_recv\_for\_get\_ordered[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04714}04714                              MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04715}04715                              \&type\_recv);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04716}04716             MPI\_Type\_commit(\&type\_recv);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04717}04717 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04718}04718             \textcolor{comment}{// recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04719}04719             MPI\_Request recv\_req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04720}04720             MPI\_Irecv(w.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04721}04721                       1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04722}04722                       type\_recv,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04723}04723                       p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04724}04724                       0,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04725}04725                       this-\/>distribution\_pt()-\/>communicator\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04726}04726                       \&recv\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04727}04727             MPI\_Type\_free(\&type\_recv);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04728}04728             requests.push\_back(recv\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04729}04729           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04730}04730         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04731}04731 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04732}04732         \textcolor{comment}{// communicate with self}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04733}04733         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04734}04734         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04735}04735           \textcolor{keywordtype}{double}* w\_values\_pt = w.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04736}04736           \textcolor{keyword}{const} \textcolor{keywordtype}{double}* v\_values\_pt = v.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04737}04737           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < Nrows\_to\_send\_for\_get\_ordered[p]; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04738}04738           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04739}04739             w\_values\_pt[Rows\_to\_recv\_for\_get\_ordered[p][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04740}04740               v\_values\_pt[Rows\_to\_send\_for\_get\_ordered[p][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04741}04741           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04742}04742         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04743}04743       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04744}04744 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04745}04745       \textcolor{comment}{// and then just wait}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04746}04746       \textcolor{keywordtype}{unsigned} c = requests.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04747}04747       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Status>}} stat(c);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04748}04748       \textcolor{keywordflow}{if} (c)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04749}04749       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04750}04750         MPI\_Waitall(c, \&requests[0], \&stat[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04751}04751       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04752}04752       \textcolor{keyword}{delete}[] block\_lengths;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04753}04753 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04754}04754 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04755}04755       \textcolor{comment}{// throw error}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04756}04756       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04757}04757       error\_message << \textcolor{stringliteral}{"{}The preconditioner is distributed and on more than one "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04758}04758                     << \textcolor{stringliteral}{"{}processor. MPI is required."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04759}04759       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04760}04760         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04761}04761 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04762}04762     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04763}04763   \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04764}04764 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04765}04765   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04766}04766 \textcolor{comment}{  /// Given the naturally ordered vector, v, return}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04767}04767 \textcolor{comment}{  /// the vector rearranged in block order in w. This function calls}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04768}04768 \textcolor{comment}{  /// get\_concatenated\_block\_vector(...) with the identity block mapping.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04769}04769 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04770}04770 \textcolor{comment}{  /// This function has been re-\/written to work with the new dof type}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04771}04771 \textcolor{comment}{  /// coarsening feature. The old function is kept alive in}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04772}04772 \textcolor{comment}{  /// internal\_get\_block\_ordered\_preconditioner\_vector(...) and is moved to}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04773}04773 \textcolor{comment}{  /// the private section of the code. The differences between the two are:}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04774}04774 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04775}04775 \textcolor{comment}{  /// 1) This function extracts all the block vectors (in one go) via the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04776}04776 \textcolor{comment}{  ///    function internal\_get\_block\_vectors(...), and concatenates them.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04777}04777 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04778}04778 \textcolor{comment}{  /// 2) The old function makes use of the variables ending in "{}get\_ordered"{},}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04779}04779 \textcolor{comment}{  ///    thus is slightly more efficient since it does not have to concatenate}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04780}04780 \textcolor{comment}{  ///    any block vectors.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04781}04781 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04782}04782 \textcolor{comment}{  /// 3) The old function no longer respect the new indirections if dof types}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04783}04783 \textcolor{comment}{  ///    have been coarsened.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04784}04784 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04785}04785 \textcolor{comment}{  /// 4) This function extracts the most fine grain dof-\/level vectors and}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04786}04786 \textcolor{comment}{  ///    concatenates them. These dof-\/level vectors respect the re-\/ordering}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04787}04787 \textcolor{comment}{  ///    caused by the coarsening of dof types. The overhead associated with}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04788}04788 \textcolor{comment}{  ///    concatenating DoubleVectors without communication is very small.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04789}04789 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04790}04790 \textcolor{comment}{  /// This function should be used.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04791}04791 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04792}04792   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04793}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_afd37323d2b5ba31e2d14f3ce8e6e474d}{04793}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_afd37323d2b5ba31e2d14f3ce8e6e474d}{BlockPreconditioner<MATRIX>::get\_block\_ordered\_preconditioner\_vector}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04794}04794     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& v, \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& w)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04795}04795   \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04796}04796 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04797}04797     \textcolor{keywordflow}{if} (!v.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04798}04798     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04799}04799       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04800}04800       error\_message << \textcolor{stringliteral}{"{}The distribution of the global vector v must be setup."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04801}04801       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04802}04802         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04803}04803     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04804}04804     \textcolor{keywordflow}{if} (*v.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() != *this-\/>master\_distribution\_pt())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04805}04805     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04806}04806       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04807}04807       error\_message << \textcolor{stringliteral}{"{}The distribution of the global vector v must match the "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04808}04808                     << \textcolor{stringliteral}{"{} specified master\_distribution\_pt(). \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04809}04809                     << \textcolor{stringliteral}{"{}i.e. Distribution\_pt in the master preconditioner"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04810}04810       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04811}04811         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04812}04812     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04813}04813 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04814}04814 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04815}04815     \textcolor{comment}{// Get the number of blocks.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04816}04816     \textcolor{keywordtype}{unsigned} nblocks = this-\/>nblock\_types();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04817}04817 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04818}04818     \textcolor{comment}{// Fill in the identity mapping.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04819}04819     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} block\_vec\_number(nblocks, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04820}04820     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < nblocks; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04821}04821     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04822}04822       block\_vec\_number[b] = b;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04823}04823     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04824}04824 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04825}04825     \textcolor{comment}{// Do the work.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04826}04826     get\_concatenated\_block\_vector(block\_vec\_number, v, w);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04827}04827   \} \textcolor{comment}{// get\_block\_ordered\_preconditioner\_vector(...)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04828}04828 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04829}04829   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04830}04830 \textcolor{comment}{  /// Takes the block ordered vector, w, and reorders it in the natural}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04831}04831 \textcolor{comment}{  /// order. Reordered vector is returned in v. Note: If the preconditioner is}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04832}04832 \textcolor{comment}{  /// a subsidiary preconditioner then only the components of the vector}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04833}04833 \textcolor{comment}{  /// associated with the blocks of the subsidiary preconditioner will be}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04834}04834 \textcolor{comment}{  /// included. Hence the length of v is master\_nrow() whereas that of the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04835}04835 \textcolor{comment}{  /// vector w is of length this-\/>nrow().}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04836}04836 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04837}04837 \textcolor{comment}{  /// This is the return function for the function}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04838}04838 \textcolor{comment}{  /// internal\_get\_block\_ordered\_preconditioner\_vector(...).}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04839}04839 \textcolor{comment}{  /// Both internal\_get\_block\_ordered\_preconditioner\_vector(...) and}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04840}04840 \textcolor{comment}{  /// internal\_return\_block\_ordered\_preconditioner\_vector(...) has been}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04841}04841 \textcolor{comment}{  /// superseded by the functions}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04842}04842 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04843}04843 \textcolor{comment}{  /// get\_block\_ordered\_preconditioner\_vector(...) and}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04844}04844 \textcolor{comment}{  /// return\_block\_ordered\_preconditioner\_vector(...),}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04845}04845 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04846}04846 \textcolor{comment}{  /// Thus this function is moved to the private section of the code.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04847}04847 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04848}04848   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04849}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a679a82067056628cc4bbc8bb68d088f2}{04849}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a679a82067056628cc4bbc8bb68d088f2}{BlockPreconditioner<MATRIX>::}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04850}04850 \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a679a82067056628cc4bbc8bb68d088f2}{    internal\_return\_block\_ordered\_preconditioner\_vector}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& w,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04851}04851                                                         \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& v)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04852}04852 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04853}04853 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04854}04854     \textcolor{keywordflow}{if} (!v.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04855}04855     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04856}04856       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04857}04857       error\_message << \textcolor{stringliteral}{"{}The distribution of the global vector v must be setup."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04858}04858       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04859}04859         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04860}04860     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04861}04861     \textcolor{keywordflow}{if} (*v.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() != *this-\/>master\_distribution\_pt())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04862}04862     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04863}04863       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04864}04864       error\_message << \textcolor{stringliteral}{"{}The distribution of the global vector v must match the "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04865}04865                     << \textcolor{stringliteral}{"{} specified master\_distribution\_pt(). \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04866}04866                     << \textcolor{stringliteral}{"{}i.e. Distribution\_pt in the master preconditioner"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04867}04867       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04868}04868         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04869}04869     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04870}04870     \textcolor{keywordflow}{if} (!w.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04871}04871     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04872}04872       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04873}04873       error\_message << \textcolor{stringliteral}{"{}The distribution of the block vector w must be setup."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04874}04874       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04875}04875         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04876}04876     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04877}04877     \textcolor{keywordflow}{if} (*w.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() !=}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04878}04878         *this-\/>internal\_preconditioner\_matrix\_distribution\_pt())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04879}04879     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04880}04880       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04881}04881       error\_message << \textcolor{stringliteral}{"{}The distribution of the block vector w must match the "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04882}04882                     << \textcolor{stringliteral}{"{} specified distribution at Distribution\_pt[b]"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04883}04883       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04884}04884         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04885}04885     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04886}04886 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04887}04887 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04888}04888 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04889}04889     \textcolor{comment}{// if + only one processor}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04890}04890     \textcolor{comment}{//    + more than one processor but matrix\_pt is not distributed}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04891}04891     \textcolor{comment}{// then use the serial get\_block method}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04892}04892     \textcolor{keywordflow}{if} (this-\/>distribution\_pt()-\/>communicator\_pt()-\/>nproc() == 1 ||}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04893}04893         !this-\/>distribution\_pt()-\/>distributed())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04894}04894     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04895}04895       \textcolor{comment}{// number of blocks}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04896}04896       \textcolor{keywordtype}{unsigned} nblock = this-\/>Internal\_nblock\_types;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04897}04897 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04898}04898       \textcolor{comment}{// copy to w}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04899}04899       \textcolor{keywordtype}{unsigned} block\_offset = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04900}04900       \textcolor{keyword}{const} \textcolor{keywordtype}{double}* w\_pt = w.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04901}04901       \textcolor{keywordtype}{double}* v\_pt = v.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04902}04902       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < nblock; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04903}04903       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04904}04904         \textcolor{keywordtype}{unsigned} block\_nrow = this-\/>internal\_block\_dimension(b);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04905}04905         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < block\_nrow; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04906}04906         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04907}04907           v\_pt[this-\/>Global\_index[b][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]] = w\_pt[block\_offset + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04908}04908         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04909}04909         block\_offset += block\_nrow;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04910}04910       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04911}04911     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04912}04912     \textcolor{comment}{// otherwise use mpi}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04913}04913     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04914}04914     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04915}04915 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04916}04916 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04917}04917       \textcolor{comment}{// my rank}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04918}04918       \textcolor{keywordtype}{unsigned} my\_rank = this-\/>distribution\_pt()-\/>communicator\_pt()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04919}04919 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04920}04920       \textcolor{comment}{// the number of processors}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04921}04921       \textcolor{keywordtype}{unsigned} nproc = this-\/>distribution\_pt()-\/>communicator\_pt()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04922}04922 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04923}04923       \textcolor{comment}{// determine the maximum number of rows to be sent or recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04924}04924       \textcolor{keywordtype}{unsigned} max\_n\_send\_or\_recv = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04925}04925       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04926}04926       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04927}04927         max\_n\_send\_or\_recv =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04928}04928           std::max(max\_n\_send\_or\_recv, Nrows\_to\_send\_for\_get\_ordered[p]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04929}04929         max\_n\_send\_or\_recv =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04930}04930           std::max(max\_n\_send\_or\_recv, Nrows\_to\_recv\_for\_get\_ordered[p]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04931}04931       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04932}04932 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04933}04933       \textcolor{comment}{// create a vectors of 1s (the size of the nblock for the mpi indexed}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04934}04934       \textcolor{comment}{// data types}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04935}04935       \textcolor{keywordtype}{int}* block\_lengths = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[max\_n\_send\_or\_recv];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04936}04936       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < max\_n\_send\_or\_recv; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04937}04937       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04938}04938         block\_lengths[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04939}04939       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04940}04940 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04941}04941       \textcolor{comment}{// perform the sends and receives}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04942}04942       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Request>}} requests;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04943}04943       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04944}04944       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04945}04945         \textcolor{comment}{// send and recv with other processors}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04946}04946         \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04947}04947         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04948}04948           \textcolor{keywordflow}{if} (Nrows\_to\_recv\_for\_get\_ordered[p] > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04949}04949           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04950}04950             \textcolor{comment}{// create the send datatype}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04951}04951             MPI\_Datatype type\_send;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04952}04952             MPI\_Type\_indexed(Nrows\_to\_recv\_for\_get\_ordered[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04953}04953                              block\_lengths,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04954}04954                              Rows\_to\_recv\_for\_get\_ordered[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04955}04955                              MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04956}04956                              \&type\_send);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04957}04957             MPI\_Type\_commit(\&type\_send);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04958}04958 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04959}04959             \textcolor{comment}{// send}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04960}04960             MPI\_Request send\_req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04961}04961             MPI\_Isend(\textcolor{keyword}{const\_cast<}\textcolor{keywordtype}{double}*\textcolor{keyword}{>}(w.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}()),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04962}04962                       1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04963}04963                       type\_send,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04964}04964                       p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04965}04965                       0,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04966}04966                       this-\/>distribution\_pt()-\/>communicator\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04967}04967                       \&send\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04968}04968             MPI\_Type\_free(\&type\_send);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04969}04969             requests.push\_back(send\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04970}04970           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04971}04971 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04972}04972           \textcolor{keywordflow}{if} (Nrows\_to\_send\_for\_get\_ordered[p] > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04973}04973           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04974}04974             \textcolor{comment}{// create the recv datatype}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04975}04975             MPI\_Datatype type\_recv;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04976}04976             MPI\_Type\_indexed(Nrows\_to\_send\_for\_get\_ordered[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04977}04977                              block\_lengths,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04978}04978                              Rows\_to\_send\_for\_get\_ordered[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04979}04979                              MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04980}04980                              \&type\_recv);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04981}04981             MPI\_Type\_commit(\&type\_recv);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04982}04982 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04983}04983             \textcolor{comment}{// recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04984}04984             MPI\_Request recv\_req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04985}04985             MPI\_Irecv(v.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04986}04986                       1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04987}04987                       type\_recv,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04988}04988                       p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04989}04989                       0,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04990}04990                       this-\/>distribution\_pt()-\/>communicator\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04991}04991                       \&recv\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04992}04992             MPI\_Type\_free(\&type\_recv);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04993}04993             requests.push\_back(recv\_req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04994}04994           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04995}04995         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04996}04996 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04997}04997         \textcolor{comment}{// communicate wih self}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04998}04998         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l04999}04999         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05000}05000           \textcolor{keyword}{const} \textcolor{keywordtype}{double}* w\_values\_pt = w.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05001}05001           \textcolor{keywordtype}{double}* v\_values\_pt = v.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05002}05002           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < Nrows\_to\_send\_for\_get\_ordered[p]; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05003}05003           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05004}05004             v\_values\_pt[Rows\_to\_send\_for\_get\_ordered[p][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05005}05005               w\_values\_pt[Rows\_to\_recv\_for\_get\_ordered[p][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05006}05006           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05007}05007         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05008}05008       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05009}05009 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05010}05010       \textcolor{comment}{// and then just wait}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05011}05011       \textcolor{keywordtype}{unsigned} c = requests.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05012}05012       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Status>}} stat(c);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05013}05013       \textcolor{keywordflow}{if} (c)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05014}05014       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05015}05015         MPI\_Waitall(c, \&requests[0], \&stat[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05016}05016       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05017}05017       \textcolor{keyword}{delete}[] block\_lengths;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05018}05018 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05019}05019 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05020}05020       \textcolor{comment}{// throw error}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05021}05021       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05022}05022       error\_message << \textcolor{stringliteral}{"{}The preconditioner is distributed and on more than one "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05023}05023                     << \textcolor{stringliteral}{"{}processor. MPI is required."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05024}05024       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05025}05025         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05026}05026 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05027}05027     \} \textcolor{comment}{// else use mpi}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05028}05028   \} \textcolor{comment}{// function return\_block\_ordered\_preconditioner\_vector}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05029}05029 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05030}05030 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05031}05031   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05032}05032 \textcolor{comment}{  /// Takes the block ordered vector, w, and reorders it in natural}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05033}05033 \textcolor{comment}{  /// order. Reordered vector is returned in v. Note: If the preconditioner is}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05034}05034 \textcolor{comment}{  /// a subsidiary preconditioner then only the components of the vector}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05035}05035 \textcolor{comment}{  /// associated with the blocks of the subsidiary preconditioner will be}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05036}05036 \textcolor{comment}{  /// included. Hence the length of v is master\_nrow() whereas that of the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05037}05037 \textcolor{comment}{  /// vector w is of length this-\/>nrow().}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05038}05038 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05039}05039 \textcolor{comment}{  /// This is the return function for the function}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05040}05040 \textcolor{comment}{  /// get\_block\_ordered\_preconditioner\_vector(...).}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05041}05041 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05042}05042 \textcolor{comment}{  /// It calls the function return\_concatenated\_block\_vector(...) with the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05043}05043 \textcolor{comment}{  /// identity block number ordering.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05044}05044 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05045}05045   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05046}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a98e920e003f085b02dbb30510fb23a0f}{05046}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a98e920e003f085b02dbb30510fb23a0f}{BlockPreconditioner<MATRIX>::return\_block\_ordered\_preconditioner\_vector}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05047}05047     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& w, \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& v)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05048}05048 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05049}05049 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05050}05050     \textcolor{keywordflow}{if} (!v.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05051}05051     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05052}05052       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05053}05053       error\_message << \textcolor{stringliteral}{"{}The distribution of the global vector v must be setup."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05054}05054       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05055}05055         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05056}05056     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05057}05057     \textcolor{keywordflow}{if} (*v.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() != *this-\/>master\_distribution\_pt())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05058}05058     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05059}05059       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05060}05060       error\_message << \textcolor{stringliteral}{"{}The distribution of the global vector v must match the "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05061}05061                     << \textcolor{stringliteral}{"{} specified master\_distribution\_pt(). \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05062}05062                     << \textcolor{stringliteral}{"{}i.e. Distribution\_pt in the master preconditioner"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05063}05063       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05064}05064         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05065}05065     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05066}05066     \textcolor{keywordflow}{if} (!w.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05067}05067     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05068}05068       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05069}05069       error\_message << \textcolor{stringliteral}{"{}The distribution of the block vector w must be setup."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05070}05070       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05071}05071         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05072}05072     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05073}05073     \textcolor{keywordflow}{if} (*w.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() != *this-\/>preconditioner\_matrix\_distribution\_pt())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05074}05074     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05075}05075       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05076}05076       error\_message << \textcolor{stringliteral}{"{}The distribution of the block vector w must match the "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05077}05077                     << \textcolor{stringliteral}{"{}concatenations of distributions in "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05078}05078                     << \textcolor{stringliteral}{"{}Block\_distribution\_pt.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05079}05079       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05080}05080         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05081}05081     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05082}05082 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05083}05083 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05084}05084     \textcolor{comment}{// Split into the block vectors.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05085}05085     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nblocks = nblock\_types();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05086}05086     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} block\_vec\_number(nblocks, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05087}05087     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < nblocks; b++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05088}05088     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05089}05089       block\_vec\_number[b] = b;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05090}05090     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05091}05091 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05092}05092     return\_concatenated\_block\_vector(block\_vec\_number, w, v);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05093}05093   \} \textcolor{comment}{// function return\_block\_ordered\_preconditioner\_vector}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05094}05094 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05095}05095   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05096}05096 \textcolor{comment}{  /// Gets block (i,j) from the matrix pointed to by}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05097}05097 \textcolor{comment}{  /// Matrix\_pt and returns it in output\_block. This is associated with the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05098}05098 \textcolor{comment}{  /// internal blocks. Please use the other get\_block(...) function.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05099}05099 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05100}05100   \textcolor{keyword}{template}<>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05101}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a4f714d01cd2fdb791aa0795f34b9610a}{05101}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_abe001ffe270c96e761ec5205364976a7}{BlockPreconditioner<CRDoubleMatrix>::internal\_get\_block}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05102}05102     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& block\_i,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05103}05103     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& block\_j,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05104}05104     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}\& output\_block)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05105}05105 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05106}05106 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05107}05107     \textcolor{comment}{// the number of blocks}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05108}05108     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_blocks = this-\/>internal\_nblock\_types();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05109}05109 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05110}05110     \textcolor{comment}{// paranoid check that block i is in this block preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05111}05111     \textcolor{keywordflow}{if} (block\_i >= n\_blocks || block\_j >= n\_blocks)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05112}05112     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05113}05113       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05114}05114       error\_message}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05115}05115         << \textcolor{stringliteral}{"{}Requested block ("{}} << block\_i << \textcolor{stringliteral}{"{},"{}} << block\_j}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05116}05116         << \textcolor{stringliteral}{"{}), however this preconditioner has internal\_nblock\_types() "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05117}05117         << \textcolor{stringliteral}{"{}= "{}} << internal\_nblock\_types() << std::endl;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05118}05118       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05119}05119         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05120}05120     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05121}05121 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05122}05122     \textcolor{comment}{// Check that the matrix is the same as that of the master}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05123}05123     \textcolor{keywordflow}{if} (is\_subsidiary\_block\_preconditioner())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05124}05124     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05125}05125       \textcolor{keywordflow}{if} (master\_block\_preconditioner\_pt()-\/>matrix\_pt() != matrix\_pt())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05126}05126       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05127}05127         \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} err = \textcolor{stringliteral}{"{}Master and subs should have same matrix."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05128}05128         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05129}05129           err, OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05130}05130       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05131}05131     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05132}05132 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05133}05133 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05134}05134     \textcolor{comment}{// Cast the pointer}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05135}05135     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}* cr\_matrix\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}*\textcolor{keyword}{>}(matrix\_pt());}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05136}05136 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05137}05137     \textcolor{comment}{// if + only one processor}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05138}05138     \textcolor{comment}{//    + more than one processor but matrix\_pt is not distributed}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05139}05139     \textcolor{comment}{// then use the serial get\_block method}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05140}05140     \textcolor{keywordflow}{if} (cr\_matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2760847d45ab334f6d902efc2620b615}{communicator\_pt}}()-\/>nproc() == 1 ||}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05141}05141         !cr\_matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a05842d032d28880ae37951deae804ad8}{distributed}}())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05142}05142     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05143}05143       \textcolor{comment}{// pointers for the jacobian matrix is compressed row sparse format}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05144}05144       \textcolor{keywordtype}{int}* j\_row\_start;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05145}05145       \textcolor{keywordtype}{int}* j\_column\_index;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05146}05146       \textcolor{keywordtype}{double}* j\_value;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05147}05147 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05148}05148       \textcolor{comment}{// sets pointers to jacobian matrix}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05149}05149       j\_row\_start = cr\_matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05150}05150       j\_column\_index = cr\_matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05151}05151       j\_value = cr\_matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05152}05152 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05153}05153       \textcolor{comment}{// get the block dimensions}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05154}05154       \textcolor{keywordtype}{unsigned} block\_nrow = this-\/>internal\_block\_dimension(block\_i);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05155}05155       \textcolor{keywordtype}{unsigned} block\_ncol = this-\/>internal\_block\_dimension(block\_j);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05156}05156 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05157}05157       \textcolor{comment}{// allocate temporary storage for the component vectors of block (i,j)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05158}05158       \textcolor{comment}{// temp\_ptr is used to point to an element in each column -\/ required as}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05159}05159       \textcolor{comment}{// cannot assume that order of block's rows in jacobian and the block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05160}05160       \textcolor{comment}{// matrix will be the same}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05161}05161       \textcolor{keywordtype}{int}* temp\_row\_start = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[block\_nrow + 1];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05162}05162       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} <= block\_nrow; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05163}05163       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05164}05164         temp\_row\_start[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05165}05165       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05166}05166       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} temp\_ptr(block\_nrow + 1);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05167}05167       \textcolor{keywordtype}{int} block\_nnz = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05168}05168 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05169}05169       \textcolor{comment}{// get number of rows in source matrix}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05170}05170       \textcolor{keywordtype}{unsigned} master\_nrow = this-\/>master\_nrow();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05171}05171 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05172}05172       \textcolor{comment}{// determine how many non zeros there are in the block (i,j)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05173}05173       \textcolor{comment}{// also determines how many non zeros are stored in each row or column -\/}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05174}05174       \textcolor{comment}{// stored in temp\_ptr temporarily}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05175}05175       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k < master\_nrow; k++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05176}05176       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05177}05177         \textcolor{keywordflow}{if} (internal\_block\_number(k) == \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(block\_i))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05178}05178         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05179}05179           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} l = j\_row\_start[k]; l < j\_row\_start[k + 1]; l++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05180}05180           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05181}05181             \textcolor{keywordflow}{if} (internal\_block\_number(j\_column\_index[l]) ==}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05182}05182                 \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(block\_j))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05183}05183             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05184}05184               block\_nnz++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05185}05185               temp\_ptr[internal\_index\_in\_block(k) + 1]++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05186}05186             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05187}05187           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05188}05188         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05189}05189       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05190}05190 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05191}05191       \textcolor{comment}{// if the matrix is not empty}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05192}05192       \textcolor{keywordtype}{int}* temp\_column\_index = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[block\_nnz];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05193}05193       \textcolor{keywordtype}{double}* temp\_value = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[block\_nnz];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05194}05194       \textcolor{keywordflow}{if} (block\_nnz > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05195}05195       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05196}05196         \textcolor{comment}{// uses number of elements in each column of block to determine values}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05197}05197         \textcolor{comment}{// for the block column start (temp\_row\_start)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05198}05198         temp\_row\_start[0] = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05199}05199         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 1; k <= block\_nrow; k++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05200}05200         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05201}05201           temp\_row\_start[k] = temp\_row\_start[k -\/ 1] + temp\_ptr[k];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05202}05202           temp\_ptr[k] = temp\_row\_start[k];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05203}05203         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05204}05204 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05205}05205         \textcolor{comment}{// copies the relevant elements of the jacobian to the correct entries}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05206}05206         \textcolor{comment}{// of the block matrix}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05207}05207         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k < master\_nrow; k++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05208}05208         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05209}05209           \textcolor{keywordflow}{if} (internal\_block\_number(k) == \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(block\_i))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05210}05210           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05211}05211             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} l = j\_row\_start[k]; l < j\_row\_start[k + 1]; l++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05212}05212             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05213}05213               \textcolor{keywordflow}{if} (internal\_block\_number(j\_column\_index[l]) ==}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05214}05214                   \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(block\_j))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05215}05215               \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05216}05216                 \textcolor{keywordtype}{int} kk = temp\_ptr[internal\_index\_in\_block(k)]++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05217}05217                 temp\_value[kk] = j\_value[l];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05218}05218                 temp\_column\_index[kk] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05219}05219                   internal\_index\_in\_block(j\_column\_index[l]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05220}05220               \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05221}05221             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05222}05222           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05223}05223         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05224}05224       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05225}05225 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05226}05226 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05227}05227       \textcolor{comment}{// Fill in the compressed row matrix ??ds Note: I kept the calls to}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05228}05228       \textcolor{comment}{// build as close as I could to before (had to replace new(dist) with}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05229}05229       \textcolor{comment}{// .build(dist) ).}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05230}05230       output\_block.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{build}}(Internal\_block\_distribution\_pt[block\_i]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05231}05231       output\_block.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafb4d7de0a87b4bda560928e6a128060}{build\_without\_copy}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05232}05232         block\_ncol, block\_nnz, temp\_value, temp\_column\_index, temp\_row\_start);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05233}05233 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05234}05234 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05235}05235       \textcolor{comment}{// checks to see if block matrix has been set up correctly}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05236}05236       \textcolor{comment}{//   block\_matrix\_test(matrix\_pt,block\_i,block\_j,block\_pt);}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05237}05237       \textcolor{keywordflow}{if} (Run\_block\_matrix\_test)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05238}05238       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05239}05239         \textcolor{comment}{// checks to see if block matrix has been set up correctly}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05240}05240         block\_matrix\_test(block\_i, block\_j, \&output\_block);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05241}05241       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05242}05242 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05243}05243     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05244}05244 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05245}05245 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05246}05246     \textcolor{comment}{// otherwise we are dealing with a distributed matrix}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05247}05247     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05248}05248     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05249}05249 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05250}05250       \textcolor{comment}{// number of processors}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05251}05251       \textcolor{keywordtype}{unsigned} nproc = this-\/>distribution\_pt()-\/>communicator\_pt()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05252}05252 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05253}05253       \textcolor{comment}{// my rank}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05254}05254       \textcolor{keywordtype}{unsigned} my\_rank = this-\/>distribution\_pt()-\/>communicator\_pt()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05255}05255 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05256}05256       \textcolor{comment}{// sets pointers to jacobian matrix}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05257}05257       \textcolor{keywordtype}{int}* j\_row\_start = cr\_matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05258}05258       \textcolor{keywordtype}{int}* j\_column\_index = cr\_matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05259}05259       \textcolor{keywordtype}{double}* j\_value = cr\_matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05260}05260 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05261}05261       \textcolor{comment}{// number of non zeros in each row to be sent}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05262}05262       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}} nnz\_send(nproc, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05263}05263 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05264}05264       \textcolor{comment}{// number of non zeros in each row to be received}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05265}05265       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}} nnz\_recv(nproc, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05266}05266 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05267}05267       \textcolor{comment}{// storage for data to be sent}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05268}05268       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}} column\_index\_for\_proc(nproc, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05269}05269       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}} values\_for\_proc(nproc, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05270}05270 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05271}05271       \textcolor{comment}{// number of non zeros to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05272}05272       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} total\_nnz\_send(nproc, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05273}05273 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05274}05274       \textcolor{comment}{// number of rows of the block matrix on this processor}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05275}05275       \textcolor{keywordtype}{unsigned} nrow\_local =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05276}05276         Internal\_block\_distribution\_pt[block\_i]-\/>nrow\_local();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05277}05277 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05278}05278       \textcolor{comment}{// resize the nnz storage and compute nnz\_send}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05279}05279       \textcolor{comment}{// and send and recv the nnz}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05280}05280       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Request>}} send\_req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05281}05281       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Request>}} recv1\_req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05282}05282       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05283}05283       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05284}05284         \textcolor{keywordtype}{int} nrow\_send = Nrows\_to\_send\_for\_get\_block(block\_i, p);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05285}05285         \textcolor{keywordtype}{int} nrow\_recv = Nrows\_to\_recv\_for\_get\_block(block\_i, p);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05286}05286 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05287}05287         \textcolor{comment}{// assemble nnz recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05288}05288         nnz\_recv[p] = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nrow\_recv];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05289}05289 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05290}05290         \textcolor{comment}{// assemble the storage to send}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05291}05291         \textcolor{keywordflow}{if} (nrow\_send > 0 \&\& p != my\_rank)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05292}05292         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05293}05293           nnz\_send[p] = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nrow\_send];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05294}05294         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05295}05295 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05296}05296         \textcolor{comment}{// compute the number of nnzs in each row and the total number}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05297}05297         \textcolor{comment}{// of nnzs}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05298}05298         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nrow\_send; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05299}05299         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05300}05300           \textcolor{keywordtype}{unsigned} row = Rows\_to\_send\_for\_get\_block(block\_i, p)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05301}05301           \textcolor{keywordtype}{int} c = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05302}05302           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} r = j\_row\_start[row]; r < j\_row\_start[row + 1]; r++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05303}05303           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05304}05304             \textcolor{keywordflow}{if} (internal\_block\_number(j\_column\_index[r]) == \textcolor{keywordtype}{int}(block\_j))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05305}05305             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05306}05306               c++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05307}05307             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05308}05308           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05309}05309           \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05310}05310           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05311}05311             nnz\_send[p][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = c;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05312}05312           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05313}05313           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05314}05314           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05315}05315             nnz\_recv[p][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = c;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05316}05316           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05317}05317           total\_nnz\_send[p] += c;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05318}05318         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05319}05319 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05320}05320         \textcolor{comment}{// send}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05321}05321         \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05322}05322         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05323}05323           \textcolor{keywordflow}{if} (nrow\_send)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05324}05324           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05325}05325             MPI\_Request req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05326}05326             MPI\_Isend(nnz\_send[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05327}05327                       nrow\_send,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05328}05328                       MPI\_INT,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05329}05329                       p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05330}05330                       0,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05331}05331                       this-\/>distribution\_pt()-\/>communicator\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05332}05332                       \&req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05333}05333             send\_req.push\_back(req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05334}05334           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05335}05335 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05336}05336           \textcolor{comment}{// recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05337}05337           \textcolor{keywordflow}{if} (nrow\_recv)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05338}05338           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05339}05339             MPI\_Request req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05340}05340             MPI\_Irecv(nnz\_recv[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05341}05341                       nrow\_recv,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05342}05342                       MPI\_INT,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05343}05343                       p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05344}05344                       0,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05345}05345                       this-\/>distribution\_pt()-\/>communicator\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05346}05346                       \&req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05347}05347             recv1\_req.push\_back(req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05348}05348           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05349}05349         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05350}05350       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05351}05351 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05352}05352       \textcolor{comment}{// next assemble the values and row\_start data to be sent for each}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05353}05353       \textcolor{comment}{// processor}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05354}05354       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05355}05355       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05356}05356         \textcolor{keywordtype}{int} nrow\_send = Nrows\_to\_send\_for\_get\_block(block\_i, p);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05357}05357 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05358}05358         \textcolor{comment}{// assemble the storage for the values and column indices to be sent}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05359}05359         \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05360}05360         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05361}05361           \textcolor{keywordflow}{if} (total\_nnz\_send[p] > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05362}05362           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05363}05363             values\_for\_proc[p] = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[total\_nnz\_send[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05364}05364             column\_index\_for\_proc[p] = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[total\_nnz\_send[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05365}05365 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05366}05366             \textcolor{comment}{// copy the values and column indices to the storage}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05367}05367             \textcolor{keywordtype}{unsigned} ptr = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05368}05368             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nrow\_send; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05369}05369             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05370}05370               \textcolor{keywordtype}{unsigned} row = Rows\_to\_send\_for\_get\_block(block\_i, p)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05371}05371               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} r = j\_row\_start[row]; r < j\_row\_start[row + 1]; r++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05372}05372               \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05373}05373                 \textcolor{keywordflow}{if} (internal\_block\_number(j\_column\_index[r]) == \textcolor{keywordtype}{int}(block\_j))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05374}05374                 \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05375}05375                   values\_for\_proc[p][ptr] = j\_value[r];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05376}05376                   column\_index\_for\_proc[p][ptr] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05377}05377                     internal\_index\_in\_block(j\_column\_index[r]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05378}05378                   ptr++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05379}05379                 \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05380}05380               \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05381}05381             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05382}05382 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05383}05383             \textcolor{comment}{// create the datatypes}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05384}05384             MPI\_Datatype types[2];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05385}05385             MPI\_Type\_contiguous(total\_nnz\_send[p], MPI\_DOUBLE, \&types[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05386}05386             MPI\_Type\_commit(\&types[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05387}05387             MPI\_Type\_contiguous(total\_nnz\_send[p], MPI\_INT, \&types[1]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05388}05388             MPI\_Type\_commit(\&types[1]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05389}05389 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05390}05390             \textcolor{comment}{// get the start address of the vectors}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05391}05391             MPI\_Aint displacement[2];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05392}05392             MPI\_Get\_address(values\_for\_proc[p], \&displacement[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05393}05393             MPI\_Get\_address(column\_index\_for\_proc[p], \&displacement[1]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05394}05394 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05395}05395             \textcolor{comment}{// compute the displacements}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05396}05396             displacement[1] -\/= displacement[0];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05397}05397             displacement[0] -\/= displacement[0];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05398}05398 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05399}05399             \textcolor{comment}{// compute the block lengths}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05400}05400             \textcolor{keywordtype}{int} length[2];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05401}05401             length[0] = length[1] = 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05402}05402 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05403}05403             \textcolor{comment}{// build the struct data type}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05404}05404             MPI\_Datatype final\_type;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05405}05405             MPI\_Type\_create\_struct(2, length, displacement, types, \&final\_type);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05406}05406             MPI\_Type\_commit(\&final\_type);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05407}05407             MPI\_Type\_free(\&types[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05408}05408             MPI\_Type\_free(\&types[1]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05409}05409 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05410}05410             \textcolor{comment}{// and send}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05411}05411             MPI\_Request req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05412}05412             MPI\_Isend(values\_for\_proc[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05413}05413                       1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05414}05414                       final\_type,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05415}05415                       p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05416}05416                       1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05417}05417                       this-\/>distribution\_pt()-\/>communicator\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05418}05418                       \&req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05419}05419             send\_req.push\_back(req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05420}05420             MPI\_Type\_free(\&final\_type);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05421}05421           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05422}05422         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05423}05423       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05424}05424 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05425}05425       \textcolor{comment}{// wait for the recv to complete (the row\_start recv which actually}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05426}05426       \textcolor{comment}{// contains the number of nnzs in each row)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05427}05427       \textcolor{keywordtype}{int} c\_recv = recv1\_req.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05428}05428       \textcolor{keywordflow}{if} (c\_recv != 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05429}05429       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05430}05430         MPI\_Waitall(c\_recv, \&recv1\_req[0], MPI\_STATUS\_IGNORE);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05431}05431       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05432}05432 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05433}05433       \textcolor{comment}{// compute the total number of nnzs to be received}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05434}05434       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} total\_nnz\_recv\_from\_proc(nproc);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05435}05435       \textcolor{keywordtype}{int} local\_block\_nnz = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05436}05436       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05437}05437       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05438}05438         \textcolor{comment}{// compute the total nnzs}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05439}05439         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < Nrows\_to\_recv\_for\_get\_block(block\_i, p); \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05440}05440         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05441}05441           total\_nnz\_recv\_from\_proc[p] += nnz\_recv[p][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05442}05442         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05443}05443         local\_block\_nnz += total\_nnz\_recv\_from\_proc[p];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05444}05444       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05445}05445 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05446}05446       \textcolor{comment}{// compute the offset for each block of nnzs (a matrix row) in the}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05447}05447       \textcolor{comment}{// values\_recv and column\_index\_recv vectors}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05448}05448 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05449}05449       \textcolor{comment}{// fisrt determine how many blocks of rows are to be recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05450}05450       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} n\_recv\_block(nproc, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05451}05451       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05452}05452       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05453}05453         \textcolor{keywordflow}{if} (Nrows\_to\_recv\_for\_get\_block(block\_i, p) > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05454}05454         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05455}05455           n\_recv\_block[p] = 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05456}05456         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05457}05457         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 1; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < Nrows\_to\_recv\_for\_get\_block(block\_i, p); \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05458}05458         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05459}05459           \textcolor{keywordflow}{if} (Rows\_to\_recv\_for\_get\_block(block\_i, p)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] !=}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05460}05460               Rows\_to\_recv\_for\_get\_block(block\_i, p)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} -\/ 1] + 1)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05461}05461           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05462}05462             n\_recv\_block[p]++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05463}05463           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05464}05464         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05465}05465       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05466}05466 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05467}05467       \textcolor{comment}{// next assemble row start recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05468}05468       \textcolor{keywordtype}{int}* row\_start\_recv = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nrow\_local + 1];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05469}05469       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} <= nrow\_local; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05470}05470       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05471}05471         row\_start\_recv[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05472}05472       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05473}05473       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05474}05474       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05475}05475         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < Nrows\_to\_recv\_for\_get\_block(block\_i, p); \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05476}05476         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05477}05477           row\_start\_recv[Rows\_to\_recv\_for\_get\_block(block\_i, p)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05478}05478             nnz\_recv[p][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05479}05479         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05480}05480       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05481}05481       \textcolor{keywordtype}{int} g = row\_start\_recv[0];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05482}05482       row\_start\_recv[0] = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05483}05483       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 1; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nrow\_local; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05484}05484       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05485}05485         \textcolor{keywordtype}{int} temp\_g = g;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05486}05486         g = row\_start\_recv[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05487}05487         row\_start\_recv[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = row\_start\_recv[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} -\/ 1] + temp\_g;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05488}05488       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05489}05489       row\_start\_recv[nrow\_local] = row\_start\_recv[nrow\_local -\/ 1] + g;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05490}05490 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05491}05491       \textcolor{comment}{// next assemble the offset and the number of nzs in each recv block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05492}05492       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}} offset\_recv\_block(nproc, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05493}05493       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}} nnz\_recv\_block(nproc, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05494}05494       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05495}05495       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05496}05496         \textcolor{keywordflow}{if} (Nrows\_to\_recv\_for\_get\_block(block\_i, p) > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05497}05497         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05498}05498           offset\_recv\_block[p] = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[n\_recv\_block[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05499}05499           offset\_recv\_block[p][0] = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05500}05500           nnz\_recv\_block[p] = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[n\_recv\_block[p]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05501}05501           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_recv\_block[p]; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05502}05502           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05503}05503             nnz\_recv\_block[p][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05504}05504           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05505}05505           \textcolor{keywordtype}{unsigned} ptr = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05506}05506           nnz\_recv\_block[p][ptr] += nnz\_recv[p][0];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05507}05507           offset\_recv\_block[p][0] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05508}05508             row\_start\_recv[Rows\_to\_recv\_for\_get\_block(block\_i, p)[0]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05509}05509           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 1; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < Nrows\_to\_recv\_for\_get\_block(block\_i, p); \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05510}05510           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05511}05511             \textcolor{keywordflow}{if} (Rows\_to\_recv\_for\_get\_block(block\_i, p)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] !=}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05512}05512                 Rows\_to\_recv\_for\_get\_block(block\_i, p)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} -\/ 1] + 1)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05513}05513             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05514}05514               ptr++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05515}05515               offset\_recv\_block[p][ptr] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05516}05516                 row\_start\_recv[Rows\_to\_recv\_for\_get\_block(block\_i, p)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05517}05517             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05518}05518             nnz\_recv\_block[p][ptr] += nnz\_recv[p][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05519}05519           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05520}05520         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05521}05521         \textcolor{keyword}{delete}[] nnz\_recv[p];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05522}05522       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05523}05523 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05524}05524       \textcolor{comment}{// post the receives}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05525}05525       \textcolor{keywordtype}{int}* column\_index\_recv = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[local\_block\_nnz];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05526}05526       \textcolor{keywordtype}{double}* values\_recv = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[local\_block\_nnz];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05527}05527       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Request>}} recv2\_req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05528}05528       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05529}05529       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05530}05530         \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05531}05531         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05532}05532           \textcolor{keywordflow}{if} (total\_nnz\_recv\_from\_proc[p] != 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05533}05533           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05534}05534             \textcolor{comment}{// create the datatypes}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05535}05535             MPI\_Datatype types[2];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05536}05536             MPI\_Type\_indexed(n\_recv\_block[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05537}05537                              nnz\_recv\_block[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05538}05538                              offset\_recv\_block[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05539}05539                              MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05540}05540                              \&types[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05541}05541             MPI\_Type\_commit(\&types[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05542}05542             MPI\_Type\_indexed(n\_recv\_block[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05543}05543                              nnz\_recv\_block[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05544}05544                              offset\_recv\_block[p],}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05545}05545                              MPI\_INT,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05546}05546                              \&types[1]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05547}05547             MPI\_Type\_commit(\&types[1]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05548}05548 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05549}05549             \textcolor{comment}{// compute the displacements}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05550}05550             MPI\_Aint displacements[2];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05551}05551             MPI\_Get\_address(values\_recv, \&displacements[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05552}05552             MPI\_Get\_address(column\_index\_recv, \&displacements[1]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05553}05553             displacements[1] -\/= displacements[0];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05554}05554             displacements[0] -\/= displacements[0];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05555}05555 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05556}05556             \textcolor{comment}{// compute the block lengths}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05557}05557             \textcolor{keywordtype}{int} length[2];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05558}05558             length[0] = length[1] = 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05559}05559 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05560}05560             \textcolor{comment}{// create the final datatype}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05561}05561             MPI\_Datatype final\_type;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05562}05562             MPI\_Type\_create\_struct(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05563}05563               2, length, displacements, types, \&final\_type);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05564}05564             MPI\_Type\_commit(\&final\_type);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05565}05565             MPI\_Type\_free(\&types[0]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05566}05566             MPI\_Type\_free(\&types[1]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05567}05567 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05568}05568             \textcolor{comment}{// and the recv}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05569}05569             MPI\_Request req;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05570}05570             MPI\_Irecv(values\_recv,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05571}05571                       1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05572}05572                       final\_type,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05573}05573                       p,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05574}05574                       1,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05575}05575                       this-\/>distribution\_pt()-\/>communicator\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05576}05576                       \&req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05577}05577             recv2\_req.push\_back(req);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05578}05578             MPI\_Type\_free(\&final\_type);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05579}05579           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05580}05580         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05581}05581         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05582}05582         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05583}05583           \textcolor{comment}{// next send the values and column indices to self}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05584}05584           \textcolor{keywordtype}{unsigned} block\_ptr = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05585}05585           \textcolor{keywordtype}{unsigned} counter = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05586}05586           \textcolor{keywordtype}{int} nrow\_send = Nrows\_to\_send\_for\_get\_block(block\_i, my\_rank);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05587}05587           \textcolor{keywordflow}{if} (nrow\_send > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05588}05588           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05589}05589             \textcolor{keywordtype}{unsigned} offset = offset\_recv\_block[my\_rank][0];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05590}05590             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nrow\_send; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05591}05591             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05592}05592               \textcolor{keywordflow}{if} (\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} > 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05593}05593               \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05594}05594                 \textcolor{keywordflow}{if} (Rows\_to\_recv\_for\_get\_block(block\_i, p)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] !=}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05595}05595                     Rows\_to\_recv\_for\_get\_block(block\_i, p)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} -\/ 1] + 1)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05596}05596                 \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05597}05597                   counter = 0;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05598}05598                   block\_ptr++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05599}05599                   offset = offset\_recv\_block[my\_rank][block\_ptr];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05600}05600                 \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05601}05601               \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05602}05602               \textcolor{keywordtype}{unsigned} row = Rows\_to\_send\_for\_get\_block(block\_i, my\_rank)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05603}05603               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} r = j\_row\_start[row]; r < j\_row\_start[row + 1]; r++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05604}05604               \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05605}05605                 \textcolor{keywordflow}{if} (internal\_block\_number(j\_column\_index[r]) == \textcolor{keywordtype}{int}(block\_j))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05606}05606                 \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05607}05607                   values\_recv[offset + counter] = j\_value[r];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05608}05608                   column\_index\_recv[offset + counter] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05609}05609                     internal\_index\_in\_block(j\_column\_index[r]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05610}05610                   counter++;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05611}05611                 \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05612}05612               \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05613}05613             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05614}05614           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05615}05615         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05616}05616       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05617}05617 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05618}05618       \textcolor{comment}{// wait for the recv to complete (for the column\_index and the values\_}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05619}05619       c\_recv = recv2\_req.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05620}05620       \textcolor{keywordflow}{if} (c\_recv != 0)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05621}05621       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05622}05622         MPI\_Waitall(c\_recv, \&recv2\_req[0], MPI\_STATUS\_IGNORE);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05623}05623       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05624}05624 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05625}05625       \textcolor{comment}{// Fill in the compressed row matrix}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05626}05626       output\_block.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{build}}(Internal\_block\_distribution\_pt[block\_i]);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05627}05627       output\_block.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafb4d7de0a87b4bda560928e6a128060}{build\_without\_copy}}(this-\/>internal\_block\_dimension(block\_j),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05628}05628                                       local\_block\_nnz,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05629}05629                                       values\_recv,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05630}05630                                       column\_index\_recv,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05631}05631                                       row\_start\_recv);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05632}05632 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05633}05633       \textcolor{comment}{// wait for the send to complete (nnz / row\_start)}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05634}05634       \textcolor{keywordtype}{int} c\_send = send\_req.size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05635}05635       \textcolor{keywordflow}{if} (c\_send)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05636}05636       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05637}05637         MPI\_Waitall(c\_send, \&send\_req[0], MPI\_STATUS\_IGNORE);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05638}05638       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05639}05639 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05640}05640       \textcolor{comment}{// delete temp storage used for assembling data for communication}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05641}05641       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05642}05642       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05643}05643         \textcolor{keyword}{delete}[] nnz\_send[p];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05644}05644         \textcolor{keyword}{delete}[] column\_index\_for\_proc[p];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05645}05645         \textcolor{keyword}{delete}[] values\_for\_proc[p];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05646}05646         \textcolor{keyword}{delete}[] offset\_recv\_block[p];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05647}05647         \textcolor{keyword}{delete}[] nnz\_recv\_block[p];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05648}05648       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05649}05649 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05650}05650       \textcolor{comment}{// throw error}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05651}05651       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05652}05652       error\_message << \textcolor{stringliteral}{"{}The matrix is distributed and on more than one "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05653}05653                     << \textcolor{stringliteral}{"{}processor. MPI is required."{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05654}05654       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05655}05655         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05656}05656 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05657}05657     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05658}05658   \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05659}05659 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05660}05660   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05661}05661 \textcolor{comment}{  /// Gets dof-\/level block (i,j).}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05662}05662 \textcolor{comment}{  /// If Replacement\_dof\_block\_pt(i,j) is not null, then the replacement}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05663}05663 \textcolor{comment}{  /// block is returned via a deep copy.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05664}05664 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05665}05665 \textcolor{comment}{  /// Otherwise if this is the uppermost block preconditioner then it calls}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05666}05666 \textcolor{comment}{  /// internal\_get\_block(i,j), else if it is a subsidiary}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05667}05667 \textcolor{comment}{  /// block preconditioner, it will call it's master block preconditioners'}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05668}05668 \textcolor{comment}{  /// get\_dof\_level\_block function.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05669}05669 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05670}05670   \textcolor{keyword}{template}<>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05671}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a1df550d281ec99914115edfa1a40b982}{05671}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner}{BlockPreconditioner<CRDoubleMatrix>::get\_dof\_level\_block}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05672}05672     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& block\_i,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05673}05673     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& block\_j,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05674}05674     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}\& output\_block,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05675}05675     \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& ignore\_replacement\_block)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05676}05676 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05677}05677 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05678}05678     \textcolor{comment}{// the number of dof types.}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05679}05679     \textcolor{keywordtype}{unsigned} para\_ndofs = ndof\_types();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05680}05680 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05681}05681     \textcolor{comment}{// paranoid check that block i is in this block preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05682}05682     \textcolor{keywordflow}{if} (block\_i >= para\_ndofs || block\_j >= para\_ndofs)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05683}05683     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05684}05684       std::ostringstream err\_msg;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05685}05685       err\_msg << \textcolor{stringliteral}{"{}Requested dof block ("{}} << block\_i << \textcolor{stringliteral}{"{},"{}} << block\_j}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05686}05686               << \textcolor{stringliteral}{"{}), however this preconditioner has ndof\_types() "{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05687}05687               << \textcolor{stringliteral}{"{}= "{}} << para\_ndofs << std::endl;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05688}05688       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05689}05689         err\_msg.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05690}05690     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05691}05691 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05692}05692 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05693}05693     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}* tmp\_block\_pt =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05694}05694       Replacement\_dof\_block\_pt.get(block\_i, block\_j);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05695}05695 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05696}05696     \textcolor{keywordflow}{if} ((tmp\_block\_pt == 0) || ignore\_replacement\_block)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05697}05697     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05698}05698       \textcolor{comment}{// Getting the block from parent preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05699}05699       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} ndof\_in\_parent\_i =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05700}05700         Doftype\_coarsen\_map\_coarse[block\_i].size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05701}05701       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} ndof\_in\_parent\_j =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05702}05702         Doftype\_coarsen\_map\_coarse[block\_j].size();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05703}05703 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05704}05704       \textcolor{keywordflow}{if} (ndof\_in\_parent\_i == 1 \&\& ndof\_in\_parent\_j == 1)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05705}05705       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05706}05706         \textcolor{keywordtype}{unsigned} parent\_dof\_i = Doftype\_coarsen\_map\_coarse[block\_i][0];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05707}05707         \textcolor{keywordtype}{unsigned} parent\_dof\_j = Doftype\_coarsen\_map\_coarse[block\_j][0];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05708}05708 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05709}05709         \textcolor{keywordflow}{if} (is\_master\_block\_preconditioner())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05710}05710         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05711}05711           internal\_get\_block(parent\_dof\_i, parent\_dof\_j, output\_block);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05712}05712         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05713}05713         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05714}05714         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05715}05715           parent\_dof\_i = Doftype\_in\_master\_preconditioner\_coarse[parent\_dof\_i];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05716}05716           parent\_dof\_j = Doftype\_in\_master\_preconditioner\_coarse[parent\_dof\_j];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05717}05717 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05718}05718           master\_block\_preconditioner\_pt()-\/>get\_dof\_level\_block(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05719}05719             parent\_dof\_i, parent\_dof\_j, output\_block, ignore\_replacement\_block);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05720}05720         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05721}05721       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05722}05722       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05723}05723       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05724}05724         \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<CRDoubleMatrix*>}} tmp\_blocks\_pt(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05725}05725           ndof\_in\_parent\_i, ndof\_in\_parent\_j, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05726}05726 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05727}05727         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<unsigned>}}> new\_block(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05728}05728           ndof\_in\_parent\_i, \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}(ndof\_in\_parent\_j, 0));}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05729}05729 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05730}05730         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_i = 0; dof\_i < ndof\_in\_parent\_i; dof\_i++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05731}05731         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05732}05732           \textcolor{keywordtype}{unsigned} parent\_dof\_i = Doftype\_coarsen\_map\_coarse[block\_i][dof\_i];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05733}05733           \textcolor{keywordflow}{if} (is\_subsidiary\_block\_preconditioner())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05734}05734           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05735}05735             parent\_dof\_i =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05736}05736               Doftype\_in\_master\_preconditioner\_coarse[parent\_dof\_i];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05737}05737           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05738}05738 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05739}05739           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_j = 0; dof\_j < ndof\_in\_parent\_j; dof\_j++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05740}05740           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05741}05741             \textcolor{keywordtype}{unsigned} parent\_dof\_j = Doftype\_coarsen\_map\_coarse[block\_j][dof\_j];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05742}05742 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05743}05743             tmp\_blocks\_pt(dof\_i, dof\_j) = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05744}05744 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05745}05745             new\_block[dof\_i][dof\_j] = 1;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05746}05746 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05747}05747             \textcolor{keywordflow}{if} (is\_master\_block\_preconditioner())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05748}05748             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05749}05749               internal\_get\_block(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05750}05750                 parent\_dof\_i, parent\_dof\_j, *tmp\_blocks\_pt(dof\_i, dof\_j));}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05751}05751             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05752}05752             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05753}05753             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05754}05754               parent\_dof\_j =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05755}05755                 Doftype\_in\_master\_preconditioner\_coarse[parent\_dof\_j];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05756}05756 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05757}05757               master\_block\_preconditioner\_pt()-\/>get\_dof\_level\_block(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05758}05758                 parent\_dof\_i,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05759}05759                 parent\_dof\_j,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05760}05760                 *tmp\_blocks\_pt(dof\_i, dof\_j),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05761}05761                 ignore\_replacement\_block);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05762}05762             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05763}05763           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05764}05764         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05765}05765 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05766}05766         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<LinearAlgebraDistribution*>}} tmp\_row\_dist\_pt(ndof\_in\_parent\_i, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05767}05767 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05768}05768         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} parent\_dof\_i = 0; parent\_dof\_i < ndof\_in\_parent\_i;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05769}05769              parent\_dof\_i++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05770}05770         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05771}05771           \textcolor{keywordtype}{unsigned} mapped\_dof\_i =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05772}05772             Doftype\_coarsen\_map\_coarse[block\_i][parent\_dof\_i];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05773}05773 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05774}05774           \textcolor{keywordflow}{if} (is\_master\_block\_preconditioner())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05775}05775           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05776}05776             tmp\_row\_dist\_pt[parent\_dof\_i] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05777}05777               Internal\_block\_distribution\_pt[mapped\_dof\_i];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05778}05778           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05779}05779           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05780}05780           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05781}05781             mapped\_dof\_i =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05782}05782               Doftype\_in\_master\_preconditioner\_coarse[mapped\_dof\_i];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05783}05783 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05784}05784             tmp\_row\_dist\_pt[parent\_dof\_i] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05785}05785               master\_block\_preconditioner\_pt()-\/>dof\_block\_distribution\_pt(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05786}05786                 mapped\_dof\_i);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05787}05787           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05788}05788         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05789}05789 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05790}05790         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<LinearAlgebraDistribution*>}} tmp\_col\_dist\_pt(ndof\_in\_parent\_j, 0);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05791}05791 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05792}05792         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} parent\_dof\_j = 0; parent\_dof\_j < ndof\_in\_parent\_j;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05793}05793              parent\_dof\_j++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05794}05794         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05795}05795           \textcolor{keywordtype}{unsigned} mapped\_dof\_j =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05796}05796             Doftype\_coarsen\_map\_coarse[block\_j][parent\_dof\_j];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05797}05797 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05798}05798           \textcolor{keywordflow}{if} (is\_master\_block\_preconditioner())}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05799}05799           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05800}05800             tmp\_col\_dist\_pt[parent\_dof\_j] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05801}05801               Internal\_block\_distribution\_pt[mapped\_dof\_j];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05802}05802           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05803}05803           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05804}05804           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05805}05805             mapped\_dof\_j =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05806}05806               Doftype\_in\_master\_preconditioner\_coarse[mapped\_dof\_j];}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05807}05807             tmp\_col\_dist\_pt[parent\_dof\_j] =}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05808}05808               master\_block\_preconditioner\_pt()-\/>dof\_block\_distribution\_pt(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05809}05809                 mapped\_dof\_j);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05810}05810           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05811}05811         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05812}05812 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05813}05813         \mbox{\hyperlink{namespaceoomph_1_1DoubleVectorHelpers_a3ea9f7c40548e1a88402312e6f15d1fc}{CRDoubleMatrixHelpers::concatenate\_without\_communication}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05814}05814           tmp\_row\_dist\_pt, tmp\_col\_dist\_pt, tmp\_blocks\_pt, output\_block);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05815}05815 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05816}05816         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_i = 0; dof\_i < ndof\_in\_parent\_i; dof\_i++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05817}05817         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05818}05818           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_j = 0; dof\_j < ndof\_in\_parent\_j; dof\_j++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05819}05819           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05820}05820             \textcolor{keywordflow}{if} (new\_block[dof\_i][dof\_j])}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05821}05821             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05822}05822               \textcolor{keyword}{delete} tmp\_blocks\_pt(dof\_i, dof\_j);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05823}05823             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05824}05824           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05825}05825         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05826}05826       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05827}05827     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05828}05828     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05829}05829     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05830}05830       \mbox{\hyperlink{namespaceoomph_1_1CRDoubleMatrixHelpers_a157511f700993ab8bc014f9d0d44f4c7}{CRDoubleMatrixHelpers::deep\_copy}}(tmp\_block\_pt, output\_block);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05831}05831     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05832}05832   \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05833}05833 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05834}05834   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05835}05835 \textcolor{comment}{  /// test function to check that every element in the block matrix}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05836}05836 \textcolor{comment}{  /// (block\_i,block\_j) matches the corresponding element in the original matrix}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05837}05837 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05838}05838   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05839}\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a4d8ff67e34e85a71c0f9bb68c0b10496}{05839}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner}{BlockPreconditioner<MATRIX>::block\_matrix\_test}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05840}05840     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& block\_i,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05841}05841     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& block\_j,}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05842}05842     \textcolor{keyword}{const} MATRIX* block\_matrix\_pt)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05843}05843 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05844}05844     \textcolor{comment}{// boolean flag to indicate whether test is passed}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05845}05845     \textcolor{keywordtype}{bool} check = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05846}05846 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05847}05847     \textcolor{comment}{// number of rows in matrix}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05848}05848     \textcolor{keywordtype}{unsigned} n\_row = matrix\_pt()-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05849}05849 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05850}05850     \textcolor{comment}{// number of columns in matrix}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05851}05851     \textcolor{keywordtype}{unsigned} n\_col = matrix\_pt()-\/>ncol();}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05852}05852 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05853}05853     \textcolor{comment}{// loop over rows of original matrix}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05854}05854     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_row; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05855}05855     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05856}05856       \textcolor{comment}{// if this coefficient is associated with a block in this block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05857}05857       \textcolor{comment}{// preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05858}05858       \textcolor{keywordflow}{if} (\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(block\_i) == this-\/>internal\_block\_number(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05859}05859       \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05860}05860         \textcolor{comment}{// loop over columns of original matrix}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05861}05861         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_col; j++)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05862}05862         \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05863}05863           \textcolor{comment}{// if the coeeficient is associated with a block in this block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05864}05864           \textcolor{comment}{// preconditioner}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05865}05865           \textcolor{keywordflow}{if} (\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(block\_j) == this-\/>internal\_block\_number(j))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05866}05866           \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05867}05867             \textcolor{comment}{// check whether elements in original matrix and matrix of block}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05868}05868             \textcolor{comment}{// pointers match}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05869}05869             \textcolor{keywordflow}{if} (matrix\_pt()-\/>\textcolor{keyword}{operator}()(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j) !=}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05870}05870                 block\_matrix\_pt-\/>operator()(internal\_index\_in\_block(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}),}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05871}05871                                             internal\_index\_in\_block(j)))}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05872}05872             \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05873}05873               check = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05874}05874             \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05875}05875           \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05876}05876         \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05877}05877       \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05878}05878     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05879}05879 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05880}05880     \textcolor{comment}{// throw error}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05881}05881     \textcolor{keywordflow}{if} (!check)}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05882}05882     \{}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05883}05883       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05884}05884       error\_message << \textcolor{stringliteral}{"{}The require elements have not been successfully copied"{}}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05885}05885                     << \textcolor{stringliteral}{"{} from the original matrix to the block matrices"{}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05886}05886       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05887}05887         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05888}05888     \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05889}05889   \}}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05890}05890 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05891}05891 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05892}05892   \textcolor{keyword}{template} \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1BlockPreconditioner}{BlockPreconditioner<CRDoubleMatrix>}};}
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05893}05893 }
\DoxyCodeLine{\Hypertarget{block__preconditioner_8cc_source_l05894}05894 \} \textcolor{comment}{// namespace oomph}}

\end{DoxyCode}
