\hypertarget{problem_8cc_source}{}\doxysection{problem.\+cc}
\label{problem_8cc_source}\index{problem.cc@{problem.cc}}
\mbox{\hyperlink{problem_8cc}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00001}00001 \textcolor{comment}{// LIC// ====================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00002}00002 \textcolor{comment}{// LIC// This file forms part of oomph-\/lib, the object-\/oriented,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00003}00003 \textcolor{comment}{// LIC// multi-\/physics finite-\/element library, available}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00004}00004 \textcolor{comment}{// LIC// at http://www.oomph-\/lib.org.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00005}00005 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00006}00006 \textcolor{comment}{// LIC// Copyright (C) 2006-\/2022 Matthias Heil and Andrew Hazel}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00007}00007 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00008}00008 \textcolor{comment}{// LIC// This library is free software; you can redistribute it and/or}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00009}00009 \textcolor{comment}{// LIC// modify it under the terms of the GNU Lesser General Public}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00010}00010 \textcolor{comment}{// LIC// License as published by the Free Software Foundation; either}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00011}00011 \textcolor{comment}{// LIC// version 2.1 of the License, or (at your option) any later version.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00012}00012 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00013}00013 \textcolor{comment}{// LIC// This library is distributed in the hope that it will be useful,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00014}00014 \textcolor{comment}{// LIC// but WITHOUT ANY WARRANTY; without even the implied warranty of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00015}00015 \textcolor{comment}{// LIC// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00016}00016 \textcolor{comment}{// LIC// Lesser General Public License for more details.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00017}00017 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00018}00018 \textcolor{comment}{// LIC// You should have received a copy of the GNU Lesser General Public}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00019}00019 \textcolor{comment}{// LIC// License along with this library; if not, write to the Free Software}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00020}00020 \textcolor{comment}{// LIC// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00021}00021 \textcolor{comment}{// LIC// 02110-\/1301  USA.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00022}00022 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00023}00023 \textcolor{comment}{// LIC// The authors may be contacted at oomph-\/lib@maths.man.ac.uk.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00024}00024 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00025}00025 \textcolor{comment}{// LIC//====================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00026}00026 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00027}00027 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00028}00028 \textcolor{preprocessor}{\#include "{}mpi.h"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00029}00029 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00030}00030 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00031}00031 \textcolor{preprocessor}{\#include <list>}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00032}00032 \textcolor{preprocessor}{\#include <algorithm>}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00033}00033 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00034}00034 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00035}00035 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{oomph__utilities_8h}{oomph\_utilities.h}}"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00036}00036 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{problem_8h}{problem.h}}"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00037}00037 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{timesteppers_8h}{timesteppers.h}}"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00038}00038 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{explicit__timesteppers_8h}{explicit\_timesteppers.h}}"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00039}00039 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{generalised__timesteppers_8h}{generalised\_timesteppers.h}}"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00040}00040 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{refineable__mesh_8h}{refineable\_mesh.h}}"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00041}00041 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{triangle__mesh_8h}{triangle\_mesh.h}}"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00042}00042 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{linear__solver_8h}{linear\_solver.h}}"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00043}00043 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{eigen__solver_8h}{eigen\_solver.h}}"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00044}00044 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{assembly__handler_8h}{assembly\_handler.h}}"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00045}00045 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{dg__elements_8h}{dg\_elements.h}}"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00046}00046 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{partitioning_8h}{partitioning.h}}"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00047}00047 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{spines_8h}{spines.h}}"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00048}00048 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00049}00049 \textcolor{comment}{// Include to fill in additional\_setup\_shared\_node\_scheme() function}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00050}00050 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{refineable__mesh_8template_8cc}{refineable\_mesh.template.cc}}"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00051}00051 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00052}00052 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00053}00053 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceoomph}{oomph}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00054}00054 \{\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00055}00055 \textcolor{comment}{  /// ///////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00056}00056 \textcolor{comment}{}  \textcolor{comment}{// Non-\/inline functions for the problem class}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00057}00057 \textcolor{comment}{  /// ///////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00058}00058 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00059}00059   \textcolor{comment}{//=================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00060}00060 \textcolor{comment}{  /// The continuation timestepper object}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00061}00061 \textcolor{comment}{}  \textcolor{comment}{//=================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00062}00062   ContinuationStorageScheme \mbox{\hyperlink{classoomph_1_1Problem_ade29c0a82218d50136b4b3860055ad30}{Problem::Continuation\_time\_stepper}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00063}00063 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00064}00064   \textcolor{comment}{//================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00065}00065 \textcolor{comment}{  /// Constructor: Allocate space for one time stepper}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00066}00066 \textcolor{comment}{  /// and set all pointers to NULL and set defaults for all}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00067}00067 \textcolor{comment}{  /// parameters.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00068}00068 \textcolor{comment}{}  \textcolor{comment}{//===============================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00069}\mbox{\hyperlink{classoomph_1_1Problem_a3f071f2f8be895dbe0d39d12ca59acf4}{00069}}   \mbox{\hyperlink{classoomph_1_1Problem_a3f071f2f8be895dbe0d39d12ca59acf4}{Problem::Problem}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00070}00070     : Mesh\_pt(0),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00071}00071       Time\_pt(0),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00072}00072       Explicit\_time\_stepper\_pt(0),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00073}00073       Saved\_dof\_pt(0),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00074}00074       Default\_set\_initial\_condition\_called(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00075}00075       Use\_globally\_convergent\_newton\_method(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00076}00076       Empty\_actions\_before\_read\_unstructured\_meshes\_has\_been\_called(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00077}00077       Empty\_actions\_after\_read\_unstructured\_meshes\_has\_been\_called(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00078}00078       Store\_local\_dof\_pt\_in\_elements(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00079}00079       Calculate\_hessian\_products\_analytic(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00080}00080 \#ifdef OOMPH\_HAS\_MPI}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00081}00081       Doc\_imbalance\_in\_parallel\_assembly(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00082}00082       Use\_default\_partition\_in\_load\_balance(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00083}00083       Must\_recompute\_load\_balance\_for\_assembly(true),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00084}00084       Halo\_scheme\_pt(0),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00085}00085 \#endif}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00086}00086       Relaxation\_factor(1.0),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00087}00087       Newton\_solver\_tolerance(1.0e-\/8),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00088}00088       \mbox{\hyperlink{namespaceoomph_1_1Locate__zeta__helpers_a473b3aa4666ed6dfeb49bff0c6ed0e71}{Max\_newton\_iterations}}(10),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00089}00089       Nnewton\_iter\_taken(0),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00090}00090       Max\_residuals(10.0),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00091}00091       Time\_adaptive\_newton\_crash\_on\_solve\_fail(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00092}00092       Jacobian\_reuse\_is\_enabled(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00093}00093       Jacobian\_has\_been\_computed(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00094}00094       Problem\_is\_nonlinear(true),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00095}00095       Pause\_at\_end\_of\_sparse\_assembly(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00096}00096       Doc\_time\_in\_distribute(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00097}00097       Sparse\_assembly\_method(Perform\_assembly\_using\_vectors\_of\_pairs),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00098}00098       Sparse\_assemble\_with\_arrays\_initial\_allocation(400),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00099}00099       Sparse\_assemble\_with\_arrays\_allocation\_increment(150),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00100}00100       Numerical\_zero\_for\_sparse\_assembly(0.0),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00101}00101       FD\_step\_used\_in\_get\_hessian\_vector\_products(1.0e-\/8),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00102}00102       Mass\_matrix\_reuse\_is\_enabled(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00103}00103       Mass\_matrix\_has\_been\_computed(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00104}00104       Discontinuous\_element\_formulation(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00105}00105       Minimum\_dt(1.0e-\/12),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00106}00106       Maximum\_dt(1.0e12),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00107}00107       DTSF\_max\_increase(4.0),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00108}00108       DTSF\_min\_decrease(0.8),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00109}00109       Minimum\_dt\_but\_still\_proceed(-\/1.0),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00110}00110       Scale\_arc\_length(true),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00111}00111       Desired\_proportion\_of\_arc\_length(0.5),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00112}00112       Theta\_squared(1.0),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00113}00113       Sign\_of\_jacobian(0),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00114}00114       Continuation\_direction(1.0),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00115}00115       Parameter\_derivative(1.0),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00116}00116       Parameter\_current(0.0),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00117}00117       Use\_continuation\_timestepper(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00118}00118       Dof\_derivative\_offset(1),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00119}00119       Dof\_current\_offset(2),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00120}00120       Ds\_current(0.0),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00121}00121       Desired\_newton\_iterations\_ds(5),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00122}00122       Minimum\_ds(1.0e-\/10),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00123}00123       Bifurcation\_detection(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00124}00124       Bisect\_to\_find\_bifurcation(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00125}00125       First\_jacobian\_sign\_change(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00126}00126       Arc\_length\_step\_taken(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00127}00127       Use\_finite\_differences\_for\_continuation\_derivatives(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00128}00128 \#ifdef OOMPH\_HAS\_MPI}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00129}00129       Dist\_problem\_matrix\_distribution(Uniform\_matrix\_distribution),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00130}00130       Parallel\_sparse\_assemble\_previous\_allocation(0),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00131}00131       Problem\_has\_been\_distributed(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00132}00132       Bypass\_increase\_in\_dof\_check\_during\_pruning(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00133}00133       Max\_permitted\_error\_for\_halo\_check(1.0e-\/14),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00134}00134 \#endif}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00135}00135       Shut\_up\_in\_newton\_solve(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00136}00136       Always\_take\_one\_newton\_step(false),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00137}00137       Timestep\_reduction\_factor\_after\_nonconvergence(0.5),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00138}00138       Keep\_temporal\_error\_below\_tolerance(true)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00139}00139   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00140}00140     \mbox{\hyperlink{classoomph_1_1Problem_afe6f5bb841832b3c4d1f06c2d939f4a6}{Use\_predictor\_values\_as\_initial\_guess}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00141}00141 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00142}00142 \textcolor{comment}{    /// Setup terminate helper}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00143}00143 \textcolor{comment}{}    \mbox{\hyperlink{namespaceoomph_1_1TerminateHelper_a38ec1b047a4438b6eba8a21b669c229d}{TerminateHelper::setup}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00144}00144 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00145}00145     \textcolor{comment}{// By default no submeshes:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00146}00146     \mbox{\hyperlink{classoomph_1_1Problem_ab65f6fc9c49860e6324457a7e6e76346}{Sub\_mesh\_pt}}.resize(0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00147}00147     \textcolor{comment}{// No timesteppers}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00148}00148     \mbox{\hyperlink{classoomph_1_1Problem_af1e8f8a739453250eb3744fea2a3b983}{Time\_stepper\_pt}}.resize(0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00149}00149 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00150}00150     \textcolor{comment}{// Set the linear solvers, eigensolver and assembly handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00151}00151     \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}} = \mbox{\hyperlink{classoomph_1_1Problem_ad01b385b2b4cd2e0b867754bea7b798a}{Default\_linear\_solver\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1SuperLUSolver}{SuperLUSolver}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00152}00152     \mbox{\hyperlink{classoomph_1_1Problem_ad4b9d15269f624044d1730957b0a8c19}{Mass\_matrix\_solver\_for\_explicit\_timestepper\_pt}} = \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00153}00153 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00154}00154     \mbox{\hyperlink{classoomph_1_1Problem_ab7938313fa45df9be16515a6b0bfd324}{Eigen\_solver\_pt}} = \mbox{\hyperlink{classoomph_1_1Problem_a39fd6a7e05c02befe9f2a09938a7a7a4}{Default\_eigen\_solver\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1ARPACK}{ARPACK}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00155}00155 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00156}00156     \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}} = \mbox{\hyperlink{classoomph_1_1Problem_ae0cebe288c8daddd9663bd10d8f1caa0}{Default\_assembly\_handler\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1AssemblyHandler}{AssemblyHandler}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00157}00157 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00158}00158     \textcolor{comment}{// setup the communicator}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00159}00159 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00160}00160     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1MPI__Helpers_aa376d403f6bc99e8595d227135932b0e}{MPI\_Helpers::mpi\_has\_been\_initialised}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00161}00161     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00162}00162       \mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1OomphCommunicator}{OomphCommunicator}}(\mbox{\hyperlink{classoomph_1_1MPI__Helpers_ac16964b22bfd4f657490802beb600ffe}{MPI\_Helpers::communicator\_pt}}());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00163}00163     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00164}00164     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00165}00165     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00166}00166       \mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1OomphCommunicator}{OomphCommunicator}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00167}00167     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00168}00168 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00169}00169     \mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1OomphCommunicator}{OomphCommunicator}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00170}00170 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00171}00171 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00172}00172     \textcolor{comment}{// just create an empty linear algebra distribution for the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00173}00173     \textcolor{comment}{// DOFs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00174}00174     \textcolor{comment}{// this is setup when assign\_eqn\_numbers(...) is called.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00175}00175     \mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00176}00176   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00177}00177 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00178}00178   \textcolor{comment}{//================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00179}00179 \textcolor{comment}{  /// Destructor to clean up memory}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00180}00180 \textcolor{comment}{}  \textcolor{comment}{//================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00181}\mbox{\hyperlink{classoomph_1_1Problem_ae2cd468ec03f7ede23c0dc8eea3be1cf}{00181}}   \mbox{\hyperlink{classoomph_1_1Problem_ae2cd468ec03f7ede23c0dc8eea3be1cf}{Problem::\string~Problem}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00182}00182   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00183}00183     \textcolor{comment}{// Delete the memory assigned for the global time}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00184}00184     \textcolor{comment}{// (it's created on the fly in Problem::add\_time\_stepper\_pt()}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00185}00185     \textcolor{comment}{// so we are entitled to delete it.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00186}00186     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_ae33fbf5f34a7d06d88ad2c98538bbbe8}{Time\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00187}00187     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00188}00188       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1Problem_ae33fbf5f34a7d06d88ad2c98538bbbe8}{Time\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00189}00189       \mbox{\hyperlink{classoomph_1_1Problem_ae33fbf5f34a7d06d88ad2c98538bbbe8}{Time\_pt}} = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00190}00190     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00191}00191 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00192}00192     \textcolor{comment}{// We're not using the default linear solver,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00193}00193     \textcolor{comment}{// somebody else must have built it, so that person}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00194}00194     \textcolor{comment}{// must be in charge of killing it.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00195}00195     \textcolor{comment}{// We can safely delete the defaults, however}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00196}00196     \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1Problem_ad01b385b2b4cd2e0b867754bea7b798a}{Default\_linear\_solver\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00197}00197 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00198}00198     \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1Problem_a39fd6a7e05c02befe9f2a09938a7a7a4}{Default\_eigen\_solver\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00199}00199     \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1Problem_ae0cebe288c8daddd9663bd10d8f1caa0}{Default\_assembly\_handler\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00200}00200     \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00201}00201     \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00202}00202 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00203}00203     \textcolor{comment}{// Delete any copies of the problem that have been created for}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00204}00204     \textcolor{comment}{// use in adaptive bifurcation tracking.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00205}00205     \textcolor{comment}{// ALH: This will eventually go}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00206}00206     \textcolor{keywordtype}{unsigned} n\_copies = \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00207}00207     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} c = 0; c < n\_copies; c++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00208}00208     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00209}00209       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00210}00210     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00211}00211 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00212}00212     \textcolor{comment}{// if this problem has sub meshes then we must delete the Mesh\_pt}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00213}00213     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_ab65f6fc9c49860e6324457a7e6e76346}{Sub\_mesh\_pt}}.size() != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00214}00214     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00215}00215       \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a38446e721be2f75a64fdaa025b7c23ad}{flush\_element\_and\_node\_storage}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00216}00216       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00217}00217     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00218}00218 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00219}00219     \textcolor{comment}{// Since we called the TerminateHelper setup function in the constructor,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00220}00220     \textcolor{comment}{// we need to delete anything that was dynamically allocated (as it's}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00221}00221     \textcolor{comment}{// just a namespace and so doesn't have it's own destructor) in the function}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00222}00222     \mbox{\hyperlink{namespaceoomph_1_1TerminateHelper_a20615123e22554c3c485484f4c23bfb5}{TerminateHelper::clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00223}00223   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00224}00224 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00225}00225   \textcolor{comment}{//=================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00226}00226 \textcolor{comment}{  /// Setup the count vector that records how many elements contribute}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00227}00227 \textcolor{comment}{  /// to each degree of freedom. Returns the total number of elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00228}00228 \textcolor{comment}{  /// in the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00229}00229 \textcolor{comment}{}  \textcolor{comment}{//=================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00230}\mbox{\hyperlink{classoomph_1_1Problem_a919a5f4752362df6005d24e51b5780e0}{00230}}   \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1Problem_a919a5f4752362df6005d24e51b5780e0}{Problem::setup\_element\_count\_per\_dof}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00231}00231   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00232}00232     \textcolor{comment}{// Now set the element counter to have the current Dof distribution}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00233}00233     \mbox{\hyperlink{classoomph_1_1Problem_ae4177b73a790b80d541b416d1e83c6c3}{Element\_count\_per\_dof}}.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00234}00234     \textcolor{comment}{// We need to use the halo scheme (assuming it has been setup)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00235}00235 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00236}00236     \mbox{\hyperlink{classoomph_1_1Problem_ae4177b73a790b80d541b416d1e83c6c3}{Element\_count\_per\_dof}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_a1aab1a84c6a82a755fdc3c6b27ce49d7}{build\_halo\_scheme}}(this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a1dcaa04975d69c616ab294cbfaf53d55}{Halo\_scheme\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00237}00237 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00238}00238 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00239}00239     \textcolor{comment}{// Loop over the elements and count the entries}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00240}00240     \textcolor{comment}{// and number of (non-\/halo) elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00241}00241     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_element = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00242}00242     \textcolor{keywordtype}{unsigned} n\_non\_halo\_element\_local = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00243}00243     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00244}00244     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00245}00245       \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00246}00246 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00247}00247       \textcolor{comment}{// Ignore halo elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00248}00248       \textcolor{keywordflow}{if} (!elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a0d9869eaf7d6e104c1e465b0d3cd6a9b}{is\_halo}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00249}00249       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00250}00250 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00251}00251         \textcolor{comment}{// Increment the number of non halo elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00252}00252         ++n\_non\_halo\_element\_local;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00253}00253         \textcolor{comment}{// Now count the number of times the element contributes to a value}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00254}00254         \textcolor{comment}{// using the current assembly handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00255}00255         \textcolor{keywordtype}{unsigned} n\_var = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a09213be8f4aa009e0366460a7ed78e68}{ndof}}(elem\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00256}00256         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00257}00257         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00258}00258           ++\mbox{\hyperlink{classoomph_1_1Problem_ae4177b73a790b80d541b416d1e83c6c3}{Element\_count\_per\_dof}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00259}00259             this-\/>\mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, n));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00260}00260         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00261}00261 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00262}00262       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00263}00263 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00264}00264     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00265}00265 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00266}00266     \textcolor{comment}{// Storage for the total number of elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00267}00267     \textcolor{keywordtype}{unsigned} Nelement = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00268}00268 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00269}00269     \textcolor{comment}{// Add together all the counts if we are in parallel}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00270}00270 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00271}00271     \mbox{\hyperlink{classoomph_1_1Problem_ae4177b73a790b80d541b416d1e83c6c3}{Element\_count\_per\_dof}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_a7165745d3397b6ea9d87f123cc97e5c9}{sum\_all\_halo\_and\_haloed\_values}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00272}00272 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00273}00273     \textcolor{comment}{// If distributed, find the total number of elements in the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00274}00274     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00275}00275     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00276}00276       \textcolor{comment}{// Need to gather the total number of non halo elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00277}00277       MPI\_Allreduce(\&n\_non\_halo\_element\_local,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00278}00278                     \&Nelement,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00279}00279                     1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00280}00280                     MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00281}00281                     MPI\_SUM,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00282}00282                     this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00283}00283     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00284}00284     \textcolor{comment}{// Otherwise the total number is the same on each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00285}00285     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00286}00286 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00287}00287     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00288}00288       Nelement = n\_non\_halo\_element\_local;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00289}00289     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00290}00290 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00291}00291     \textcolor{keywordflow}{return} Nelement;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00292}00292   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00293}00293 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00294}00294 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00295}00295 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00296}00296 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00297}00297   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00298}00298 \textcolor{comment}{  /// Setup the halo scheme for the degrees of freedom}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00299}00299 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00300}\mbox{\hyperlink{classoomph_1_1Problem_a216679e2a976e0205165bbe7ab558579}{00300}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a216679e2a976e0205165bbe7ab558579}{Problem::setup\_dof\_halo\_scheme}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00301}00301   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00302}00302     \textcolor{comment}{// Find the number of elements stored on this processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00303}00303     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_element = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00304}00304 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00305}00305     \textcolor{comment}{// Work out the all global equations to which this processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00306}00306     \textcolor{comment}{// contributes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00307}00307     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} my\_eqns;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00308}00308     this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae222ce1fa229441a733d350105dfd1f7}{get\_my\_eqns}}(this-\/>\mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}}, 0, n\_element -\/ 1, my\_eqns);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00309}00309 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00310}00310     \textcolor{comment}{// Build the halo scheme, based on the equations to which this}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00311}00311     \textcolor{comment}{// processor contributes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00312}00312     \mbox{\hyperlink{classoomph_1_1Problem_a1dcaa04975d69c616ab294cbfaf53d55}{Halo\_scheme\_pt}} =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00313}00313       \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1DoubleVectorHaloScheme}{DoubleVectorHaloScheme}}(this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}, my\_eqns);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00314}00314 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00315}00315     \textcolor{comment}{// Find pointers to all the halo dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00316}00316     \textcolor{comment}{// There may be more of these than required by my\_eqns}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00317}00317     \textcolor{comment}{//(but should not be less)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00318}00318     std::map<unsigned, double*> halo\_data\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00319}00319     this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ad5c302721bf6699ecf8c8760e49d47d8}{get\_all\_halo\_data}}(halo\_data\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00320}00320 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00321}00321     \textcolor{comment}{// Now setup the Halo\_dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00322}00322     \mbox{\hyperlink{classoomph_1_1Problem_a1dcaa04975d69c616ab294cbfaf53d55}{Halo\_scheme\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DoubleVectorHaloScheme_aa630dd65e7a97e5609426baffcb6eca9}{setup\_halo\_dofs}}(halo\_data\_pt, this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ac59d9163cc5d008a2ade4de8da06dbf6}{Halo\_dof\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00323}00323   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00324}00324 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00325}00325   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00326}00326 \textcolor{comment}{  /// Distribute the problem without doc; report stats if required.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00327}00327 \textcolor{comment}{  /// Returns actual partitioning used, e.g. for restart.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00328}00328 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00329}\mbox{\hyperlink{classoomph_1_1Problem_af0365ddbe425b730ece6a575db1cd7dd}{00329}}   \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} \mbox{\hyperlink{classoomph_1_1Problem_aa35e1adc0fdf14b217c7b608eb9cf20b}{Problem::distribute}}(\textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& report\_stats)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00330}00330   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00331}00331     \textcolor{comment}{// Set dummy doc paramemters}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00332}00332     \mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}} doc\_info;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00333}00333     doc\_info.\mbox{\hyperlink{classoomph_1_1DocInfo_a666a20817ab9c396b225d8652bc0a338}{disable\_doc}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00334}00334 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00335}00335     \textcolor{comment}{// Set the sizes of the input and output vectors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00336}00336     \textcolor{keywordtype}{unsigned} n\_element = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00337}00337     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} element\_partition(n\_element, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00338}00338 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00339}00339     \textcolor{comment}{// Distribute and return partitioning}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00340}00340     \textcolor{keywordflow}{return} \mbox{\hyperlink{classoomph_1_1Problem_aa35e1adc0fdf14b217c7b608eb9cf20b}{distribute}}(element\_partition, doc\_info, report\_stats);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00341}00341   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00342}00342 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00343}00343   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00344}00344 \textcolor{comment}{  /// Distribute the problem according to specified partition.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00345}00345 \textcolor{comment}{  /// If all entries in partitioning vector are zero we use METIS}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00346}00346 \textcolor{comment}{  /// to do the partitioning after all.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00347}00347 \textcolor{comment}{  /// Returns actual partitioning used, e.g. for restart.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00348}00348 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00349}\mbox{\hyperlink{classoomph_1_1Problem_aa35f7ff2b0075cfd4dda519858a65d6c}{00349}}   \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} \mbox{\hyperlink{classoomph_1_1Problem_aa35e1adc0fdf14b217c7b608eb9cf20b}{Problem::distribute}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00350}00350     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& element\_partition, \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& report\_stats)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00351}00351   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00352}00352 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00353}00353     \textcolor{keywordtype}{bool} has\_non\_zero\_entry = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00354}00354     \textcolor{keywordtype}{unsigned} n = element\_partition.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00355}00355     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00356}00356     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00357}00357       \textcolor{keywordflow}{if} (element\_partition[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00358}00358       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00359}00359         has\_non\_zero\_entry = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00360}00360         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00361}00361       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00362}00362     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00363}00363     \textcolor{keywordflow}{if} (!has\_non\_zero\_entry)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00364}00364     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00365}00365       std::ostringstream warn\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00366}00366       warn\_message << \textcolor{stringliteral}{"{}WARNING: All entries in specified partitioning vector \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00367}00367                    << \textcolor{stringliteral}{"{}         are zero -\/-\/ will ignore this and use METIS\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00368}00368                    << \textcolor{stringliteral}{"{}         to perform the partitioning\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00369}00369       \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00370}00370         warn\_message.str(), \textcolor{stringliteral}{"{}Problem::distribute()"{}}, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00371}00371     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00372}00372 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00373}00373     \textcolor{comment}{// Set dummy doc paramemters}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00374}00374     \mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}} doc\_info;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00375}00375     doc\_info.\mbox{\hyperlink{classoomph_1_1DocInfo_a666a20817ab9c396b225d8652bc0a338}{disable\_doc}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00376}00376 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00377}00377     \textcolor{comment}{// Distribute and return partitioning}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00378}00378     \textcolor{keywordflow}{return} \mbox{\hyperlink{classoomph_1_1Problem_aa35e1adc0fdf14b217c7b608eb9cf20b}{distribute}}(element\_partition, doc\_info, report\_stats);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00379}00379   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00380}00380 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00381}00381   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00382}00382 \textcolor{comment}{  /// Distribute the problem and doc to specified DocInfo.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00383}00383 \textcolor{comment}{  /// Returns actual partitioning used, e.g. for restart.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00384}00384 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00385}\mbox{\hyperlink{classoomph_1_1Problem_a9bab7c41bf5d6d053259ff10920d7303}{00385}}   \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} \mbox{\hyperlink{classoomph_1_1Problem_aa35e1adc0fdf14b217c7b608eb9cf20b}{Problem::distribute}}(\mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}}\& doc\_info,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00386}00386                                        \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& report\_stats)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00387}00387   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00388}00388     \textcolor{comment}{// Set the sizes of the input and output vectors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00389}00389     \textcolor{keywordtype}{unsigned} n\_element = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00390}00390 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00391}00391     \textcolor{comment}{// Dummy input vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00392}00392     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} element\_partition(n\_element, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00393}00393 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00394}00394     \textcolor{comment}{// Distribute and return partitioning}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00395}00395     \textcolor{keywordflow}{return} \mbox{\hyperlink{classoomph_1_1Problem_aa35e1adc0fdf14b217c7b608eb9cf20b}{distribute}}(element\_partition, doc\_info, report\_stats);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00396}00396   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00397}00397 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00398}00398   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00399}00399 \textcolor{comment}{  /// Distribute the problem according to specified partition.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00400}00400 \textcolor{comment}{  /// (If all entries in partitioning vector are zero we use METIS}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00401}00401 \textcolor{comment}{  /// to do the partitioning after all) and doc.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00402}00402 \textcolor{comment}{  /// Returns actual partitioning used, e.g. for restart.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00403}00403 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00404}\mbox{\hyperlink{classoomph_1_1Problem_aa35e1adc0fdf14b217c7b608eb9cf20b}{00404}}   \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} \mbox{\hyperlink{classoomph_1_1Problem_aa35e1adc0fdf14b217c7b608eb9cf20b}{Problem::distribute}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00405}00405     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& element\_partition,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00406}00406     \mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}}\& doc\_info,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00407}00407     \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& report\_stats)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00408}00408   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00409}00409     \textcolor{comment}{// Storage for number of processors and number of elements in global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00410}00410     \textcolor{keywordtype}{int} n\_proc = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00411}00411     \textcolor{keywordtype}{int} my\_rank = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00412}00412     \textcolor{keywordtype}{int} n\_element = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00413}00413 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00414}00414     \textcolor{comment}{// Vector to be returned}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00415}00415     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} return\_element\_domain;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00416}00416 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00417}00417     \textcolor{comment}{// Buffer extreme cases}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00418}00418     \textcolor{keywordflow}{if} (n\_proc == 1) \textcolor{comment}{// single-\/process job -\/ don't do anything}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00419}00419     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00420}00420       \textcolor{keywordflow}{if} (report\_stats)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00421}00421       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00422}00422         std::ostringstream warn\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00423}00423         warn\_message << \textcolor{stringliteral}{"{}WARNING: You've tried to distribute a problem over\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00424}00424                      << \textcolor{stringliteral}{"{}only one processor: this would make METIS crash.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00425}00425                      << \textcolor{stringliteral}{"{}Ignoring your request for distribution.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00426}00426         \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(warn\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00427}00427                         \textcolor{stringliteral}{"{}Problem::distribute()"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00428}00428                         OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00429}00429       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00430}00430     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00431}00431     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (n\_proc > n\_element) \textcolor{comment}{// more processors than elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00432}00432     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00433}00433       \textcolor{comment}{// Throw an error}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00434}00434       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00435}00435       error\_stream << \textcolor{stringliteral}{"{}You have tried to distribute a problem\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00436}00436                    << \textcolor{stringliteral}{"{}but there are less elements than processors.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00437}00437                    << \textcolor{stringliteral}{"{}Please re-\/run with more elements!\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00438}00438                    << \textcolor{stringliteral}{"{}Please also ensure that actions\_before\_distribute().\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00439}00439                    << \textcolor{stringliteral}{"{}and actions\_after\_distribute() are correctly set up.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00440}00440                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00441}00441       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00442}00442         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00443}00443     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00444}00444     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00445}00445     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00446}00446       \textcolor{comment}{// We only distribute uniformly-\/refined meshes; buffer the case where}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00447}00447       \textcolor{comment}{// either mesh is not uniformly refined}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00448}00448       \textcolor{keywordtype}{bool} a\_mesh\_is\_not\_uniformly\_refined = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00449}00449       \textcolor{keywordtype}{unsigned} n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00450}00450       \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00451}00451       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00452}00452         \textcolor{comment}{// Check refinement levels}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00453}00453         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00454}00454               \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00455}00455         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00456}00456           \textcolor{keywordtype}{unsigned} min\_ref\_level = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00457}00457           \textcolor{keywordtype}{unsigned} max\_ref\_level = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00458}00458           mmesh\_pt-\/>get\_refinement\_levels(min\_ref\_level, max\_ref\_level);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00459}00459           \textcolor{comment}{// If they are not the same}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00460}00460           \textcolor{keywordflow}{if} (max\_ref\_level != min\_ref\_level)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00461}00461           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00462}00462             a\_mesh\_is\_not\_uniformly\_refined = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00463}00463           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00464}00464         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00465}00465       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00466}00466       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00467}00467       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00468}00468         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00469}00469         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00470}00470           \textcolor{comment}{// Check refinement levels for each mesh individually}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00471}00471           \textcolor{comment}{// (one mesh is allowed to be "{}more uniformly refined"{} than another)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00472}00472           \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00473}00473                 \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00474}00474           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00475}00475             \textcolor{keywordtype}{unsigned} min\_ref\_level = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00476}00476             \textcolor{keywordtype}{unsigned} max\_ref\_level = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00477}00477             mmesh\_pt-\/>get\_refinement\_levels(min\_ref\_level, max\_ref\_level);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00478}00478             \textcolor{comment}{// If they are not the same}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00479}00479             \textcolor{keywordflow}{if} (max\_ref\_level != min\_ref\_level)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00480}00480             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00481}00481               a\_mesh\_is\_not\_uniformly\_refined = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00482}00482             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00483}00483           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00484}00484         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00485}00485       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00486}00486 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00487}00487       \textcolor{comment}{// If any mesh is not uniformly refined}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00488}00488       \textcolor{keywordflow}{if} (a\_mesh\_is\_not\_uniformly\_refined)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00489}00489       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00490}00490         \textcolor{comment}{// Again it may make more sense to throw an error here as the user}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00491}00491         \textcolor{comment}{// will probably not be running a problem that is small enough to}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00492}00492         \textcolor{comment}{// fit the whole of on each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00493}00493         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00494}00494         error\_stream << \textcolor{stringliteral}{"{}You have tried to distribute a problem\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00495}00495                      << \textcolor{stringliteral}{"{}but at least one of your meshes is no longer\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00496}00496                      << \textcolor{stringliteral}{"{}uniformly refined.  In order to preserve the Tree\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00497}00497                      << \textcolor{stringliteral}{"{}and TreeForest structure, Problem::distribute() can\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00498}00498                      << \textcolor{stringliteral}{"{}only be called while meshes are uniformly refined.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00499}00499                      << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00500}00500         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00501}00501           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00502}00502       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00503}00503       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00504}00504       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00505}00505         \textcolor{comment}{// Is there any global data?  If so, distributing the problem won't work}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00506}00506         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a60a9b6861928cf9115110b5bfc7d11a7}{nglobal\_data}}() > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00507}00507         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00508}00508           std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00509}00509           error\_stream << \textcolor{stringliteral}{"{}You have tried to distribute a problem\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00510}00510                        << \textcolor{stringliteral}{"{}and there is some global data.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00511}00511                        << \textcolor{stringliteral}{"{}This is not likely to work...\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00512}00512                        << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00513}00513           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00514}00514                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00515}00515                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00516}00516         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00517}00517 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00518}00518         \textcolor{keywordtype}{double} t\_start = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00519}00519         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a524b68efcaae084ad7144f944cb39c69}{Doc\_time\_in\_distribute}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00520}00520         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00521}00521           t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00522}00522         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00523}00523 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00524}00524 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00525}00525 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00526}00526         \textcolor{keywordtype}{unsigned} old\_ndof = \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00527}00527 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00528}00528 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00529}00529         \textcolor{comment}{// Need to partition the global mesh before distributing}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00530}00530         \mbox{\hyperlink{classoomph_1_1Mesh}{Mesh}}* global\_mesh\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00531}00531 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00532}00532         \textcolor{comment}{// Vector listing the affiliation of each element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00533}00533         \textcolor{keywordtype}{unsigned} nelem = global\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00534}00534         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} element\_domain(nelem);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00535}00535 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00536}00536         \textcolor{comment}{// Number of elements that I'm in charge of, based on any}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00537}00537         \textcolor{comment}{// incoming partitioning}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00538}00538         \textcolor{keywordtype}{unsigned} n\_my\_elements = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00539}00539 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00540}00540         \textcolor{comment}{// Have we used the pre-\/set partitioning}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00541}00541         \textcolor{keywordtype}{bool} used\_preset\_partitioning = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00542}00542 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00543}00543         \textcolor{comment}{// Partition the mesh, unless the partition has already been passed in}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00544}00544         \textcolor{comment}{// If it hasn't then the sum of all the entries of the vector should be}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00545}00545         \textcolor{comment}{// 0}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00546}00546         \textcolor{keywordtype}{unsigned} sum\_element\_partition = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00547}00547         \textcolor{keywordtype}{unsigned} n\_part = element\_partition.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00548}00548         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_part; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00549}00549         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00550}00550           \textcolor{comment}{// ... another one for me.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00551}00551           \textcolor{keywordflow}{if} (\textcolor{keywordtype}{int}(element\_partition[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]) == my\_rank) n\_my\_elements++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00552}00552 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00553}00553           sum\_element\_partition += element\_partition[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00554}00554         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00555}00555         \textcolor{keywordflow}{if} (sum\_element\_partition == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00556}00556         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00557}00557           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}INFO: using METIS to partition elements"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00558}00558           \mbox{\hyperlink{classoomph_1_1Problem_ad29fc4bc4d4bead472059765fbbd3b11}{partition\_global\_mesh}}(global\_mesh\_pt, doc\_info, element\_domain);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00559}00559           used\_preset\_partitioning = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00560}00560         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00561}00561         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00562}00562         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00563}00563           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}INFO: using pre-\/set partition of elements"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00564}00564                      << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00565}00565           used\_preset\_partitioning = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00566}00566           element\_domain = element\_partition;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00567}00567         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00568}00568 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00569}00569         \textcolor{comment}{// Set the GLOBAL Mesh as being distributed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00570}00570         global\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_aa5684cde011ba20382e719e63a1329eb}{set\_communicator\_pt}}(this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00571}00571 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00572}00572         \textcolor{keywordtype}{double} t\_end = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00573}00573         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a524b68efcaae084ad7144f944cb39c69}{Doc\_time\_in\_distribute}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00574}00574         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00575}00575           t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00576}00576           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for partitioning of global mesh: "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00577}00577                      << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00578}00578           t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00579}00579         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00580}00580 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00581}00581         \textcolor{comment}{// Store how many elements we had in the various sub-\/meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00582}00582         \textcolor{comment}{// before actions\_before\_distribute() (which may empty some of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00583}00583         \textcolor{comment}{// them).}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00584}00584         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} n\_element\_in\_old\_submesh(n\_mesh);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00585}00585         \textcolor{keywordflow}{if} (n\_mesh != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00586}00586         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00587}00587           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00588}00588           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00589}00589             \textcolor{keywordtype}{unsigned} nsub\_elem = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00590}00590             n\_element\_in\_old\_submesh[i\_mesh] = nsub\_elem;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00591}00591           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00592}00592         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00593}00593 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00594}00594         \textcolor{comment}{// Partitioning complete; call actions before distribute}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00595}00595         \mbox{\hyperlink{classoomph_1_1Problem_a1d1280f442f9352a614bada21324456d}{actions\_before\_distribute}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00596}00596 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00597}00597         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a524b68efcaae084ad7144f944cb39c69}{Doc\_time\_in\_distribute}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00598}00598         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00599}00599           t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00600}00600           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for actions before distribute: "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00601}00601                      << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00602}00602         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00603}00603 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00604}00604         \textcolor{comment}{// This next bit is cheap -\/-\/ omit timing}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00605}00605         \textcolor{comment}{// t\_start = TimingHelpers::timer();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00606}00606 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00607}00607         \textcolor{comment}{// Number of submeshes (NB: some may have been deleted in}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00608}00608         \textcolor{comment}{//                          actions\_after\_distribute())}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00609}00609         n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00610}00610 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00611}00611 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00612}00612         \textcolor{comment}{// Prepare vector of vectors for submesh element domains}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00613}00613         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<unsigned>}}> submesh\_element\_domain(n\_mesh);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00614}00614 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00615}00615         \textcolor{comment}{// The submeshes need to know their own element domains.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00616}00616         \textcolor{comment}{// Also if any meshes have been emptied we ignore their}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00617}00617         \textcolor{comment}{// partitioning in the vector that we return from here}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00618}00618         return\_element\_domain.reserve(element\_domain.size());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00619}00619         \textcolor{keywordflow}{if} (n\_mesh != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00620}00620         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00621}00621           \textcolor{keywordtype}{unsigned} count = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00622}00622           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00623}00623           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00624}00624             \textcolor{keywordtype}{unsigned} nsub\_elem = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00625}00625             submesh\_element\_domain[i\_mesh].resize(nsub\_elem);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00626}00626             \textcolor{keywordtype}{unsigned} nsub\_elem\_old = n\_element\_in\_old\_submesh[i\_mesh];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00627}00627             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nsub\_elem\_old; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00628}00628             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00629}00629               \textcolor{keywordflow}{if} (nsub\_elem\_old == nsub\_elem)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00630}00630               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00631}00631                 submesh\_element\_domain[i\_mesh][\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = element\_domain[count];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00632}00632                 return\_element\_domain.push\_back(element\_domain[count]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00633}00633               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00634}00634               \textcolor{comment}{// return\_element\_domain.push\_back(element\_domain[count]);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00635}00635               count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00636}00636             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00637}00637           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00638}00638         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00639}00639         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00640}00640         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00641}00641           return\_element\_domain = element\_domain;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00642}00642         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00643}00643 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00644}00644         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a524b68efcaae084ad7144f944cb39c69}{Doc\_time\_in\_distribute}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00645}00645         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00646}00646           t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00647}00647         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00648}00648 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00649}00649         \textcolor{comment}{// Setup the map between "{}root"{} element and number in global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00650}00650         \textcolor{comment}{// (currently used in the load\_balance() routines)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00651}00651 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00652}00652         \textcolor{comment}{// This map is only established for structured meshes, then we}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00653}00653         \textcolor{comment}{// need to check here the type of mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00654}00654         \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00655}00655         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00656}00656           \textcolor{comment}{// Check if the only one mesh is an structured mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00657}00657           \textcolor{keywordtype}{bool} structured\_mesh = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00658}00658           \mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}* tri\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00659}00659             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00660}00660           \textcolor{keywordflow}{if} (tri\_mesh\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00661}00661           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00662}00662             structured\_mesh = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00663}00663           \} \textcolor{comment}{// if (tri\_mesh\_pt != 0)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00664}00664           \textcolor{keywordflow}{if} (structured\_mesh)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00665}00665           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00666}00666             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_ele = global\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00667}00667             \mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}.resize(n\_ele);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00668}00668             \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}.clear();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00669}00669             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_ele; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00670}00670             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00671}00671               \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* el\_pt = global\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00672}00672               \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}[el\_pt] = \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00673}00673               \mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = el\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00674}00674             \} \textcolor{comment}{// for (e<n\_ele)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00675}00675           \} \textcolor{comment}{// A TreeBaseMesh mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00676}00676         \} \textcolor{comment}{// if (n\_mesh==0)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00677}00677         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00678}00678         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00679}00679           \textcolor{comment}{// If we have submeshes then we only add those elements that}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00680}00680           \textcolor{comment}{// belong to structured meshes, but first compute the number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00681}00681           \textcolor{comment}{// of total elements in the structured meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00682}00682           \textcolor{keywordtype}{unsigned} nglobal\_element = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00683}00683           \textcolor{comment}{// Store which submeshes are structured}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00684}00684           std::vector<bool> is\_structured\_mesh(n\_mesh);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00685}00685           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00686}00686           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00687}00687             \mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}* tri\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00688}00688               \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00689}00689             \textcolor{keywordflow}{if} (tri\_mesh\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00690}00690             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00691}00691               \textcolor{comment}{// Set the flags to indicate this is not an structured}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00692}00692               \textcolor{comment}{// mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00693}00693               is\_structured\_mesh[i\_mesh] = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00694}00694             \} \textcolor{comment}{// if (tri\_mesh\_pt != 0)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00695}00695             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00696}00696             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00697}00697               \textcolor{comment}{// Set the flags to indicate this is an structured}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00698}00698               \textcolor{comment}{// mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00699}00699               is\_structured\_mesh[i\_mesh] = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00700}00700             \} \textcolor{comment}{// else if (tri\_mesh\_pt != 0)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00701}00701             \textcolor{comment}{// Check if mesh is an structured mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00702}00702             \textcolor{keywordflow}{if} (is\_structured\_mesh[i\_mesh])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00703}00703             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00704}00704               nglobal\_element += \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00705}00705             \} \textcolor{comment}{// A TreeBaseMesh mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00706}00706           \} \textcolor{comment}{// for (i\_mesh<n\_mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00707}00707 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00708}00708           \textcolor{comment}{// Once computed the number of elements, then resize the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00709}00709           \textcolor{comment}{// structure}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00710}00710           \mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}.resize(nglobal\_element);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00711}00711           \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}.clear();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00712}00712           \textcolor{keywordtype}{unsigned} counter = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00713}00713           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00714}00714           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00715}00715             \textcolor{comment}{// Check if mesh is an structured mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00716}00716             \textcolor{keywordflow}{if} (is\_structured\_mesh[i\_mesh])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00717}00717             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00718}00718               \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_ele = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00719}00719               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_ele; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00720}00720               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00721}00721                 \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* el\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00722}00722                 \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}[el\_pt] = counter + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00723}00723                 \mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}[counter] = el\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00724}00724                 \textcolor{comment}{// Inrease the global element number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00725}00725                 counter++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00726}00726               \} \textcolor{comment}{// for (e<n\_ele)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00727}00727             \} \textcolor{comment}{// An structured mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00728}00728           \} \textcolor{comment}{// for (i\_mesh<n\_mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00729}00729 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00730}00730 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00731}00731           \textcolor{keywordflow}{if} (counter != nglobal\_element)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00732}00732           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00733}00733             std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00734}00734             error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00735}00735               << \textcolor{stringliteral}{"{}The number of global elements ("{}} << nglobal\_element}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00736}00736               << \textcolor{stringliteral}{"{}) is not the sameas the number of\(\backslash\)nadded elements ("{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00737}00737               << counter << \textcolor{stringliteral}{"{}) to the Base\_mesh\_element\_pt data "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00738}00738               << \textcolor{stringliteral}{"{}structure!!!\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00739}00739             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00740}00740                                 \textcolor{stringliteral}{"{}Problem::distribute()"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00741}00741                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00742}00742           \} \textcolor{comment}{// if (counter != nglobal\_element)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00743}00743 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// \#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00744}00744 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00745}00745         \} \textcolor{comment}{// else if (n\_mesh==0)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00746}00746 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00747}00747         \textcolor{comment}{// Wipe everything if a pre-\/determined partitioning}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00748}00748         \textcolor{comment}{// didn't specify ANY elements for this processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00749}00749         \textcolor{comment}{// (typically happens during restarts with larger number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00750}00750         \textcolor{comment}{// of processors -\/-\/ in this case we really want an empty}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00751}00751         \textcolor{comment}{// processor rather than one with any "{}kept"{} halo elements)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00752}00752         \textcolor{keywordtype}{bool} overrule\_keep\_as\_halo\_element\_status = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00753}00753         \textcolor{keywordflow}{if} ((n\_my\_elements == 0) \&\& (used\_preset\_partitioning))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00754}00754         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00755}00755           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}INFO: We're over-\/ruling the \(\backslash\)"{}keep as halo element\(\backslash\)"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00756}00756                      << \textcolor{stringliteral}{"{}      status because the preset partitioning\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00757}00757                      << \textcolor{stringliteral}{"{}      didn't place ANY elements on this processor,\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00758}00758                      << \textcolor{stringliteral}{"{}      probably because of a restart on a larger \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00759}00759                      << \textcolor{stringliteral}{"{}      number of processors\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00760}00760           overrule\_keep\_as\_halo\_element\_status = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00761}00761         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00762}00762 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00763}00763 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00764}00764         \textcolor{comment}{// Distribute the (sub)meshes (i.e. sort out their halo lookup schemes)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00765}00765         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<GeneralisedElement*>}} deleted\_element\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00766}00766         \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00767}00767         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00768}00768           global\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_adeef6d5b1de197aab956025b4b038778}{distribute}}(this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00769}00769                                      element\_domain,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00770}00770                                      deleted\_element\_pt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00771}00771                                      doc\_info,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00772}00772                                      report\_stats,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00773}00773                                      overrule\_keep\_as\_halo\_element\_status);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00774}00774         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00775}00775         \textcolor{keywordflow}{else} \textcolor{comment}{// There are submeshes, "{}distribute"{} each one separately}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00776}00776         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00777}00777           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00778}00778           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00779}00779             \textcolor{keywordflow}{if} (report\_stats)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00780}00780             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00781}00781               \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Distributing submesh "{}} << i\_mesh << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00782}00782                          << \textcolor{stringliteral}{"{}-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00783}00783             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00784}00784             \textcolor{comment}{// Set the doc\_info number to reflect the submesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00785}00785             doc\_info.\mbox{\hyperlink{classoomph_1_1DocInfo_a9d9ce638a7834bbd4961779af426bf13}{number}}() = i\_mesh;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00786}00786             \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_adeef6d5b1de197aab956025b4b038778}{distribute}}(this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00787}00787                                         submesh\_element\_domain[i\_mesh],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00788}00788                                         deleted\_element\_pt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00789}00789                                         doc\_info,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00790}00790                                         report\_stats,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00791}00791                                         overrule\_keep\_as\_halo\_element\_status);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00792}00792           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00793}00793           \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00794}00794           \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00795}00795         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00796}00796 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00797}00797         \textcolor{comment}{// Null out information associated with deleted elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00798}00798         \textcolor{keywordtype}{unsigned} n\_del = deleted\_element\_pt.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00799}00799         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_del; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00800}00800         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00801}00801           \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* el\_pt = deleted\_element\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00802}00802           \textcolor{keywordtype}{unsigned} old\_el\_number = \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}[el\_pt] -\/ 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00803}00803           \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}[el\_pt] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00804}00804           \mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}[old\_el\_number] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00805}00805         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00806}00806 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00807}00807         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a524b68efcaae084ad7144f944cb39c69}{Doc\_time\_in\_distribute}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00808}00808         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00809}00809           t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00810}00810           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for mesh-\/level distribution: "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00811}00811                      << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00812}00812           t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00813}00813         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00814}00814 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00815}00815         \textcolor{comment}{// Now the problem has been distributed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00816}00816         \mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00817}00817 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00818}00818         \textcolor{comment}{// Call actions after distribute}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00819}00819         \mbox{\hyperlink{classoomph_1_1Problem_a4d3e3bd312518ca5afef94e169f81c39}{actions\_after\_distribute}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00820}00820 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00821}00821         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a524b68efcaae084ad7144f944cb39c69}{Doc\_time\_in\_distribute}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00822}00822         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00823}00823           t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00824}00824           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for actions after distribute: "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00825}00825                      << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00826}00826           t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00827}00827         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00828}00828 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00829}00829         \textcolor{comment}{// Re-\/assign the equation numbers (incl synchronisation if reqd)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00830}00830         \textcolor{keywordtype}{unsigned} n\_dof = \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00831}00831         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of equations: "{}} << n\_dof << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00832}00832 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00833}00833         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a524b68efcaae084ad7144f944cb39c69}{Doc\_time\_in\_distribute}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00834}00834         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00835}00835           t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00836}00836           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for re-\/assigning eqn numbers (in distribute): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00837}00837                      << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00838}00838         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00839}00839 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00840}00840 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00841}00841 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00842}00842         \textcolor{keywordflow}{if} (n\_dof != old\_ndof)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00843}00843         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00844}00844           std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00845}00845           error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00846}00846             << \textcolor{stringliteral}{"{}Number of dofs in distribute() has changed "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00847}00847             << \textcolor{stringliteral}{"{}from "{}} << old\_ndof << \textcolor{stringliteral}{"{} to "{}} << n\_dof << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00848}00848             << \textcolor{stringliteral}{"{}Check that you've implemented any necessary "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00849}00849                \textcolor{stringliteral}{"{}actions\_before/after\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00850}00850             << \textcolor{stringliteral}{"{}distribute functions, e.g. to pin redundant pressure dofs"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00851}00851             << \textcolor{stringliteral}{"{} etc.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00852}00852           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00853}00853                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00854}00854                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00855}00855         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00856}00856 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00857}00857 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00858}00858       \} \textcolor{comment}{// end if to check for uniformly refined mesh(es)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00859}00859 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00860}00860     \} \textcolor{comment}{// end if to check number of processors vs. number of elements etc.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00861}00861 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00862}00862 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00863}00863     \textcolor{comment}{// Force re-\/analysis of time spent on assembly each}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00864}00864     \textcolor{comment}{// elemental Jacobian}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00865}00865     \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00866}00866     \mbox{\hyperlink{classoomph_1_1Problem_a2b2bcde2b051f47278ccf8446699bbfb}{Elemental\_assembly\_time}}.clear();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00867}00867 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00868}00868     \textcolor{comment}{// Return the partition vector used in the distribution}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00869}00869     \textcolor{keywordflow}{return} return\_element\_domain;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00870}00870   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00871}00871 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00872}00872   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00873}00873 \textcolor{comment}{  /// Partition the global mesh, return vector specifying the processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00874}00874 \textcolor{comment}{  /// number for each element. Virtual so that it can be overloaded by}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00875}00875 \textcolor{comment}{  /// any user; the default is to use METIS to perform the partitioning}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00876}00876 \textcolor{comment}{  /// (with a bit of cleaning up afterwards to sort out "{}special cases"{}).}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00877}00877 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00878}\mbox{\hyperlink{classoomph_1_1Problem_ad29fc4bc4d4bead472059765fbbd3b11}{00878}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ad29fc4bc4d4bead472059765fbbd3b11}{Problem::partition\_global\_mesh}}(\mbox{\hyperlink{classoomph_1_1Mesh}{Mesh}}*\& global\_mesh\_pt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00879}00879                                       \mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}}\& doc\_info,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00880}00880                                       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& element\_domain,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00881}00881                                       \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& report\_stats)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00882}00882   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00883}00883     \textcolor{comment}{// Storage for number of processors and current processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00884}00884     \textcolor{keywordtype}{int} n\_proc = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00885}00885     \textcolor{keywordtype}{int} rank = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00886}00886 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00887}00887     std::ostringstream filename;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00888}00888     std::ofstream some\_file;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00889}00889 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00890}00890     \textcolor{comment}{// Doc the original mesh on proc 0}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00891}00891     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00892}00892     \textcolor{keywordflow}{if} (doc\_info.\mbox{\hyperlink{classoomph_1_1DocInfo_a2ce90cf54f24b4ab523c624031fbb76b}{is\_doc\_enabled}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00893}00893     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00894}00894       \textcolor{keywordflow}{if} (rank == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00895}00895       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00896}00896         filename << doc\_info.\mbox{\hyperlink{classoomph_1_1DocInfo_a85d58bcfce0a7b7cae461624e6fcd08a}{directory}}() << \textcolor{stringliteral}{"{}/complete\_mesh"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00897}00897                  << doc\_info.\mbox{\hyperlink{classoomph_1_1DocInfo_a9d9ce638a7834bbd4961779af426bf13}{number}}() << \textcolor{stringliteral}{"{}.dat"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00898}00898         global\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_aab74388e8e21325f3ca26f1bd99c26f7}{output}}(filename.str().c\_str(), 5);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00899}00899       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00900}00900     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00901}00901 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00902}00902     \textcolor{comment}{// Partition the mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00903}00903     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00904}00904     \textcolor{comment}{// METIS Objective (0: minimise edge cut; 1: minimise total comm volume)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00905}00905     \textcolor{keywordtype}{unsigned} objective = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00906}00906 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00907}00907     \textcolor{comment}{// Do the partitioning}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00908}00908     \textcolor{keywordtype}{unsigned} nelem = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00909}00909     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>my\_rank() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00910}00910     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00911}00911       \mbox{\hyperlink{namespaceoomph_1_1METIS_aa3c7e4be46d6148cc60f43354127fc94}{METIS::partition\_mesh}}(\textcolor{keyword}{this}, n\_proc, objective, element\_domain);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00912}00912       nelem = element\_domain.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00913}00913     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00914}00914     MPI\_Bcast(\&nelem, 1, MPI\_UNSIGNED, 0, this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00915}00915     element\_domain.resize(nelem);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00916}00916     MPI\_Bcast(\&element\_domain[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00917}00917               nelem,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00918}00918               MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00919}00919               0,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00920}00920               this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00921}00921 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00922}00922     \textcolor{comment}{// On very coarse meshes with larger numbers of processors, METIS}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00923}00923     \textcolor{comment}{// occasionally returns an element\_domain Vector for which a particular}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00924}00924     \textcolor{comment}{// processor has no elements affiliated to it; the following fixes this}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00925}00925 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00926}00926     \textcolor{comment}{// Convert element\_domain to integer storage}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00927}00927     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} int\_element\_domain(nelem);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00928}00928     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nelem; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00929}00929     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00930}00930       int\_element\_domain[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = element\_domain[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00931}00931     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00932}00932 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00933}00933     \textcolor{comment}{// Global storage for number of elements on each process}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00934}00934     \textcolor{keywordtype}{int} my\_number\_of\_elements = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00935}00935     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} number\_of\_elements(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00936}00936 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00937}00937     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nelem; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00938}00938     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00939}00939       \textcolor{keywordflow}{if} (int\_element\_domain[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] == rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00940}00940       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00941}00941         my\_number\_of\_elements++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00942}00942       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00943}00943     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00944}00944 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00945}00945     \textcolor{comment}{// Communicate the correct value for each single process into}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00946}00946     \textcolor{comment}{// the global storage vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00947}00947     MPI\_Allgather(\&my\_number\_of\_elements,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00948}00948                   1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00949}00949                   MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00950}00950                   \&number\_of\_elements[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00951}00951                   1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00952}00952                   MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00953}00953                   this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00954}00954 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00955}00955     \textcolor{comment}{// If a process has no elements then switch an element with the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00956}00956     \textcolor{comment}{// process with the largest number of elements, assuming}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00957}00957     \textcolor{comment}{// that it still has enough elements left to share}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00958}00958     \textcolor{keywordtype}{int} max\_number\_of\_elements = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00959}00959     \textcolor{keywordtype}{int} process\_with\_max\_elements = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00960}00960     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} d = 0; d < n\_proc; d++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00961}00961     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00962}00962       \textcolor{keywordflow}{if} (number\_of\_elements[d] == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00963}00963       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00964}00964         \textcolor{comment}{// Find the process with maximum number of elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00965}00965         \textcolor{keywordflow}{if} (max\_number\_of\_elements <= 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00966}00966         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00967}00967           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} dd = 0; dd < n\_proc; dd++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00968}00968           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00969}00969             \textcolor{keywordflow}{if} (number\_of\_elements[dd] > max\_number\_of\_elements)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00970}00970             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00971}00971               max\_number\_of\_elements = number\_of\_elements[dd];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00972}00972               process\_with\_max\_elements = dd;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00973}00973             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00974}00974           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00975}00975         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00976}00976 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00977}00977         \textcolor{comment}{// Check that this number of elements is okay for sharing}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00978}00978         \textcolor{keywordflow}{if} (max\_number\_of\_elements <= 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00979}00979         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00980}00980           \textcolor{comment}{// Throw an error if elements can't be shared}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00981}00981           std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00982}00982           error\_stream << \textcolor{stringliteral}{"{}No process has more than 1 element, and\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00983}00983                        << \textcolor{stringliteral}{"{}at least one process has no elements!\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00984}00984                        << \textcolor{stringliteral}{"{}Suggest rerunning with more refinement.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00985}00985                        << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00986}00986           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00987}00987                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00988}00988                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00989}00989         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00990}00990 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00991}00991         \textcolor{comment}{// Loop over the element domain vector and switch}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00992}00992         \textcolor{comment}{// one value for process "{}process\_with\_max\_elements"{} with d}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00993}00993         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nelem; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00994}00994         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00995}00995           \textcolor{keywordflow}{if} (int\_element\_domain[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] == process\_with\_max\_elements)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00996}00996           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00997}00997             int\_element\_domain[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = d;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00998}00998             \textcolor{comment}{// Change the numbers associated with these processes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l00999}00999             number\_of\_elements[d]++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01000}01000             number\_of\_elements[process\_with\_max\_elements]-\/-\/;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01001}01001             \textcolor{comment}{// Reduce the number of elements available on "{}max"{} process}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01002}01002             max\_number\_of\_elements-\/-\/;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01003}01003             \textcolor{comment}{// Inform the user that a switch has taken place}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01004}01004             \textcolor{keywordflow}{if} (report\_stats)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01005}01005             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01006}01006               \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}INFO: Switched element domain at position "{}} << \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01007}01007                          << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01008}01008                          << \textcolor{stringliteral}{"{}from process "{}} << process\_with\_max\_elements}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01009}01009                          << \textcolor{stringliteral}{"{} to process "{}} << d << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01010}01010                          << \textcolor{stringliteral}{"{}which was given no elements by METIS partition"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01011}01011                          << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01012}01012             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01013}01013             \textcolor{comment}{// Only need to do this once for this element loop, otherwise}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01014}01014             \textcolor{comment}{// this will take all the elements from "{}max"{} process and put them}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01015}01015             \textcolor{comment}{// in process d, thus leaving essentially the same problem!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01016}01016             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01017}01017           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01018}01018         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01019}01019       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01020}01020     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01021}01021 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01022}01022     \textcolor{comment}{// Reassign new values to the element\_domain vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01023}01023     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nelem; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01024}01024     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01025}01025       element\_domain[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = int\_element\_domain[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01026}01026     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01027}01027 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01028}01028     \textcolor{keywordtype}{unsigned} count\_elements = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01029}01029     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nelem; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01030}01030     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01031}01031       \textcolor{keywordflow}{if} (\textcolor{keywordtype}{int}(element\_domain[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]) == rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01032}01032       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01033}01033         count\_elements++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01034}01034       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01035}01035     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01036}01036 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01037}01037     \textcolor{keywordflow}{if} (report\_stats)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01038}01038     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01039}01039       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}I have "{}} << count\_elements}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01040}01040                  << \textcolor{stringliteral}{"{} elements from this partition"{}} << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01041}01041                  << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01042}01042     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01043}01043   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01044}01044 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01045}01045   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01046}01046 \textcolor{comment}{  /// (Irreversibly) prune halo(ed) elements and nodes, usually}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01047}01047 \textcolor{comment}{  /// after another round of refinement, to get rid of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01048}01048 \textcolor{comment}{  /// excessively wide halo layers. Note that the current}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01049}01049 \textcolor{comment}{  /// mesh will be now regarded as the base mesh and no unrefinement}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01050}01050 \textcolor{comment}{  /// relative to it will be possible once this function}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01051}01051 \textcolor{comment}{  /// has been called.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01052}01052 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01053}\mbox{\hyperlink{classoomph_1_1Problem_a8c5982a9323392e31a166e23a0c7f0a3}{01053}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a8c5982a9323392e31a166e23a0c7f0a3}{Problem::prune\_halo\_elements\_and\_nodes}}(\mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}}\& doc\_info,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01054}01054                                               \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& report\_stats)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01055}01055   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01056}01056     \textcolor{comment}{// Storage for number of processors and current processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01057}01057     \textcolor{keywordtype}{int} n\_proc = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01058}01058 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01059}01059     \textcolor{comment}{// Has the problem been distributed yet?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01060}01060     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01061}01061     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01062}01062       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01063}01063         << \textcolor{stringliteral}{"{}WARNING: Problem::prune\_halo\_elements\_and\_nodes() was called on a "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01064}01064         << \textcolor{stringliteral}{"{}non-\/distributed Problem!"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01065}01065       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Ignoring your request..."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01066}01066     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01067}01067     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01068}01068     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01069}01069       \textcolor{comment}{// There are no halo layers to prune if it's a single-\/process job}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01070}01070       \textcolor{keywordflow}{if} (n\_proc == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01071}01071       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01072}01072         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01073}01073           << \textcolor{stringliteral}{"{}WARNING: You've tried to prune halo layers on a problem\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01074}01074           << \textcolor{stringliteral}{"{}with only one processor: this is unnecessary.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01075}01075           << \textcolor{stringliteral}{"{}Ignoring your request."{}} << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01076}01076           << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01077}01077       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01078}01078       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01079}01079       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01080}01080 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01081}01081         \textcolor{keywordtype}{unsigned} old\_ndof = \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01082}01082 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01083}01083 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01084}01084         \textcolor{keywordtype}{double} t\_start = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01085}01085         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01086}01086         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01087}01087           t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01088}01088         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01089}01089 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01090}01090         \textcolor{comment}{// Call actions before distribute}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01091}01091         \mbox{\hyperlink{classoomph_1_1Problem_a1d1280f442f9352a614bada21324456d}{actions\_before\_distribute}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01092}01092 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01093}01093         \textcolor{keywordtype}{double} t\_end = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01094}01094         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01095}01095         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01096}01096           t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01097}01097           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for actions\_before\_distribute() in "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01098}01098                      << \textcolor{stringliteral}{"{}Problem::prune\_halo\_elements\_and\_nodes(): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01099}01099                      << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01100}01100           t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01101}01101         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01102}01102 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01103}01103         \textcolor{comment}{// Associate all elements with root in current Base mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01104}01104         \textcolor{keywordtype}{unsigned} nel = \mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01105}01105         std::map<GeneralisedElement*, unsigned>}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01106}01106           old\_base\_element\_number\_plus\_one;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01107}01107         std::vector<bool> old\_root\_is\_halo\_or\_non\_existent(nel, \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01108}01108         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nel; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01109}01109         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01110}01110           \textcolor{comment}{// Get the base element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01111}01111           \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* base\_el\_pt = \mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01112}01112 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01113}01113           \textcolor{comment}{// Does it exist locally?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01114}01114           \textcolor{keywordflow}{if} (base\_el\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01115}01115           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01116}01116             \textcolor{comment}{// Check if it's a halo element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01117}01117             \textcolor{keywordflow}{if} (!base\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a0d9869eaf7d6e104c1e465b0d3cd6a9b}{is\_halo}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01118}01118             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01119}01119               old\_root\_is\_halo\_or\_non\_existent[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01120}01120             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01121}01121 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01122}01122             \textcolor{comment}{// Not refineable: It's only the element iself}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01123}01123             \mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}* ref\_el\_pt = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01124}01124             ref\_el\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(base\_el\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01125}01125             \textcolor{keywordflow}{if} (ref\_el\_pt == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01126}01126             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01127}01127               old\_base\_element\_number\_plus\_one[base\_el\_pt] = \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01128}01128             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01129}01129             \textcolor{comment}{// Refineable: Get entire tree of elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01130}01130             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01131}01131             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01132}01132               \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Tree*>}} tree\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01133}01133               ref\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_a4b783f4e5b6aeed83d49e478510d614f}{tree\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Tree_a2c84b4e4700a825ef0a6ca533b9ae895}{stick\_all\_tree\_nodes\_into\_vector}}(tree\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01134}01134               \textcolor{keywordtype}{unsigned} ntree = tree\_pt.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01135}01135               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}} = 0; \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}} < ntree; \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01136}01136               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01137}01137                 old\_base\_element\_number\_plus\_one[tree\_pt[\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}]-\/>object\_pt()] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01138}01138                   \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01139}01139               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01140}01140             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01141}01141           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01142}01142         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01143}01143 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01144}01144 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01145}01145         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01146}01146         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01147}01147           t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01148}01148           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for setup old root elements in "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01149}01149                      << \textcolor{stringliteral}{"{}Problem::prune\_halo\_elements\_and\_nodes(): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01150}01150                      << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01151}01151           t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01152}01152         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01153}01153 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01154}01154 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01155}01155         \textcolor{comment}{// Now remember the old number of base elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01156}01156         \textcolor{keywordtype}{unsigned} nel\_base\_old = nel;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01157}01157 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01158}01158 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01159}01159         \textcolor{comment}{// Prune the halo elements and nodes of the mesh(es)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01160}01160         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<GeneralisedElement*>}} deleted\_element\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01161}01161         \textcolor{keywordtype}{unsigned} n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01162}01162         \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01163}01163         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01164}01164           \textcolor{comment}{// Prune halo elements and nodes for the (single) global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01165}01165           \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a80f2372d3d0847d26030df88204acebe}{prune\_halo\_elements\_and\_nodes}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01166}01166             deleted\_element\_pt, doc\_info, report\_stats);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01167}01167         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01168}01168         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01169}01169         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01170}01170           \textcolor{comment}{// Loop over individual submeshes and prune separately}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01171}01171           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01172}01172           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01173}01173             \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a80f2372d3d0847d26030df88204acebe}{prune\_halo\_elements\_and\_nodes}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01174}01174               deleted\_element\_pt, doc\_info, report\_stats);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01175}01175           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01176}01176 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01177}01177           \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01178}01178           \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01179}01179         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01180}01180 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01181}01181         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01182}01182         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01183}01183           t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01184}01184           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Total time for all mesh-\/level prunes in "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01185}01185                      << \textcolor{stringliteral}{"{}Problem::prune\_halo\_elements\_and\_nodes(): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01186}01186                      << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01187}01187           t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01188}01188         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01189}01189 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01190}01190         \textcolor{comment}{// Loop over all elements in newly rebuilt mesh (which contains}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01191}01191         \textcolor{comment}{// all element in "{}tree order"{}), find the roots}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01192}01192         \textcolor{comment}{// (which are either non-\/refineable elements or refineable elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01193}01193         \textcolor{comment}{// whose tree representations are TreeRoots)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01194}01194         std::map<FiniteElement*, bool> root\_el\_done;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01195}01195 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01196}01196         \textcolor{comment}{// Vector storing vectors of pointers to new base elements associated}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01197}01197         \textcolor{comment}{// with the same old base element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01198}01198         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<GeneralisedElement*>}}>}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01199}01199           new\_base\_element\_associated\_with\_old\_base\_element(nel\_base\_old);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01200}01200 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01201}01201         \textcolor{keywordtype}{unsigned} n\_meshes = n\_mesh;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01202}01202         \textcolor{comment}{// Change the value for the number of submeshes if there is only}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01203}01203         \textcolor{comment}{// one mesh so that the loop below works if we have only one}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01204}01204         \textcolor{comment}{// mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01205}01205         \textcolor{keywordflow}{if} (n\_meshes == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01206}01206         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01207}01207           n\_meshes = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01208}01208         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01209}01209 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01210}01210         \textcolor{comment}{// Store which submeshes, if there are some are structured}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01211}01211         \textcolor{comment}{// meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01212}01212         std::vector<bool> is\_structured\_mesh(n\_meshes);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01213}01213 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01214}01214         \textcolor{comment}{// Loop over all elements in the rebuilt mesh, but make sure}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01215}01215         \textcolor{comment}{// that we are only looping over the structured meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01216}01216         nel = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01217}01217         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_meshes; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01218}01218         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01219}01219           \mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}* tri\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01220}01220             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01221}01221           \textcolor{keywordflow}{if} (!(tri\_mesh\_pt != 0))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01222}01222           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01223}01223             \textcolor{comment}{// Mark the mesh as structured mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01224}01224             is\_structured\_mesh[i\_mesh] = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01225}01225             \textcolor{comment}{// Add the number of elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01226}01226             nel += \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01227}01227           \} \textcolor{comment}{// if (!(tri\_mesh\_pt!=0))}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01228}01228           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01229}01229           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01230}01230             \textcolor{comment}{// Mark the mesh as nonstructured mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01231}01231             is\_structured\_mesh[i\_mesh] = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01232}01232           \} \textcolor{comment}{// else if (!(tri\_mesh\_pt!=0))}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01233}01233         \} \textcolor{comment}{// for (i\_mesh < n\_mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01234}01234 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01235}01235         \textcolor{comment}{// Go for all the meshes (if there are submeshes)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01236}01236         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_meshes; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01237}01237         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01238}01238           \textcolor{comment}{// Only work with the elements in the mesh if it is an}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01239}01239           \textcolor{comment}{// structured mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01240}01240           \textcolor{keywordflow}{if} (is\_structured\_mesh[i\_mesh])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01241}01241           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01242}01242             \textcolor{comment}{// Get the number of elements in the submesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01243}01243             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nele\_submesh = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01244}01244             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nele\_submesh; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01245}01245             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01246}01246               \textcolor{comment}{// Get the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01247}01247               \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* el\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01248}01248 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01249}01249               \textcolor{comment}{// Not refineable: It's definitely a new base element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01250}01250               \mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}* ref\_el\_pt = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01251}01251               ref\_el\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(el\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01252}01252               \textcolor{keywordflow}{if} (ref\_el\_pt == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01253}01253               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01254}01254                 \textcolor{keywordtype}{unsigned} old\_base\_el\_no =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01255}01255                   old\_base\_element\_number\_plus\_one[el\_pt] -\/ 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01256}01256                 new\_base\_element\_associated\_with\_old\_base\_element}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01257}01257                   [old\_base\_el\_no]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01258}01258                     .push\_back(el\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01259}01259               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01260}01260               \textcolor{comment}{// Refineable}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01261}01261               \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01262}01262               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01263}01263                 \textcolor{comment}{// Is it a tree root (after pruning)? In that case it's}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01264}01264                 \textcolor{comment}{// a new base element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01265}01265                 \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeRoot}{TreeRoot}}*\textcolor{keyword}{>}(ref\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_a4b783f4e5b6aeed83d49e478510d614f}{tree\_pt}}()))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01266}01266                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01267}01267                   \textcolor{keywordtype}{unsigned} old\_base\_el\_no =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01268}01268                     old\_base\_element\_number\_plus\_one[el\_pt] -\/ 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01269}01269                   new\_base\_element\_associated\_with\_old\_base\_element}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01270}01270                     [old\_base\_el\_no]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01271}01271                       .push\_back(el\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01272}01272                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01273}01273                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01274}01274                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01275}01275                   \textcolor{comment}{// Get associated root element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01276}01276                   \mbox{\hyperlink{classoomph_1_1FiniteElement}{FiniteElement}}* root\_el\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01277}01277                     ref\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_a4b783f4e5b6aeed83d49e478510d614f}{tree\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Tree_a33b9926754cddfaafd9869af3fe266e7}{root\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Tree_a7d630dad19ef861ab6a5f37ad6ea67f4}{object\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01278}01278 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01279}01279                   \textcolor{keywordflow}{if} (!root\_el\_done[root\_el\_pt])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01280}01280                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01281}01281                     root\_el\_done[root\_el\_pt] = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01282}01282                     \textcolor{keywordtype}{unsigned} old\_base\_el\_no =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01283}01283                       old\_base\_element\_number\_plus\_one[el\_pt] -\/ 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01284}01284                     new\_base\_element\_associated\_with\_old\_base\_element}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01285}01285                       [old\_base\_el\_no]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01286}01286                         .push\_back(root\_el\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01287}01287                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01288}01288                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01289}01289               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01290}01290             \} \textcolor{comment}{// for (e < nele\_submesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01291}01291           \} \textcolor{comment}{// if (is\_structured\_mesh[i\_mesh])}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01292}01292         \} \textcolor{comment}{// for (i\_mesh < n\_mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01293}01293 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01294}01294         \textcolor{comment}{// Create a vector that stores how many new root/base elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01295}01295         \textcolor{comment}{// got spawned from each old root/base element in the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01296}01296         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} local\_n\_new\_root(nel\_base\_old);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01297}01297 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01298}01298         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} n\_new\_root\_back(nel\_base\_old);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01299}01299 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01300}01300         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nel\_base\_old; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01301}01301         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01302}01302           local\_n\_new\_root[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01303}01303             new\_base\_element\_associated\_with\_old\_base\_element[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}].size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01304}01304 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01305}01305 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01306}01306           \textcolor{comment}{// Backup so we can check that halo data was consistent}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01307}01307           n\_new\_root\_back[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = local\_n\_new\_root[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01308}01308 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01309}01309         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01310}01310 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01311}01311         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01312}01312         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01313}01313           t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01314}01314           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for setup of new base elements in "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01315}01315                      << \textcolor{stringliteral}{"{}Problem::prune\_halo\_elements\_and\_nodes(): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01316}01316                      << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01317}01317           t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01318}01318         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01319}01319 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01320}01320         \textcolor{comment}{// Now do reduce operation to get information for all}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01321}01321         \textcolor{comment}{// old root/base elements -\/-\/ the pruned (halo!) base elements contain}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01322}01322         \textcolor{comment}{// fewer associated new roots.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01323}01323         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} n\_new\_root(nel\_base\_old);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01324}01324         MPI\_Allreduce(\&local\_n\_new\_root[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01325}01325                       \&n\_new\_root[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01326}01326                       nel\_base\_old,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01327}01327                       MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01328}01328                       MPI\_MAX,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01329}01329                       this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01330}01330 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01331}01331 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01332}01332         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01333}01333         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01334}01334           t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01335}01335           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for allreduce in "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01336}01336                      << \textcolor{stringliteral}{"{}Problem::prune\_halo\_elements\_and\_nodes(): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01337}01337                      << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01338}01338           t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01339}01339         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01340}01340 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01341}01341         \textcolor{comment}{// Find out total number of base elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01342}01342         \textcolor{keywordtype}{unsigned} nel\_base\_new = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01343}01343         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nel\_base\_old; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01344}01344         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01345}01345           \textcolor{comment}{// Increment}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01346}01346           nel\_base\_new += n\_new\_root[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01347}01347 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01348}01348 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01349}01349           \textcolor{comment}{// If we already had data for this root previously then}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01350}01350           \textcolor{comment}{// the data ought to be consistent afterwards (since taking}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01351}01351           \textcolor{comment}{// the max of consistent numbers shouldn't change things -\/-\/ this}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01352}01352           \textcolor{comment}{// deals with halo/haloed elements)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01353}01353           \textcolor{keywordflow}{if} (!old\_root\_is\_halo\_or\_non\_existent[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01354}01354           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01355}01355             \textcolor{keywordflow}{if} (n\_new\_root\_back[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01356}01356             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01357}01357               \textcolor{keywordflow}{if} (n\_new\_root\_back[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] != n\_new\_root[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01358}01358               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01359}01359                 std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01360}01360                 error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01361}01361                   << \textcolor{stringliteral}{"{}Number of new root elements spawned from old root "{}} << \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01362}01362                   << \textcolor{stringliteral}{"{}: "{}} << n\_new\_root[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] << \textcolor{stringliteral}{"{}\(\backslash\)nis not consistent"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01363}01363                   << \textcolor{stringliteral}{"{} with previous value: "{}} << n\_new\_root\_back[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01364}01364                   << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01365}01365                 \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01366}01366                                     OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01367}01367                                     OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01368}01368               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01369}01369             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01370}01370           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01371}01371 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01372}01372 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01373}01373         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01374}01374 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01375}01375         \textcolor{comment}{// Reset base\_mesh information}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01376}01376         \mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}.clear();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01377}01377         \mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}.resize(nel\_base\_new, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01378}01378         \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}.clear();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01379}01379 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01380}01380         \textcolor{comment}{// Now enumerate the new base/root elements consistently}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01381}01381         \textcolor{keywordtype}{unsigned} count = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01382}01382         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nel\_base\_old; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01383}01383         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01384}01384           \textcolor{comment}{// Old root is non-\/halo: Just add the new roots into the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01385}01385           \textcolor{comment}{// new lookup scheme consecutively}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01386}01386           \textcolor{keywordflow}{if} (!old\_root\_is\_halo\_or\_non\_existent[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01387}01387           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01388}01388             \textcolor{comment}{// Loop over new root/base element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01389}01389             \textcolor{keywordtype}{unsigned} n\_new\_root =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01390}01390               new\_base\_element\_associated\_with\_old\_base\_element[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}].size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01391}01391             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_new\_root; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01392}01392             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01393}01393               \textcolor{comment}{// Store new root/base element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01394}01394               \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* el\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01395}01395                 new\_base\_element\_associated\_with\_old\_base\_element[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}][j];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01396}01396               \mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}[count] = el\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01397}01397               \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}[el\_pt] = count + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01398}01398 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01399}01399               \textcolor{comment}{// Bump counter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01400}01400               count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01401}01401             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01402}01402           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01403}01403           \textcolor{comment}{// Old root element is halo so skip insertion (i.e. leave}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01404}01404           \textcolor{comment}{// entries in lookup schemes nulled) but increase counter to}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01405}01405           \textcolor{comment}{// ensure consistency between processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01406}01406           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01407}01407           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01408}01408             \textcolor{keywordtype}{unsigned} nskip = n\_new\_root[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01409}01409             count += nskip;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01410}01410           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01411}01411         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01412}01412 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01413}01413         \textcolor{comment}{// Re-\/setup the map between "{}root"{} element and number in global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01414}01414         \textcolor{comment}{// (used in the load\_balance() routines)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01415}01415         \mbox{\hyperlink{classoomph_1_1Problem_ab5f60ebc552c00ee681776bc7fa61203}{setup\_base\_mesh\_info\_after\_pruning}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01416}01416 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01417}01417 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01418}01418         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01419}01419         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01420}01420           t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01421}01421           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for finishing off base mesh info "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01422}01422                      << \textcolor{stringliteral}{"{}Problem::prune\_halo\_elements\_and\_nodes(): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01423}01423                      << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01424}01424           t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01425}01425         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01426}01426 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01427}01427 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01428}01428         \textcolor{comment}{// Call actions after distribute}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01429}01429         \mbox{\hyperlink{classoomph_1_1Problem_a4d3e3bd312518ca5afef94e169f81c39}{actions\_after\_distribute}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01430}01430 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01431}01431 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01432}01432         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01433}01433         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01434}01434           t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01435}01435           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for actions\_after\_distribute() "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01436}01436                      << \textcolor{stringliteral}{"{}Problem::prune\_halo\_elements\_and\_nodes(): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01437}01437                      << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01438}01438           t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01439}01439         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01440}01440 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01441}01441 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01442}01442         \textcolor{comment}{// Re-\/assign the equation numbers (incl synchronisation if reqd)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01443}01443 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01444}01444         \textcolor{keywordtype}{unsigned} n\_dof = \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01445}01445 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01446}01446         \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01447}01447 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01448}01448 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01449}01449 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01450}01450         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01451}01451         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01452}01452           t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01453}01453           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for assign\_eqn\_numbers() "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01454}01454                      << \textcolor{stringliteral}{"{}Problem::prune\_halo\_elements\_and\_nodes(): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01455}01455                      << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01456}01456           t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01457}01457         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01458}01458 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01459}01459 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01460}01460 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01461}01461         \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_a2cee2eaaf1ac49020fc76b3b6adb9bba}{Bypass\_increase\_in\_dof\_check\_during\_pruning}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01462}01462         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01463}01463           \textcolor{keywordflow}{if} (n\_dof != old\_ndof)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01464}01464           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01465}01465             std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01466}01466             error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01467}01467               << \textcolor{stringliteral}{"{}Number of dofs in prune\_halo\_elements\_and\_nodes() has "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01468}01468                  \textcolor{stringliteral}{"{}changed "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01469}01469               << \textcolor{stringliteral}{"{}from "{}} << old\_ndof << \textcolor{stringliteral}{"{} to "{}} << n\_dof << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01470}01470               << \textcolor{stringliteral}{"{}Check that you've implemented any necessary "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01471}01471                  \textcolor{stringliteral}{"{}actions\_before/after"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01472}01472               << \textcolor{stringliteral}{"{}\(\backslash\)nadapt/distribute functions, e.g. to pin redundant pressure"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01473}01473               << \textcolor{stringliteral}{"{} dofs etc.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01474}01474             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01475}01475                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01476}01476                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01477}01477           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01478}01478         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01479}01479 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01480}01480       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01481}01481     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01482}01482   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01483}01483 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01484}01484 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01485}01485 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01486}01486 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01487}01487 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01488}01488   \textcolor{comment}{//===================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01489}01489 \textcolor{comment}{  /// Build a single (global) mesh from a number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01490}01490 \textcolor{comment}{  /// of submeshes which are passed as a vector of pointers to the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01491}01491 \textcolor{comment}{  /// submeshes. The ordering is not necessarily optimal.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01492}01492 \textcolor{comment}{}  \textcolor{comment}{//==============================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01493}\mbox{\hyperlink{classoomph_1_1Problem_a0faad6f705a6dc0ffe27229f9104ed7c}{01493}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a0faad6f705a6dc0ffe27229f9104ed7c}{Problem::build\_global\_mesh}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01494}01494   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01495}01495 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01496}01496     \textcolor{comment}{// Has a global mesh already been built}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01497}01497     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01498}01498     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01499}01499       \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} error\_message = \textcolor{stringliteral}{"{}Problem::build\_global\_mesh() called,\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01500}01500       error\_message += \textcolor{stringliteral}{"{} but a global mesh has already been built:\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01501}01501       error\_message += \textcolor{stringliteral}{"{}Problem::Mesh\_pt is not zero!\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01502}01502 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01503}01503       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01504}01504         error\_message, OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01505}01505     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01506}01506     \textcolor{comment}{// Check that there are submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01507}01507     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_ab65f6fc9c49860e6324457a7e6e76346}{Sub\_mesh\_pt}}.size() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01508}01508     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01509}01509       \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} error\_message = \textcolor{stringliteral}{"{}Problem::build\_global\_mesh() called,\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01510}01510       error\_message += \textcolor{stringliteral}{"{} but there are no submeshes:\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01511}01511       error\_message += \textcolor{stringliteral}{"{}Problem::Sub\_mesh\_pt has no entries\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01512}01512 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01513}01513       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01514}01514         error\_message, OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01515}01515     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01516}01516 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01517}01517 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01518}01518     \textcolor{comment}{// Create an empty mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01519}01519     \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1Mesh}{Mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01520}01520 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01521}01521     \textcolor{comment}{// Call the rebuild function to construct the mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01522}01522     \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01523}01523   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01524}01524 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01525}01525   \textcolor{comment}{//====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01526}01526 \textcolor{comment}{  /// If one of the submeshes has changed (e.g. by}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01527}01527 \textcolor{comment}{  /// mesh adaptation) we need to update the global mesh.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01528}01528 \textcolor{comment}{  /// \(\backslash\)b Note: The nodes boundary information refers to the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01529}01529 \textcolor{comment}{  /// boundary numbers within the submesh!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01530}01530 \textcolor{comment}{  /// N.B. This is essentially the same function as the Mesh constructor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01531}01531 \textcolor{comment}{  /// that assembles a single global mesh from submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01532}01532 \textcolor{comment}{}  \textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01533}\mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{01533}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{Problem::rebuild\_global\_mesh}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01534}01534   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01535}01535     \textcolor{comment}{// Use the function in mesh to merge the submeshes into this one}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01536}01536     \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af4e77a5529b2aabfed8289e313c1c8d9}{merge\_meshes}}(\mbox{\hyperlink{classoomph_1_1Problem_ab65f6fc9c49860e6324457a7e6e76346}{Sub\_mesh\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01537}01537   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01538}01538 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01539}01539 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01540}01540   \textcolor{comment}{//================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01541}01541 \textcolor{comment}{  ///  Add a timestepper to the problem. The function will automatically}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01542}01542 \textcolor{comment}{  /// create or resize the Time object so that it contains the appropriate}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01543}01543 \textcolor{comment}{  /// number of levels of storage.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01544}01544 \textcolor{comment}{}  \textcolor{comment}{//================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01545}\mbox{\hyperlink{classoomph_1_1Problem_a8856eae2daa9cea05e99bfcd4ef340a4}{01545}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a8856eae2daa9cea05e99bfcd4ef340a4}{Problem::add\_time\_stepper\_pt}}(\mbox{\hyperlink{classoomph_1_1TimeStepper}{TimeStepper}}* \textcolor{keyword}{const}\& time\_stepper\_pt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01546}01546   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01547}01547     \textcolor{comment}{// Add the timestepper to the vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01548}01548     \mbox{\hyperlink{classoomph_1_1Problem_af1e8f8a739453250eb3744fea2a3b983}{Time\_stepper\_pt}}.push\_back(\mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01549}01549 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01550}01550     \textcolor{comment}{// Find the number of timesteps required by the timestepper}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01551}01551     \textcolor{keywordtype}{unsigned} ndt = \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_a00e57b6436cff4fc82af481b81a78a1a}{ndt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01552}01552 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01553}01553     \textcolor{comment}{// If time has not been allocated, create time object with the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01554}01554     \textcolor{comment}{// required number of time steps}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01555}01555     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_ae33fbf5f34a7d06d88ad2c98538bbbe8}{Time\_pt}} == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01556}01556     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01557}01557       \mbox{\hyperlink{classoomph_1_1Problem_ae33fbf5f34a7d06d88ad2c98538bbbe8}{Time\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1Time}{Time}}(ndt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01558}01558       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Created Time with "{}} << ndt << \textcolor{stringliteral}{"{} timesteps"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01559}01559     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01560}01560     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01561}01561     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01562}01562       \textcolor{comment}{// If the required number of time steps is greater than currently stored}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01563}01563       \textcolor{comment}{// resize the time storage}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01564}01564       \textcolor{keywordflow}{if} (ndt > \mbox{\hyperlink{classoomph_1_1Problem_ae33fbf5f34a7d06d88ad2c98538bbbe8}{Time\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Time_ad40953c471eb3ce59921e6870ed755f3}{ndt}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01565}01565       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01566}01566         \mbox{\hyperlink{classoomph_1_1Problem_ae33fbf5f34a7d06d88ad2c98538bbbe8}{Time\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Time_aeab1acb1e182797c4194af84c0583c3f}{resize}}(ndt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01567}01567         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Resized Time to include "{}} << ndt << \textcolor{stringliteral}{"{} timesteps"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01568}01568                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01569}01569       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01570}01570       \textcolor{comment}{// Otherwise report that we are OK}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01571}01571       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01572}01572       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01573}01573         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time object already has storage for "{}} << ndt}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01574}01574                    << \textcolor{stringliteral}{"{} timesteps"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01575}01575       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01576}01576     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01577}01577 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01578}01578     \textcolor{comment}{// Pass the pointer to time to the timestepper}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01579}01579     \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_ac73981d5a68161d7b317bebb4ee04adb}{time\_pt}}() = \mbox{\hyperlink{classoomph_1_1Problem_ae33fbf5f34a7d06d88ad2c98538bbbe8}{Time\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01580}01580   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01581}01581 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01582}01582   \textcolor{comment}{//================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01583}01583 \textcolor{comment}{  /// Set the explicit time stepper for the problem and also}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01584}01584 \textcolor{comment}{  /// ensure that a time object has been created.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01585}01585 \textcolor{comment}{}  \textcolor{comment}{//================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01586}\mbox{\hyperlink{classoomph_1_1Problem_a4cf44478e6f6abe95063b7bb2dd530a0}{01586}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a4cf44478e6f6abe95063b7bb2dd530a0}{Problem::set\_explicit\_time\_stepper\_pt}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01587}01587     \mbox{\hyperlink{classoomph_1_1ExplicitTimeStepper}{ExplicitTimeStepper}}* \textcolor{keyword}{const}\& explicit\_time\_stepper\_pt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01588}01588   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01589}01589     \textcolor{comment}{// Set the explicit time stepper}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01590}01590     \mbox{\hyperlink{classoomph_1_1Problem_af8466091ea4f5b57033bb3ad24831167}{Explicit\_time\_stepper\_pt}} = \mbox{\hyperlink{classoomph_1_1Problem_ab69ae6020f1886e7b288180b6130b7ed}{explicit\_time\_stepper\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01591}01591 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01592}01592     \textcolor{comment}{// If time has not been allocated, create time object with the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01593}01593     \textcolor{comment}{// required number of time steps}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01594}01594     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_ae33fbf5f34a7d06d88ad2c98538bbbe8}{Time\_pt}} == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01595}01595     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01596}01596       \mbox{\hyperlink{classoomph_1_1Problem_ae33fbf5f34a7d06d88ad2c98538bbbe8}{Time\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1Time}{Time}}(0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01597}01597       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Created Time with storage for no previous timestep"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01598}01598                  << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01599}01599     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01600}01600     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01601}01601     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01602}01602       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time object already exists "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01603}01603     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01604}01604   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01605}01605 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01606}01606 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01607}01607 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01608}01608 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01609}01609   \textcolor{comment}{//================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01610}01610 \textcolor{comment}{  /// Set default first and last elements for parallel assembly}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01611}01611 \textcolor{comment}{  /// of non-\/distributed problem.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01612}01612 \textcolor{comment}{}  \textcolor{comment}{//================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01613}\mbox{\hyperlink{classoomph_1_1Problem_ab002dc7a6faf97a1bfcd9c098a04f840}{01613}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ab002dc7a6faf97a1bfcd9c098a04f840}{Problem::set\_default\_first\_and\_last\_element\_for\_assembly}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01614}01614   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01615}01615     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01616}01616     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01617}01617       \textcolor{comment}{// Minimum number of elements per processor if there are fewer elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01618}01618       \textcolor{comment}{// than processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01619}01619       \textcolor{keywordtype}{unsigned} min\_el = 10;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01620}01620 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01621}01621       \textcolor{comment}{// Resize and make default assignments}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01622}01622       \textcolor{keywordtype}{int} n\_proc = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01623}01623       \textcolor{keywordtype}{unsigned} n\_elements = \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01624}01624       \mbox{\hyperlink{classoomph_1_1Problem_a0caac0918eaaea840238ce83f5be7836}{First\_el\_for\_assembly}}.resize(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01625}01625       \mbox{\hyperlink{classoomph_1_1Problem_a4842a9a213197905b5a8e182a3c02cce}{Last\_el\_plus\_one\_for\_assembly}}.resize(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01626}01626 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01627}01627       \textcolor{comment}{// In the absence of any better knowledge distribute work evenly}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01628}01628       \textcolor{comment}{// over elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01629}01629       \textcolor{keywordtype}{unsigned} range = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01630}01630       \textcolor{keywordtype}{unsigned} lo\_proc = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01631}01631       \textcolor{keywordtype}{unsigned} hi\_proc = n\_proc -\/ 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01632}01632       \textcolor{keywordflow}{if} (\textcolor{keywordtype}{int}(n\_elements) >= n\_proc)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01633}01633       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01634}01634         range = unsigned(\textcolor{keywordtype}{double}(n\_elements) / \textcolor{keywordtype}{double}(n\_proc));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01635}01635       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01636}01636       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01637}01637       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01638}01638         range = min\_el;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01639}01639         lo\_proc = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01640}01640         hi\_proc = unsigned(\textcolor{keywordtype}{double}(n\_elements) / \textcolor{keywordtype}{double}(min\_el));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01641}01641       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01642}01642 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01643}01643       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = lo\_proc; p <= int(hi\_proc); p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01644}01644       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01645}01645         \mbox{\hyperlink{classoomph_1_1Problem_a0caac0918eaaea840238ce83f5be7836}{First\_el\_for\_assembly}}[p] = p * range;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01646}01646 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01647}01647         \textcolor{keywordtype}{unsigned} last\_el\_plus\_one = (p + 1) * range;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01648}01648         \textcolor{keywordflow}{if} (last\_el\_plus\_one > n\_elements) last\_el\_plus\_one = n\_elements;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01649}01649         \mbox{\hyperlink{classoomph_1_1Problem_a4842a9a213197905b5a8e182a3c02cce}{Last\_el\_plus\_one\_for\_assembly}}[p] = last\_el\_plus\_one;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01650}01650       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01651}01651 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01652}01652       \textcolor{comment}{// Last one needs to incorporate any dangling elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01653}01653       \textcolor{keywordflow}{if} (\textcolor{keywordtype}{int}(n\_elements) >= n\_proc)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01654}01654       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01655}01655         \mbox{\hyperlink{classoomph_1_1Problem_a4842a9a213197905b5a8e182a3c02cce}{Last\_el\_plus\_one\_for\_assembly}}[n\_proc -\/ 1] = n\_elements;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01656}01656       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01657}01657 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01658}01658       \textcolor{comment}{// Doc}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01659}01659       \textcolor{keywordflow}{if} (n\_proc > 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01660}01660       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01661}01661         \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_ab4a3743c23a2d1eed56981484636c958}{Shut\_up\_in\_newton\_solve}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01662}01662         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01663}01663           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Problem is not distributed. Parallel assembly of "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01664}01664                      << \textcolor{stringliteral}{"{}Jacobian uses default partitioning: "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01665}01665           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < n\_proc; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01666}01666           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01667}01667             \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a4842a9a213197905b5a8e182a3c02cce}{Last\_el\_plus\_one\_for\_assembly}}[p] != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01668}01668             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01669}01669               \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Proc "{}} << p << \textcolor{stringliteral}{"{} assembles from element "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01670}01670                          << \mbox{\hyperlink{classoomph_1_1Problem_a0caac0918eaaea840238ce83f5be7836}{First\_el\_for\_assembly}}[p] << \textcolor{stringliteral}{"{} to "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01671}01671                          << \mbox{\hyperlink{classoomph_1_1Problem_a4842a9a213197905b5a8e182a3c02cce}{Last\_el\_plus\_one\_for\_assembly}}[p] -\/ 1 << \textcolor{stringliteral}{"{} \(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01672}01672             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01673}01673             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01674}01674             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01675}01675               \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Proc "{}} << p << \textcolor{stringliteral}{"{} assembles no elements\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01676}01676             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01677}01677           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01678}01678         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01679}01679       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01680}01680     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01681}01681   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01682}01682 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01683}01683 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01684}01684   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01685}01685 \textcolor{comment}{  /// Helper function to re-\/assign the first and last elements to be}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01686}01686 \textcolor{comment}{  /// assembled by each processor during parallel assembly for}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01687}01687 \textcolor{comment}{  /// non-\/distributed problem.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01688}01688 \textcolor{comment}{}  \textcolor{comment}{//=======================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01689}\mbox{\hyperlink{classoomph_1_1Problem_aa9d808bb5d62db0da8e962fa29c24af9}{01689}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_aa9d808bb5d62db0da8e962fa29c24af9}{Problem::recompute\_load\_balanced\_assembly}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01690}01690   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01691}01691     \textcolor{comment}{// Wait until all processes have completed/timed their assembly}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01692}01692     MPI\_Barrier(this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01693}01693 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01694}01694     \textcolor{comment}{// Storage for number of processors and current processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01695}01695     \textcolor{keywordtype}{int} n\_proc = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01696}01696     \textcolor{keywordtype}{int} rank = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01697}01697 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01698}01698     \textcolor{comment}{// Don't bother to update if we've got fewer elements than}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01699}01699     \textcolor{comment}{// processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01700}01700     \textcolor{keywordtype}{unsigned} nel = \mbox{\hyperlink{classoomph_1_1Problem_a2b2bcde2b051f47278ccf8446699bbfb}{Elemental\_assembly\_time}}.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01701}01701     \textcolor{keywordflow}{if} (\textcolor{keywordtype}{int}(nel) < n\_proc)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01702}01702     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01703}01703       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Not re-\/computing distribution of elemental assembly\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01704}01704                  << \textcolor{stringliteral}{"{}because there are fewer elements than processors\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01705}01705       \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01706}01706     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01707}01707 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01708}01708     \textcolor{comment}{// Setup vectors storing the number of element timings to be sent}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01709}01709     \textcolor{comment}{// and the offset in the final vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01710}01710     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} receive\_count(n\_proc);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01711}01711     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} displacement(n\_proc);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01712}01712     \textcolor{keywordtype}{int} offset = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01713}01713     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < n\_proc; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01714}01714     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01715}01715       \textcolor{comment}{// Default distribution of labour}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01716}01716       \textcolor{keywordtype}{unsigned} el\_lo = \mbox{\hyperlink{classoomph_1_1Problem_a0caac0918eaaea840238ce83f5be7836}{First\_el\_for\_assembly}}[p];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01717}01717       \textcolor{keywordtype}{unsigned} el\_hi = \mbox{\hyperlink{classoomph_1_1Problem_a4842a9a213197905b5a8e182a3c02cce}{Last\_el\_plus\_one\_for\_assembly}}[p] -\/ 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01718}01718 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01719}01719       \textcolor{comment}{// Number of timings to be sent and offset from start in}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01720}01720       \textcolor{comment}{// final vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01721}01721       receive\_count[p] = el\_hi -\/ el\_lo + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01722}01722       displacement[p] = offset;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01723}01723       offset += el\_hi -\/ el\_lo + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01724}01724     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01725}01725 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01726}01726     \textcolor{comment}{// Make temporary c-\/style array to avoid over-\/writing in Gatherv below}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01727}01727     \textcolor{keywordtype}{double}* el\_ass\_time = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[nel];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01728}01728     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nel; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01729}01729     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01730}01730       el\_ass\_time[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = \mbox{\hyperlink{classoomph_1_1Problem_a2b2bcde2b051f47278ccf8446699bbfb}{Elemental\_assembly\_time}}[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01731}01731     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01732}01732 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01733}01733     \textcolor{comment}{// Gather timings on root processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01734}01734     \textcolor{keywordtype}{unsigned} nel\_local =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01735}01735       \mbox{\hyperlink{classoomph_1_1Problem_a4842a9a213197905b5a8e182a3c02cce}{Last\_el\_plus\_one\_for\_assembly}}[rank] -\/ 1 -\/ \mbox{\hyperlink{classoomph_1_1Problem_a0caac0918eaaea840238ce83f5be7836}{First\_el\_for\_assembly}}[rank] + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01736}01736     MPI\_Gatherv(\&el\_ass\_time[\mbox{\hyperlink{classoomph_1_1Problem_a0caac0918eaaea840238ce83f5be7836}{First\_el\_for\_assembly}}[rank]],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01737}01737                 nel\_local,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01738}01738                 MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01739}01739                 \&\mbox{\hyperlink{classoomph_1_1Problem_a2b2bcde2b051f47278ccf8446699bbfb}{Elemental\_assembly\_time}}[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01740}01740                 \&receive\_count[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01741}01741                 \&displacement[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01742}01742                 MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01743}01743                 0,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01744}01744                 this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01745}01745     \textcolor{keyword}{delete}[] el\_ass\_time;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01746}01746 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01747}01747     \textcolor{comment}{// Vector of first and last elements for each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01748}01748     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<int>}}> first\_and\_last\_element(n\_proc);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01749}01749     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < n\_proc; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01750}01750     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01751}01751       first\_and\_last\_element[p].resize(2);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01752}01752     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01753}01753 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01754}01754     \textcolor{comment}{// Re-\/distribute work}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01755}01755     \textcolor{keywordflow}{if} (rank == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01756}01756     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01757}01757       \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_ab4a3743c23a2d1eed56981484636c958}{Shut\_up\_in\_newton\_solve}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01758}01758       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01759}01759         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01760}01760           << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01761}01761           << \textcolor{stringliteral}{"{}Re-\/assigning distribution of element assembly over processors:"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01762}01762           << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01763}01763       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01764}01764 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01765}01765       \textcolor{comment}{// Get total assembly time}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01766}01766       \textcolor{keywordtype}{double} total = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01767}01767       \textcolor{keywordtype}{unsigned} n\_elements = \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01768}01768       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_elements; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01769}01769       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01770}01770         total += \mbox{\hyperlink{classoomph_1_1Problem_a2b2bcde2b051f47278ccf8446699bbfb}{Elemental\_assembly\_time}}[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01771}01771       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01772}01772 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01773}01773       \textcolor{comment}{// Target load per processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01774}01774       \textcolor{keywordtype}{double} target\_load = total / double(n\_proc);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01775}01775 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01776}01776       \textcolor{comment}{// We're on the root processor: Always start with the first element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01777}01777       \textcolor{keywordtype}{int} proc = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01778}01778       first\_and\_last\_element[0][0] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01779}01779 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01780}01780       \textcolor{comment}{// Highest element we can help ourselves to if we want to leave}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01781}01781       \textcolor{comment}{// at least one element for all subsequent processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01782}01782       \textcolor{keywordtype}{unsigned} max\_el\_avail = n\_elements -\/ n\_proc;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01783}01783 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01784}01784       \textcolor{comment}{// Initialise total work allocated}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01785}01785       total = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01786}01786       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_elements; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01787}01787       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01788}01788         total += \mbox{\hyperlink{classoomph_1_1Problem_a2b2bcde2b051f47278ccf8446699bbfb}{Elemental\_assembly\_time}}[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01789}01789 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01790}01790         \textcolor{comment}{// Once we have reached the target load or we've used up practically}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01791}01791         \textcolor{comment}{// all the elements...}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01792}01792         \textcolor{keywordflow}{if} ((total > target\_load) || (\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} == max\_el\_avail))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01793}01793         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01794}01794           \textcolor{comment}{// Last element for current processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01795}01795           first\_and\_last\_element[proc][1] = \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01796}01796 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01797}01797           \textcolor{comment}{// Provided that we are not on the last processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01798}01798           \textcolor{keywordflow}{if} (proc < (n\_proc -\/ 1))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01799}01799           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01800}01800             \textcolor{comment}{// Set first element for next one}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01801}01801             first\_and\_last\_element[proc + 1][0] = \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01802}01802 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01803}01803             \textcolor{comment}{// Move on to the next processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01804}01804             proc++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01805}01805           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01806}01806 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01807}01807           \textcolor{comment}{// Can have one more...}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01808}01808           max\_el\_avail++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01809}01809 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01810}01810           \textcolor{comment}{// Re-\/initialise the time}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01811}01811           total = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01812}01812         \} \textcolor{comment}{// end of test for "{}total exceeds target"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01813}01813       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01814}01814 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01815}01815 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01816}01816       \textcolor{comment}{// Last element for last processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01817}01817       first\_and\_last\_element[n\_proc -\/ 1][1] = n\_elements -\/ 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01818}01818 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01819}01819 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01820}01820       \textcolor{comment}{// The following block should probably be paranoidified away}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01821}01821       \textcolor{comment}{// but we've screwed the logic up so many times that I feel}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01822}01822       \textcolor{comment}{// it's safer to keep it...}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01823}01823       \textcolor{keywordtype}{bool} wrong = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01824}01824       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01825}01825       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < n\_proc -\/ 1; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01826}01826       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01827}01827         \textcolor{keywordtype}{unsigned} first\_of\_current = first\_and\_last\_element[p][0];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01828}01828         \textcolor{keywordtype}{unsigned} last\_of\_current = first\_and\_last\_element[p][1];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01829}01829         \textcolor{keywordflow}{if} (first\_of\_current > last\_of\_current)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01830}01830         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01831}01831           wrong = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01832}01832           error\_stream << \textcolor{stringliteral}{"{}Error: First/last element of proc "{}} << p << \textcolor{stringliteral}{"{}: "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01833}01833                        << first\_of\_current << \textcolor{stringliteral}{"{} "{}} << last\_of\_current}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01834}01834                        << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01835}01835         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01836}01836         \textcolor{keywordtype}{unsigned} first\_of\_next = first\_and\_last\_element[p + 1][0];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01837}01837         \textcolor{keywordflow}{if} (first\_of\_next != (last\_of\_current + 1))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01838}01838         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01839}01839           wrong = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01840}01840           error\_stream << \textcolor{stringliteral}{"{}Error: First element of proc "{}} << p + 1 << \textcolor{stringliteral}{"{}: "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01841}01841                        << first\_of\_next << \textcolor{stringliteral}{"{} and last element of proc "{}} << p}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01842}01842                        << \textcolor{stringliteral}{"{}: "{}} << last\_of\_current << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01843}01843         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01844}01844       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01845}01845       \textcolor{keywordflow}{if} (wrong)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01846}01846       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01847}01847         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01848}01848           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01849}01849       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01850}01850 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01851}01851 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01852}01852       \textcolor{comment}{// THIS TIDY UP SHOULD NO LONGER BE REQUIRED AND CAN GO AT SOME POINT}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01853}01853 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01854}01854       \textcolor{comment}{// //If we haven't got to the end of the processor list then}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01855}01855       \textcolor{comment}{// //need to shift things about slightly because the processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01856}01856       \textcolor{comment}{// //at the end will be empty.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01857}01857       \textcolor{comment}{// //This can occur when you have very fast assembly times and the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01858}01858       \textcolor{comment}{// //rounding errors mean that the targets are achieved before all}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01859}01859       \textcolor{comment}{// processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01860}01860       \textcolor{comment}{// //have been visited.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01861}01861       \textcolor{comment}{// //Happens a lot when you massively oversubscribe the CPUs (which was}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01862}01862       \textcolor{comment}{// //only ever for testing!)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01863}01863       \textcolor{comment}{// if (proc!=n\_proc-\/1)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01864}01864       \textcolor{comment}{//  \{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01865}01865       \textcolor{comment}{//   oomph\_info}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01866}01866       \textcolor{comment}{//    << "{}First pass did not allocate elements on every processor\(\backslash\)n"{};}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01867}01867       \textcolor{comment}{//   oomph\_info <<}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01868}01868       \textcolor{comment}{//    "{}Moving elements so that each processor has at least one\(\backslash\)n"{};}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01869}01869 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01870}01870       \textcolor{comment}{//   //Work out number of empty processos}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01871}01871       \textcolor{comment}{//   unsigned n\_empty\_processors = n\_proc -\/ proc + 1;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01872}01872 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01873}01873       \textcolor{comment}{//   //Loop over the processors that do have elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01874}01874       \textcolor{comment}{//   //and work out how many we need to steal elements from}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01875}01875       \textcolor{comment}{//   unsigned n\_element\_on\_processors=0;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01876}01876       \textcolor{comment}{//   do}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01877}01877       \textcolor{comment}{//    \{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01878}01878       \textcolor{comment}{//     //Step down the processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01879}01879       \textcolor{comment}{//     -\/-\/proc;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01880}01880       \textcolor{comment}{//     //Add the current processor to the number of empty processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01881}01881       \textcolor{comment}{//     //because the elements have to be shared between processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01882}01882       \textcolor{comment}{//     //including the one(s) on which they are currently stored.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01883}01883       \textcolor{comment}{//     ++n\_empty\_processors;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01884}01884       \textcolor{comment}{//     n\_element\_on\_processors +=}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01885}01885       \textcolor{comment}{//      (first\_and\_last\_element[proc][1] -\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01886}01886       \textcolor{comment}{//       first\_and\_last\_element[proc][0] + 1);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01887}01887       \textcolor{comment}{//    \}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01888}01888       \textcolor{comment}{//   while(n\_element\_on\_processors < n\_empty\_processors);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01889}01889 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01890}01890       \textcolor{comment}{//   //Should now be able to put one element on each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01891}01891       \textcolor{comment}{//   //Start from the end and do so}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01892}01892       \textcolor{comment}{//   unsigned current\_element  = n\_elements-\/1;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01893}01893       \textcolor{comment}{//   for(int p=n\_proc-\/1;p>proc;p-\/-\/)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01894}01894       \textcolor{comment}{//    \{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01895}01895       \textcolor{comment}{//     first\_and\_last\_element[p][1] = current\_element;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01896}01896       \textcolor{comment}{//     first\_and\_last\_element[p][0] = -\/-\/current\_element;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01897}01897       \textcolor{comment}{//    \}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01898}01898 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01899}01899       \textcolor{comment}{//   //Now for the last processor we touched, just adjust the final value}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01900}01900       \textcolor{comment}{//   first\_and\_last\_element[proc][1] = current\_element;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01901}01901       \textcolor{comment}{//  \}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01902}01902       \textcolor{comment}{// //Otherwise just put the rest of the elements on the final}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01903}01903       \textcolor{comment}{// //processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01904}01904       \textcolor{comment}{// else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01905}01905       \textcolor{comment}{//  \{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01906}01906       \textcolor{comment}{//   // Last one}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01907}01907       \textcolor{comment}{//   first\_and\_last\_element[n\_proc-\/1][1]=n\_elements-\/1;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01908}01908       \textcolor{comment}{//  \}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01909}01909 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01910}01910 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01911}01911       \textcolor{comment}{// END PRESUMED-\/TO-\/BE-\/UNNECESSARY BLOCK...}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01912}01912 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01913}01913 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01914}01914       \textcolor{comment}{// Now communicate the information}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01915}01915 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01916}01916       \textcolor{comment}{// Set local informationt for this (root) processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01917}01917       \mbox{\hyperlink{classoomph_1_1Problem_a0caac0918eaaea840238ce83f5be7836}{First\_el\_for\_assembly}}[0] = first\_and\_last\_element[0][0];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01918}01918       \mbox{\hyperlink{classoomph_1_1Problem_a4842a9a213197905b5a8e182a3c02cce}{Last\_el\_plus\_one\_for\_assembly}}[0] = first\_and\_last\_element[0][1] + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01919}01919 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01920}01920       \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_ab4a3743c23a2d1eed56981484636c958}{Shut\_up\_in\_newton\_solve}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01921}01921       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01922}01922         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Processor "{}} << 0 << \textcolor{stringliteral}{"{} assembles Jacobians"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01923}01923                    << \textcolor{stringliteral}{"{} from elements "{}} << first\_and\_last\_element[0][0]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01924}01924                    << \textcolor{stringliteral}{"{} to "{}} << first\_and\_last\_element[0][1] << \textcolor{stringliteral}{"{} "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01925}01925                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01926}01926       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01927}01927 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01928}01928       \textcolor{comment}{// Only now can we send the information to the other processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01929}01929       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 1; p < n\_proc; ++p)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01930}01930       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01931}01931         MPI\_Send(\&first\_and\_last\_element[p][0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01932}01932                  2,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01933}01933                  MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01934}01934                  p,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01935}01935                  0,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01936}01936                  this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01937}01937 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01938}01938 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01939}01939         \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_ab4a3743c23a2d1eed56981484636c958}{Shut\_up\_in\_newton\_solve}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01940}01940         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01941}01941           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Processor "{}} << p << \textcolor{stringliteral}{"{} assembles Jacobians"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01942}01942                      << \textcolor{stringliteral}{"{} from elements "{}} << first\_and\_last\_element[p][0]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01943}01943                      << \textcolor{stringliteral}{"{} to "{}} << first\_and\_last\_element[p][1] << \textcolor{stringliteral}{"{} "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01944}01944                      << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01945}01945         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01946}01946       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01947}01947     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01948}01948     \textcolor{comment}{// Receive first and last element from root on non-\/master processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01949}01949     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01950}01950     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01951}01951       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} aux(2);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01952}01952       MPI\_Status status;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01953}01953       MPI\_Recv(\&aux[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01954}01954                2,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01955}01955                MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01956}01956                0,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01957}01957                0,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01958}01958                this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01959}01959                \&status);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01960}01960       \mbox{\hyperlink{classoomph_1_1Problem_a0caac0918eaaea840238ce83f5be7836}{First\_el\_for\_assembly}}[rank] = aux[0];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01961}01961       \mbox{\hyperlink{classoomph_1_1Problem_a4842a9a213197905b5a8e182a3c02cce}{Last\_el\_plus\_one\_for\_assembly}}[rank] = aux[1] + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01962}01962     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01963}01963 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01964}01964     \textcolor{comment}{// Wipe all others}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01965}01965     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < n\_proc; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01966}01966     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01967}01967       \textcolor{keywordflow}{if} (p != rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01968}01968       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01969}01969         \mbox{\hyperlink{classoomph_1_1Problem_a0caac0918eaaea840238ce83f5be7836}{First\_el\_for\_assembly}}[p] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01970}01970         \mbox{\hyperlink{classoomph_1_1Problem_a4842a9a213197905b5a8e182a3c02cce}{Last\_el\_plus\_one\_for\_assembly}}[p] = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01971}01971       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01972}01972     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01973}01973 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01974}01974     \textcolor{comment}{// The equations assembled by this processor may have changed so}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01975}01975     \textcolor{comment}{// we must resize the sparse assemble with arrays previous allocation}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01976}01976     \mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}.resize(0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01977}01977   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01978}01978 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01979}01979 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01980}01980 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01981}01981   \textcolor{comment}{//================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01982}01982 \textcolor{comment}{  /// Assign all equation numbers for problem: Deals with global}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01983}01983 \textcolor{comment}{  /// data (= data that isn't attached to any elements) and then}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01984}01984 \textcolor{comment}{  /// does the equation numbering for the elements.  Bool argument}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01985}01985 \textcolor{comment}{  /// can be set to false to ignore assigning local equation numbers}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01986}01986 \textcolor{comment}{  /// (necessary in the parallel implementation of locate\_zeta}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01987}01987 \textcolor{comment}{  /// between multiple meshes).}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01988}01988 \textcolor{comment}{}  \textcolor{comment}{//================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01989}\mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{01989}}   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{Problem::assign\_eqn\_numbers}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01990}01990     \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& assign\_local\_eqn\_numbers)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01991}01991   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01992}01992     \textcolor{comment}{// Check that the global mesh has been build}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01993}01993 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01994}01994     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}} == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01995}01995     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01996}01996       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01997}01997       error\_stream << \textcolor{stringliteral}{"{}Global mesh does not exist, so equation numbers cannot "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01998}01998                       \textcolor{stringliteral}{"{}be assigned.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l01999}01999       \textcolor{comment}{// Check for sub meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02000}02000       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02001}02001       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02002}02002         error\_stream << \textcolor{stringliteral}{"{}There aren't even any sub-\/meshes in the Problem.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02003}02003                      << \textcolor{stringliteral}{"{}You can set the global mesh directly by using\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02004}02004                      << \textcolor{stringliteral}{"{}Problem::mesh\_pt() = my\_mesh\_pt;\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02005}02005                      << \textcolor{stringliteral}{"{}OR you can use Problem::add\_sub\_mesh(mesh\_pt); "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02006}02006                      << \textcolor{stringliteral}{"{}to add a sub mesh.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02007}02007       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02008}02008       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02009}02009       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02010}02010         error\_stream << \textcolor{stringliteral}{"{}There are "{}} << \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}() << \textcolor{stringliteral}{"{} sub-\/meshes.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02011}02011       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02012}02012       error\_stream << \textcolor{stringliteral}{"{}You need to call Problem::build\_global\_mesh() to create "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02013}02013                       \textcolor{stringliteral}{"{}a global mesh\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02014}02014                    << \textcolor{stringliteral}{"{}from the sub-\/meshes.\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02015}02015 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02016}02016       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02017}02017         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02018}02018     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02019}02019 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02020}02020 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02021}02021     \textcolor{comment}{// Number of submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02022}02022     \textcolor{keywordtype}{unsigned} n\_sub\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_ab65f6fc9c49860e6324457a7e6e76346}{Sub\_mesh\_pt}}.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02023}02023 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02024}02024 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02025}02025 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02026}02026     \textcolor{comment}{// Storage for number of processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02027}02027     \textcolor{keywordtype}{int} n\_proc = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02028}02028 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02029}02029 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02030}02030     \textcolor{keywordflow}{if} (n\_proc > 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02031}02031     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02032}02032       \textcolor{comment}{// Force re-\/analysis of time spent on assembly each}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02033}02033       \textcolor{comment}{// elemental Jacobian}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02034}02034       \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02035}02035       \mbox{\hyperlink{classoomph_1_1Problem_a2b2bcde2b051f47278ccf8446699bbfb}{Elemental\_assembly\_time}}.clear();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02036}02036     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02037}02037     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02038}02038     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02039}02039       \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02040}02040     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02041}02041 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02042}02042     \textcolor{comment}{// Re-\/distribution of elements over processors during assembly}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02043}02043     \textcolor{comment}{// must be recomputed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02044}02044     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02045}02045     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02046}02046       \textcolor{comment}{// Set default first and last elements for parallel assembly}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02047}02047       \textcolor{comment}{// of non-\/distributed problem.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02048}02048       \mbox{\hyperlink{classoomph_1_1Problem_ab002dc7a6faf97a1bfcd9c098a04f840}{set\_default\_first\_and\_last\_element\_for\_assembly}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02049}02049     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02050}02050 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02051}02051 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02052}02052 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02053}02053 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02054}02054     \textcolor{keywordtype}{double} t\_start = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02055}02055     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02056}02056     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02057}02057       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02058}02058     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02059}02059 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02060}02060     \textcolor{comment}{// Loop over all elements in the mesh and set up any additional}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02061}02061     \textcolor{comment}{// dependencies that they may have (e.g. storing the geometric}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02062}02062     \textcolor{comment}{// Data, i.e. Data that affects an element's shape in elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02063}02063     \textcolor{comment}{// with algebraic node-\/update functions}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02064}02064     \textcolor{keywordtype}{unsigned} nel = \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02065}02065     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nel; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02066}02066     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02067}02067       \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}})-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_af03c43b9df873659a6ca91e39566256e}{complete\_setup\_of\_dependencies}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02068}02068     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02069}02069 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02070}02070 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02071}02071     \textcolor{comment}{// Complete setup of dependencies for external halo elements too}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02072}02072     \textcolor{keywordtype}{unsigned} n\_mesh = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02073}02073     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02074}02074     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02075}02075       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} iproc = 0; iproc < n\_proc; iproc++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02076}02076       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02077}02077         \textcolor{keywordtype}{unsigned} n\_ext\_halo\_el = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af7554deb7f9854272d849a6482a57d60}{nexternal\_halo\_element}}(iproc);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02078}02078         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_ext\_halo\_el; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02079}02079         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02080}02080           \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02081}02081             -\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1f889ef9305db5f812f93931877839d2}{external\_halo\_element\_pt}}(iproc, \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02082}02082             -\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_af03c43b9df873659a6ca91e39566256e}{complete\_setup\_of\_dependencies}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02083}02083         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02084}02084       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02085}02085     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02086}02086 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02087}02087 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02088}02088 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02089}02089     \textcolor{keywordtype}{double} t\_end = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02090}02090     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02091}02091     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02092}02092       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02093}02093       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02094}02094         << \textcolor{stringliteral}{"{}Time for complete setup of dependencies in assign\_eqn\_numbers: "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02095}02095         << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02096}02096     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02097}02097 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02098}02098 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02099}02099     \textcolor{comment}{// Initialise number of dofs for reserve below}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02100}02100     \textcolor{keywordtype}{unsigned} n\_dof = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02101}02101 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02102}02102     \textcolor{comment}{// Potentially loop over remainder of routine, possible re-\/visiting all}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02103}02103     \textcolor{comment}{// those parts that must be redone, following the removal of duplicate}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02104}02104     \textcolor{comment}{// external halo data.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02105}02105     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} loop\_count = 0; loop\_count < 2; loop\_count++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02106}02106     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02107}02107       \textcolor{comment}{//(Re)-\/set the dof pointer to zero length because entries are}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02108}02108       \textcolor{comment}{// pushed back onto it -\/-\/ if it's not reset here then we get into}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02109}02109       \textcolor{comment}{// trouble during mesh refinement when we reassign all dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02110}02110       \mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.resize(0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02111}02111 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02112}02112       \textcolor{comment}{// Reserve from previous allocation if we're going around again}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02113}02113       \mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.reserve(n\_dof);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02114}02114 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02115}02115       \textcolor{comment}{// Reset the equation number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02116}02116       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} equation\_number = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02117}02117 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02118}02118       \textcolor{comment}{// Now set equation numbers for the global Data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02119}02119       \textcolor{keywordtype}{unsigned} Nglobal\_data = \mbox{\hyperlink{classoomph_1_1Problem_a60a9b6861928cf9115110b5bfc7d11a7}{nglobal\_data}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02120}02120       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < Nglobal\_data; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02121}02121       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02122}02122         \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]-\/>assign\_eqn\_numbers(equation\_number, \mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02123}02123       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02124}02124 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02125}02125       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02126}02126       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02127}02127         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02128}02128       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02129}02129 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02130}02130       \textcolor{comment}{// Call assign equation numbers on the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02131}02131       n\_dof = \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_addf84f5fbe29d45259c36acf5f01d330}{assign\_global\_eqn\_numbers}}(\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02132}02132 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02133}02133       \textcolor{comment}{// Deal with the spine meshes additional numbering}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02134}02134       \textcolor{comment}{// If there is only one mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02135}02135       \textcolor{keywordflow}{if} (n\_sub\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02136}02136       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02137}02137         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1SpineMesh}{SpineMesh}}* \textcolor{keyword}{const} spine\_mesh\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SpineMesh}{SpineMesh}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02138}02138         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02139}02139           n\_dof = spine\_mesh\_pt-\/>assign\_global\_spine\_eqn\_numbers(\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02140}02140         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02141}02141       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02142}02142       \textcolor{comment}{// Otherwise loop over the sub meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02143}02143       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02144}02144       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02145}02145         \textcolor{comment}{// Assign global equation numbers first}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02146}02146         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_sub\_mesh; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02147}02147         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02148}02148           \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1SpineMesh}{SpineMesh}}* \textcolor{keyword}{const} spine\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02149}02149                 \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SpineMesh}{SpineMesh}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ab65f6fc9c49860e6324457a7e6e76346}{Sub\_mesh\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02150}02150           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02151}02151             n\_dof = spine\_mesh\_pt-\/>assign\_global\_spine\_eqn\_numbers(\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02152}02152           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02153}02153         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02154}02154       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02155}02155 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02156}02156       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02157}02157       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02158}02158         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02159}02159         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02160}02160           << \textcolor{stringliteral}{"{}Time for assign\_global\_eqn\_numbers in assign\_eqn\_numbers: "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02161}02161           << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02162}02162         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02163}02163       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02164}02164 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02165}02165 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02166}02166 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02167}02167 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02168}02168       \textcolor{comment}{// reset previous allocation}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02169}02169       \mbox{\hyperlink{classoomph_1_1Problem_a6a96b64a44cb378db1c0a07c562f7dae}{Parallel\_sparse\_assemble\_previous\_allocation}} = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02170}02170 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02171}02171       \textcolor{comment}{// Only synchronise if the problem has actually been}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02172}02172       \textcolor{comment}{// distributed.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02173}02173       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02174}02174       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02175}02175         \textcolor{comment}{// Synchronise the equation numbers and return the total}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02176}02176         \textcolor{comment}{// number of degrees of freedom in the overall problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02177}02177         \textcolor{comment}{// Do not assign local equation numbers -\/-\/ we're doing this}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02178}02178         \textcolor{comment}{// below.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02179}02179         n\_dof = \mbox{\hyperlink{classoomph_1_1Problem_a9a9ce9ee869ff79ee5596e434309f379}{synchronise\_eqn\_numbers}}(\textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02180}02180       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02181}02181       \textcolor{comment}{// ..else just setup the Dof\_distribution\_pt}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02182}02182       \textcolor{comment}{// NOTE: this is setup by synchronise\_eqn\_numbers(...)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02183}02183       \textcolor{comment}{// if Problem\_has\_been\_distributed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02184}02184       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02185}02185 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02186}02186       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02187}02187         \mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a3cab441019e738e4c6db6ee22dd71515}{build}}(\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}, n\_dof, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02188}02188       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02189}02189 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02190}02190       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02191}02191       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02192}02192         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02193}02193         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for Problem::synchronise\_eqn\_numbers in "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02194}02194                    << \textcolor{stringliteral}{"{}Problem::assign\_eqn\_numbers: "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02195}02195                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02196}02196       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02197}02197 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02198}02198 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02199}02199 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02200}02200 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02201}02201 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02202}02202       \textcolor{comment}{// Now remove duplicate data in external halo elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02203}02203       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02204}02204       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02205}02205         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02206}02206         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02207}02207           t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02208}02208         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02209}02209 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02210}02210         \textcolor{comment}{// Monitor if we've actually changed anything}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02211}02211         \textcolor{keywordtype}{bool} actually\_removed\_some\_data = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02212}02212 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02213}02213         \textcolor{comment}{// Only do it once!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02214}02214         \textcolor{keywordflow}{if} (loop\_count == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02215}02215         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02216}02216           \textcolor{keywordflow}{if} (n\_sub\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02217}02217           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02218}02218             \mbox{\hyperlink{classoomph_1_1Problem_a088570d2600c2e710da2717e9ed35404}{remove\_duplicate\_data}}(\mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}, actually\_removed\_some\_data);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02219}02219           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02220}02220           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02221}02221           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02222}02222             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_sub\_mesh; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02223}02223             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02224}02224               \textcolor{keywordtype}{bool} tmp\_actually\_removed\_some\_data = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02225}02225               \mbox{\hyperlink{classoomph_1_1Problem_a088570d2600c2e710da2717e9ed35404}{remove\_duplicate\_data}}(\mbox{\hyperlink{classoomph_1_1Problem_ab65f6fc9c49860e6324457a7e6e76346}{Sub\_mesh\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02226}02226                                     tmp\_actually\_removed\_some\_data);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02227}02227               \textcolor{keywordflow}{if} (tmp\_actually\_removed\_some\_data)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02228}02228                 actually\_removed\_some\_data = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02229}02229             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02230}02230           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02231}02231         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02232}02232 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02233}02233 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02234}02234         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02235}02235         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02236}02236           t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02237}02237           std::stringstream tmp;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02238}02238           tmp << \textcolor{stringliteral}{"{}Time for calls to Problem::remove\_duplicate\_data in "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02239}02239               << \textcolor{stringliteral}{"{}Problem::assign\_eqn\_numbers: "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02240}02240               << \textcolor{stringliteral}{"{} ; have "{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02241}02241           \textcolor{keywordflow}{if} (!actually\_removed\_some\_data)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02242}02242           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02243}02243             tmp << \textcolor{stringliteral}{"{} not "{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02244}02244           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02245}02245           tmp << \textcolor{stringliteral}{"{} removed some/any data.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02246}02246           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << tmp.str();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02247}02247           t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02248}02248         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02249}02249 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02250}02250         \textcolor{comment}{// Break out of the loop if we haven't done anything here.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02251}02251         \textcolor{keywordtype}{unsigned} status = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02252}02252         \textcolor{keywordflow}{if} (actually\_removed\_some\_data) status = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02253}02253 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02254}02254         \textcolor{comment}{// Allreduce to check if anyone has removed any data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02255}02255         \textcolor{keywordtype}{unsigned} overall\_status = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02256}02256         MPI\_Allreduce(\&status,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02257}02257                       \&overall\_status,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02258}02258                       1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02259}02259                       MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02260}02260                       MPI\_MAX,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02261}02261                       this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02262}02262 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02263}02263 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02264}02264         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02265}02265         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02266}02266           t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02267}02267           std::stringstream tmp;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02268}02268           tmp}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02269}02269             << \textcolor{stringliteral}{"{}Time for MPI\_Allreduce after Problem::remove\_duplicate\_data in "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02270}02270             << \textcolor{stringliteral}{"{}Problem::assign\_eqn\_numbers: "{}} << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02271}02271           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << tmp.str();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02272}02272           t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02273}02273         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02274}02274 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02275}02275         \textcolor{comment}{// Bail out if we haven't done anything here}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02276}02276         \textcolor{keywordflow}{if} (overall\_status != 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02277}02277         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02278}02278           \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02279}02279         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02280}02280 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02281}02281         \textcolor{comment}{// Big tidy up: Remove null pointers from halo/haloed node storage}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02282}02282         \textcolor{comment}{// for all meshes (this involves comms and therefore must be}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02283}02283         \textcolor{comment}{// performed outside loop over meshes so the all-\/to-\/all is only}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02284}02284         \textcolor{comment}{// done once)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02285}02285         \mbox{\hyperlink{classoomph_1_1Problem_aee39a957d45bc474c1f5b27d96c9dcc0}{remove\_null\_pointers\_from\_external\_halo\_node\_storage}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02286}02286 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02287}02287         \textcolor{comment}{// Time it...}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02288}02288         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02289}02289         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02290}02290           \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02291}02291           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Total time for "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02292}02292                      << \textcolor{stringliteral}{"{}Problem::remove\_null\_pointers\_from\_external\_halo\_node\_"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02293}02293                         \textcolor{stringliteral}{"{}storage(): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02294}02294                      << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02295}02295         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02296}02296       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02297}02297       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02298}02298       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02299}02299         \textcolor{comment}{// Problem not distributed; no need for another loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02300}02300         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02301}02301       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02302}02302 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02303}02303 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02304}02304 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02305}02305       \textcolor{comment}{// Serial run: Again no need for a second loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02306}02306       \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02307}02307 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02308}02308 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02309}02309 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02310}02310     \} \textcolor{comment}{// end of loop over fcts that need to be re-\/executed if}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02311}02311     \textcolor{comment}{// we've removed duplicate external data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02312}02312 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02313}02313 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02314}02314     \textcolor{comment}{// Resize the sparse assemble with arrays previous allocation}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02315}02315     \mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}.resize(0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02316}02316 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02317}02317 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02318}02318     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02319}02319     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02320}02320       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02321}02321     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02322}02322 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02323}02323     \textcolor{comment}{// Finally assign local equations}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02324}02324     \textcolor{keywordflow}{if} (assign\_local\_eqn\_numbers)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02325}02325     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02326}02326       \textcolor{keywordflow}{if} (n\_sub\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02327}02327       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02328}02328         \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ab73d03d38e9b94b15f21b2c12f5dc3bc}{assign\_local\_eqn\_numbers}}(\mbox{\hyperlink{classoomph_1_1Problem_a075696d6f4c4260ce860997c8c931de4}{Store\_local\_dof\_pt\_in\_elements}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02329}02329       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02330}02330       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02331}02331       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02332}02332         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_sub\_mesh; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02333}02333         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02334}02334           \mbox{\hyperlink{classoomph_1_1Problem_ab65f6fc9c49860e6324457a7e6e76346}{Sub\_mesh\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]-\/>assign\_local\_eqn\_numbers(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02335}02335             \mbox{\hyperlink{classoomph_1_1Problem_a075696d6f4c4260ce860997c8c931de4}{Store\_local\_dof\_pt\_in\_elements}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02336}02336         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02337}02337       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02338}02338     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02339}02339 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02340}02340     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02341}02341     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02342}02342       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02343}02343       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Total time for all Mesh::assign\_local\_eqn\_numbers in "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02344}02344                  << \textcolor{stringliteral}{"{}Problem::assign\_eqn\_numbers: "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02345}02345                  << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02346}02346     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02347}02347 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02348}02348 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02349}02349     \textcolor{comment}{// and return the total number of DOFs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02350}02350     \textcolor{keywordflow}{return} n\_dof;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02351}02351   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02352}02352   \textcolor{comment}{//================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02353}02353 \textcolor{comment}{  /// Function to describe the dofs in terms of the global}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02354}02354 \textcolor{comment}{  /// equation number, i.e. what type of value (nodal value of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02355}02355 \textcolor{comment}{  /// a Node; value in a Data object; value of internal Data in an}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02356}02356 \textcolor{comment}{  /// element; etc) is the unknown with a certain global equation number.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02357}02357 \textcolor{comment}{  /// Output stream defaults to oomph\_info.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02358}02358 \textcolor{comment}{}  \textcolor{comment}{//================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02359}\mbox{\hyperlink{classoomph_1_1Problem_a0563ae60b5c372087398fc3c45af757d}{02359}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a0563ae60b5c372087398fc3c45af757d}{Problem::describe\_dofs}}(std::ostream\& out)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02360}02360 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02361}02361     \textcolor{comment}{// Check that the global mesh has been build}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02362}02362 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02363}02363     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}} == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02364}02364     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02365}02365       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02366}02366       error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02367}02367         << \textcolor{stringliteral}{"{}Global mesh does not exist, so equation numbers cannot be found.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02368}02368       \textcolor{comment}{// Check for sub meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02369}02369       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02370}02370       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02371}02371         error\_stream << \textcolor{stringliteral}{"{}There aren't even any sub-\/meshes in the Problem.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02372}02372                      << \textcolor{stringliteral}{"{}You can set the global mesh directly by using\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02373}02373                      << \textcolor{stringliteral}{"{}Problem::mesh\_pt() = my\_mesh\_pt;\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02374}02374                      << \textcolor{stringliteral}{"{}OR you can use Problem::add\_sub\_mesh(mesh\_pt); "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02375}02375                      << \textcolor{stringliteral}{"{}to add a sub mesh.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02376}02376       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02377}02377       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02378}02378       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02379}02379         error\_stream << \textcolor{stringliteral}{"{}There are "{}} << \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}() << \textcolor{stringliteral}{"{} sub-\/meshes.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02380}02380       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02381}02381       error\_stream << \textcolor{stringliteral}{"{}You need to call Problem::build\_global\_mesh() to create "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02382}02382                       \textcolor{stringliteral}{"{}a global mesh\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02383}02383                    << \textcolor{stringliteral}{"{}from the sub-\/meshes.\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02384}02384 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02385}02385       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02386}02386         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02387}02387     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02388}02388 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02389}02389 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02390}02390     out}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02391}02391       << \textcolor{stringliteral}{"{}Although this program will describe the degrees of freedom in the \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02392}02392       << \textcolor{stringliteral}{"{}problem, it will do so using the typedef for the elements. This is \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02393}02393       << \textcolor{stringliteral}{"{}not neccesarily human readable, but there is a solution.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02394}02394       << \textcolor{stringliteral}{"{}Pipe your program's output through c++filt, with the argument -\/t.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02395}02395       << \textcolor{stringliteral}{"{}e.g. \(\backslash\)"{}./two\_d\_multi\_poisson | c++filt -\/t > ReadableOutput.txt\(\backslash\)"{}.\(\backslash\)n "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02396}02396       << \textcolor{stringliteral}{"{}(Disregarding the quotes)\(\backslash\)n\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02397}02397 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02398}02398     out << \textcolor{stringliteral}{"{}Classifying Global Equation Numbers"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02399}02399     out << \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}}(80, \textcolor{charliteral}{'-\/'}) << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02400}02400 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02401}02401     \textcolor{comment}{// Number of submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02402}02402     \textcolor{keywordtype}{unsigned} n\_sub\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_ab65f6fc9c49860e6324457a7e6e76346}{Sub\_mesh\_pt}}.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02403}02403 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02404}02404     \textcolor{comment}{// Classify Global dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02405}02405     \textcolor{keywordtype}{unsigned} Nglobal\_data = \mbox{\hyperlink{classoomph_1_1Problem_a60a9b6861928cf9115110b5bfc7d11a7}{nglobal\_data}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02406}02406     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < Nglobal\_data; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02407}02407     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02408}02408       std::stringstream conversion;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02409}02409       conversion << \textcolor{stringliteral}{"{} in Global Data "{}} << \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} << \textcolor{stringliteral}{"{}."{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02410}02410       \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} in(conversion.str());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02411}02411       \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]-\/>describe\_dofs(out, in);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02412}02412     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02413}02413 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02414}02414     \textcolor{comment}{// Put string in limiting scope.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02415}02415     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02416}02416       \textcolor{comment}{// Descend into assignment for mesh.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02417}02417       \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} in(\textcolor{stringliteral}{"{} in Problem's Only Mesh."{}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02418}02418       \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a86d000c45f6d29fa215b98051cc2d23f}{describe\_dofs}}(out, in);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02419}02419     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02420}02420 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02421}02421     \textcolor{comment}{// Deal with the spine meshes additional numbering:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02422}02422     \textcolor{comment}{// If there is only one mesh:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02423}02423     \textcolor{keywordflow}{if} (n\_sub\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02424}02424     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02425}02425       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1SpineMesh}{SpineMesh}}* \textcolor{keyword}{const} spine\_mesh\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SpineMesh}{SpineMesh}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02426}02426       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02427}02427         \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} in(\textcolor{stringliteral}{"{} in Problem's Only SpineMesh."{}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02428}02428         spine\_mesh\_pt-\/>describe\_spine\_dofs(out, in);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02429}02429       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02430}02430     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02431}02431     \textcolor{comment}{// Otherwise loop over the sub meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02432}02432     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02433}02433     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02434}02434       \textcolor{comment}{// Assign global equation numbers first}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02435}02435       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_sub\_mesh; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02436}02436       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02437}02437         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1SpineMesh}{SpineMesh}}* \textcolor{keyword}{const} spine\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02438}02438               \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SpineMesh}{SpineMesh}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ab65f6fc9c49860e6324457a7e6e76346}{Sub\_mesh\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02439}02439         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02440}02440           std::stringstream conversion;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02441}02441           conversion << \textcolor{stringliteral}{"{} in Sub-\/SpineMesh "{}} << \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} << \textcolor{stringliteral}{"{}."{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02442}02442           \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} in(conversion.str());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02443}02443           spine\_mesh\_pt-\/>describe\_spine\_dofs(out, in);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02444}02444         \} \textcolor{comment}{// end if.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02445}02445       \} \textcolor{comment}{// end for.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02446}02446     \} \textcolor{comment}{// end else.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02447}02447 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02448}02448 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02449}02449     out << \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}}(80, \textcolor{charliteral}{'\(\backslash\)\(\backslash\)'}) << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02450}02450     out << \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}}(80, \textcolor{charliteral}{'\(\backslash\)\(\backslash\)'}) << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02451}02451     out << \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}}(80, \textcolor{charliteral}{'\(\backslash\)\(\backslash\)'}) << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02452}02452     out << \textcolor{stringliteral}{"{}Classifying global eqn numbers in terms of elements."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02453}02453     out << \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}}(80, \textcolor{charliteral}{'-\/'}) << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02454}02454     out << \textcolor{stringliteral}{"{}Eqns   | Source"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02455}02455     out << \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}}(80, \textcolor{charliteral}{'-\/'}) << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02456}02456 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02457}02457     \textcolor{keywordflow}{if} (n\_sub\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02458}02458     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02459}02459       \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} in(\textcolor{stringliteral}{"{} in Problem's Only Mesh."{}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02460}02460       \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a57d57b7b6d7a32fadafb03e7055c5ad4}{describe\_local\_dofs}}(out, in);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02461}02461     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02462}02462     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02463}02463     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02464}02464       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_sub\_mesh; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02465}02465       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02466}02466         std::stringstream conversion;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02467}02467         conversion << \textcolor{stringliteral}{"{} in Sub-\/Mesh "{}} << \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} << \textcolor{stringliteral}{"{}."{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02468}02468         \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} in(conversion.str());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02469}02469         \mbox{\hyperlink{classoomph_1_1Problem_ab65f6fc9c49860e6324457a7e6e76346}{Sub\_mesh\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]-\/>describe\_local\_dofs(out, in);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02470}02470       \} \textcolor{comment}{// End for}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02471}02471     \} \textcolor{comment}{// End else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02472}02472   \} \textcolor{comment}{// End problem::describe\_dofs(...)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02473}02473 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02474}02474 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02475}02475   \textcolor{comment}{//================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02476}02476 \textcolor{comment}{  /// Get the vector of dofs, i.e. a vector containing the current}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02477}02477 \textcolor{comment}{  /// values of all unknowns.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02478}02478 \textcolor{comment}{}  \textcolor{comment}{//================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02479}\mbox{\hyperlink{classoomph_1_1Problem_ae2ef66732d76053dba15001818c0605c}{02479}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ae2ef66732d76053dba15001818c0605c}{Problem::get\_dofs}}(\mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& dofs)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02480}02480 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02481}02481     \textcolor{comment}{// Find number of dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02482}02482     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_dof = \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02483}02483 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02484}02484     \textcolor{comment}{// Resize the vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02485}02485     dofs.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}, 0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02486}02486 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02487}02487     \textcolor{comment}{// Copy dofs into vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02488}02488     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} l = 0; l < n\_dof; l++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02489}02489     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02490}02490       dofs[l] = *\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[l];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02491}02491     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02492}02492   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02493}02493 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02494}02494 \textcolor{comment}{  /// Get history values of dofs in a double vector.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02495}\mbox{\hyperlink{classoomph_1_1Problem_abb56c404b0dd6df75bcadab797d9a24e}{02495}} \textcolor{comment}{}  \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ae2ef66732d76053dba15001818c0605c}{Problem::get\_dofs}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& dofs)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02496}02496 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02497}02497 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02498}02498     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_af5e9f1623cad361048856a4c0463ea23}{distributed}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02499}02499     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02500}02500       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Not designed for distributed problems"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02501}02501                           OOMPH\_EXCEPTION\_LOCATION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02502}02502                           OOMPH\_CURRENT\_FUNCTION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02503}02503       \textcolor{comment}{// might work, not sure}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02504}02504     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02505}02505 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02506}02506 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02507}02507     \textcolor{comment}{// Resize the vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02508}02508     dofs.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}, 0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02509}02509 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02510}02510     \textcolor{comment}{// First deal with global data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02511}02511     \textcolor{keywordtype}{unsigned} Nglobal\_data = \mbox{\hyperlink{classoomph_1_1Problem_a60a9b6861928cf9115110b5bfc7d11a7}{nglobal\_data}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02512}02512     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < Nglobal\_data; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02513}02513     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02514}02514       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0, nj = \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]-\/>nvalue(); j < nj; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02515}02515       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02516}02516         \textcolor{comment}{// For each data get the equation number and copy out the value.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02517}02517         \textcolor{keywordtype}{int} eqn\_number = \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]-\/>eqn\_number(j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02518}02518         \textcolor{keywordflow}{if} (eqn\_number >= 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02519}02519         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02520}02520           dofs[eqn\_number] = \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]-\/>value(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02521}02521         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02522}02522       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02523}02523     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02524}02524 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02525}02525     \textcolor{comment}{// Next element internal data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02526}02526     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0, ni = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>nelement(); \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < ni; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02527}02527     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02528}02528       \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* ele\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02529}02529       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0, nj = ele\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a6b736de0af4c92831968636479b3480e}{ninternal\_data}}(); j < nj; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02530}02530       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02531}02531         \mbox{\hyperlink{classoomph_1_1Data}{Data}}* d\_pt = ele\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a3b83389f2c80788013421c6d59604f0b}{internal\_data\_pt}}(j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02532}02532         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0, nk = d\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7e67fc78a2e8a2fd6eb75bd292d42ff8}{nvalue}}(); k < nk; k++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02533}02533         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02534}02534           \textcolor{keywordtype}{int} eqn\_number = d\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_ab6845db69833c541766d9a073b023fc4}{eqn\_number}}(k);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02535}02535           \textcolor{keywordflow}{if} (eqn\_number >= 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02536}02536           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02537}02537             dofs[eqn\_number] = d\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a9383101536882db34e618cbe30dba2da}{value}}(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, k);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02538}02538           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02539}02539         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02540}02540       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02541}02541     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02542}02542 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02543}02543     \textcolor{comment}{// Now the nodes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02544}02544     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0, ni = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>nnode(); \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < ni; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02545}02545     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02546}02546       \mbox{\hyperlink{classoomph_1_1Node}{Node}}* node\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02547}02547       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0, nj = node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7e67fc78a2e8a2fd6eb75bd292d42ff8}{nvalue}}(); j < nj; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02548}02548       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02549}02549         \textcolor{comment}{// For each node get the equation number and copy out the value.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02550}02550         \textcolor{keywordtype}{int} eqn\_number = node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_ab6845db69833c541766d9a073b023fc4}{eqn\_number}}(j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02551}02551         \textcolor{keywordflow}{if} (eqn\_number >= 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02552}02552         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02553}02553           dofs[eqn\_number] = node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_afcc5cdba40bca251826ae5bee5ca15b4}{value}}(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02554}02554         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02555}02555       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02556}02556     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02557}02557   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02558}02558 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02559}02559 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02560}02560 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02561}02561 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02562}02562   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02563}02563 \textcolor{comment}{  /// Private helper function to remove repeated data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02564}02564 \textcolor{comment}{  /// in external haloed elements associated with specified mesh.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02565}02565 \textcolor{comment}{  /// Bool is true if some data was removed -\/-\/ this usually requires}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02566}02566 \textcolor{comment}{  /// re-\/running through certain parts of the equation numbering procedure.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02567}02567 \textcolor{comment}{}  \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02568}\mbox{\hyperlink{classoomph_1_1Problem_a088570d2600c2e710da2717e9ed35404}{02568}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a088570d2600c2e710da2717e9ed35404}{Problem::remove\_duplicate\_data}}(\mbox{\hyperlink{classoomph_1_1Mesh}{Mesh}}* \textcolor{keyword}{const}\& mesh\_pt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02569}02569                                       \textcolor{keywordtype}{bool}\& actually\_removed\_some\_data)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02570}02570   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02571}02571     \textcolor{comment}{//    //   // Taken out again by MH -\/-\/ clutters up output}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02572}02572     \textcolor{comment}{//    // Doc timings if required}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02573}02573     \textcolor{comment}{//    double t\_start=0.0;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02574}02574     \textcolor{comment}{//    if (Global\_timings::Doc\_comprehensive\_timings)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02575}02575     \textcolor{comment}{//     \{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02576}02576     \textcolor{comment}{//      t\_start=TimingHelpers::timer();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02577}02577     \textcolor{comment}{//     \}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02578}02578 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02579}02579     \textcolor{keywordtype}{int} n\_proc = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02580}02580     \textcolor{keywordtype}{int} my\_rank = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02581}02581 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02582}02582     \textcolor{comment}{// Initialise}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02583}02583     actually\_removed\_some\_data = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02584}02584 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02585}02585     \textcolor{comment}{// Each individual container of external halo nodes has unique}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02586}02586     \textcolor{comment}{// nodes/equation numbers, but there may be some duplication between}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02587}02587     \textcolor{comment}{// two or more different containers; the following code checks for this}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02588}02588     \textcolor{comment}{// and removes the duplication by overwriting any data point with an already}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02589}02589     \textcolor{comment}{// existing eqn number with the original data point which had the eqn no.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02590}02590 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02591}02591     \textcolor{comment}{// // Storage for existing nodes, enumerated by first non-\/negative}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02592}02592     \textcolor{comment}{// // global equation number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02593}02593     \textcolor{comment}{// unsigned n\_dof=ndof();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02594}02594 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02595}02595     \textcolor{comment}{// Note: This used to be}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02596}02596     \textcolor{comment}{// Vector<Node*> global\_node\_pt(n\_dof,0);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02597}02597     \textcolor{comment}{// but this is a total killer! Memory allocation is extremely}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02598}02598     \textcolor{comment}{// costly and only relatively few entries are used so use}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02599}02599     \textcolor{comment}{// map:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02600}02600     std::map<unsigned, Node*> global\_node\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02601}02601 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02602}02602     \textcolor{comment}{// Only do each retained node once}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02603}02603     std::map<Node*, bool> node\_done;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02604}02604 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02605}02605     \textcolor{comment}{// Loop over existing "{}normal"{} elements in mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02606}02606     \textcolor{keywordtype}{unsigned} n\_element = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02607}02607     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02608}02608     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02609}02609       \mbox{\hyperlink{classoomph_1_1FiniteElement}{FiniteElement}}* el\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02610}02610         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1FiniteElement}{FiniteElement}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02611}02611       \textcolor{keywordflow}{if} (el\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02612}02612       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02613}02613         \textcolor{comment}{// Loop over nodes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02614}02614         \textcolor{keywordtype}{unsigned} n\_node = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a6219ed269a6d89b5aa14659cce48905a}{nnode}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02615}02615         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_node; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02616}02616         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02617}02617           \mbox{\hyperlink{classoomph_1_1Node}{Node}}* nod\_pt = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02618}02618 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02619}02619           \textcolor{comment}{// Have we already done the node?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02620}02620           \textcolor{keywordflow}{if} (!node\_done[nod\_pt])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02621}02621           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02622}02622             node\_done[nod\_pt] = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02623}02623 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02624}02624             \textcolor{comment}{// Loop over values stored at node (if any) to find}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02625}02625             \textcolor{comment}{// the first non-\/negative eqn number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02626}02626             \textcolor{keywordtype}{unsigned} first\_non\_negative\_eqn\_number\_plus\_one = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02627}02627             \textcolor{keywordtype}{unsigned} n\_val = nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7e67fc78a2e8a2fd6eb75bd292d42ff8}{nvalue}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02628}02628             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_val = 0; i\_val < n\_val; i\_val++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02629}02629             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02630}02630               \textcolor{keywordtype}{int} eqn\_no = nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_ab6845db69833c541766d9a073b023fc4}{eqn\_number}}(i\_val);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02631}02631               \textcolor{keywordflow}{if} (eqn\_no >= 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02632}02632               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02633}02633                 first\_non\_negative\_eqn\_number\_plus\_one = eqn\_no + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02634}02634                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02635}02635               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02636}02636             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02637}02637 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02638}02638             \textcolor{comment}{// If we haven't found a non-\/negative eqn number check}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02639}02639             \textcolor{comment}{// eqn numbers associated with solid data (if any)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02640}02640             \textcolor{keywordflow}{if} (first\_non\_negative\_eqn\_number\_plus\_one == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02641}02641             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02642}02642               \textcolor{comment}{// Is it a solid node?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02643}02643               \mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}* solid\_nod\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}*\textcolor{keyword}{>}(nod\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02644}02644               \textcolor{keywordflow}{if} (solid\_nod\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02645}02645               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02646}02646                 \textcolor{comment}{// Loop over values stored at node (if any) to find}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02647}02647                 \textcolor{comment}{// the first non-\/negative eqn number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02648}02648                 \textcolor{keywordtype}{unsigned} n\_val = solid\_nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidNode_a22078726936f5bf3cf9e4328b3852a4a}{variable\_position\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Data_a7e67fc78a2e8a2fd6eb75bd292d42ff8}{nvalue}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02649}02649                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_val = 0; i\_val < n\_val; i\_val++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02650}02650                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02651}02651                   \textcolor{keywordtype}{int} eqn\_no =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02652}02652                     solid\_nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidNode_a22078726936f5bf3cf9e4328b3852a4a}{variable\_position\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Data_ab6845db69833c541766d9a073b023fc4}{eqn\_number}}(i\_val);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02653}02653                   \textcolor{keywordflow}{if} (eqn\_no >= 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02654}02654                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02655}02655                     first\_non\_negative\_eqn\_number\_plus\_one = eqn\_no + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02656}02656                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02657}02657                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02658}02658                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02659}02659               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02660}02660             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02661}02661 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02662}02662             \textcolor{comment}{// Associate node with first non negative global eqn number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02663}02663             \textcolor{keywordflow}{if} (first\_non\_negative\_eqn\_number\_plus\_one > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02664}02664             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02665}02665               global\_node\_pt[first\_non\_negative\_eqn\_number\_plus\_one -\/ 1] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02666}02666                 nod\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02667}02667             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02668}02668 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02669}02669 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02670}02670             \textcolor{comment}{// Take into account master nodes too}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02671}02671             \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(el\_pt) != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02672}02672             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02673}02673               \textcolor{keywordtype}{int} n\_cont\_int\_values = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(el\_pt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02674}02674                                         -\/>ncont\_interpolated\_values();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02675}02675               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i\_cont = -\/1; i\_cont < n\_cont\_int\_values; i\_cont++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02676}02676               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02677}02677                 \textcolor{keywordflow}{if} (nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_af0e6237dfafad62cf427ff5013ddcfef}{is\_hanging}}(i\_cont))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02678}02678                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02679}02679                   \mbox{\hyperlink{classoomph_1_1HangInfo}{HangInfo}}* hang\_pt = nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_afefa22db8b28e783b8647e3577ee01d9}{hanging\_pt}}(i\_cont);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02680}02680                   \textcolor{keywordtype}{unsigned} n\_master = hang\_pt-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_aa9c1130b58db2ff6d5eee4f923ba365c}{nmaster}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02681}02681                   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_master; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02682}02682                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02683}02683                     \mbox{\hyperlink{classoomph_1_1Node}{Node}}* master\_nod\_pt = hang\_pt-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_a7a935ae7eeca594a648ca1800444827c}{master\_node\_pt}}(m);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02684}02684                     \textcolor{keywordflow}{if} (!node\_done[master\_nod\_pt])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02685}02685                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02686}02686                       node\_done[master\_nod\_pt] = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02687}02687 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02688}02688                       \textcolor{comment}{// Loop over values stored at node (if any) to find}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02689}02689                       \textcolor{comment}{// the first non-\/negative eqn number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02690}02690                       \textcolor{keywordtype}{unsigned} first\_non\_negative\_eqn\_number\_plus\_one = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02691}02691                       \textcolor{keywordtype}{unsigned} n\_val = master\_nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7e67fc78a2e8a2fd6eb75bd292d42ff8}{nvalue}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02692}02692                       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_val = 0; i\_val < n\_val; i\_val++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02693}02693                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02694}02694                         \textcolor{keywordtype}{int} eqn\_no = master\_nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_ab6845db69833c541766d9a073b023fc4}{eqn\_number}}(i\_val);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02695}02695                         \textcolor{keywordflow}{if} (eqn\_no >= 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02696}02696                         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02697}02697                           first\_non\_negative\_eqn\_number\_plus\_one = eqn\_no + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02698}02698                           \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02699}02699                         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02700}02700                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02701}02701 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02702}02702                       \textcolor{comment}{// If we haven't found a non-\/negative eqn number check}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02703}02703                       \textcolor{comment}{// eqn numbers associated with solid data (if any)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02704}02704                       \textcolor{keywordflow}{if} (first\_non\_negative\_eqn\_number\_plus\_one == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02705}02705                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02706}02706                         \textcolor{comment}{// If this master is a SolidNode then add its extra}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02707}02707                         \textcolor{comment}{// eqn numbers}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02708}02708                         \mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}* master\_solid\_nod\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02709}02709                           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}*\textcolor{keyword}{>}(master\_nod\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02710}02710                         \textcolor{keywordflow}{if} (master\_solid\_nod\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02711}02711                         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02712}02712                           \textcolor{comment}{// Loop over values stored at node (if any) to find}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02713}02713                           \textcolor{comment}{// the first non-\/negative eqn number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02714}02714                           \textcolor{keywordtype}{unsigned} n\_val =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02715}02715                             master\_solid\_nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidNode_a22078726936f5bf3cf9e4328b3852a4a}{variable\_position\_pt}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02716}02716                               -\/>\mbox{\hyperlink{classoomph_1_1Data_a7e67fc78a2e8a2fd6eb75bd292d42ff8}{nvalue}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02717}02717                           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_val = 0; i\_val < n\_val; i\_val++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02718}02718                           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02719}02719                             \textcolor{keywordtype}{int} eqn\_no =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02720}02720                               master\_solid\_nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidNode_a22078726936f5bf3cf9e4328b3852a4a}{variable\_position\_pt}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02721}02721                                 -\/>\mbox{\hyperlink{classoomph_1_1Data_ab6845db69833c541766d9a073b023fc4}{eqn\_number}}(i\_val);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02722}02722                             \textcolor{keywordflow}{if} (eqn\_no >= 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02723}02723                             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02724}02724                               first\_non\_negative\_eqn\_number\_plus\_one =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02725}02725                                 eqn\_no + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02726}02726                               \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02727}02727                             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02728}02728                           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02729}02729                         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02730}02730                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02731}02731                       \textcolor{comment}{// Associate node with first non negative global}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02732}02732                       \textcolor{comment}{// eqn number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02733}02733                       \textcolor{keywordflow}{if} (first\_non\_negative\_eqn\_number\_plus\_one > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02734}02734                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02735}02735                         global\_node\_pt[first\_non\_negative\_eqn\_number\_plus\_one -\/}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02736}02736                                        1] = master\_nod\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02737}02737                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02738}02738 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02739}02739                     \} \textcolor{comment}{// End of not-\/yet-\/done hang node}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02740}02740                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02741}02741                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02742}02742               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02743}02743             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02744}02744           \} \textcolor{comment}{// endif for node already done}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02745}02745         \} \textcolor{comment}{// End of loop over nodes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02746}02746       \} \textcolor{comment}{// End of FiniteElement}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02747}02747 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02748}02748       \textcolor{comment}{// Internal data equation numbers do not need to be added since}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02749}02749       \textcolor{comment}{// internal data cannot be shared between distinct elements, so}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02750}02750       \textcolor{comment}{// internal data on locally-\/stored elements can never be halo.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02751}02751     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02752}02752 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02753}02753     \textcolor{comment}{// Set to record duplicate nodes scheduled to be killed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02754}02754     std::set<Node*> killed\_nodes;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02755}02755 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02756}02756     \textcolor{comment}{// Now loop over the other processors from highest to lowest}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02757}02757     \textcolor{comment}{// (i.e. if there is a duplicate between these containers}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02758}02758     \textcolor{comment}{//  then this will use the node on the highest numbered processor)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02759}02759     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} iproc = n\_proc -\/ 1; iproc >= 0; iproc-\/-\/)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02760}02760     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02761}02761       \textcolor{comment}{// Don't have external halo elements with yourself!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02762}02762       \textcolor{keywordflow}{if} (iproc != my\_rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02763}02763       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02764}02764         \textcolor{comment}{// Loop over external halo elements with iproc}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02765}02765         \textcolor{comment}{// to remove the duplicates}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02766}02766         \textcolor{keywordtype}{unsigned} n\_element = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af7554deb7f9854272d849a6482a57d60}{nexternal\_halo\_element}}(iproc);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02767}02767         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} e\_ext = 0; e\_ext < n\_element; e\_ext++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02768}02768         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02769}02769           \mbox{\hyperlink{classoomph_1_1FiniteElement}{FiniteElement}}* finite\_ext\_el\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1FiniteElement}{FiniteElement}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02770}02770             \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1f889ef9305db5f812f93931877839d2}{external\_halo\_element\_pt}}(iproc, e\_ext));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02771}02771           \textcolor{keywordflow}{if} (finite\_ext\_el\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02772}02772           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02773}02773             \textcolor{comment}{// Loop over nodes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02774}02774             \textcolor{keywordtype}{unsigned} n\_node = finite\_ext\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a6219ed269a6d89b5aa14659cce48905a}{nnode}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02775}02775             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_node; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02776}02776             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02777}02777               \mbox{\hyperlink{classoomph_1_1Node}{Node}}* nod\_pt = finite\_ext\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02778}02778 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02779}02779               \textcolor{comment}{// Loop over values stored at node (if any) to find}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02780}02780               \textcolor{comment}{// the first non-\/negative eqn number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02781}02781               \textcolor{keywordtype}{unsigned} first\_non\_negative\_eqn\_number\_plus\_one = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02782}02782               \textcolor{keywordtype}{unsigned} n\_val = nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7e67fc78a2e8a2fd6eb75bd292d42ff8}{nvalue}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02783}02783               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_val = 0; i\_val < n\_val; i\_val++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02784}02784               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02785}02785                 \textcolor{keywordtype}{int} eqn\_no = nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_ab6845db69833c541766d9a073b023fc4}{eqn\_number}}(i\_val);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02786}02786                 \textcolor{keywordflow}{if} (eqn\_no >= 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02787}02787                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02788}02788                   first\_non\_negative\_eqn\_number\_plus\_one = eqn\_no + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02789}02789                   \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02790}02790                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02791}02791               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02792}02792 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02793}02793               \textcolor{comment}{// If we haven't found a non-\/negative eqn number check}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02794}02794               \textcolor{comment}{// eqn numbers associated with solid data (if any)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02795}02795               \textcolor{keywordflow}{if} (first\_non\_negative\_eqn\_number\_plus\_one == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02796}02796               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02797}02797                 \textcolor{comment}{// Is it a solid node?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02798}02798                 \mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}* solid\_nod\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}*\textcolor{keyword}{>}(nod\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02799}02799                 \textcolor{keywordflow}{if} (solid\_nod\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02800}02800                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02801}02801                   \textcolor{comment}{// Loop over values stored at node (if any) to find}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02802}02802                   \textcolor{comment}{// the first non-\/negative eqn number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02803}02803                   \textcolor{keywordtype}{unsigned} n\_val =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02804}02804                     solid\_nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidNode_a22078726936f5bf3cf9e4328b3852a4a}{variable\_position\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Data_a7e67fc78a2e8a2fd6eb75bd292d42ff8}{nvalue}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02805}02805                   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_val = 0; i\_val < n\_val; i\_val++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02806}02806                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02807}02807                     \textcolor{keywordtype}{int} eqn\_no =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02808}02808                       solid\_nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidNode_a22078726936f5bf3cf9e4328b3852a4a}{variable\_position\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Data_ab6845db69833c541766d9a073b023fc4}{eqn\_number}}(i\_val);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02809}02809                     \textcolor{keywordflow}{if} (eqn\_no >= 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02810}02810                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02811}02811                       first\_non\_negative\_eqn\_number\_plus\_one = eqn\_no + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02812}02812                       \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02813}02813                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02814}02814                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02815}02815                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02816}02816               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02817}02817 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02818}02818               \textcolor{comment}{// Identified which node we're dealing with via first non-\/negative}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02819}02819               \textcolor{comment}{// global eqn number (if there is none, everything is pinned}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02820}02820               \textcolor{comment}{// and we don't give a damn...)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02821}02821               \textcolor{keywordflow}{if} (first\_non\_negative\_eqn\_number\_plus\_one > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02822}02822               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02823}02823                 \mbox{\hyperlink{classoomph_1_1Node}{Node}}* existing\_node\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02824}02824                   global\_node\_pt[first\_non\_negative\_eqn\_number\_plus\_one -\/ 1];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02825}02825 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02826}02826                 \textcolor{comment}{// Does this node already exist?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02827}02827                 \textcolor{keywordflow}{if} (existing\_node\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02828}02828                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02829}02829                   \textcolor{comment}{// Record that we're about to cull one}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02830}02830                   actually\_removed\_some\_data = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02831}02831 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02832}02832                   \textcolor{comment}{// It's a duplicate, so store the duplicated one for}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02833}02833                   \textcolor{comment}{// later killing...}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02834}02834                   \mbox{\hyperlink{classoomph_1_1Node}{Node}}* duplicated\_node\_pt = nod\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02835}02835                   \textcolor{keywordflow}{if} (!node\_done[duplicated\_node\_pt])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02836}02836                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02837}02837                     \textcolor{comment}{// Remove node from all boundaries}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02838}02838                     std::set<unsigned>* boundaries\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02839}02839                     duplicated\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_a33092a3d51285282ae8ec8e702d1cbf5}{get\_boundaries\_pt}}(boundaries\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02840}02840                     \textcolor{keywordflow}{if} (boundaries\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02841}02841                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02842}02842                       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} bound;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02843}02843                       \textcolor{keywordtype}{unsigned} nb = (*boundaries\_pt).size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02844}02844                       bound.reserve(nb);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02845}02845                       \textcolor{keywordflow}{for} (std::set<unsigned>::iterator it =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02846}02846                              (*boundaries\_pt).begin();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02847}02847                            it != (*boundaries\_pt).end();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02848}02848                            it++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02849}02849                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02850}02850                         bound.push\_back((*it));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02851}02851                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02852}02852                       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nb; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02853}02853                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02854}02854                         \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1690e5351ff05b5e47db184f64b1edc4}{remove\_boundary\_node}}(bound[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02855}02855                                                       duplicated\_node\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02856}02856                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02857}02857                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02858}02858 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02859}02859                     \textcolor{comment}{// Get ready to kill it}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02860}02860                     killed\_nodes.insert(duplicated\_node\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02861}02861                     \textcolor{keywordtype}{unsigned} i\_proc = unsigned(iproc);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02862}02862                     \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ae44a2c10b99136ec7ff3b31e67745d72}{null\_external\_halo\_node}}(i\_proc,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02863}02863                                                      duplicated\_node\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02864}02864                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02865}02865 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02866}02866 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02867}02867                   \textcolor{comment}{// Note: For now we're leaving the "{}dangling"{} (no longer}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02868}02868                   \textcolor{comment}{// accessed masters where they are; they get cleaned}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02869}02869                   \textcolor{comment}{// up next time we delete all the external storage}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02870}02870                   \textcolor{comment}{// for the meshes so it's a temporary "{}leak"{} only...}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02871}02871                   \textcolor{comment}{// At some point we should probably delete them properly too}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02872}02872 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02873}02873 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02874}02874 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02875}02875                   \textcolor{comment}{// Check that hang status of exiting and replacement node}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02876}02876                   \textcolor{comment}{// matches}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02877}02877                   \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(finite\_ext\_el\_pt) != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02878}02878                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02879}02879                     \textcolor{keywordtype}{int} n\_cont\_inter\_values =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02880}02880                       \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(finite\_ext\_el\_pt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02881}02881                         -\/>ncont\_interpolated\_values();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02882}02882                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i\_cont = -\/1; i\_cont < n\_cont\_inter\_values;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02883}02883                          i\_cont++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02884}02884                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02885}02885                       \textcolor{keywordtype}{unsigned} n\_master\_orig = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02886}02886                       \textcolor{keywordflow}{if} (finite\_ext\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(j)-\/>\mbox{\hyperlink{classoomph_1_1Node_af0e6237dfafad62cf427ff5013ddcfef}{is\_hanging}}(i\_cont))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02887}02887                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02888}02888                         n\_master\_orig = finite\_ext\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(j)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02889}02889                                           -\/>\mbox{\hyperlink{classoomph_1_1Node_afefa22db8b28e783b8647e3577ee01d9}{hanging\_pt}}(i\_cont)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02890}02890                                           -\/>\mbox{\hyperlink{classoomph_1_1HangInfo_aa9c1130b58db2ff6d5eee4f923ba365c}{nmaster}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02891}02891 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02892}02892                         \textcolor{comment}{// Temporary leak: Resolve like this:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02893}02893                         \textcolor{comment}{// loop over all external halo nodes and identify the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02894}02894                         \textcolor{comment}{// the ones that are still reached by any of the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02895}02895                         \textcolor{comment}{// external elements. Kill the dangling ones.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02896}02896                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02897}02897                       \textcolor{keywordtype}{unsigned} n\_master\_replace = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02898}02898                       \textcolor{keywordflow}{if} (existing\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_af0e6237dfafad62cf427ff5013ddcfef}{is\_hanging}}(i\_cont))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02899}02899                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02900}02900                         n\_master\_replace =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02901}02901                           existing\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_afefa22db8b28e783b8647e3577ee01d9}{hanging\_pt}}(i\_cont)-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_aa9c1130b58db2ff6d5eee4f923ba365c}{nmaster}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02902}02902                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02903}02903 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02904}02904                       \textcolor{keywordflow}{if} (n\_master\_orig != n\_master\_replace)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02905}02905                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02906}02906                         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02907}02907                         error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02908}02908                           << \textcolor{stringliteral}{"{}Number of master nodes for node to be replaced, "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02909}02909                           << n\_master\_orig << \textcolor{stringliteral}{"{}, doesn't match"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02910}02910                           << \textcolor{stringliteral}{"{}those of replacement node, "{}} << n\_master\_replace}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02911}02911                           << \textcolor{stringliteral}{"{} for i\_cont="{}} << i\_cont << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02912}02912                         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02913}02913                           error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02914}02914                             << \textcolor{stringliteral}{"{}Nodal coordinates of replacement node:"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02915}02915                           \textcolor{keywordtype}{unsigned} ndim = existing\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_a786c96a8e46eb27a03b2b31f629d41b3}{ndim}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02916}02916                           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < ndim; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02917}02917                           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02918}02918                             error\_stream << existing\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_ab76b4773a65b349f143539e07b6e15e2}{x}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) << \textcolor{stringliteral}{"{} "{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02919}02919                           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02920}02920                           error\_stream << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02921}02921                           error\_stream << \textcolor{stringliteral}{"{}The coordinates of its "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02922}02922                                        << n\_master\_replace}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02923}02923                                        << \textcolor{stringliteral}{"{} master nodes are: \(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02924}02924                           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k < n\_master\_replace; k++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02925}02925                           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02926}02926                             \mbox{\hyperlink{classoomph_1_1Node}{Node}}* master\_nod\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02927}02927                               existing\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_afefa22db8b28e783b8647e3577ee01d9}{hanging\_pt}}(i\_cont)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02928}02928                                 -\/>\mbox{\hyperlink{classoomph_1_1HangInfo_a7a935ae7eeca594a648ca1800444827c}{master\_node\_pt}}(k);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02929}02929                             \textcolor{keywordtype}{unsigned} ndim = master\_nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_a786c96a8e46eb27a03b2b31f629d41b3}{ndim}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02930}02930                             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < ndim; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02931}02931                             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02932}02932                               error\_stream << master\_nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_ab76b4773a65b349f143539e07b6e15e2}{x}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) << \textcolor{stringliteral}{"{} "{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02933}02933                             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02934}02934                             error\_stream << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02935}02935                           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02936}02936                         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02937}02937 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02938}02938                         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02939}02939                           error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02940}02940                             << \textcolor{stringliteral}{"{}Nodal coordinates of node to be replaced:"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02941}02941                           \textcolor{keywordtype}{unsigned} ndim = finite\_ext\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(j)-\/>\mbox{\hyperlink{classoomph_1_1Node_a786c96a8e46eb27a03b2b31f629d41b3}{ndim}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02942}02942                           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < ndim; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02943}02943                           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02944}02944                             error\_stream << finite\_ext\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(j)-\/>\mbox{\hyperlink{classoomph_1_1Node_ab76b4773a65b349f143539e07b6e15e2}{x}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02945}02945                                          << \textcolor{stringliteral}{"{} "{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02946}02946                           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02947}02947                           error\_stream << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02948}02948                           error\_stream << \textcolor{stringliteral}{"{}The coordinates of its "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02949}02949                                        << n\_master\_orig}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02950}02950                                        << \textcolor{stringliteral}{"{} master nodes are: \(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02951}02951                           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k < n\_master\_orig; k++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02952}02952                           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02953}02953                             \mbox{\hyperlink{classoomph_1_1Node}{Node}}* master\_nod\_pt = finite\_ext\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(j)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02954}02954                                                     -\/>\mbox{\hyperlink{classoomph_1_1Node_afefa22db8b28e783b8647e3577ee01d9}{hanging\_pt}}(i\_cont)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02955}02955                                                     -\/>\mbox{\hyperlink{classoomph_1_1HangInfo_a7a935ae7eeca594a648ca1800444827c}{master\_node\_pt}}(k);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02956}02956                             \textcolor{keywordtype}{unsigned} ndim = master\_nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_a786c96a8e46eb27a03b2b31f629d41b3}{ndim}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02957}02957                             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < ndim; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02958}02958                             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02959}02959                               error\_stream << master\_nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_ab76b4773a65b349f143539e07b6e15e2}{x}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) << \textcolor{stringliteral}{"{} "{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02960}02960                             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02961}02961                             error\_stream << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02962}02962                           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02963}02963                         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02964}02964 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02965}02965 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02966}02966                         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02967}02967                                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02968}02968                                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02969}02969                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02970}02970                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02971}02971                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02972}02972 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02973}02973                   \textcolor{comment}{// ...and point to the existing one}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02974}02974                   finite\_ext\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(j) = existing\_node\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02975}02975                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02976}02976                 \textcolor{comment}{// If it doesn't add it to the list of existing ones}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02977}02977                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02978}02978                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02979}02979                   global\_node\_pt[first\_non\_negative\_eqn\_number\_plus\_one -\/ 1] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02980}02980                     nod\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02981}02981                   node\_done[nod\_pt] = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02982}02982                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02983}02983               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02984}02984 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02985}02985 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02986}02986               \textcolor{comment}{// Do the same for any master nodes of that (possibly replaced)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02987}02987               \textcolor{comment}{// node}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02988}02988               \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(finite\_ext\_el\_pt) != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02989}02989               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02990}02990                 \textcolor{keywordtype}{int} n\_cont\_inter\_values =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02991}02991                   \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(finite\_ext\_el\_pt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02992}02992                     -\/>ncont\_interpolated\_values();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02993}02993                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i\_cont = -\/1; i\_cont < n\_cont\_inter\_values; i\_cont++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02994}02994                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02995}02995                   \textcolor{keywordflow}{if} (finite\_ext\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(j)-\/>\mbox{\hyperlink{classoomph_1_1Node_af0e6237dfafad62cf427ff5013ddcfef}{is\_hanging}}(i\_cont))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02996}02996                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02997}02997                     \mbox{\hyperlink{classoomph_1_1HangInfo}{HangInfo}}* hang\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02998}02998                       finite\_ext\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(j)-\/>\mbox{\hyperlink{classoomph_1_1Node_afefa22db8b28e783b8647e3577ee01d9}{hanging\_pt}}(i\_cont);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l02999}02999                     \textcolor{keywordtype}{unsigned} n\_master = hang\_pt-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_aa9c1130b58db2ff6d5eee4f923ba365c}{nmaster}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03000}03000                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_master; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03001}03001                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03002}03002                       \mbox{\hyperlink{classoomph_1_1Node}{Node}}* master\_nod\_pt = hang\_pt-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_a7a935ae7eeca594a648ca1800444827c}{master\_node\_pt}}(m);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03003}03003                       \textcolor{keywordtype}{unsigned} n\_val = master\_nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7e67fc78a2e8a2fd6eb75bd292d42ff8}{nvalue}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03004}03004                       \textcolor{keywordtype}{unsigned} first\_non\_negative\_eqn\_number\_plus\_one = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03005}03005                       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_val = 0; i\_val < n\_val; i\_val++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03006}03006                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03007}03007                         \textcolor{keywordtype}{int} eqn\_no = master\_nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_ab6845db69833c541766d9a073b023fc4}{eqn\_number}}(i\_val);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03008}03008                         \textcolor{keywordflow}{if} (eqn\_no >= 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03009}03009                         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03010}03010                           first\_non\_negative\_eqn\_number\_plus\_one = eqn\_no + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03011}03011                           \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03012}03012                         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03013}03013                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03014}03014 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03015}03015                       \textcolor{comment}{// If we haven't found a non-\/negative eqn number check}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03016}03016                       \textcolor{comment}{// eqn numbers associated with solid data (if any)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03017}03017                       \textcolor{keywordflow}{if} (first\_non\_negative\_eqn\_number\_plus\_one == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03018}03018                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03019}03019                         \mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}* solid\_master\_nod\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03020}03020                           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}*\textcolor{keyword}{>}(master\_nod\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03021}03021                         \textcolor{keywordflow}{if} (solid\_master\_nod\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03022}03022                         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03023}03023                           \textcolor{comment}{// Loop over values stored at node (if any) to find}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03024}03024                           \textcolor{comment}{// the first non-\/negative eqn number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03025}03025                           \textcolor{keywordtype}{unsigned} n\_val =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03026}03026                             solid\_master\_nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidNode_a22078726936f5bf3cf9e4328b3852a4a}{variable\_position\_pt}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03027}03027                               -\/>\mbox{\hyperlink{classoomph_1_1Data_a7e67fc78a2e8a2fd6eb75bd292d42ff8}{nvalue}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03028}03028                           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_val = 0; i\_val < n\_val; i\_val++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03029}03029                           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03030}03030                             \textcolor{keywordtype}{int} eqn\_no =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03031}03031                               solid\_master\_nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidNode_a22078726936f5bf3cf9e4328b3852a4a}{variable\_position\_pt}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03032}03032                                 -\/>\mbox{\hyperlink{classoomph_1_1Data_ab6845db69833c541766d9a073b023fc4}{eqn\_number}}(i\_val);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03033}03033                             \textcolor{keywordflow}{if} (eqn\_no >= 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03034}03034                             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03035}03035                               first\_non\_negative\_eqn\_number\_plus\_one =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03036}03036                                 eqn\_no + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03037}03037                               \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03038}03038                             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03039}03039                           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03040}03040                         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03041}03041                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03042}03042 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03043}03043                       \textcolor{comment}{// Identified which node we're dealing with via}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03044}03044                       \textcolor{comment}{// first non-\/negative global eqn number (if there}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03045}03045                       \textcolor{comment}{// is none, everything is pinned and we don't give a}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03046}03046                       \textcolor{comment}{// damn...)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03047}03047                       \textcolor{keywordflow}{if} (first\_non\_negative\_eqn\_number\_plus\_one > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03048}03048                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03049}03049                         \mbox{\hyperlink{classoomph_1_1Node}{Node}}* existing\_node\_pt = global\_node\_pt}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03050}03050                           [first\_non\_negative\_eqn\_number\_plus\_one -\/ 1];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03051}03051 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03052}03052                         \textcolor{comment}{// Does this node already exist?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03053}03053                         \textcolor{keywordflow}{if} (existing\_node\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03054}03054                         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03055}03055                           \textcolor{comment}{// Record that we're about to cull one}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03056}03056                           actually\_removed\_some\_data = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03057}03057 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03058}03058                           \textcolor{comment}{// It's a duplicate, so store the duplicated one for}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03059}03059                           \textcolor{comment}{// later killing...}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03060}03060                           \mbox{\hyperlink{classoomph_1_1Node}{Node}}* duplicated\_node\_pt = master\_nod\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03061}03061 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03062}03062                           \textcolor{keywordflow}{if} (!node\_done[duplicated\_node\_pt])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03063}03063                           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03064}03064                             \textcolor{comment}{// Remove node from all boundaries}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03065}03065                             std::set<unsigned>* boundaries\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03066}03066                             duplicated\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_a33092a3d51285282ae8ec8e702d1cbf5}{get\_boundaries\_pt}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03067}03067                               boundaries\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03068}03068                             \textcolor{keywordflow}{if} (boundaries\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03069}03069                             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03070}03070                               \textcolor{keywordflow}{for} (std::set<unsigned>::iterator it =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03071}03071                                      (*boundaries\_pt).begin();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03072}03072                                    it != (*boundaries\_pt).end();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03073}03073                                    it++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03074}03074                               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03075}03075                                 \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1690e5351ff05b5e47db184f64b1edc4}{remove\_boundary\_node}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03076}03076                                   (*it), duplicated\_node\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03077}03077                               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03078}03078                             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03079}03079 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03080}03080                             killed\_nodes.insert(duplicated\_node\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03081}03081                             \textcolor{keywordtype}{unsigned} i\_proc = unsigned(iproc);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03082}03082                             \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ae44a2c10b99136ec7ff3b31e67745d72}{null\_external\_halo\_node}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03083}03083                               i\_proc, duplicated\_node\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03084}03084                           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03085}03085 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03086}03086                           \textcolor{comment}{// Weight of the original node}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03087}03087                           \textcolor{keywordtype}{double} m\_weight = hang\_pt-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_ac49ebdd8957a658fe4a2420108d2dcee}{master\_weight}}(m);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03088}03088 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03089}03089 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03090}03090 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03091}03091                           \textcolor{comment}{// Sanity check: setting replacement master}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03092}03092                           \textcolor{comment}{// node for non-\/hanging node? Sign of really}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03093}03093                           \textcolor{comment}{// f***ed up code.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03094}03094                           \mbox{\hyperlink{classoomph_1_1Node}{Node}}* tmp\_nod\_pt = finite\_ext\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03095}03095                           \textcolor{keywordflow}{if} (!tmp\_nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_af0e6237dfafad62cf427ff5013ddcfef}{is\_hanging}}(i\_cont))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03096}03096                           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03097}03097                             std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03098}03098                             error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03099}03099                               << \textcolor{stringliteral}{"{}About to re-\/set master for i\_cont= "{}} << i\_cont}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03100}03100                               << \textcolor{stringliteral}{"{} for external node (with proc "{}} << iproc}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03101}03101                               << \textcolor{stringliteral}{"{} )"{}} << tmp\_nod\_pt << \textcolor{stringliteral}{"{} at "{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03102}03102                             \textcolor{keywordtype}{unsigned} n = tmp\_nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_a786c96a8e46eb27a03b2b31f629d41b3}{ndim}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03103}03103                             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} jj = 0; jj < n; jj++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03104}03104                             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03105}03105                               error\_stream << tmp\_nod\_pt-\/>x(jj) << \textcolor{stringliteral}{"{} "{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03106}03106                             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03107}03107                             error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03108}03108                               << \textcolor{stringliteral}{"{} which is not hanging -\/-\/> About to die!"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03109}03109                               << \textcolor{stringliteral}{"{}Outputting offending element into oomph-\/info "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03110}03110                               << \textcolor{stringliteral}{"{}stream. \(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03111}03111                             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03112}03112                             finite\_ext\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a2ad98a3d2ef4999f1bef62c0ff13f2a7}{output}}(*(\mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}.\mbox{\hyperlink{classoomph_1_1OomphInfo_a353cd56d96da9152d6d730b328c07a06}{stream\_pt}}()));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03113}03113                             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03114}03114                             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}.\mbox{\hyperlink{classoomph_1_1OomphInfo_a353cd56d96da9152d6d730b328c07a06}{stream\_pt}}()-\/>flush();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03115}03115                             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03116}03116                                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03117}03117                                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03118}03118                           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03119}03119 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03120}03120 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03121}03121 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03122}03122                           \textcolor{comment}{// And re-\/set master}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03123}03123                           finite\_ext\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(j)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03124}03124                             -\/>\mbox{\hyperlink{classoomph_1_1Node_afefa22db8b28e783b8647e3577ee01d9}{hanging\_pt}}(i\_cont)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03125}03125                             -\/>\mbox{\hyperlink{classoomph_1_1HangInfo_afe4042d5805342d5e12b6a28e376885a}{set\_master\_node\_pt}}(m, existing\_node\_pt, m\_weight);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03126}03126                         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03127}03127                         \textcolor{comment}{// If it doesn't, add it to the list of existing ones}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03128}03128                         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03129}03129                         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03130}03130                           global\_node\_pt}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03131}03131                             [first\_non\_negative\_eqn\_number\_plus\_one -\/ 1] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03132}03132                               master\_nod\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03133}03133                           node\_done[master\_nod\_pt] = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03134}03134                         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03135}03135                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03136}03136                     \} \textcolor{comment}{// End of loop over master nodes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03137}03137                   \} \textcolor{comment}{// end of hanging}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03138}03138                 \} \textcolor{comment}{// end of loop over continously interpolated variables}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03139}03139               \} \textcolor{comment}{// end refineable element (with potentially hanging node}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03140}03140 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03141}03141             \} \textcolor{comment}{// end loop over nodes on external halo elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03142}03142 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03143}03143           \} \textcolor{comment}{// End of check for finite element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03144}03144 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03145}03145         \} \textcolor{comment}{// end loop over external halo elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03146}03146       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03147}03147     \} \textcolor{comment}{// end loop over processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03148}03148 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03149}03149 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03150}03150     \textcolor{comment}{// Now kill all the deleted nodes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03151}03151     \textcolor{keywordflow}{for} (std::set<Node*>::iterator it = killed\_nodes.begin();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03152}03152          it != killed\_nodes.end();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03153}03153          it++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03154}03154     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03155}03155       \textcolor{keyword}{delete} (*it);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03156}03156     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03157}03157 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03158}03158 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03159}03159     \textcolor{comment}{//   oomph\_info << "{}Number of nonzero entries in global\_node\_pt: "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03160}03160     \textcolor{comment}{//              << global\_node\_pt.size() << std::endl;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03161}03161 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03162}03162     \textcolor{comment}{//    // Time it...}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03163}03163     \textcolor{comment}{//    // Taken out again by MH -\/-\/ clutters up output}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03164}03164     \textcolor{comment}{//    if (Global\_timings::Doc\_comprehensive\_timings)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03165}03165     \textcolor{comment}{//     \{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03166}03166     \textcolor{comment}{//      double t\_end = TimingHelpers::timer();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03167}03167     \textcolor{comment}{//      oomph\_info}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03168}03168     \textcolor{comment}{//       << "{}Total time for Problem::remove\_duplicate\_data: "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03169}03169     \textcolor{comment}{//       << t\_end-\/t\_start << std::endl;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03170}03170     \textcolor{comment}{//     \}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03171}03171   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03172}03172 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03173}03173 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03174}03174   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03175}03175 \textcolor{comment}{  /// Consolidate external halo node storage by removing nulled out}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03176}03176 \textcolor{comment}{  /// pointers in external halo and haloed schemes for all meshes.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03177}03177 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03178}\mbox{\hyperlink{classoomph_1_1Problem_aee39a957d45bc474c1f5b27d96c9dcc0}{03178}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_aee39a957d45bc474c1f5b27d96c9dcc0}{Problem::remove\_null\_pointers\_from\_external\_halo\_node\_storage}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03179}03179   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03180}03180     \textcolor{comment}{// Do we have submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03181}03181     \textcolor{keywordtype}{unsigned} n\_mesh\_loop = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03182}03182     \textcolor{keywordtype}{unsigned} nmesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03183}03183     \textcolor{keywordflow}{if} (nmesh > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03184}03184     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03185}03185       n\_mesh\_loop = nmesh;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03186}03186     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03187}03187 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03188}03188     \textcolor{comment}{// Storage for number of processors and current processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03189}03189     \textcolor{keywordtype}{int} n\_proc = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03190}03190     \textcolor{keywordtype}{int} my\_rank = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03191}03191 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03192}03192     \textcolor{comment}{// If only one processor then return}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03193}03193     \textcolor{keywordflow}{if} (n\_proc == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03194}03194     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03195}03195       \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03196}03196     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03197}03197 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03198}03198     \textcolor{comment}{// Loop over all (other) processors and store index of any nulled-\/out}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03199}03199     \textcolor{comment}{// external halo nodes in storage scheme.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03200}03200 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03201}03201     \textcolor{comment}{// Data to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03202}03202     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} send\_n(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03203}03203 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03204}03204     \textcolor{comment}{// Storage for all values to be sent to all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03205}03205     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} send\_data;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03206}03206 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03207}03207     \textcolor{comment}{// Start location within send\_data for data to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03208}03208     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} send\_displacement(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03209}03209 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03210}03210     \textcolor{comment}{// Check missing ones}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03211}03211     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} domain = 0; domain < n\_proc; domain++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03212}03212     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03213}03213       \textcolor{comment}{// Set the offset for the current processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03214}03214       send\_displacement[domain] = send\_data.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03215}03215 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03216}03216       \textcolor{comment}{// Don't bother to do anything if the processor in the loop is the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03217}03217       \textcolor{comment}{// current processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03218}03218       \textcolor{keywordflow}{if} (domain != my\_rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03219}03219       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03220}03220         \textcolor{comment}{// Deal with sub-\/meshes one-\/by-\/one if required}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03221}03221         \mbox{\hyperlink{classoomph_1_1Mesh}{Mesh}}* my\_mesh\_pt = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03222}03222 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03223}03223         \textcolor{comment}{// Loop over submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03224}03224         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imesh = 0; imesh < n\_mesh\_loop; imesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03225}03225         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03226}03226           \textcolor{keywordflow}{if} (nmesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03227}03227           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03228}03228             my\_mesh\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03229}03229           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03230}03230           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03231}03231           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03232}03232             my\_mesh\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03233}03233           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03234}03234 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03235}03235           \textcolor{comment}{// Make backup of external halo node pointers with this domain}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03236}03236           \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Node*>}} backup\_pt(my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1f88352a0bf5be7d15858915097c1e70}{external\_halo\_node\_pt}}(domain));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03237}03237 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03238}03238           \textcolor{comment}{// How many do we have currently?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03239}03239           \textcolor{keywordtype}{unsigned} nnod = backup\_pt.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03240}03240 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03241}03241           \textcolor{comment}{// Prepare storage for updated halo nodes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03242}03242           \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Node*>}} new\_external\_halo\_node\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03243}03243           new\_external\_halo\_node\_pt.reserve(nnod);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03244}03244 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03245}03245           \textcolor{comment}{// Loop over external halo nodes with this domain}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03246}03246           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < nnod; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03247}03247           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03248}03248             \textcolor{comment}{// Get pointer to node}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03249}03249             \mbox{\hyperlink{classoomph_1_1Node}{Node}}* nod\_pt = backup\_pt[j];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03250}03250 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03251}03251             \textcolor{comment}{// Has it been nulled out?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03252}03252             \textcolor{keywordflow}{if} (nod\_pt == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03253}03253             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03254}03254               \textcolor{comment}{// Save index of nulled out one}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03255}03255               send\_data.push\_back(j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03256}03256             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03257}03257             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03258}03258             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03259}03259               \textcolor{comment}{// Still alive: Copy across}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03260}03260               new\_external\_halo\_node\_pt.push\_back(nod\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03261}03261             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03262}03262           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03263}03263 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03264}03264           \textcolor{comment}{// Set new external halo node vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03265}03265           my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a00e8bdf6233681039aaecd63dfa4c30a}{set\_external\_halo\_node\_pt}}(domain,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03266}03266                                                 new\_external\_halo\_node\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03267}03267 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03268}03268           \textcolor{comment}{// End of data for this mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03269}03269           send\_data.push\_back(-\/1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03270}03270 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03271}03271         \} \textcolor{comment}{// end of loop over meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03272}03272 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03273}03273       \} \textcolor{comment}{// end skip own domain}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03274}03274 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03275}03275       \textcolor{comment}{// Find the number of data added to the vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03276}03276       send\_n[domain] = send\_data.size() -\/ send\_displacement[domain];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03277}03277     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03278}03278 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03279}03279     \textcolor{comment}{// Storage for the number of data to be received from each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03280}03280     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} receive\_n(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03281}03281 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03282}03282     \textcolor{comment}{// Now send numbers of data to be sent between all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03283}03283     MPI\_Alltoall(\&send\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03284}03284                  1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03285}03285                  MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03286}03286                  \&receive\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03287}03287                  1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03288}03288                  MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03289}03289                  this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03290}03290 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03291}03291 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03292}03292     \textcolor{comment}{// We now prepare the data to be received}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03293}03293     \textcolor{comment}{// by working out the displacements from the received data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03294}03294     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} receive\_displacement(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03295}03295     \textcolor{keywordtype}{int} receive\_data\_count = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03296}03296     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} rank = 0; rank < n\_proc; ++rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03297}03297     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03298}03298       \textcolor{comment}{// Displacement is number of data received so far}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03299}03299       receive\_displacement[rank] = receive\_data\_count;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03300}03300       receive\_data\_count += receive\_n[rank];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03301}03301     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03302}03302 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03303}03303     \textcolor{comment}{// Now resize the receive buffer for all data from all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03304}03304     \textcolor{comment}{// Make sure that it has a size of at least one}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03305}03305     \textcolor{keywordflow}{if} (receive\_data\_count == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03306}03306     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03307}03307       ++receive\_data\_count;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03308}03308     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03309}03309     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} receive\_data(receive\_data\_count);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03310}03310 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03311}03311     \textcolor{comment}{// Make sure that the send buffer has size at least one}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03312}03312     \textcolor{comment}{// so that we don't get a segmentation fault}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03313}03313     \textcolor{keywordflow}{if} (send\_data.size() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03314}03314     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03315}03315       send\_data.resize(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03316}03316     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03317}03317 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03318}03318     \textcolor{comment}{// Now send the data between all the processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03319}03319     MPI\_Alltoallv(\&send\_data[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03320}03320                   \&send\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03321}03321                   \&send\_displacement[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03322}03322                   MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03323}03323                   \&receive\_data[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03324}03324                   \&receive\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03325}03325                   \&receive\_displacement[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03326}03326                   MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03327}03327                   this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03328}03328 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03329}03329     \textcolor{comment}{// Now use the received data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03330}03330     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} send\_rank = 0; send\_rank < n\_proc; send\_rank++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03331}03331     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03332}03332       \textcolor{comment}{// Don't bother to do anything for the processor corresponding to the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03333}03333       \textcolor{comment}{// current processor or if no data were received from this processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03334}03334       \textcolor{keywordflow}{if} ((send\_rank != my\_rank) \&\& (receive\_n[send\_rank] != 0))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03335}03335       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03336}03336         \textcolor{comment}{// Counter for the data within the large array}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03337}03337         \textcolor{keywordtype}{unsigned} count = receive\_displacement[send\_rank];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03338}03338 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03339}03339         \textcolor{comment}{// Deal with sub-\/meshes one-\/by-\/one if required}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03340}03340         \mbox{\hyperlink{classoomph_1_1Mesh}{Mesh}}* my\_mesh\_pt = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03341}03341 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03342}03342         \textcolor{comment}{// Loop over submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03343}03343         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imesh = 0; imesh < n\_mesh\_loop; imesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03344}03344         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03345}03345           \textcolor{keywordflow}{if} (nmesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03346}03346           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03347}03347             my\_mesh\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03348}03348           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03349}03349           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03350}03350           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03351}03351             my\_mesh\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03352}03352           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03353}03353 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03354}03354           \textcolor{comment}{// Make backup of external haloed node pointers with this domain}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03355}03355           \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Node*>}} backup\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03356}03356             my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9f6a99d3f3b01dc1b48247285f50e14d}{external\_haloed\_node\_pt}}(send\_rank);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03357}03357 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03358}03358           \textcolor{comment}{// Unpack until we reach "{}end of data"{} indicator (-\/1) for this mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03359}03359           \textcolor{keywordflow}{while} (\textcolor{keyword}{true})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03360}03360           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03361}03361             \textcolor{comment}{// Read next entry}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03362}03362             \textcolor{keywordtype}{int} next\_one = receive\_data[count++];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03363}03363 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03364}03364             \textcolor{keywordflow}{if} (next\_one == -\/1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03365}03365             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03366}03366               \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03367}03367             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03368}03368             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03369}03369             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03370}03370               \textcolor{comment}{// Null out the entry}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03371}03371               backup\_pt[next\_one] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03372}03372             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03373}03373           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03374}03374 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03375}03375           \textcolor{comment}{// How many do we have currently?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03376}03376           \textcolor{keywordtype}{unsigned} nnod = backup\_pt.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03377}03377 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03378}03378           \textcolor{comment}{// Prepare storage for updated haloed nodes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03379}03379           \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Node*>}} new\_external\_haloed\_node\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03380}03380           new\_external\_haloed\_node\_pt.reserve(nnod);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03381}03381 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03382}03382           \textcolor{comment}{// Loop over external haloed nodes with this domain}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03383}03383           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < nnod; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03384}03384           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03385}03385             \textcolor{comment}{// Get pointer to node}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03386}03386             \mbox{\hyperlink{classoomph_1_1Node}{Node}}* nod\_pt = backup\_pt[j];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03387}03387 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03388}03388             \textcolor{comment}{// Has it been nulled out?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03389}03389             \textcolor{keywordflow}{if} (nod\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03390}03390             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03391}03391               \textcolor{comment}{// Still alive: Copy across}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03392}03392               new\_external\_haloed\_node\_pt.push\_back(nod\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03393}03393             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03394}03394           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03395}03395 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03396}03396           \textcolor{comment}{// Set new external haloed node vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03397}03397           my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a7422e9f12bbdcdce7f0193c057a5eb27}{set\_external\_haloed\_node\_pt}}(send\_rank,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03398}03398                                                   new\_external\_haloed\_node\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03399}03399         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03400}03400       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03401}03401 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03402}03402     \} \textcolor{comment}{// End of data is received}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03403}03403   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03404}03404 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03405}03405 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03406}03406 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03407}03407 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03408}03408   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03409}03409 \textcolor{comment}{  /// Function that sets the values of the dofs in the object}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03410}03410 \textcolor{comment}{}  \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03411}\mbox{\hyperlink{classoomph_1_1Problem_ab51480d18550c107c9f13629102f6b08}{03411}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ab51480d18550c107c9f13629102f6b08}{Problem::set\_dofs}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& dofs)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03412}03412   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03413}03413     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_dof = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03414}03414 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03415}03415     \textcolor{keywordflow}{if} (n\_dof != dofs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03416}03416     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03417}03417       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03418}03418       error\_stream << \textcolor{stringliteral}{"{}Number of degrees of freedom in vector argument "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03419}03419                    << dofs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}() << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03420}03420                    << \textcolor{stringliteral}{"{}does not equal number of degrees of freedom in problem "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03421}03421                    << n\_dof;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03422}03422       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03423}03423         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03424}03424     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03425}03425 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03426}03426     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} l = 0; l < n\_dof; l++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03427}03427     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03428}03428       *\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[l] = dofs[l];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03429}03429     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03430}03430   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03431}03431 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03432}03432 \textcolor{comment}{  /// Set history values of dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03433}\mbox{\hyperlink{classoomph_1_1Problem_a62d7dbbf49388e6383e3b93e50351e89}{03433}} \textcolor{comment}{}  \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ab51480d18550c107c9f13629102f6b08}{Problem::set\_dofs}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& dofs)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03434}03434   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03435}03435 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03436}03436     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_af5e9f1623cad361048856a4c0463ea23}{distributed}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03437}03437     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03438}03438       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Not designed for distributed problems"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03439}03439                           OOMPH\_EXCEPTION\_LOCATION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03440}03440                           OOMPH\_CURRENT\_FUNCTION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03441}03441       \textcolor{comment}{// might work if the dofs vector is distributed in the right way...}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03442}03442     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03443}03443 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03444}03444 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03445}03445     \textcolor{comment}{// First deal with global data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03446}03446     \textcolor{keywordtype}{unsigned} Nglobal\_data = \mbox{\hyperlink{classoomph_1_1Problem_a60a9b6861928cf9115110b5bfc7d11a7}{nglobal\_data}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03447}03447     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < Nglobal\_data; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03448}03448     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03449}03449       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0, nj = \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]-\/>nvalue(); j < nj; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03450}03450       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03451}03451         \textcolor{comment}{// For each data get the equation number and copy out the value.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03452}03452         \textcolor{keywordtype}{int} eqn\_number = \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]-\/>eqn\_number(j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03453}03453         \textcolor{keywordflow}{if} (eqn\_number >= 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03454}03454         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03455}03455           \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]-\/>set\_value(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, j, dofs[eqn\_number]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03456}03456         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03457}03457       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03458}03458     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03459}03459 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03460}03460     \textcolor{comment}{// Next element internal data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03461}03461     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0, ni = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>nelement(); \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < ni; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03462}03462     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03463}03463       \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* ele\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03464}03464       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0, nj = ele\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a6b736de0af4c92831968636479b3480e}{ninternal\_data}}(); j < nj; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03465}03465       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03466}03466         \mbox{\hyperlink{classoomph_1_1Data}{Data}}* d\_pt = ele\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a3b83389f2c80788013421c6d59604f0b}{internal\_data\_pt}}(j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03467}03467         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0, nk = d\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7e67fc78a2e8a2fd6eb75bd292d42ff8}{nvalue}}(); k < nk; k++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03468}03468         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03469}03469           \textcolor{keywordtype}{int} eqn\_number = d\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_ab6845db69833c541766d9a073b023fc4}{eqn\_number}}(k);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03470}03470           \textcolor{keywordflow}{if} (eqn\_number >= 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03471}03471           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03472}03472             d\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7289ca322725c6fd493970a19474b382}{set\_value}}(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, k, dofs[eqn\_number]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03473}03473           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03474}03474         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03475}03475       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03476}03476     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03477}03477 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03478}03478     \textcolor{comment}{// Now the nodes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03479}03479     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0, ni = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>nnode(); \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < ni; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03480}03480     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03481}03481       \mbox{\hyperlink{classoomph_1_1Node}{Node}}* node\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03482}03482       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0, nj = node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7e67fc78a2e8a2fd6eb75bd292d42ff8}{nvalue}}(); j < nj; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03483}03483       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03484}03484         \textcolor{comment}{// For each node get the equation number and copy out the value.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03485}03485         \textcolor{keywordtype}{int} eqn\_number = node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_ab6845db69833c541766d9a073b023fc4}{eqn\_number}}(j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03486}03486         \textcolor{keywordflow}{if} (eqn\_number >= 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03487}03487         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03488}03488           node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7289ca322725c6fd493970a19474b382}{set\_value}}(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, j, dofs[eqn\_number]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03489}03489         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03490}03490       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03491}03491     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03492}03492   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03493}03493 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03494}03494 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03495}03495 \textcolor{comment}{  /// Set history values of dofs from the type of vector stored in}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03496}03496 \textcolor{comment}{  /// problem::Dof\_pt.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03497}\mbox{\hyperlink{classoomph_1_1Problem_a4b01ea8bfa914f1c9f40f9a2a7aa8ad5}{03497}} \textcolor{comment}{}  \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ab51480d18550c107c9f13629102f6b08}{Problem::set\_dofs}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}}\& dof\_pt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03498}03498   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03499}03499 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03500}03500     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_af5e9f1623cad361048856a4c0463ea23}{distributed}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03501}03501     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03502}03502       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Not implemented for distributed problems!"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03503}03503                           OOMPH\_EXCEPTION\_LOCATION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03504}03504                           OOMPH\_CURRENT\_FUNCTION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03505}03505     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03506}03506 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03507}03507 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03508}03508     \textcolor{comment}{// If we have any spine meshes I think there might be more degrees}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03509}03509     \textcolor{comment}{// of freedom there. I don't use them though so I'll let someone who}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03510}03510     \textcolor{comment}{// knows what they are doing handle it. -\/-\/David Shepherd}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03511}03511 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03512}03512     \textcolor{comment}{// First deal with global data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03513}03513     \textcolor{keywordtype}{unsigned} Nglobal\_data = \mbox{\hyperlink{classoomph_1_1Problem_a60a9b6861928cf9115110b5bfc7d11a7}{nglobal\_data}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03514}03514     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < Nglobal\_data; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03515}03515     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03516}03516       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0, nj = \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]-\/>nvalue(); j < nj; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03517}03517       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03518}03518         \textcolor{comment}{// For each data get the equation number and copy in the value.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03519}03519         \textcolor{keywordtype}{int} eqn\_number = \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]-\/>eqn\_number(j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03520}03520         \textcolor{keywordflow}{if} (eqn\_number >= 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03521}03521         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03522}03522           \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]-\/>set\_value(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, j, *(\mbox{\hyperlink{classoomph_1_1Problem_a8f48134fe83371d3cc3605772e76d043}{dof\_pt}}[eqn\_number]));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03523}03523         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03524}03524       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03525}03525     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03526}03526 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03527}03527     \textcolor{comment}{// Now the mesh data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03528}03528     \textcolor{comment}{// nodes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03529}03529     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0, ni = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>nnode(); \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < ni; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03530}03530     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03531}03531       \mbox{\hyperlink{classoomph_1_1Node}{Node}}* node\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03532}03532       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0, nj = node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7e67fc78a2e8a2fd6eb75bd292d42ff8}{nvalue}}(); j < nj; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03533}03533       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03534}03534         \textcolor{comment}{// For each node get the equation number and copy in the value.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03535}03535         \textcolor{keywordtype}{int} eqn\_number = node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_ab6845db69833c541766d9a073b023fc4}{eqn\_number}}(j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03536}03536         \textcolor{keywordflow}{if} (eqn\_number >= 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03537}03537         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03538}03538           node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7289ca322725c6fd493970a19474b382}{set\_value}}(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, j, *(\mbox{\hyperlink{classoomph_1_1Problem_a8f48134fe83371d3cc3605772e76d043}{dof\_pt}}[eqn\_number]));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03539}03539         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03540}03540       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03541}03541     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03542}03542 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03543}03543     \textcolor{comment}{// and non-\/nodal data inside elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03544}03544     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0, ni = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>nelement(); \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < ni; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03545}03545     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03546}03546       \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* ele\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03547}03547       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0, nj = ele\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a6b736de0af4c92831968636479b3480e}{ninternal\_data}}(); j < nj; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03548}03548       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03549}03549         \mbox{\hyperlink{classoomph_1_1Data}{Data}}* data\_pt = ele\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a3b83389f2c80788013421c6d59604f0b}{internal\_data\_pt}}(j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03550}03550         \textcolor{comment}{// For each node get the equation number and copy in the value.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03551}03551         \textcolor{keywordtype}{int} eqn\_number = data\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_ab6845db69833c541766d9a073b023fc4}{eqn\_number}}(j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03552}03552         \textcolor{keywordflow}{if} (eqn\_number >= 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03553}03553         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03554}03554           data\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7289ca322725c6fd493970a19474b382}{set\_value}}(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, j, *(\mbox{\hyperlink{classoomph_1_1Problem_a8f48134fe83371d3cc3605772e76d043}{dof\_pt}}[eqn\_number]));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03555}03555         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03556}03556       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03557}03557     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03558}03558   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03559}03559 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03560}03560 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03561}03561   \textcolor{comment}{//===================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03562}03562 \textcolor{comment}{  /// Function that adds the values to the dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03563}03563 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03564}\mbox{\hyperlink{classoomph_1_1Problem_a352210408b3eed3e7a834b8b9a33a99a}{03564}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a352210408b3eed3e7a834b8b9a33a99a}{Problem::add\_to\_dofs}}(\textcolor{keyword}{const} \textcolor{keywordtype}{double}\& lambda,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03565}03565                             \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& increment\_dofs)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03566}03566   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03567}03567     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_dof = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03568}03568     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} l = 0; l < n\_dof; l++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03569}03569     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03570}03570       *\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[l] += lambda * increment\_dofs[l];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03571}03571     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03572}03572   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03573}03573 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03574}03574 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03575}03575   \textcolor{comment}{//=========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03576}03576 \textcolor{comment}{  /// Return the residual vector multiplied by the inverse mass matrix}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03577}03577 \textcolor{comment}{  /// Virtual so that it can be overloaded for mpi problems}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03578}03578 \textcolor{comment}{}  \textcolor{comment}{//=========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03579}\mbox{\hyperlink{classoomph_1_1Problem_a8d7cc317f4900e076dec400ce2493c19}{03579}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a8d7cc317f4900e076dec400ce2493c19}{Problem::get\_inverse\_mass\_matrix\_times\_residuals}}(\mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& Mres)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03580}03580   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03581}03581     \textcolor{comment}{// This function does not make sense for assembly handlers other than the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03582}03582     \textcolor{comment}{// default, so complain if we try to call it with another handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03583}03583 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03584}03584 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03585}03585     \textcolor{comment}{// If we are not the default, then complain}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03586}03586     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}() != \mbox{\hyperlink{classoomph_1_1Problem_ae0cebe288c8daddd9663bd10d8f1caa0}{Default\_assembly\_handler\_pt}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03587}03587     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03588}03588       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03589}03589       error\_stream << \textcolor{stringliteral}{"{}The function get\_inverse\_mass\_matrix\_times\_residuals() "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03590}03590                       \textcolor{stringliteral}{"{}can only be\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03591}03591                    << \textcolor{stringliteral}{"{}used with the default assembly handler\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03592}03592       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03593}03593         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03594}03594     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03595}03595 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03596}03596 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03597}03597     \textcolor{comment}{// Find the number of degrees of freedom in the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03598}03598     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_dof = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03599}03599 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03600}03600     \textcolor{comment}{// Resize the vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03601}03601     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} dist(this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), n\_dof, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03602}03602     Mres.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(\&dist, 0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03603}03603 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03604}03604     \textcolor{comment}{// If we have discontinuous formulation}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03605}03605     \textcolor{comment}{// We can invert the mass matrix element by element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03606}03606     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a97ca0078fff6adca318835c11503dc2d}{Discontinuous\_element\_formulation}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03607}03607     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03608}03608       \textcolor{comment}{// Loop over the elements and get their residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03609}03609       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_element = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{Problem::mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03610}03610       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} element\_Mres;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03611}03611       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03612}03612       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03613}03613         \textcolor{comment}{// Cache the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03614}03614         \mbox{\hyperlink{classoomph_1_1DGElement}{DGElement}}* \textcolor{keyword}{const} elem\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03615}03615           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DGElement}{DGElement}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{Problem::mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03616}03616 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03617}03617         \textcolor{comment}{// Find the elemental inverse mass matrix times residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03618}03618         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_el\_dofs = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03619}03619         elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1DGElement_ad2247a9d65eb229dbf30d709c7b28d6d}{get\_inverse\_mass\_matrix\_times\_residuals}}(element\_Mres);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03620}03620 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03621}03621         \textcolor{comment}{// Add contribution to global matrix}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03622}03622         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_el\_dofs; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03623}03623         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03624}03624           Mres[elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})] = element\_Mres[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03625}03625         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03626}03626       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03627}03627     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03628}03628     \textcolor{comment}{// Otherwise it's continous and we must invert the full}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03629}03629     \textcolor{comment}{// mass matrix via a global linear solve.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03630}03630     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03631}03631     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03632}03632       \textcolor{comment}{// Now do the linear solve -\/-\/ recycling Mass matrix if requested}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03633}03633       \textcolor{comment}{// If we already have the factorised mass matrix, then resolve}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03634}03634       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_af4d25809ac090102a4d4a398e4ad0e26}{Mass\_matrix\_reuse\_is\_enabled}} \&\& \mbox{\hyperlink{classoomph_1_1Problem_a6067c6d344363a073fb8d02a99fb7ed0}{Mass\_matrix\_has\_been\_computed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03635}03635       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03636}03636         \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_ab4a3743c23a2d1eed56981484636c958}{Shut\_up\_in\_newton\_solve}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03637}03637         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03638}03638           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Not recomputing Mass Matrix "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03639}03639         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03640}03640 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03641}03641         \textcolor{comment}{// Get the residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03642}03642         \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} residuals(\&dist, 0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03643}03643         this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a7300386d91390e3e5be993aca7459498}{get\_residuals}}(residuals);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03644}03644 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03645}03645         \textcolor{comment}{// Resolve the linear system}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03646}03646         this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a9612322b1a2e4f297b450674ae7904d3}{mass\_matrix\_solver\_for\_explicit\_timestepper\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03647}03647           residuals, Mres);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03648}03648       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03649}03649       \textcolor{comment}{// Otherwise solve for the first time}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03650}03650       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03651}03651       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03652}03652         \textcolor{comment}{// If we wish to reuse the mass matrix, then enable resolve}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03653}03653         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_af4d25809ac090102a4d4a398e4ad0e26}{Mass\_matrix\_reuse\_is\_enabled}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03654}03654         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03655}03655           \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_ab4a3743c23a2d1eed56981484636c958}{Shut\_up\_in\_newton\_solve}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03656}03656           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03657}03657             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Enabling resolve in explicit timestep"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03658}03658           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03659}03659           this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a9612322b1a2e4f297b450674ae7904d3}{mass\_matrix\_solver\_for\_explicit\_timestepper\_pt}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03660}03660             -\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3000ebd9becb3468d8a6a821a9cc0cd9}{enable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03661}03661         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03662}03662 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03663}03663         \textcolor{comment}{// Use a custom assembly handler to assemble and invert the mass matrix}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03664}03664 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03665}03665         \textcolor{comment}{// Store the old assembly handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03666}03666         \mbox{\hyperlink{classoomph_1_1AssemblyHandler}{AssemblyHandler}}* old\_assembly\_handler\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03667}03667         \textcolor{comment}{// Set the assembly handler to the explicit timestep handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03668}03668         this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}() = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1ExplicitTimeStepHandler}{ExplicitTimeStepHandler}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03669}03669 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03670}03670         \textcolor{comment}{// Solve the linear system}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03671}03671         this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a9612322b1a2e4f297b450674ae7904d3}{mass\_matrix\_solver\_for\_explicit\_timestepper\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a15ce22542b74ed1826ea485edacbeb6e}{solve}}(\textcolor{keyword}{this},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03672}03672                                                                       Mres);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03673}03673         \textcolor{comment}{// The mass matrix has now been computed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03674}03674         \mbox{\hyperlink{classoomph_1_1Problem_a6067c6d344363a073fb8d02a99fb7ed0}{Mass\_matrix\_has\_been\_computed}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03675}03675 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03676}03676         \textcolor{comment}{// Delete the Explicit Timestep handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03677}03677         \textcolor{keyword}{delete} this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03678}03678         \textcolor{comment}{// Reset the assembly handler to the original handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03679}03679         this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}() = old\_assembly\_handler\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03680}03680       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03681}03681     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03682}03682   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03683}03683 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03684}\mbox{\hyperlink{classoomph_1_1Problem_a2d456362f4408556e879871ae34e57f1}{03684}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a2d456362f4408556e879871ae34e57f1}{Problem::get\_dvaluesdt}}(\mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& f)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03685}03685   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03686}03686     \textcolor{comment}{// Loop over timesteppers: make them (temporarily) steady and store their}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03687}03687     \textcolor{comment}{// is\_steady status.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03688}03688     \textcolor{keywordtype}{unsigned} n\_time\_steppers = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ace3cdf55009c3bff21d2b7d3706d522a}{ntime\_stepper}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03689}03689     std::vector<bool> was\_steady(n\_time\_steppers);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03690}03690     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_time\_steppers; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03691}03691     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03692}03692       was\_steady[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_ad341ba9e80265e1c26c1cda0f40c8292}{is\_steady}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03693}03693       \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_a81ea0ff2e66cef5e0184b616c608e418}{make\_steady}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03694}03694     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03695}03695 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03696}03696     \textcolor{comment}{// Calculate f using the residual/jacobian machinary.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03697}03697     \mbox{\hyperlink{classoomph_1_1Problem_a8d7cc317f4900e076dec400ce2493c19}{get\_inverse\_mass\_matrix\_times\_residuals}}(f);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03698}03698 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03699}03699     \textcolor{comment}{// Reset the is\_steady status of all timesteppers that weren't already}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03700}03700     \textcolor{comment}{// steady when we came in here and reset their weights}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03701}03701     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_time\_steppers; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03702}03702     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03703}03703       \textcolor{keywordflow}{if} (!was\_steady[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03704}03704       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03705}03705         \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_aada05f89e86aae352bd5b32bfb173b18}{undo\_make\_steady}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03706}03706       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03707}03707     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03708}03708   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03709}03709 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03710}03710 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03711}03711   \textcolor{comment}{//================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03712}03712 \textcolor{comment}{  /// Get the total residuals Vector for the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03713}03713 \textcolor{comment}{}  \textcolor{comment}{//================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03714}\mbox{\hyperlink{classoomph_1_1Problem_a7300386d91390e3e5be993aca7459498}{03714}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a7300386d91390e3e5be993aca7459498}{Problem::get\_residuals}}(\mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& residuals)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03715}03715   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03716}03716     \textcolor{comment}{// Three different cases; if MPI\_Helpers::MPI\_has\_been\_initialised=true}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03717}03717     \textcolor{comment}{// this means MPI\_Helpers::init() has been called.  This could happen on a}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03718}03718     \textcolor{comment}{// code compiled with MPI but run serially; in this instance the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03719}03719     \textcolor{comment}{// get\_residuals function still works on one processor.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03720}03720     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03721}03721     \textcolor{comment}{// Secondly, if a code has been compiled with MPI, but MPI\_Helpers::init()}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03722}03722     \textcolor{comment}{// has not been called, then MPI\_Helpers::MPI\_has\_been\_initialised=false}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03723}03723     \textcolor{comment}{// and the code calls...}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03724}03724     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03725}03725     \textcolor{comment}{// Thirdly, the serial version (compiled by all, but only run when compiled}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03726}03726     \textcolor{comment}{// with MPI if MPI\_Helpers::MPI\_has\_been\_initialised=false}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03727}03727 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03728}03728     \textcolor{comment}{// Check that the residuals has the correct number of rows if it has been}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03729}03729     \textcolor{comment}{// setup}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03730}03730 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03731}03731     \textcolor{keywordflow}{if} (residuals.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03732}03732     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03733}03733       \textcolor{keywordflow}{if} (residuals.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_aafad0b69de2284808366b65bd63e493b}{nrow}}() != this-\/>ndof())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03734}03734       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03735}03735         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03736}03736         error\_stream << \textcolor{stringliteral}{"{}The distribution of the residuals vector does not "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03737}03737                         \textcolor{stringliteral}{"{}have the correct\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03738}03738                      << \textcolor{stringliteral}{"{}number of global rows\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03739}03739 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03740}03740         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03741}03741           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03742}03742       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03743}03743     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03744}03744 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03745}03745 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03746}03746     \textcolor{comment}{// Find the number of rows}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03747}03747     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nrow = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03748}03748 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03749}03749     \textcolor{comment}{// Determine the distribution for the residuals vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03750}03750     \textcolor{comment}{// IF the vector has distribution setup then use that}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03751}03751     \textcolor{comment}{// ELSE determine the distribution based on the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03752}03752     \textcolor{comment}{// distributed\_matrix\_distribution enum}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03753}03753     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* dist\_pt = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03754}03754     \textcolor{keywordflow}{if} (residuals.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03755}03755     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03756}03756       dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(residuals.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03757}03757     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03758}03758     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03759}03759     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03760}03760 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03761}03761       \textcolor{comment}{// if problem is only one one processor assemble non-\/distributed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03762}03762       \textcolor{comment}{// distribution}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03763}03763       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>nproc() == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03764}03764       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03765}03765         dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}, nrow, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03766}03766       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03767}03767       \textcolor{comment}{// if the problem is not distributed then assemble the jacobian with}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03768}03768       \textcolor{comment}{// a uniform distributed distribution}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03769}03769       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03770}03770       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03771}03771         dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}, nrow, \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03772}03772       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03773}03773       \textcolor{comment}{// otherwise the problem is a distributed problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03774}03774       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03775}03775       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03776}03776         \textcolor{keywordflow}{switch} (\mbox{\hyperlink{classoomph_1_1Problem_a1da221c501adc7d58bd21f630207c6c3}{Dist\_problem\_matrix\_distribution}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03777}03777         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03778}03778           \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1Problem_a8fc1f40f2a9309e9ff02772fa2258402a741cb51275fde6a02373b2ffacf1273f}{Uniform\_matrix\_distribution}}:}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03779}03779             dist\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03780}03780               \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}, nrow, \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03781}03781             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03782}03782           \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1Problem_a8fc1f40f2a9309e9ff02772fa2258402aed8521359adcaf514039424b29893796}{Problem\_matrix\_distribution}}:}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03783}03783             dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03784}03784             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03785}03785           \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1Problem_a8fc1f40f2a9309e9ff02772fa2258402ad7503f3fef4bc3556497018171c820e6}{Default\_matrix\_distribution}}:}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03786}03786             \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* uniform\_dist\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03787}03787               \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}, nrow, \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03788}03788             \textcolor{keywordtype}{bool} use\_problem\_dist = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03789}03789             \textcolor{keywordtype}{unsigned} nproc = \mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>nproc();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03790}03790             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03791}03791             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03792}03792               \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{double})\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}(p) >}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03793}03793                   ((\textcolor{keywordtype}{double})uniform\_dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}(p)) * 1.1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03794}03794               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03795}03795                 use\_problem\_dist = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03796}03796               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03797}03797             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03798}03798             \textcolor{keywordflow}{if} (use\_problem\_dist)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03799}03799             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03800}03800               dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03801}03801             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03802}03802             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03803}03803             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03804}03804               dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(uniform\_dist\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03805}03805             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03806}03806             \textcolor{keyword}{delete} uniform\_dist\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03807}03807             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03808}03808         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03809}03809       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03810}03810 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03811}03811       dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}, nrow, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03812}03812 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03813}03813     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03814}03814 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03815}03815     \textcolor{comment}{// Locally cache pointer to assembly handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03816}03816     \mbox{\hyperlink{classoomph_1_1AssemblyHandler}{AssemblyHandler}}* \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}} = \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03817}03817 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03818}03818     \textcolor{comment}{// Build and zero the residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03819}03819     residuals.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(dist\_pt, 0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03820}03820 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03821}03821     \textcolor{comment}{// Serial (or one processor case)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03822}03822 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03823}03823     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>nproc() == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03824}03824     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03825}03825 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03826}03826       \textcolor{comment}{// Loop over all the elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03827}03827       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} Element\_pt\_range = \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03828}03828       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < Element\_pt\_range; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03829}03829       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03830}03830         \textcolor{comment}{// Get the pointer to the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03831}03831         \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03832}03832         \textcolor{comment}{// Find number of dofs in the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03833}03833         \textcolor{keywordtype}{unsigned} n\_element\_dofs = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a09213be8f4aa009e0366460a7ed78e68}{ndof}}(elem\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03834}03834         \textcolor{comment}{// Set up an array}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03835}03835         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} element\_residuals(n\_element\_dofs);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03836}03836         \textcolor{comment}{// Fill the array}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03837}03837         \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a7a6203b0ab90da62b4da2af8a26d08b3}{get\_residuals}}(elem\_pt, element\_residuals);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03838}03838         \textcolor{comment}{// Now loop over the dofs and assign values to global Vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03839}03839         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} l = 0; l < n\_element\_dofs; l++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03840}03840         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03841}03841           residuals[\mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, l)] +=}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03842}03842             element\_residuals[l];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03843}03843         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03844}03844       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03845}03845       \textcolor{comment}{// Otherwise parallel case}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03846}03846 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03847}03847     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03848}03848     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03849}03849     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03850}03850       \textcolor{comment}{// Store the current assembly handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03851}03851       \mbox{\hyperlink{classoomph_1_1AssemblyHandler}{AssemblyHandler}}* \textcolor{keyword}{const} old\_assembly\_handler\_pt = \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03852}03852       \textcolor{comment}{// Create a new assembly handler that only assembles the residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03853}03853       \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}} =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03854}03854         \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1ParallelResidualsHandler}{ParallelResidualsHandler}}(old\_assembly\_handler\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03855}03855 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03856}03856       \textcolor{comment}{// Setup memory for parallel sparse assemble}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03857}03857       \textcolor{comment}{// No matrix so all size zero}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03858}03858       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}} column\_index;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03859}03859       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}} row\_start;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03860}03860       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}} value;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03861}03861       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} nnz;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03862}03862       \textcolor{comment}{// One set of residuals of sizer one}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03863}03863       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}} res(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03864}03864 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03865}03865       \textcolor{comment}{// Call the parallel sparse assemble, that should only assemble residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03866}03866       \mbox{\hyperlink{classoomph_1_1Problem_a0487a7ef40e6cc4dad88e99ac96193e2}{parallel\_sparse\_assemble}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03867}03867         dist\_pt, column\_index, row\_start, value, nnz, res);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03868}03868       \textcolor{comment}{// Fill in the residuals data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03869}03869       residuals.\mbox{\hyperlink{classoomph_1_1DoubleVector_a4715c8cf47f9fc56d95889343d1a3b82}{set\_external\_values}}(res[0], \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03870}03870 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03871}03871       \textcolor{comment}{// Delete new assembly handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03872}03872       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03873}03873       \textcolor{comment}{// Reset the assembly handler to the original}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03874}03874       \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}} = old\_assembly\_handler\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03875}03875     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03876}03876 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03877}03877 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03878}03878     \textcolor{comment}{// Delete the distribution}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03879}03879     \textcolor{keyword}{delete} dist\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03880}03880   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03881}03881 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03882}03882   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03883}03883 \textcolor{comment}{  /// Get the fully assembled residual vector and Jacobian matrix}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03884}03884 \textcolor{comment}{  /// in dense storage. The DoubleVector residuals returned will be}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03885}03885 \textcolor{comment}{  /// non-\/distributed. If on calling this method the DoubleVector residuals is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03886}03886 \textcolor{comment}{  /// setup then it must be non-\/distributed and of the correct length.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03887}03887 \textcolor{comment}{  /// The matrix type DenseDoubleMatrix is not distributable and therefore}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03888}03888 \textcolor{comment}{  /// the residual vector is also assumed to be non distributable.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03889}03889 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03890}\mbox{\hyperlink{classoomph_1_1Problem_a4ba83bbea19db3a530539f3e9f88a7e4}{03890}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a4ba83bbea19db3a530539f3e9f88a7e4}{Problem::get\_jacobian}}(\mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& residuals,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03891}03891                              \mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix}{DenseDoubleMatrix}}\& jacobian)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03892}03892   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03893}03893     \textcolor{comment}{// get the number of degrees of freedom}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03894}03894     \textcolor{keywordtype}{unsigned} n\_dof = \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03895}03895 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03896}03896 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03897}03897     \textcolor{comment}{// PARANOID checks : if the distribution of residuals is setup then it must}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03898}03898     \textcolor{comment}{// must not be distributed, have the right number of rows, and the same}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03899}03899     \textcolor{comment}{// communicator as the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03900}03900     \textcolor{keywordflow}{if} (residuals.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03901}03901     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03902}03902       \textcolor{keywordflow}{if} (residuals.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a05842d032d28880ae37951deae804ad8}{distributed}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03903}03903       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03904}03904         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03905}03905         error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03906}03906           << \textcolor{stringliteral}{"{}If the DoubleVector residuals is setup then it must not "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03907}03907           << \textcolor{stringliteral}{"{}be distributed."{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03908}03908         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03909}03909           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03910}03910       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03911}03911       \textcolor{keywordflow}{if} (residuals.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_aafad0b69de2284808366b65bd63e493b}{nrow}}() != n\_dof)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03912}03912       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03913}03913         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03914}03914         error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03915}03915           << \textcolor{stringliteral}{"{}If the DoubleVector residuals is setup then it must have"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03916}03916           << \textcolor{stringliteral}{"{} the correct number of rows"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03917}03917         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03918}03918           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03919}03919       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03920}03920       \textcolor{keywordflow}{if} (!(*\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}} ==}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03921}03921             *residuals.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2760847d45ab334f6d902efc2620b615}{communicator\_pt}}()))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03922}03922       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03923}03923         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03924}03924         error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03925}03925           << \textcolor{stringliteral}{"{}If the DoubleVector residuals is setup then it must have"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03926}03926           << \textcolor{stringliteral}{"{} the same communicator as the problem."{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03927}03927         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03928}03928           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03929}03929       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03930}03930     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03931}03931 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03932}03932 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03933}03933     \textcolor{comment}{// set the residuals distribution if it is not setup}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03934}03934     \textcolor{keywordflow}{if} (!residuals.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03935}03935     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03936}03936       \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} dist(\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}, n\_dof, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03937}03937       residuals.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(\&dist, 0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03938}03938     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03939}03939     \textcolor{comment}{// else just zero the residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03940}03940     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03941}03941     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03942}03942       residuals.\mbox{\hyperlink{classoomph_1_1DoubleVector_a180c1057a29f4ed721da46040a619ecd}{initialise}}(0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03943}03943     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03944}03944 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03945}03945     \textcolor{comment}{// Resize the matrices -\/-\/ this cannot always be done externally}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03946}03946     \textcolor{comment}{// because get\_jacobian exists in many different versions for}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03947}03947     \textcolor{comment}{// different storage formats -\/-\/ resizing a CC or CR matrix doesn't}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03948}03948     \textcolor{comment}{// make sense.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03949}03949 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03950}03950     \textcolor{comment}{// resize the jacobian}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03951}03951     jacobian.\mbox{\hyperlink{classoomph_1_1DenseMatrix_adec1ef741b1c5048a12ba9a540c2719c}{resize}}(n\_dof, n\_dof);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03952}03952     jacobian.\mbox{\hyperlink{classoomph_1_1DenseMatrix_aafcfbb0309fdcbd84f8654fe1b5601fd}{initialise}}(0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03953}03953 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03954}03954     \textcolor{comment}{// Locally cache pointer to assembly handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03955}03955     \mbox{\hyperlink{classoomph_1_1AssemblyHandler}{AssemblyHandler}}* \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}} = \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03956}03956 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03957}03957     \textcolor{comment}{// Loop over all the elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03958}03958     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_element = \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03959}03959     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03960}03960     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03961}03961       \textcolor{comment}{// Get the pointer to the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03962}03962       \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03963}03963       \textcolor{comment}{// Find number of dofs in the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03964}03964       \textcolor{keywordtype}{unsigned} n\_element\_dofs = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a09213be8f4aa009e0366460a7ed78e68}{ndof}}(elem\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03965}03965       \textcolor{comment}{// Set up an array}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03966}03966       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} element\_residuals(n\_element\_dofs);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03967}03967       \textcolor{comment}{// Set up a matrix}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03968}03968       \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} element\_jacobian(n\_element\_dofs);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03969}03969       \textcolor{comment}{// Fill the array}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03970}03970       \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_ad43c3d8760be0ba6ebee8d82509458e5}{get\_jacobian}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03971}03971         elem\_pt, element\_residuals, element\_jacobian);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03972}03972       \textcolor{comment}{// Now loop over the dofs and assign values to global Vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03973}03973       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} l = 0; l < n\_element\_dofs; l++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03974}03974       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03975}03975         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} eqn\_number = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, l);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03976}03976         residuals[eqn\_number] += element\_residuals[l];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03977}03977         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} l2 = 0; l2 < n\_element\_dofs; l2++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03978}03978         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03979}03979           jacobian(eqn\_number, \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, l2)) +=}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03980}03980             element\_jacobian(l, l2);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03981}03981         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03982}03982       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03983}03983     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03984}03984   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03985}03985 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03986}03986   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03987}03987 \textcolor{comment}{  /// Return the fully-\/assembled Jacobian and residuals for the problem,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03988}03988 \textcolor{comment}{  /// in the case where the Jacobian matrix is in a distributable}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03989}03989 \textcolor{comment}{  /// row compressed storage format.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03990}03990 \textcolor{comment}{  /// 1. If the distribution of the jacobian and residuals is setup then, they}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03991}03991 \textcolor{comment}{  /// will be returned with that distribution.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03992}03992 \textcolor{comment}{  /// Note. the jacobian and residuals must have the same distribution.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03993}03993 \textcolor{comment}{  /// 2. If the distribution of the jacobian and residuals are not setup then}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03994}03994 \textcolor{comment}{  /// their distribution will computed based on:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03995}03995 \textcolor{comment}{  /// Distributed\_problem\_matrix\_distribution.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03996}03996 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03997}\mbox{\hyperlink{classoomph_1_1Problem_a1369827c6970abfd41deae4ef185822c}{03997}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a4ba83bbea19db3a530539f3e9f88a7e4}{Problem::get\_jacobian}}(\mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& residuals, \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}\& jacobian)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03998}03998   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l03999}03999     \textcolor{comment}{// Three different cases; if MPI\_Helpers::MPI\_has\_been\_initialised=true}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04000}04000     \textcolor{comment}{// this means MPI\_Helpers::setup() has been called.  This could happen on a}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04001}04001     \textcolor{comment}{// code compiled with MPI but run serially; in this instance the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04002}04002     \textcolor{comment}{// get\_residuals function still works on one processor.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04003}04003     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04004}04004     \textcolor{comment}{// Secondly, if a code has been compiled with MPI, but MPI\_Helpers::setup()}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04005}04005     \textcolor{comment}{// has not been called, then MPI\_Helpers::MPI\_has\_been\_initialised=false}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04006}04006     \textcolor{comment}{// and the code calls...}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04007}04007     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04008}04008     \textcolor{comment}{// Thirdly, the serial version (compiled by all, but only run when compiled}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04009}04009     \textcolor{comment}{// with MPI if MPI\_Helpers::MPI\_has\_been\_initialised=false}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04010}04010     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04011}04011     \textcolor{comment}{// The only case where an MPI code cannot run serially at present}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04012}04012     \textcolor{comment}{// is one where the distribute function is used (i.e. METIS is called)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04013}04013 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04014}04014     \textcolor{comment}{// Allocate storage for the matrix entries}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04015}04015     \textcolor{comment}{// The generalised Vector<Vector<>> structure is required}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04016}04016     \textcolor{comment}{// for the most general interface to sparse\_assemble() which allows}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04017}04017     \textcolor{comment}{// the assembly of multiple matrices at once.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04018}04018     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}} column\_index(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04019}04019     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}} row\_start(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04020}04020     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}} value(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04021}04021     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} nnz(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04022}04022 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04023}04023 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04024}04024     \textcolor{comment}{// PARANOID checks that the distribution of the jacobian matches that of the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04025}04025     \textcolor{comment}{// residuals (if they are setup) and that they have the right number of rows}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04026}04026     \textcolor{keywordflow}{if} (residuals.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}() \&\& jacobian.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a8c35baa65e335043f62954c92c090a5a}{distribution\_built}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04027}04027     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04028}04028       \textcolor{keywordflow}{if} (!(*residuals.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() == *jacobian.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04029}04029       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04030}04030         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04031}04031         error\_stream << \textcolor{stringliteral}{"{}The distribution of the residuals must "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04032}04032                      << \textcolor{stringliteral}{"{}be the same as the distribution of the jacobian."{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04033}04033         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04034}04034           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04035}04035       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04036}04036       \textcolor{keywordflow}{if} (jacobian.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_aafad0b69de2284808366b65bd63e493b}{nrow}}() != this-\/>ndof())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04037}04037       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04038}04038         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04039}04039         error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04040}04040           << \textcolor{stringliteral}{"{}The distribution of the jacobian and residuals does not"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04041}04041           << \textcolor{stringliteral}{"{}have the correct number of global rows."{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04042}04042         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04043}04043           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04044}04044       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04045}04045     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04046}04046     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (residuals.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}() != jacobian.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a8c35baa65e335043f62954c92c090a5a}{distribution\_built}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04047}04047     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04048}04048       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04049}04049       error\_stream << \textcolor{stringliteral}{"{}The distribution of the jacobian and residuals must "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04050}04050                    << \textcolor{stringliteral}{"{}both be setup or both not setup"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04051}04051       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04052}04052         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04053}04053     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04054}04054 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04055}04055 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04056}04056 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04057}04057     \textcolor{comment}{// Allocate generalised storage format for passing to sparse\_assemble()}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04058}04058     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}} res(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04059}04059 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04060}04060     \textcolor{comment}{// number of rows}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04061}04061     \textcolor{keywordtype}{unsigned} nrow = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04062}04062 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04063}04063     \textcolor{comment}{// determine the distribution for the jacobian.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04064}04064     \textcolor{comment}{// IF the jacobian has distribution setup then use that}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04065}04065     \textcolor{comment}{// ELSE determine the distribution based on the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04066}04066     \textcolor{comment}{// distributed\_matrix\_distribution enum}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04067}04067     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* dist\_pt = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04068}04068     \textcolor{keywordflow}{if} (jacobian.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a8c35baa65e335043f62954c92c090a5a}{distribution\_built}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04069}04069     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04070}04070       dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(jacobian.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04071}04071     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04072}04072     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04073}04073     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04074}04074 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04075}04075       \textcolor{comment}{// if problem is only one one processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04076}04076       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>nproc() == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04077}04077       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04078}04078         dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}, nrow, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04079}04079       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04080}04080       \textcolor{comment}{// if the problem is not distributed then assemble the jacobian with}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04081}04081       \textcolor{comment}{// a uniform distributed distribution}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04082}04082       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04083}04083       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04084}04084         dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}, nrow, \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04085}04085       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04086}04086       \textcolor{comment}{// otherwise the problem is a distributed problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04087}04087       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04088}04088       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04089}04089         \textcolor{keywordflow}{switch} (\mbox{\hyperlink{classoomph_1_1Problem_a1da221c501adc7d58bd21f630207c6c3}{Dist\_problem\_matrix\_distribution}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04090}04090         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04091}04091           \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1Problem_a8fc1f40f2a9309e9ff02772fa2258402a741cb51275fde6a02373b2ffacf1273f}{Uniform\_matrix\_distribution}}:}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04092}04092             dist\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04093}04093               \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}, nrow, \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04094}04094             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04095}04095           \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1Problem_a8fc1f40f2a9309e9ff02772fa2258402aed8521359adcaf514039424b29893796}{Problem\_matrix\_distribution}}:}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04096}04096             dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04097}04097             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04098}04098           \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1Problem_a8fc1f40f2a9309e9ff02772fa2258402ad7503f3fef4bc3556497018171c820e6}{Default\_matrix\_distribution}}:}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04099}04099             \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* uniform\_dist\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04100}04100               \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}, nrow, \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04101}04101             \textcolor{keywordtype}{bool} use\_problem\_dist = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04102}04102             \textcolor{keywordtype}{unsigned} nproc = \mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>nproc();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04103}04103             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04104}04104             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04105}04105               \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{double})\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}(p) >}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04106}04106                   ((\textcolor{keywordtype}{double})uniform\_dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}(p)) * 1.1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04107}04107               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04108}04108                 use\_problem\_dist = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04109}04109               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04110}04110             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04111}04111             \textcolor{keywordflow}{if} (use\_problem\_dist)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04112}04112             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04113}04113               dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04114}04114             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04115}04115             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04116}04116             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04117}04117               dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(uniform\_dist\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04118}04118             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04119}04119             \textcolor{keyword}{delete} uniform\_dist\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04120}04120             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04121}04121         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04122}04122       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04123}04123 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04124}04124       dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}, nrow, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04125}04125 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04126}04126     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04127}04127 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04128}04128 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04129}04129     \textcolor{comment}{// The matrix is in compressed row format}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04130}04130     \textcolor{keywordtype}{bool} compressed\_row\_flag = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04131}04131 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04132}04132 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04133}04133     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04134}04134     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>nproc() == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04135}04135     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04136}04136 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04137}04137       \mbox{\hyperlink{classoomph_1_1Problem_a072f2894b20672be1a48783684c4a50b}{sparse\_assemble\_row\_or\_column\_compressed}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04138}04138         column\_index, row\_start, value, nnz, res, compressed\_row\_flag);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04139}04139       jacobian.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{build}}(dist\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04140}04140       jacobian.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafb4d7de0a87b4bda560928e6a128060}{build\_without\_copy}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04141}04141         dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_aafad0b69de2284808366b65bd63e493b}{nrow}}(), nnz[0], value[0], column\_index[0], row\_start[0]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04142}04142       residuals.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(dist\_pt, 0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04143}04143       residuals.\mbox{\hyperlink{classoomph_1_1DoubleVector_a4715c8cf47f9fc56d95889343d1a3b82}{set\_external\_values}}(res[0], \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04144}04144 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04145}04145     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04146}04146     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04147}04147     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04148}04148       \textcolor{keywordflow}{if} (dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a05842d032d28880ae37951deae804ad8}{distributed}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04149}04149       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04150}04150         \mbox{\hyperlink{classoomph_1_1Problem_a0487a7ef40e6cc4dad88e99ac96193e2}{parallel\_sparse\_assemble}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04151}04151           dist\_pt, column\_index, row\_start, value, nnz, res);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04152}04152         jacobian.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{build}}(dist\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04153}04153         jacobian.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafb4d7de0a87b4bda560928e6a128060}{build\_without\_copy}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04154}04154           dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_aafad0b69de2284808366b65bd63e493b}{nrow}}(), nnz[0], value[0], column\_index[0], row\_start[0]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04155}04155         residuals.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(dist\_pt, 0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04156}04156         residuals.\mbox{\hyperlink{classoomph_1_1DoubleVector_a4715c8cf47f9fc56d95889343d1a3b82}{set\_external\_values}}(res[0], \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04157}04157       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04158}04158       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04159}04159       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04160}04160         \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* temp\_dist\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04161}04161           \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}, dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_aafad0b69de2284808366b65bd63e493b}{nrow}}(), \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04162}04162         \mbox{\hyperlink{classoomph_1_1Problem_a0487a7ef40e6cc4dad88e99ac96193e2}{parallel\_sparse\_assemble}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04163}04163           temp\_dist\_pt, column\_index, row\_start, value, nnz, res);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04164}04164         jacobian.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{build}}(temp\_dist\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04165}04165         jacobian.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafb4d7de0a87b4bda560928e6a128060}{build\_without\_copy}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04166}04166           dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_aafad0b69de2284808366b65bd63e493b}{nrow}}(), nnz[0], value[0], column\_index[0], row\_start[0]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04167}04167         jacobian.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9ba295a04e08e3153ae06bc0556f507d}{redistribute}}(dist\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04168}04168         residuals.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(temp\_dist\_pt, 0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04169}04169         residuals.\mbox{\hyperlink{classoomph_1_1DoubleVector_a4715c8cf47f9fc56d95889343d1a3b82}{set\_external\_values}}(res[0], \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04170}04170         residuals.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(dist\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04171}04171         \textcolor{keyword}{delete} temp\_dist\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04172}04172       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04173}04173     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04174}04174 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04175}04175 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04176}04176     \textcolor{comment}{// clean up dist\_pt and residuals\_vector pt}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04177}04177     \textcolor{keyword}{delete} dist\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04178}04178   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04179}04179 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04180}04180   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04181}04181 \textcolor{comment}{  /// Return the fully-\/assembled Jacobian and residuals for the problem,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04182}04182 \textcolor{comment}{  /// in the case when the jacobian matrix is in column-\/compressed storage}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04183}04183 \textcolor{comment}{  /// format.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04184}04184 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04185}\mbox{\hyperlink{classoomph_1_1Problem_a9e6c6d71f95d96943a1a8487b6131e89}{04185}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a4ba83bbea19db3a530539f3e9f88a7e4}{Problem::get\_jacobian}}(\mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& residuals, \mbox{\hyperlink{classoomph_1_1CCDoubleMatrix}{CCDoubleMatrix}}\& jacobian)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04186}04186   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04187}04187     \textcolor{comment}{// Three different cases; if MPI\_Helpers::MPI\_has\_been\_initialised=true}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04188}04188     \textcolor{comment}{// this means MPI\_Helpers::setup() has been called.  This could happen on a}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04189}04189     \textcolor{comment}{// code compiled with MPI but run serially; in this instance the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04190}04190     \textcolor{comment}{// get\_residuals function still works on one processor.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04191}04191     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04192}04192     \textcolor{comment}{// Secondly, if a code has been compiled with MPI, but MPI\_Helpers::setup()}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04193}04193     \textcolor{comment}{// has not been called, then MPI\_Helpers::MPI\_has\_been\_initialised=false}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04194}04194     \textcolor{comment}{// and the code calls...}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04195}04195     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04196}04196     \textcolor{comment}{// Thirdly, the serial version (compiled by all, but only run when compiled}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04197}04197     \textcolor{comment}{// with MPI if MPI\_Helpers::MPI\_has\_been\_5Binitialised=false}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04198}04198     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04199}04199     \textcolor{comment}{// The only case where an MPI code cannot run serially at present}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04200}04200     \textcolor{comment}{// is one where the distribute function is used (i.e. METIS is called)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04201}04201 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04202}04202     \textcolor{comment}{// get the number of degrees of freedom}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04203}04203     \textcolor{keywordtype}{unsigned} n\_dof = \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04204}04204 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04205}04205 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04206}04206     \textcolor{comment}{// PARANOID checks : if the distribution of residuals is setup then it must}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04207}04207     \textcolor{comment}{// must not be distributed, have the right number of rows, and the same}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04208}04208     \textcolor{comment}{// communicator as the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04209}04209     \textcolor{keywordflow}{if} (residuals.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04210}04210     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04211}04211       \textcolor{keywordflow}{if} (residuals.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a05842d032d28880ae37951deae804ad8}{distributed}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04212}04212       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04213}04213         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04214}04214         error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04215}04215           << \textcolor{stringliteral}{"{}If the DoubleVector residuals is setup then it must not "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04216}04216           << \textcolor{stringliteral}{"{}be distributed."{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04217}04217         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04218}04218           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04219}04219       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04220}04220       \textcolor{keywordflow}{if} (residuals.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_aafad0b69de2284808366b65bd63e493b}{nrow}}() != n\_dof)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04221}04221       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04222}04222         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04223}04223         error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04224}04224           << \textcolor{stringliteral}{"{}If the DoubleVector residuals is setup then it must have"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04225}04225           << \textcolor{stringliteral}{"{} the correct number of rows"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04226}04226         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04227}04227           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04228}04228       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04229}04229       \textcolor{keywordflow}{if} (!(*\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}} ==}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04230}04230             *residuals.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2760847d45ab334f6d902efc2620b615}{communicator\_pt}}()))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04231}04231       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04232}04232         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04233}04233         error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04234}04234           << \textcolor{stringliteral}{"{}If the DoubleVector residuals is setup then it must have"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04235}04235           << \textcolor{stringliteral}{"{} the same communicator as the problem."{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04236}04236         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04237}04237           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04238}04238       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04239}04239     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04240}04240 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04241}04241 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04242}04242     \textcolor{comment}{// Allocate storage for the matrix entries}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04243}04243     \textcolor{comment}{// The generalised Vector<Vector<>> structure is required}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04244}04244     \textcolor{comment}{// for the most general interface to sparse\_assemble() which allows}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04245}04245     \textcolor{comment}{// the assembly of multiple matrices at once.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04246}04246     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}} row\_index(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04247}04247     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}} column\_start(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04248}04248     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}} value(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04249}04249 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04250}04250     \textcolor{comment}{// Allocate generalised storage format for passing to sparse\_assemble()}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04251}04251     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}} res(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04252}04252 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04253}04253     \textcolor{comment}{// allocate storage for the number of non-\/zeros in each matrix}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04254}04254     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} nnz(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04255}04255 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04256}04256     \textcolor{comment}{// The matrix is in compressed column format}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04257}04257     \textcolor{keywordtype}{bool} compressed\_row\_flag = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04258}04258 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04259}04259     \textcolor{comment}{// get the distribution for the residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04260}04260     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* dist\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04261}04261     \textcolor{keywordflow}{if} (!residuals.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04262}04262     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04263}04263       dist\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04264}04264         \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}, this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}(), \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04265}04265     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04266}04266     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04267}04267     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04268}04268       dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(residuals.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04269}04269     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04270}04270 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04271}04271 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04272}04272     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>nproc() == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04273}04273     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04274}04274 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04275}04275       \mbox{\hyperlink{classoomph_1_1Problem_a072f2894b20672be1a48783684c4a50b}{sparse\_assemble\_row\_or\_column\_compressed}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04276}04276         row\_index, column\_start, value, nnz, res, compressed\_row\_flag);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04277}04277       jacobian.\mbox{\hyperlink{classoomph_1_1CCMatrix_a57eddb79a6a3af698a1c92196482335a}{build\_without\_copy}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04278}04278         value[0], row\_index[0], column\_start[0], nnz[0], n\_dof, n\_dof);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04279}04279       residuals.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(dist\_pt, 0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04280}04280       residuals.\mbox{\hyperlink{classoomph_1_1DoubleVector_a4715c8cf47f9fc56d95889343d1a3b82}{set\_external\_values}}(res[0], \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04281}04281 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04282}04282     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04283}04283     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04284}04284     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04285}04285       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04286}04286       error\_stream << \textcolor{stringliteral}{"{}Cannot assemble a CCDoubleMatrix Jacobian on more "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04287}04287                    << \textcolor{stringliteral}{"{}than one processor."{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04288}04288       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04289}04289         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04290}04290     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04291}04291 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04292}04292 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04293}04293     \textcolor{comment}{// clean up}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04294}04294     \textcolor{keyword}{delete} dist\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04295}04295   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04296}04296 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04297}04297 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04298}04298   \textcolor{comment}{//===================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04299}04299 \textcolor{comment}{  /// Set all pinned values to zero.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04300}04300 \textcolor{comment}{  /// Used to set boundary conditions to be homogeneous in the copy}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04301}04301 \textcolor{comment}{  /// of the problem  used in adaptive bifurcation tracking}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04302}04302 \textcolor{comment}{  /// (ALH: TEMPORARY HACK, WILL BE FIXED)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04303}04303 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04304}\mbox{\hyperlink{classoomph_1_1Problem_a820d3c43c7d678b4fe186a8c83a90732}{04304}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a820d3c43c7d678b4fe186a8c83a90732}{Problem::set\_pinned\_values\_to\_zero}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04305}04305   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04306}04306     \textcolor{comment}{// NOTE THIS DOES NOT ZERO ANY SPINE DATA, but otherwise everything else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04307}04307     \textcolor{comment}{// should be zeroed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04308}04308 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04309}04309     \textcolor{comment}{// Zero any pinned global Data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04310}04310     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_global\_data = \mbox{\hyperlink{classoomph_1_1Problem_a60a9b6861928cf9115110b5bfc7d11a7}{nglobal\_data}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04311}04311     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_global\_data; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04312}04312     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04313}04313       \mbox{\hyperlink{classoomph_1_1Data}{Data}}* \textcolor{keyword}{const} local\_data\_pt = \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04314}04314       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_value = local\_data\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7e67fc78a2e8a2fd6eb75bd292d42ff8}{nvalue}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04315}04315       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_value; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04316}04316       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04317}04317         \textcolor{comment}{// If the data value is pinned set the value to zero}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04318}04318         \textcolor{keywordflow}{if} (local\_data\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_aedd0c445396ddcd650c814d17fef77dc}{is\_pinned}}(j))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04319}04319         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04320}04320           local\_data\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7289ca322725c6fd493970a19474b382}{set\_value}}(j, 0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04321}04321         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04322}04322       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04323}04323     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04324}04324 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04325}04325     \textcolor{comment}{// Loop over the submeshes:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04326}04326     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_sub\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_ab65f6fc9c49860e6324457a7e6e76346}{Sub\_mesh\_pt}}.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04327}04327     \textcolor{keywordflow}{if} (n\_sub\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04328}04328     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04329}04329       \textcolor{comment}{// Loop over the nodes in the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04330}04330       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_node = \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a945e7823d1a2af243b5b7f7866aaff5e}{nnode}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04331}04331       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_node; n++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04332}04332       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04333}04333         \mbox{\hyperlink{classoomph_1_1Node}{Node}}* \textcolor{keyword}{const} local\_node\_pt = \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(n);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04334}04334         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_value = local\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7e67fc78a2e8a2fd6eb75bd292d42ff8}{nvalue}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04335}04335         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_value; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04336}04336         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04337}04337           \textcolor{comment}{// If the data value is pinned set the value to zero}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04338}04338           \textcolor{keywordflow}{if} (local\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_aedd0c445396ddcd650c814d17fef77dc}{is\_pinned}}(j))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04339}04339           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04340}04340             local\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7289ca322725c6fd493970a19474b382}{set\_value}}(j, 0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04341}04341           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04342}04342         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04343}04343 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04344}04344         \textcolor{comment}{// Try to cast to a solid node}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04345}04345         \mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}* \textcolor{keyword}{const} local\_solid\_node\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04346}04346           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}*\textcolor{keyword}{>}(local\_node\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04347}04347         \textcolor{comment}{// If we are successful}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04348}04348         \textcolor{keywordflow}{if} (local\_solid\_node\_pt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04349}04349         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04350}04350           \textcolor{comment}{// Find the dimension of the node}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04351}04351           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_dim = local\_solid\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_a786c96a8e46eb27a03b2b31f629d41b3}{ndim}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04352}04352           \textcolor{comment}{// Find number of positions}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04353}04353           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_position\_type =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04354}04354             local\_solid\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_aee6f2b7a46fc9d875c6736895d7fc095}{nposition\_type}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04355}04355 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04356}04356           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k < n\_position\_type; k++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04357}04357           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04358}04358             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dim; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04359}04359             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04360}04360               \textcolor{comment}{// If the generalised position is pinned,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04361}04361               \textcolor{comment}{// set the value to zero}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04362}04362               \textcolor{keywordflow}{if} (local\_solid\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidNode_afd8204156be2ff0fa40834ca35daf243}{position\_is\_pinned}}(k, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04363}04363               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04364}04364                 local\_solid\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_af7fdc0dfda495d69bd31c790ee77da73}{x\_gen}}(k, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04365}04365               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04366}04366             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04367}04367           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04368}04368         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04369}04369       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04370}04370 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04371}04371       \textcolor{comment}{// Now loop over the element's and zero the internal data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04372}04372       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_element = \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04373}04373       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04374}04374       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04375}04375         \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const} local\_element\_pt = \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04376}04376         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_internal = local\_element\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a6b736de0af4c92831968636479b3480e}{ninternal\_data}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04377}04377         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_internal; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04378}04378         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04379}04379           \mbox{\hyperlink{classoomph_1_1Data}{Data}}* \textcolor{keyword}{const} local\_data\_pt = local\_element\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a3b83389f2c80788013421c6d59604f0b}{internal\_data\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04380}04380           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_value = local\_data\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7e67fc78a2e8a2fd6eb75bd292d42ff8}{nvalue}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04381}04381           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_value; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04382}04382           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04383}04383             \textcolor{comment}{// If the data value is pinned set the value to zero}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04384}04384             \textcolor{keywordflow}{if} (local\_data\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_aedd0c445396ddcd650c814d17fef77dc}{is\_pinned}}(j))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04385}04385             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04386}04386               local\_data\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7289ca322725c6fd493970a19474b382}{set\_value}}(j, 0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04387}04387             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04388}04388           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04389}04389         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04390}04390       \} \textcolor{comment}{// End of loop over elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04391}04391     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04392}04392     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04393}04393     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04394}04394       \textcolor{comment}{// Alternatively loop over all sub meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04395}04395       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_sub\_mesh; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04396}04396       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04397}04397         \textcolor{comment}{// Loop over the nodes in the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04398}04398         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_node = \mbox{\hyperlink{classoomph_1_1Problem_ab65f6fc9c49860e6324457a7e6e76346}{Sub\_mesh\_pt}}[m]-\/>nnode();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04399}04399         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_node; n++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04400}04400         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04401}04401           \mbox{\hyperlink{classoomph_1_1Node}{Node}}* \textcolor{keyword}{const} local\_node\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ab65f6fc9c49860e6324457a7e6e76346}{Sub\_mesh\_pt}}[m]-\/>node\_pt(n);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04402}04402           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_value = local\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7e67fc78a2e8a2fd6eb75bd292d42ff8}{nvalue}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04403}04403           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_value; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04404}04404           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04405}04405             \textcolor{comment}{// If the data value is pinned set the value to zero}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04406}04406             \textcolor{keywordflow}{if} (local\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_aedd0c445396ddcd650c814d17fef77dc}{is\_pinned}}(j))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04407}04407             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04408}04408               local\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7289ca322725c6fd493970a19474b382}{set\_value}}(j, 0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04409}04409             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04410}04410           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04411}04411 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04412}04412           \textcolor{comment}{// Try to cast to a solid node}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04413}04413           \mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}* \textcolor{keyword}{const} local\_solid\_node\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04414}04414             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}*\textcolor{keyword}{>}(local\_node\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04415}04415           \textcolor{comment}{// If we are successful}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04416}04416           \textcolor{keywordflow}{if} (local\_solid\_node\_pt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04417}04417           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04418}04418             \textcolor{comment}{// Find the dimension of the node}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04419}04419             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_dim = local\_solid\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_a786c96a8e46eb27a03b2b31f629d41b3}{ndim}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04420}04420             \textcolor{comment}{// Find number of positions}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04421}04421             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_position\_type =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04422}04422               local\_solid\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_aee6f2b7a46fc9d875c6736895d7fc095}{nposition\_type}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04423}04423 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04424}04424             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k < n\_position\_type; k++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04425}04425             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04426}04426               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dim; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04427}04427               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04428}04428                 \textcolor{comment}{// If the generalised position is pinned,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04429}04429                 \textcolor{comment}{// set the value to zero}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04430}04430                 \textcolor{keywordflow}{if} (local\_solid\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidNode_afd8204156be2ff0fa40834ca35daf243}{position\_is\_pinned}}(k, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04431}04431                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04432}04432                   local\_solid\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_af7fdc0dfda495d69bd31c790ee77da73}{x\_gen}}(k, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04433}04433                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04434}04434               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04435}04435             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04436}04436           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04437}04437         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04438}04438 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04439}04439         \textcolor{comment}{// Now loop over the element's and zero the internal data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04440}04440         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_element = \mbox{\hyperlink{classoomph_1_1Problem_ab65f6fc9c49860e6324457a7e6e76346}{Sub\_mesh\_pt}}[m]-\/>nelement();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04441}04441         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04442}04442         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04443}04443           \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const} local\_element\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04444}04444             \mbox{\hyperlink{classoomph_1_1Problem_ab65f6fc9c49860e6324457a7e6e76346}{Sub\_mesh\_pt}}[m]-\/>element\_pt(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04445}04445           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_internal = local\_element\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a6b736de0af4c92831968636479b3480e}{ninternal\_data}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04446}04446           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_internal; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04447}04447           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04448}04448             \mbox{\hyperlink{classoomph_1_1Data}{Data}}* \textcolor{keyword}{const} local\_data\_pt = local\_element\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a3b83389f2c80788013421c6d59604f0b}{internal\_data\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04449}04449             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_value = local\_data\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7e67fc78a2e8a2fd6eb75bd292d42ff8}{nvalue}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04450}04450             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_value; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04451}04451             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04452}04452               \textcolor{comment}{// If the data value is pinned set the value to zero}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04453}04453               \textcolor{keywordflow}{if} (local\_data\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_aedd0c445396ddcd650c814d17fef77dc}{is\_pinned}}(j))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04454}04454               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04455}04455                 local\_data\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7289ca322725c6fd493970a19474b382}{set\_value}}(j, 0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04456}04456               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04457}04457             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04458}04458           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04459}04459         \} \textcolor{comment}{// End of loop over elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04460}04460       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04461}04461     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04462}04462   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04463}04463 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04464}04464 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04465}04465   \textcolor{comment}{//=====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04466}04466 \textcolor{comment}{  /// This is a (private) helper function that is used to assemble system}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04467}04467 \textcolor{comment}{  /// matrices in compressed row or column format}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04468}04468 \textcolor{comment}{  /// and compute residual vectors.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04469}04469 \textcolor{comment}{  /// The default action is to assemble the jacobian matrix and}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04470}04470 \textcolor{comment}{  /// residuals for the Newton method. The action can be}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04471}04471 \textcolor{comment}{  /// overloaded at an elemental level by changing the default}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04472}04472 \textcolor{comment}{  /// behaviour of the function Element::get\_all\_vectors\_and\_matrices().}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04473}04473 \textcolor{comment}{  /// column\_or\_row\_index: Column [or row] index of given entry}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04474}04474 \textcolor{comment}{  /// row\_or\_column\_start: Index of first entry for given row [or column]}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04475}04475 \textcolor{comment}{  /// value              : Vector of nonzero entries}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04476}04476 \textcolor{comment}{  /// residuals          : Residual vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04477}04477 \textcolor{comment}{  /// compressed\_row\_flag: Bool flag to indicate if storage format is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04478}04478 \textcolor{comment}{  ///                      compressed row [if false interpretation of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04479}04479 \textcolor{comment}{  ///                      arguments is as stated in square brackets].}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04480}04480 \textcolor{comment}{  /// We provide four different assembly methods, each with different}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04481}04481 \textcolor{comment}{  /// memory requirements/execution speeds. The method is set by}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04482}04482 \textcolor{comment}{  /// the public flag Problem::Sparse\_assembly\_method.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04483}04483 \textcolor{comment}{}  \textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04484}\mbox{\hyperlink{classoomph_1_1Problem_a072f2894b20672be1a48783684c4a50b}{04484}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a072f2894b20672be1a48783684c4a50b}{Problem::sparse\_assemble\_row\_or\_column\_compressed}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04485}04485     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}}\& column\_or\_row\_index,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04486}04486     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}}\& row\_or\_column\_start,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04487}04487     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}}\& value,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04488}04488     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& nnz,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04489}04489     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}}\& residuals,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04490}04490     \textcolor{keywordtype}{bool} compressed\_row\_flag)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04491}04491   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04492}04492     \textcolor{comment}{// Choose the actual method}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04493}04493     \textcolor{keywordflow}{switch} (\mbox{\hyperlink{classoomph_1_1Problem_a447f9d42b248f6c394581ff1a0b02513}{Sparse\_assembly\_method}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04494}04494     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04495}04495       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1Problem_ac793c004113930938730ec04dd2245b7aa00e1772bb5ccf1c837a2bad2f240241}{Perform\_assembly\_using\_vectors\_of\_pairs}}:}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04496}04496 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04497}04497         \mbox{\hyperlink{classoomph_1_1Problem_a3d5d5ac657381a2b2b077988e887fef8}{sparse\_assemble\_row\_or\_column\_compressed\_with\_vectors\_of\_pairs}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04498}04498           column\_or\_row\_index,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04499}04499           row\_or\_column\_start,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04500}04500           value,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04501}04501           nnz,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04502}04502           residuals,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04503}04503           compressed\_row\_flag);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04504}04504 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04505}04505         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04506}04506 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04507}04507       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1Problem_ac793c004113930938730ec04dd2245b7a6008d2b6aa449ee405313b49632d18ff}{Perform\_assembly\_using\_two\_vectors}}:}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04508}04508 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04509}04509         \mbox{\hyperlink{classoomph_1_1Problem_a767f7064ccbdcc2a039e0360b98dc48d}{sparse\_assemble\_row\_or\_column\_compressed\_with\_two\_vectors}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04510}04510           column\_or\_row\_index,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04511}04511           row\_or\_column\_start,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04512}04512           value,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04513}04513           nnz,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04514}04514           residuals,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04515}04515           compressed\_row\_flag);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04516}04516 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04517}04517         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04518}04518 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04519}04519       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1Problem_ac793c004113930938730ec04dd2245b7a406ad24599e1a59450acdd09bac1d717}{Perform\_assembly\_using\_maps}}:}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04520}04520 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04521}04521         \mbox{\hyperlink{classoomph_1_1Problem_ade9708e503889b48e0a1dbbe47906eba}{sparse\_assemble\_row\_or\_column\_compressed\_with\_maps}}(column\_or\_row\_index,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04522}04522                                                            row\_or\_column\_start,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04523}04523                                                            value,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04524}04524                                                            nnz,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04525}04525                                                            residuals,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04526}04526                                                            compressed\_row\_flag);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04527}04527 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04528}04528         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04529}04529 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04530}04530       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1Problem_ac793c004113930938730ec04dd2245b7ad73bb55e4e1f000cfd6930cb8b2a52f8}{Perform\_assembly\_using\_lists}}:}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04531}04531 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04532}04532         \mbox{\hyperlink{classoomph_1_1Problem_a18867724e4682e69f10fe19d7a20116d}{sparse\_assemble\_row\_or\_column\_compressed\_with\_lists}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04533}04533           column\_or\_row\_index,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04534}04534           row\_or\_column\_start,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04535}04535           value,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04536}04536           nnz,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04537}04537           residuals,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04538}04538           compressed\_row\_flag);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04539}04539 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04540}04540         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04541}04541 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04542}04542       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1Problem_ac793c004113930938730ec04dd2245b7a1383f03857ad8602ba7edef43bd947f5}{Perform\_assembly\_using\_two\_arrays}}:}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04543}04543 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04544}04544         \mbox{\hyperlink{classoomph_1_1Problem_a19520f8a38dc1dabb33cd7f397ff3506}{sparse\_assemble\_row\_or\_column\_compressed\_with\_two\_arrays}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04545}04545           column\_or\_row\_index,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04546}04546           row\_or\_column\_start,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04547}04547           value,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04548}04548           nnz,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04549}04549           residuals,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04550}04550           compressed\_row\_flag);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04551}04551 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04552}04552         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04553}04553 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04554}04554       \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04555}04555 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04556}04556         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04557}04557         error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04558}04558           << \textcolor{stringliteral}{"{}Error: Incorrect value for Problem::Sparse\_assembly\_method"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04559}04559           << \mbox{\hyperlink{classoomph_1_1Problem_a447f9d42b248f6c394581ff1a0b02513}{Sparse\_assembly\_method}} << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04560}04560           << \textcolor{stringliteral}{"{}It should be one of the enumeration Problem::Assembly\_method"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04561}04561           << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04562}04562         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04563}04563           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04564}04564     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04565}04565   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04566}04566 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04567}04567 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04568}04568   \textcolor{comment}{//=====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04569}04569 \textcolor{comment}{  /// This is a (private) helper function that is used to assemble system}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04570}04570 \textcolor{comment}{  /// matrices in compressed row or column format}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04571}04571 \textcolor{comment}{  /// and compute residual vectors, using maps}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04572}04572 \textcolor{comment}{  /// The default action is to assemble the jacobian matrix and}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04573}04573 \textcolor{comment}{  /// residuals for the Newton method. The action can be}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04574}04574 \textcolor{comment}{  /// overloaded at an elemental level by chaging the default}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04575}04575 \textcolor{comment}{  /// behaviour of the function Element::get\_all\_vectors\_and\_matrices().}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04576}04576 \textcolor{comment}{  /// column\_or\_row\_index: Column [or row] index of given entry}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04577}04577 \textcolor{comment}{  /// row\_or\_column\_start: Index of first entry for given row [or column]}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04578}04578 \textcolor{comment}{  /// value              : Vector of nonzero entries}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04579}04579 \textcolor{comment}{  /// residuals          : Residual vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04580}04580 \textcolor{comment}{  /// compressed\_row\_flag: Bool flag to indicate if storage format is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04581}04581 \textcolor{comment}{  ///                      compressed row [if false interpretation of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04582}04582 \textcolor{comment}{  ///                      arguments is as stated in square brackets].}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04583}04583 \textcolor{comment}{}  \textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04584}\mbox{\hyperlink{classoomph_1_1Problem_ade9708e503889b48e0a1dbbe47906eba}{04584}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ade9708e503889b48e0a1dbbe47906eba}{Problem::sparse\_assemble\_row\_or\_column\_compressed\_with\_maps}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04585}04585     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}}\& column\_or\_row\_index,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04586}04586     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}}\& row\_or\_column\_start,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04587}04587     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}}\& value,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04588}04588     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& nnz,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04589}04589     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}}\& residuals,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04590}04590     \textcolor{keywordtype}{bool} compressed\_row\_flag)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04591}04591   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04592}04592     \textcolor{comment}{// Total number of elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04593}04593     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_elements = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04594}04594 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04595}04595     \textcolor{comment}{// Default range of elements for distributed problems}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04596}04596     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} el\_lo = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04597}04597     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} el\_hi = n\_elements -\/ 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04598}04598 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04599}04599 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04600}04600     \textcolor{comment}{// Otherwise just loop over a fraction of the elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04601}04601     \textcolor{comment}{// (This will either have been initialised in}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04602}04602     \textcolor{comment}{// Problem::set\_default\_first\_and\_last\_element\_for\_assembly() or}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04603}04603     \textcolor{comment}{// will have been re-\/assigned during a previous assembly loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04604}04604     \textcolor{comment}{// Note that following the re-\/assignment only the entries}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04605}04605     \textcolor{comment}{// for the current processor are relevant.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04606}04606     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04607}04607     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04608}04608       el\_lo = \mbox{\hyperlink{classoomph_1_1Problem_a0caac0918eaaea840238ce83f5be7836}{First\_el\_for\_assembly}}[\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>my\_rank()];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04609}04609       el\_hi = \mbox{\hyperlink{classoomph_1_1Problem_a4842a9a213197905b5a8e182a3c02cce}{Last\_el\_plus\_one\_for\_assembly}}[\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>my\_rank()] -\/ 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04610}04610     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04611}04611 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04612}04612 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04613}04613     \textcolor{comment}{// number of dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04614}04614     \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}} = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04615}04615 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04616}04616     \textcolor{comment}{// Find the number of vectors to be assembled}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04617}04617     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_vector = residuals.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04618}04618 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04619}04619     \textcolor{comment}{// Find the number of matrices to be assembled}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04620}04620     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_matrix = column\_or\_row\_index.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04621}04621 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04622}04622     \textcolor{comment}{// Locally cache pointer to assembly handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04623}04623     \mbox{\hyperlink{classoomph_1_1AssemblyHandler}{AssemblyHandler}}* \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}} = \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04624}04624 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04625}04625 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04626}04626     \textcolor{keywordtype}{bool} doing\_residuals = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04627}04627     \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1ParallelResidualsHandler}{ParallelResidualsHandler}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}}) != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04628}04628     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04629}04629       doing\_residuals = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04630}04630     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04631}04631 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04632}04632 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04633}04633 \textcolor{comment}{// Error check dimensions}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04634}04634 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04635}04635     \textcolor{keywordflow}{if} (row\_or\_column\_start.size() != n\_matrix)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04636}04636     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04637}04637       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04638}04638       error\_stream << \textcolor{stringliteral}{"{}Error: "{}} << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04639}04639                    << \textcolor{stringliteral}{"{}row\_or\_column\_start.size() "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04640}04640                    << row\_or\_column\_start.size() << \textcolor{stringliteral}{"{} does not equal "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04641}04641                    << \textcolor{stringliteral}{"{}column\_or\_row\_index.size() "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04642}04642                    << column\_or\_row\_index.size() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04643}04643       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04644}04644         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04645}04645     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04646}04646 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04647}04647     \textcolor{keywordflow}{if} (value.size() != n\_matrix)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04648}04648     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04649}04649       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04650}04650       error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04651}04651         << \textcolor{stringliteral}{"{}Error in Problem::sparse\_assemble\_row\_or\_column\_compressed "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04652}04652         << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04653}04653         << \textcolor{stringliteral}{"{}value.size() "{}} << value.size() << \textcolor{stringliteral}{"{} does not equal "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04654}04654         << \textcolor{stringliteral}{"{}column\_or\_row\_index.size() "{}} << column\_or\_row\_index.size()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04655}04655         << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04656}04656         << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04657}04657         << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04658}04658       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04659}04659         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04660}04660     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04661}04661 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04662}04662 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04663}04663 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04664}04664     \textcolor{comment}{// The idea behind this sparse assembly routine is to use a vector of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04665}04665     \textcolor{comment}{// maps for the entries in each row or column of the complete matrix.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04666}04666     \textcolor{comment}{// The key for each map is the global row or column number and}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04667}04667     \textcolor{comment}{// the default comparison operator for integers means that each map}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04668}04668     \textcolor{comment}{// is ordered by the global row or column number. Thus, we need not}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04669}04669     \textcolor{comment}{// sort the maps, that happens at each insertion of a new entry. The}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04670}04670     \textcolor{comment}{// price we pay  is that for large maps, inseration is not a}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04671}04671     \textcolor{comment}{// cheap operation. Hash maps can be used to increase the speed, but then}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04672}04672     \textcolor{comment}{// the ordering is lost and we would have to sort anyway. The solution if}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04673}04673     \textcolor{comment}{// speed is required is to use lists, see below.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04674}04674 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04675}04675 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04676}04676     \textcolor{comment}{// Set up a vector of vectors of maps of entries of each  matrix,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04677}04677     \textcolor{comment}{// indexed by either the column or row. The entries of the vector for}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04678}04678     \textcolor{comment}{// each matrix correspond to all the rows or columns of that matrix.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04679}04679     \textcolor{comment}{// The use of the map storage}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04680}04680     \textcolor{comment}{// scheme, with its implicit ordering on the first index, gives}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04681}04681     \textcolor{comment}{// a sparse ordered list of the entries in the given row or column.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04682}04682     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<std::map<unsigned, double>}}>> matrix\_data\_map(n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04683}04683     \textcolor{comment}{// Loop over the number of matrices being assembled and resize}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04684}04684     \textcolor{comment}{// each vector of maps to the number of rows or columns of the matrix}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04685}04685     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04686}04686     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04687}04687       matrix\_data\_map[m].resize(\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04688}04688     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04689}04689 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04690}04690     \textcolor{comment}{// Resize the residuals vectors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04691}04691     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04692}04692     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04693}04693       residuals[v] = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04694}04694       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04695}04695       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04696}04696         residuals[v][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04697}04697       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04698}04698     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04699}04699 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04700}04700 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04701}04701 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04702}04702 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04703}04703 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04704}04704     \textcolor{comment}{// Storage for assembly time for elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04705}04705     \textcolor{keywordtype}{double} t\_assemble\_start = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04706}04706 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04707}04707     \textcolor{comment}{// Storage for assembly times}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04708}04708     \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04709}04709     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04710}04710       \mbox{\hyperlink{classoomph_1_1Problem_a2b2bcde2b051f47278ccf8446699bbfb}{Elemental\_assembly\_time}}.resize(n\_elements);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04711}04711     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04712}04712 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04713}04713 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04714}04714 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04715}04715     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/Assemble and populate the maps-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04716}04716     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04717}04717       \textcolor{comment}{// Allocate local storage for the element's contribution to the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04718}04718       \textcolor{comment}{// residuals vectors and system matrices of the size of the maximum}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04719}04719       \textcolor{comment}{// number of dofs in any element.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04720}04720       \textcolor{comment}{// This means that the storage is only allocated (and deleted) once}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04721}04721       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<double>}}> el\_residuals(n\_vector);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04722}04722       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DenseMatrix<double>}}> el\_jacobian(n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04723}04723 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04724}04724       \textcolor{comment}{// Loop over the elements for this processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04725}04725       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = el\_lo; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} <= el\_hi; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04726}04726       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04727}04727 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04728}04728         \textcolor{comment}{// Time it?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04729}04729         \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04730}04730         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04731}04731           t\_assemble\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04732}04732         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04733}04733 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04734}04734 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04735}04735         \textcolor{comment}{// Get the pointer to the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04736}04736         \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04737}04737 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04738}04738 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04739}04739         \textcolor{comment}{// Ignore halo elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04740}04740         \textcolor{keywordflow}{if} (!elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a0d9869eaf7d6e104c1e465b0d3cd6a9b}{is\_halo}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04741}04741         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04742}04742 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04743}04743 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04744}04744           \textcolor{comment}{// Find number of degrees of freedom in the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04745}04745           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nvar = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a09213be8f4aa009e0366460a7ed78e68}{ndof}}(elem\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04746}04746 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04747}04747           \textcolor{comment}{// Resize the storage for elemental jacobian and residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04748}04748           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04749}04749           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04750}04750             el\_residuals[v].resize(nvar);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04751}04751           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04752}04752           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04753}04753           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04754}04754             el\_jacobian[m].resize(nvar);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04755}04755           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04756}04756 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04757}04757           \textcolor{comment}{// Now get the residuals and jacobian for the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04758}04758           \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_ab2e4ee4623116b18245ca90cfe9ba144}{get\_all\_vectors\_and\_matrices}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04759}04759             elem\_pt, el\_residuals, el\_jacobian);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04760}04760 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04761}04761           \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/Insert the values into the maps-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04762}04762 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04763}04763           \textcolor{comment}{// Loop over the first index of local variables}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04764}04764           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nvar; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04765}04765           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04766}04766             \textcolor{comment}{// Get the local equation number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04767}04767             \textcolor{keywordtype}{unsigned} eqn\_number = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04768}04768 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04769}04769             \textcolor{comment}{// Add the contribution to the residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04770}04770             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04771}04771             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04772}04772               \textcolor{comment}{// Fill in each residuals vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04773}04773               residuals[v][eqn\_number] += el\_residuals[v][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04774}04774             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04775}04775 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04776}04776             \textcolor{comment}{// Now loop over the other index}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04777}04777             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < nvar; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04778}04778             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04779}04779               \textcolor{comment}{// Get the number of the unknown}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04780}04780               \textcolor{keywordtype}{unsigned} unknown = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04781}04781 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04782}04782               \textcolor{comment}{// Loop over the matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04783}04783               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04784}04784               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04785}04785                 \textcolor{comment}{// Get the value of the matrix at this point}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04786}04786                 \textcolor{keywordtype}{double} value = el\_jacobian[m](\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04787}04787                 \textcolor{comment}{// Only bother to add to the map if it's non-\/zero}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04788}04788                 \textcolor{keywordflow}{if} (std::fabs(value) > \mbox{\hyperlink{classoomph_1_1Problem_ad1a1ffc2bd685377ce7213452876b127}{Numerical\_zero\_for\_sparse\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04789}04789                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04790}04790                   \textcolor{comment}{// If it's compressed row storage, then our vector of maps}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04791}04791                   \textcolor{comment}{// is indexed by row (equation number)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04792}04792                   \textcolor{keywordflow}{if} (compressed\_row\_flag)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04793}04793                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04794}04794                     \textcolor{comment}{// Add the data into the map using the unknown as the map}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04795}04795                     \textcolor{comment}{// key}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04796}04796                     matrix\_data\_map[m][eqn\_number][unknown] += value;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04797}04797                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04798}04798                   \textcolor{comment}{// Otherwise it's compressed column storage and our vector is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04799}04799                   \textcolor{comment}{// indexed by column (the unknown)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04800}04800                   \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04801}04801                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04802}04802                     \textcolor{comment}{// Add the data into the map using the eqn\_numbe as the map}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04803}04803                     \textcolor{comment}{// key}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04804}04804                     matrix\_data\_map[m][unknown][eqn\_number] += value;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04805}04805                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04806}04806                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04807}04807               \} \textcolor{comment}{// End of loop over matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04808}04808             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04809}04809           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04810}04810 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04811}04811 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04812}04812         \} \textcolor{comment}{// endif halo element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04813}04813 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04814}04814 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04815}04815 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04816}04816 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04817}04817         \textcolor{comment}{// Time it?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04818}04818         \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04819}04819         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04820}04820           \mbox{\hyperlink{classoomph_1_1Problem_a2b2bcde2b051f47278ccf8446699bbfb}{Elemental\_assembly\_time}}[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04821}04821             \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}() -\/ t\_assemble\_start;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04822}04822         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04823}04823 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04824}04824 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04825}04825       \} \textcolor{comment}{// End of loop over the elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04826}04826 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04827}04827     \} \textcolor{comment}{// End of map assembly}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04828}04828 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04829}04829 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04830}04830 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04831}04831 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04832}04832     \textcolor{comment}{// Postprocess timing information and re-\/allocate distribution of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04833}04833     \textcolor{comment}{// elements during subsequent assemblies.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04834}04834     \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& (!\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}}) \&\&}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04835}04835         \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04836}04836     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04837}04837       \mbox{\hyperlink{classoomph_1_1Problem_aa9d808bb5d62db0da8e962fa29c24af9}{recompute\_load\_balanced\_assembly}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04838}04838     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04839}04839 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04840}04840     \textcolor{comment}{// We have determined load balancing for current setup.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04841}04841     \textcolor{comment}{// This can remain the same until assign\_eqn\_numbers() is called}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04842}04842     \textcolor{comment}{// again -\/-\/ the flag is re-\/set to true there.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04843}04843     \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04844}04844     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04845}04845       \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04846}04846     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04847}04847 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04848}04848 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04849}04849 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04850}04850 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04851}04851     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/Finally we need to convert the beautiful map storage scheme}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04852}04852     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/to the containers required by SuperLU}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04853}04853 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04854}04854     \textcolor{comment}{// Loop over the number of matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04855}04855     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04856}04856     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04857}04857       \textcolor{comment}{// Set the number of rows or columns}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04858}04858       row\_or\_column\_start[m] = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}} + 1];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04859}04859       \textcolor{comment}{// Counter for the total number of entries in the storage scheme}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04860}04860       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} entry\_count = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04861}04861       row\_or\_column\_start[m][0] = entry\_count;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04862}04862 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04863}04863       \textcolor{comment}{// first we compute the number of non-\/zeros}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04864}04864       nnz[m] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04865}04865       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} i\_global = 0; i\_global < \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}; i\_global++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04866}04866       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04867}04867         nnz[m] += matrix\_data\_map[m][i\_global].size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04868}04868       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04869}04869 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04870}04870       \textcolor{comment}{// and then resize the storage}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04871}04871       column\_or\_row\_index[m] = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nnz[m]];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04872}04872       value[m] = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[nnz[m]];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04873}04873 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04874}04874       \textcolor{comment}{// Now we merely loop over the number of rows or columns}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04875}04875       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} i\_global = 0; i\_global < \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}; i\_global++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04876}04876       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04877}04877         \textcolor{comment}{// Start index for the present row}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04878}04878         row\_or\_column\_start[m][i\_global] = entry\_count;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04879}04879         \textcolor{comment}{// If there are no entries in the map then skip the rest of the loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04880}04880         \textcolor{keywordflow}{if} (matrix\_data\_map[m][i\_global].empty())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04881}04881         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04882}04882           \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04883}04883         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04884}04884 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04885}04885         \textcolor{comment}{// Loop over all the entries in the map corresponding to the given}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04886}04886         \textcolor{comment}{// row or column. It will be ordered}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04887}04887 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04888}04888         \textcolor{keywordflow}{for} (std::map<unsigned, double>::iterator it =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04889}04889                matrix\_data\_map[m][i\_global].begin();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04890}04890              it != matrix\_data\_map[m][i\_global].end();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04891}04891              ++it)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04892}04892         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04893}04893           \textcolor{comment}{// The first value is the column or row index}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04894}04894           column\_or\_row\_index[m][entry\_count] = it-\/>first;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04895}04895           \textcolor{comment}{// The second value is the actual data value}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04896}04896           value[m][entry\_count] = it-\/>second;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04897}04897           \textcolor{comment}{// Increase the value of the counter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04898}04898           entry\_count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04899}04899         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04900}04900       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04901}04901 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04902}04902       \textcolor{comment}{// Final entry in the row/column start vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04903}04903       row\_or\_column\_start[m][\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}] = entry\_count;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04904}04904     \} \textcolor{comment}{// End of the loop over the matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04905}04905 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04906}04906     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aedefa8337ace6043c2fdfd5a2d19afd3}{Pause\_at\_end\_of\_sparse\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04907}04907     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04908}04908       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Pausing at end of sparse assembly."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04909}04909       \mbox{\hyperlink{namespaceoomph_a4a82243b0ce4c28469a290fe2d7cd2c4}{pause}}(\textcolor{stringliteral}{"{}Check memory usage now."{}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04910}04910     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04911}04911   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04912}04912 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04913}04913 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04914}04914   \textcolor{comment}{//=====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04915}04915 \textcolor{comment}{  /// This is a (private) helper function that is used to assemble system}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04916}04916 \textcolor{comment}{  /// matrices in compressed row or column format}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04917}04917 \textcolor{comment}{  /// and compute residual vectors using lists}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04918}04918 \textcolor{comment}{  /// The default action is to assemble the jacobian matrix and}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04919}04919 \textcolor{comment}{  /// residuals for the Newton method. The action can be}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04920}04920 \textcolor{comment}{  /// overloaded at an elemental level by chaging the default}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04921}04921 \textcolor{comment}{  /// behaviour of the function Element::get\_all\_vectors\_and\_matrices().}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04922}04922 \textcolor{comment}{  /// column\_or\_row\_index: Column [or row] index of given entry}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04923}04923 \textcolor{comment}{  /// row\_or\_column\_start: Index of first entry for given row [or column]}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04924}04924 \textcolor{comment}{  /// value              : Vector of nonzero entries}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04925}04925 \textcolor{comment}{  /// residuals          : Residual vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04926}04926 \textcolor{comment}{  /// compressed\_row\_flag: Bool flag to indicate if storage format is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04927}04927 \textcolor{comment}{  ///                      compressed row [if false interpretation of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04928}04928 \textcolor{comment}{  ///                      arguments is as stated in square brackets].}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04929}04929 \textcolor{comment}{}  \textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04930}\mbox{\hyperlink{classoomph_1_1Problem_a18867724e4682e69f10fe19d7a20116d}{04930}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a18867724e4682e69f10fe19d7a20116d}{Problem::sparse\_assemble\_row\_or\_column\_compressed\_with\_lists}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04931}04931     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}}\& column\_or\_row\_index,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04932}04932     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}}\& row\_or\_column\_start,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04933}04933     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}}\& value,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04934}04934     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& nnz,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04935}04935     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}}\& residuals,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04936}04936     \textcolor{keywordtype}{bool} compressed\_row\_flag)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04937}04937   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04938}04938     \textcolor{comment}{// Total number of elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04939}04939     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_elements = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04940}04940 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04941}04941     \textcolor{comment}{// Default range of elements for distributed problems}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04942}04942     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} el\_lo = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04943}04943     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} el\_hi = n\_elements -\/ 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04944}04944 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04945}04945 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04946}04946     \textcolor{comment}{// Otherwise just loop over a fraction of the elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04947}04947     \textcolor{comment}{// (This will either have been initialised in}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04948}04948     \textcolor{comment}{// Problem::set\_default\_first\_and\_last\_element\_for\_assembly() or}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04949}04949     \textcolor{comment}{// will have been re-\/assigned during a previous assembly loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04950}04950     \textcolor{comment}{// Note that following the re-\/assignment only the entries}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04951}04951     \textcolor{comment}{// for the current processor are relevant.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04952}04952     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04953}04953     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04954}04954       el\_lo = \mbox{\hyperlink{classoomph_1_1Problem_a0caac0918eaaea840238ce83f5be7836}{First\_el\_for\_assembly}}[\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>my\_rank()];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04955}04955       el\_hi = \mbox{\hyperlink{classoomph_1_1Problem_a4842a9a213197905b5a8e182a3c02cce}{Last\_el\_plus\_one\_for\_assembly}}[\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>my\_rank()] -\/ 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04956}04956     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04957}04957 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04958}04958 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04959}04959     \textcolor{comment}{// number of dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04960}04960     \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}} = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04961}04961 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04962}04962     \textcolor{comment}{// Find the number of vectors to be assembled}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04963}04963     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_vector = residuals.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04964}04964 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04965}04965     \textcolor{comment}{// Find the number of matrices to be assembled}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04966}04966     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_matrix = column\_or\_row\_index.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04967}04967 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04968}04968     \textcolor{comment}{// Locally cache pointer to assembly handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04969}04969     \mbox{\hyperlink{classoomph_1_1AssemblyHandler}{AssemblyHandler}}* \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}} = \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04970}04970 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04971}04971 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04972}04972     \textcolor{keywordtype}{bool} doing\_residuals = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04973}04973     \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1ParallelResidualsHandler}{ParallelResidualsHandler}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}}) != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04974}04974     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04975}04975       doing\_residuals = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04976}04976     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04977}04977 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04978}04978 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04979}04979 \textcolor{comment}{// Error check dimensions}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04980}04980 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04981}04981     \textcolor{keywordflow}{if} (row\_or\_column\_start.size() != n\_matrix)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04982}04982     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04983}04983       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04984}04984       error\_stream << \textcolor{stringliteral}{"{}Error: "{}} << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04985}04985                    << \textcolor{stringliteral}{"{}row\_or\_column\_start.size() "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04986}04986                    << row\_or\_column\_start.size() << \textcolor{stringliteral}{"{} does not equal "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04987}04987                    << \textcolor{stringliteral}{"{}column\_or\_row\_index.size() "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04988}04988                    << column\_or\_row\_index.size() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04989}04989       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04990}04990         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04991}04991     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04992}04992 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04993}04993     \textcolor{keywordflow}{if} (value.size() != n\_matrix)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04994}04994     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04995}04995       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04996}04996       error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04997}04997         << \textcolor{stringliteral}{"{}Error in Problem::sparse\_assemble\_row\_or\_column\_compressed "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04998}04998         << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l04999}04999         << \textcolor{stringliteral}{"{}value.size() "{}} << value.size() << \textcolor{stringliteral}{"{} does not equal "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05000}05000         << \textcolor{stringliteral}{"{}column\_or\_row\_index.size() "{}} << column\_or\_row\_index.size()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05001}05001         << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05002}05002         << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05003}05003         << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05004}05004       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05005}05005         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05006}05006     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05007}05007 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05008}05008 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05009}05009     \textcolor{comment}{// The idea behind this sparse assembly routine is to use a vector of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05010}05010     \textcolor{comment}{// lists for the entries in each row or column of the complete matrix.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05011}05011     \textcolor{comment}{// The lists contain pairs of entries (global row/column number, value).}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05012}05012     \textcolor{comment}{// All non-\/zero contributions from each element are added to the lists.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05013}05013     \textcolor{comment}{// We then sort each list by global row/column number and then combine}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05014}05014     \textcolor{comment}{// the entries corresponding to each row/column before adding to the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05015}05015     \textcolor{comment}{// vectors column\_or\_row\_index and value.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05016}05016 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05017}05017     \textcolor{comment}{// Note the trade off for "{}fast assembly"{} is that we will require}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05018}05018     \textcolor{comment}{// more memory during the assembly phase. Then again, if we can}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05019}05019     \textcolor{comment}{// only just assemble the sparse matrix, we're in real trouble.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05020}05020 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05021}05021     \textcolor{comment}{// Set up a vector of lists of paired entries of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05022}05022     \textcolor{comment}{//(row/column index, jacobian matrix entry).}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05023}05023     \textcolor{comment}{// The entries of the vector correspond to all the rows or columns.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05024}05024     \textcolor{comment}{// The use of the list storage scheme, should give fast insertion}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05025}05025     \textcolor{comment}{// and fast sorts later.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05026}05026     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<std::list<std::pair<unsigned, double>}}>>> matrix\_data\_list(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05027}05027       n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05028}05028     \textcolor{comment}{// Loop over the number of matrices and resize}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05029}05029     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05030}05030     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05031}05031       matrix\_data\_list[m].resize(\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05032}05032     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05033}05033 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05034}05034     \textcolor{comment}{// Resize the residuals vectors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05035}05035     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05036}05036     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05037}05037       residuals[v] = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05038}05038       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05039}05039       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05040}05040         residuals[v][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05041}05041       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05042}05042     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05043}05043 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05044}05044 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05045}05045 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05046}05046 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05047}05047     \textcolor{comment}{// Storage for assembly time for elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05048}05048     \textcolor{keywordtype}{double} t\_assemble\_start = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05049}05049 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05050}05050     \textcolor{comment}{// Storage for assembly times}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05051}05051     \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05052}05052     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05053}05053       \mbox{\hyperlink{classoomph_1_1Problem_a2b2bcde2b051f47278ccf8446699bbfb}{Elemental\_assembly\_time}}.resize(n\_elements);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05054}05054     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05055}05055 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05056}05056 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05057}05057 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05058}05058     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/Assemble and populate the lists-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05059}05059     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05060}05060       \textcolor{comment}{// Allocate local storage for the element's contribution to the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05061}05061       \textcolor{comment}{// residuals vectors and system matrices of the size of the maximum}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05062}05062       \textcolor{comment}{// number of dofs in any element.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05063}05063       \textcolor{comment}{// This means that the stored is only allocated (and deleted) once}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05064}05064       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<double>}}> el\_residuals(n\_vector);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05065}05065       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DenseMatrix<double>}}> el\_jacobian(n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05066}05066 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05067}05067 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05068}05068       \textcolor{comment}{// Pointer to a single list to be used during the assembly}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05069}05069       std::list<std::pair<unsigned, double>>* list\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05070}05070 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05071}05071       \textcolor{comment}{// Loop over the all elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05072}05072       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = el\_lo; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} <= el\_hi; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05073}05073       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05074}05074 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05075}05075         \textcolor{comment}{// Time it?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05076}05076         \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05077}05077         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05078}05078           t\_assemble\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05079}05079         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05080}05080 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05081}05081 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05082}05082         \textcolor{comment}{// Get the pointer to the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05083}05083         \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05084}05084 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05085}05085 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05086}05086         \textcolor{comment}{// Ignore halo elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05087}05087         \textcolor{keywordflow}{if} (!elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a0d9869eaf7d6e104c1e465b0d3cd6a9b}{is\_halo}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05088}05088         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05089}05089 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05090}05090 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05091}05091           \textcolor{comment}{// Find number of degrees of freedom in the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05092}05092           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nvar = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a09213be8f4aa009e0366460a7ed78e68}{ndof}}(elem\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05093}05093 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05094}05094           \textcolor{comment}{// Resize the storage for the elemental jacobian and residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05095}05095           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05096}05096           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05097}05097             el\_residuals[v].resize(nvar);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05098}05098           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05099}05099           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05100}05100           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05101}05101             el\_jacobian[m].resize(nvar);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05102}05102           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05103}05103 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05104}05104           \textcolor{comment}{// Now get the residuals and jacobian for the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05105}05105           \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_ab2e4ee4623116b18245ca90cfe9ba144}{get\_all\_vectors\_and\_matrices}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05106}05106             elem\_pt, el\_residuals, el\_jacobian);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05107}05107 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05108}05108           \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ Insert the values into the lists -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05109}05109 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05110}05110           \textcolor{comment}{// Loop over the first index of local variables}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05111}05111           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nvar; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05112}05112           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05113}05113             \textcolor{comment}{// Get the local equation number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05114}05114             \textcolor{keywordtype}{unsigned} eqn\_number = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05115}05115 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05116}05116             \textcolor{comment}{// Add the contribution to the residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05117}05117             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05118}05118             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05119}05119               \textcolor{comment}{// Fill in the residuals vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05120}05120               residuals[v][eqn\_number] += el\_residuals[v][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05121}05121             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05122}05122 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05123}05123             \textcolor{comment}{// Now loop over the other index}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05124}05124             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < nvar; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05125}05125             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05126}05126               \textcolor{comment}{// Get the number of the unknown}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05127}05127               \textcolor{keywordtype}{unsigned} unknown = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05128}05128 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05129}05129               \textcolor{comment}{// Loop over the matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05130}05130               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05131}05131               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05132}05132                 \textcolor{comment}{// Get the value of the matrix at this point}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05133}05133                 \textcolor{keywordtype}{double} value = el\_jacobian[m](\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05134}05134                 \textcolor{comment}{// Only add to theif it's non-\/zero}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05135}05135                 \textcolor{keywordflow}{if} (std::fabs(value) > \mbox{\hyperlink{classoomph_1_1Problem_ad1a1ffc2bd685377ce7213452876b127}{Numerical\_zero\_for\_sparse\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05136}05136                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05137}05137                   \textcolor{comment}{// If it's compressed row storage, then our vector is indexed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05138}05138                   \textcolor{comment}{// by row (the equation number)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05139}05139                   \textcolor{keywordflow}{if} (compressed\_row\_flag)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05140}05140                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05141}05141                     \textcolor{comment}{// Find the list that corresponds to the desired row}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05142}05142                     list\_pt = \&matrix\_data\_list[m][eqn\_number];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05143}05143                     \textcolor{comment}{// Insert the data into the list, the first entry}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05144}05144                     \textcolor{comment}{// in the pair is the unknown (column index),}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05145}05145                     \textcolor{comment}{// the second is the value itself.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05146}05146                     list\_pt-\/>insert(list\_pt-\/>end(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05147}05147                                     std::make\_pair(unknown, value));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05148}05148                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05149}05149                   \textcolor{comment}{// Otherwise it's compressed column storage, and our}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05150}05150                   \textcolor{comment}{// vector is indexed by column (the unknown)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05151}05151                   \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05152}05152                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05153}05153                     \textcolor{comment}{// Find the list that corresponds to the desired column}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05154}05154                     list\_pt = \&matrix\_data\_list[m][unknown];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05155}05155                     \textcolor{comment}{// Insert the data into the list, the first entry}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05156}05156                     \textcolor{comment}{// in the pair is the equation number (row index),}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05157}05157                     \textcolor{comment}{// the second is the value itself.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05158}05158                     list\_pt-\/>insert(list\_pt-\/>end(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05159}05159                                     std::make\_pair(eqn\_number, value));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05160}05160                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05161}05161                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05162}05162               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05163}05163             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05164}05164           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05165}05165 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05166}05166 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05167}05167         \} \textcolor{comment}{// endif halo element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05168}05168 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05169}05169 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05170}05170 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05171}05171 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05172}05172         \textcolor{comment}{// Time it?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05173}05173         \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05174}05174         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05175}05175           \mbox{\hyperlink{classoomph_1_1Problem_a2b2bcde2b051f47278ccf8446699bbfb}{Elemental\_assembly\_time}}[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05176}05176             \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}() -\/ t\_assemble\_start;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05177}05177         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05178}05178 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05179}05179 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05180}05180       \} \textcolor{comment}{// End of loop over the elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05181}05181 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05182}05182     \} \textcolor{comment}{// list\_pt goes out of scope}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05183}05183 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05184}05184 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05185}05185 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05186}05186 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05187}05187     \textcolor{comment}{// Postprocess timing information and re-\/allocate distribution of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05188}05188     \textcolor{comment}{// elements during subsequent assemblies.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05189}05189     \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& (!\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}}) \&\&}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05190}05190         \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05191}05191     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05192}05192       \mbox{\hyperlink{classoomph_1_1Problem_aa9d808bb5d62db0da8e962fa29c24af9}{recompute\_load\_balanced\_assembly}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05193}05193     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05194}05194 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05195}05195     \textcolor{comment}{// We have determined load balancing for current setup.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05196}05196     \textcolor{comment}{// This can remain the same until assign\_eqn\_numbers() is called}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05197}05197     \textcolor{comment}{// again -\/-\/ the flag is re-\/set to true there.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05198}05198     \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05199}05199     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05200}05200       \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05201}05201     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05202}05202 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05203}05203 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05204}05204 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05205}05205 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05206}05206     \textcolor{comment}{//-\/-\/-\/-\/Finally we need to convert the beautiful list storage scheme-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05207}05207     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/to the containers required by SuperLU-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05208}05208 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05209}05209     \textcolor{comment}{// Loop over the number of matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05210}05210     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05211}05211     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05212}05212       \textcolor{comment}{// Set the number of rows or columns}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05213}05213       row\_or\_column\_start[m] = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}} + 1];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05214}05214       \textcolor{comment}{// Counter for the total number of entries in the storage scheme}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05215}05215       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} entry\_count = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05216}05216       \textcolor{comment}{// The first entry is 0}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05217}05217       row\_or\_column\_start[m][0] = entry\_count;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05218}05218 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05219}05219       \textcolor{comment}{// first we compute the number of non-\/zeros}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05220}05220       nnz[m] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05221}05221       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} i\_global = 0; i\_global < \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}; i\_global++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05222}05222       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05223}05223         nnz[m] += matrix\_data\_list[m][i\_global].size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05224}05224       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05225}05225 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05226}05226       \textcolor{comment}{// and then resize the storage}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05227}05227       column\_or\_row\_index[m] = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nnz[m]];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05228}05228       value[m] = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[nnz[m]];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05229}05229 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05230}05230       \textcolor{comment}{// Now we merely loop over the number of rows or columns}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05231}05231       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} i\_global = 0; i\_global < \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}; i\_global++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05232}05232       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05233}05233         \textcolor{comment}{// Start index for the present row is the number of entries so far}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05234}05234         row\_or\_column\_start[m][i\_global] = entry\_count;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05235}05235         \textcolor{comment}{// If there are no entries in the list then skip the loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05236}05236         \textcolor{keywordflow}{if} (matrix\_data\_list[m][i\_global].empty())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05237}05237         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05238}05238           \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05239}05239         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05240}05240 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05241}05241         \textcolor{comment}{// Sort the list corresponding to this row or column by the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05242}05242         \textcolor{comment}{// column or row index (first entry in the pair).}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05243}05243         \textcolor{comment}{// This might be inefficient, but we only have to do the sort ONCE}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05244}05244         \textcolor{comment}{// for each list. This is faster than using a map storage scheme, where}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05245}05245         \textcolor{comment}{// we are sorting for every insertion (although the map structure}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05246}05246         \textcolor{comment}{// is cleaner and more memory efficient)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05247}05247         matrix\_data\_list[m][i\_global].sort();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05248}05248 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05249}05249         \textcolor{comment}{// Set up an iterator for start of the list}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05250}05250         std::list<std::pair<unsigned, double>>::iterator it =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05251}05251           matrix\_data\_list[m][i\_global].begin();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05252}05252 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05253}05253         \textcolor{comment}{// Get the first row or column index in the list...}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05254}05254         \textcolor{keywordtype}{unsigned} current\_index = it-\/>first;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05255}05255         \textcolor{comment}{//...and the corresponding value}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05256}05256         \textcolor{keywordtype}{double} current\_value = it-\/>second;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05257}05257 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05258}05258         \textcolor{comment}{// Loop over all the entries in the sorted list}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05259}05259         \textcolor{comment}{// Increase the iterator so that we start at the second entry}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05260}05260         \textcolor{keywordflow}{for} (++it; it != matrix\_data\_list[m][i\_global].end(); ++it)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05261}05261         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05262}05262           \textcolor{comment}{// If the index has not changed, then we must add the contribution}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05263}05263           \textcolor{comment}{// of the present entry to the value.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05264}05264           \textcolor{comment}{// Additionally check that the entry is non-\/zero}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05265}05265           \textcolor{keywordflow}{if} ((it-\/>first == current\_index) \&\&}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05266}05266               (std::fabs(it-\/>second) > \mbox{\hyperlink{classoomph_1_1Problem_ad1a1ffc2bd685377ce7213452876b127}{Numerical\_zero\_for\_sparse\_assembly}}))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05267}05267           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05268}05268             current\_value += it-\/>second;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05269}05269           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05270}05270           \textcolor{comment}{// Otherwise, we have added all the contributions to the index}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05271}05271           \textcolor{comment}{// to current\_value, so add it to the SuperLU data structure}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05272}05272           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05273}05273           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05274}05274             \textcolor{comment}{// Add the row or column index to the vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05275}05275             column\_or\_row\_index[m][entry\_count] = current\_index;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05276}05276             \textcolor{comment}{// Add the actual value to the vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05277}05277             value[m][entry\_count] = current\_value;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05278}05278             \textcolor{comment}{// Increase the counter for the number of entries in each vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05279}05279             entry\_count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05280}05280 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05281}05281             \textcolor{comment}{// Set the index and value to be those of the current entry in the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05282}05282             \textcolor{comment}{// list}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05283}05283             current\_index = it-\/>first;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05284}05284             current\_value = it-\/>second;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05285}05285           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05286}05286         \} \textcolor{comment}{// End of loop over all list entries for this global row or column}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05287}05287 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05288}05288         \textcolor{comment}{// There are TWO special cases to consider.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05289}05289         \textcolor{comment}{// If there is only one equation number in the list, then it}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05290}05290         \textcolor{comment}{// will NOT have been added. We test this case by comparing the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05291}05291         \textcolor{comment}{// number of entries with those stored in row\_or\_column\_start[i\_global]}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05292}05292         \textcolor{comment}{// Otherwise}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05293}05293         \textcolor{comment}{// If the final entry in the list has the same index as the penultimate}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05294}05294         \textcolor{comment}{// entry, then it will NOT have been added to the SuperLU storage scheme}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05295}05295         \textcolor{comment}{// Check this by comparing the current\_index with the final index}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05296}05296         \textcolor{comment}{// stored in the SuperLU scheme. If they are not the same, then}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05297}05297         \textcolor{comment}{// add the current\_index and value.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05298}05298 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05299}05299         \textcolor{comment}{// If single equation number in list}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05300}05300         \textcolor{keywordflow}{if} ((\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(entry\_count) == row\_or\_column\_start[m][i\_global])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05301}05301             \textcolor{comment}{// If we have a single equation number, this will not be evaluated.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05302}05302             \textcolor{comment}{// If we don't then we do the test to check that the final}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05303}05303             \textcolor{comment}{// entry is added}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05304}05304             || (\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(current\_index) !=}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05305}05305                 column\_or\_row\_index[m][entry\_count -\/ 1]))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05306}05306         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05307}05307           \textcolor{comment}{// Add the row or column index to the vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05308}05308           column\_or\_row\_index[m][entry\_count] = current\_index;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05309}05309           \textcolor{comment}{// Add the actual value to the vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05310}05310           value[m][entry\_count] = current\_value;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05311}05311           \textcolor{comment}{// Increase the counter for the number of entries in each vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05312}05312           entry\_count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05313}05313         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05314}05314 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05315}05315       \} \textcolor{comment}{// End of loop over the rows or columns of the entire matrix}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05316}05316 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05317}05317       \textcolor{comment}{// Final entry in the row/column start vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05318}05318       row\_or\_column\_start[m][\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}] = entry\_count;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05319}05319     \} \textcolor{comment}{// End of loop over matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05320}05320 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05321}05321     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aedefa8337ace6043c2fdfd5a2d19afd3}{Pause\_at\_end\_of\_sparse\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05322}05322     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05323}05323       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Pausing at end of sparse assembly."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05324}05324       \mbox{\hyperlink{namespaceoomph_a4a82243b0ce4c28469a290fe2d7cd2c4}{pause}}(\textcolor{stringliteral}{"{}Check memory usage now."{}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05325}05325     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05326}05326   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05327}05327 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05328}05328 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05329}05329   \textcolor{comment}{//=====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05330}05330 \textcolor{comment}{  /// This is a (private) helper function that is used to assemble system}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05331}05331 \textcolor{comment}{  /// matrices in compressed row or column format}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05332}05332 \textcolor{comment}{  /// and compute residual vectors using vectors of pairs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05333}05333 \textcolor{comment}{  /// The default action is to assemble the jacobian matrix and}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05334}05334 \textcolor{comment}{  /// residuals for the Newton method. The action can be}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05335}05335 \textcolor{comment}{  /// overloaded at an elemental level by chaging the default}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05336}05336 \textcolor{comment}{  /// behaviour of the function Element::get\_all\_vectors\_and\_matrices().}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05337}05337 \textcolor{comment}{  /// column\_or\_row\_index: Column [or row] index of given entry}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05338}05338 \textcolor{comment}{  /// row\_or\_column\_start: Index of first entry for given row [or column]}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05339}05339 \textcolor{comment}{  /// value              : Vector of nonzero entries}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05340}05340 \textcolor{comment}{  /// residuals          : Residual vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05341}05341 \textcolor{comment}{  /// compressed\_row\_flag: Bool flag to indicate if storage format is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05342}05342 \textcolor{comment}{  ///                      compressed row [if false interpretation of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05343}05343 \textcolor{comment}{  ///                      arguments is as stated in square brackets].}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05344}05344 \textcolor{comment}{}  \textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05345}\mbox{\hyperlink{classoomph_1_1Problem_a3d5d5ac657381a2b2b077988e887fef8}{05345}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a3d5d5ac657381a2b2b077988e887fef8}{Problem::sparse\_assemble\_row\_or\_column\_compressed\_with\_vectors\_of\_pairs}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05346}05346     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}}\& column\_or\_row\_index,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05347}05347     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}}\& row\_or\_column\_start,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05348}05348     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}}\& value,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05349}05349     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& nnz,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05350}05350     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}}\& residuals,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05351}05351     \textcolor{keywordtype}{bool} compressed\_row\_flag)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05352}05352   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05353}05353     \textcolor{comment}{// Total number of elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05354}05354     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_elements = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05355}05355 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05356}05356     \textcolor{comment}{// Default range of elements for distributed problems}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05357}05357     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} el\_lo = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05358}05358     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} el\_hi = n\_elements -\/ 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05359}05359 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05360}05360 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05361}05361     \textcolor{comment}{// Otherwise just loop over a fraction of the elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05362}05362     \textcolor{comment}{// (This will either have been initialised in}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05363}05363     \textcolor{comment}{// Problem::set\_default\_first\_and\_last\_element\_for\_assembly() or}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05364}05364     \textcolor{comment}{// will have been re-\/assigned during a previous assembly loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05365}05365     \textcolor{comment}{// Note that following the re-\/assignment only the entries}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05366}05366     \textcolor{comment}{// for the current processor are relevant.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05367}05367     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05368}05368     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05369}05369       el\_lo = \mbox{\hyperlink{classoomph_1_1Problem_a0caac0918eaaea840238ce83f5be7836}{First\_el\_for\_assembly}}[\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>my\_rank()];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05370}05370       el\_hi = \mbox{\hyperlink{classoomph_1_1Problem_a4842a9a213197905b5a8e182a3c02cce}{Last\_el\_plus\_one\_for\_assembly}}[\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>my\_rank()] -\/ 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05371}05371     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05372}05372 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05373}05373 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05374}05374     \textcolor{comment}{// number of local eqns}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05375}05375     \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}} = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05376}05376 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05377}05377     \textcolor{comment}{// Find the number of vectors to be assembled}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05378}05378     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_vector = residuals.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05379}05379 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05380}05380     \textcolor{comment}{// Find the number of matrices to be assembled}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05381}05381     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_matrix = column\_or\_row\_index.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05382}05382 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05383}05383     \textcolor{comment}{// Locally cache pointer to assembly handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05384}05384     \mbox{\hyperlink{classoomph_1_1AssemblyHandler}{AssemblyHandler}}* \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}} = \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05385}05385 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05386}05386 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05387}05387     \textcolor{keywordtype}{bool} doing\_residuals = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05388}05388     \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1ParallelResidualsHandler}{ParallelResidualsHandler}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}}) != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05389}05389     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05390}05390       doing\_residuals = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05391}05391     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05392}05392 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05393}05393 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05394}05394 \textcolor{comment}{// Error check dimensions}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05395}05395 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05396}05396     \textcolor{keywordflow}{if} (row\_or\_column\_start.size() != n\_matrix)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05397}05397     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05398}05398       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05399}05399       error\_stream << \textcolor{stringliteral}{"{}Error: "{}} << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05400}05400                    << \textcolor{stringliteral}{"{}row\_or\_column\_start.size() "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05401}05401                    << row\_or\_column\_start.size() << \textcolor{stringliteral}{"{} does not equal "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05402}05402                    << \textcolor{stringliteral}{"{}column\_or\_row\_index.size() "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05403}05403                    << column\_or\_row\_index.size() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05404}05404       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05405}05405         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05406}05406     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05407}05407 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05408}05408     \textcolor{keywordflow}{if} (value.size() != n\_matrix)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05409}05409     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05410}05410       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05411}05411       error\_stream << \textcolor{stringliteral}{"{}Error: "{}} << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05412}05412                    << \textcolor{stringliteral}{"{}value.size() "{}} << value.size() << \textcolor{stringliteral}{"{} does not equal "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05413}05413                    << \textcolor{stringliteral}{"{}column\_or\_row\_index.size() "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05414}05414                    << column\_or\_row\_index.size() << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05415}05415                    << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05416}05416                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05417}05417       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05418}05418         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05419}05419     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05420}05420 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05421}05421 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05422}05422 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05423}05423     \textcolor{comment}{// The idea behind this sparse assembly routine is to use a Vector of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05424}05424     \textcolor{comment}{// Vectors of pairs for each complete matrix.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05425}05425     \textcolor{comment}{// Each inner Vector stores pairs and holds the row (or column) index}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05426}05426     \textcolor{comment}{// and the value of the matrix entry.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05427}05427 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05428}05428     \textcolor{comment}{// Set up Vector of Vectors to store the entries of each matrix,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05429}05429     \textcolor{comment}{// indexed by either the column or row.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05430}05430     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<Vector<std::pair<unsigned, double>}}>>> matrix\_data(n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05431}05431 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05432}05432     \textcolor{comment}{// Loop over the number of matrices being assembled and resize}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05433}05433     \textcolor{comment}{// each Vector of Vectors to the number of rows or columns of the matrix}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05434}05434     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05435}05435     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05436}05436       matrix\_data[m].resize(\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05437}05437     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05438}05438 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05439}05439     \textcolor{comment}{// Resize the residuals vectors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05440}05440     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05441}05441     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05442}05442       residuals[v] = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05443}05443       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05444}05444       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05445}05445         residuals[v][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05446}05446       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05447}05447     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05448}05448 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05449}05449 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05450}05450 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05451}05451     \textcolor{comment}{// Storage for assembly time for elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05452}05452     \textcolor{keywordtype}{double} t\_assemble\_start = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05453}05453 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05454}05454     \textcolor{comment}{// Storage for assembly times}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05455}05455     \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05456}05456     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05457}05457       \mbox{\hyperlink{classoomph_1_1Problem_a2b2bcde2b051f47278ccf8446699bbfb}{Elemental\_assembly\_time}}.resize(n\_elements);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05458}05458     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05459}05459 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05460}05460 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05461}05461 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05462}05462     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/Assemble and populate the vector storage scheme-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05463}05463     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05464}05464       \textcolor{comment}{// Allocate local storage for the element's contribution to the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05465}05465       \textcolor{comment}{// residuals vectors and system matrices of the size of the maximum}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05466}05466       \textcolor{comment}{// number of dofs in any element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05467}05467       \textcolor{comment}{// This means that the storage is only allocated (and deleted) once}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05468}05468       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<double>}}> el\_residuals(n\_vector);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05469}05469       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DenseMatrix<double>}}> el\_jacobian(n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05470}05470 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05471}05471       \textcolor{comment}{// Loop over the elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05472}05472       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = el\_lo; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} <= el\_hi; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05473}05473       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05474}05474 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05475}05475         \textcolor{comment}{// Time it?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05476}05476         \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05477}05477         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05478}05478           t\_assemble\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05479}05479         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05480}05480 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05481}05481 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05482}05482         \textcolor{comment}{// Get the pointer to the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05483}05483         \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05484}05484 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05485}05485 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05486}05486         \textcolor{comment}{// Ignore halo elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05487}05487         \textcolor{keywordflow}{if} (!elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a0d9869eaf7d6e104c1e465b0d3cd6a9b}{is\_halo}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05488}05488         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05489}05489 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05490}05490 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05491}05491           \textcolor{comment}{// Find number of degrees of freedom in the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05492}05492           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nvar = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a09213be8f4aa009e0366460a7ed78e68}{ndof}}(elem\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05493}05493 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05494}05494           \textcolor{comment}{// Resize the storage for elemental jacobian and residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05495}05495           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05496}05496           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05497}05497             el\_residuals[v].resize(nvar);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05498}05498           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05499}05499           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05500}05500           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05501}05501             el\_jacobian[m].resize(nvar);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05502}05502           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05503}05503 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05504}05504           \textcolor{comment}{// Now get the residuals and jacobian for the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05505}05505           \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_ab2e4ee4623116b18245ca90cfe9ba144}{get\_all\_vectors\_and\_matrices}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05506}05506             elem\_pt, el\_residuals, el\_jacobian);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05507}05507 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05508}05508           \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/Insert the values into the vectors-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05509}05509 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05510}05510           \textcolor{comment}{// Loop over the first index of local variables}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05511}05511           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nvar; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05512}05512           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05513}05513             \textcolor{comment}{// Get the local equation number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05514}05514             \textcolor{keywordtype}{unsigned} eqn\_number = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05515}05515 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05516}05516             \textcolor{comment}{// Add the contribution to the residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05517}05517             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05518}05518             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05519}05519               \textcolor{comment}{// Fill in each residuals vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05520}05520               residuals[v][eqn\_number] += el\_residuals[v][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05521}05521             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05522}05522 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05523}05523             \textcolor{comment}{// Now loop over the other index}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05524}05524             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < nvar; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05525}05525             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05526}05526               \textcolor{comment}{// Get the number of the unknown}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05527}05527               \textcolor{keywordtype}{unsigned} unknown = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05528}05528 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05529}05529               \textcolor{comment}{// Loop over the matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05530}05530               \textcolor{comment}{// If it's compressed row storage, then our vector of maps}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05531}05531               \textcolor{comment}{// is indexed by row (equation number)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05532}05532               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05533}05533               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05534}05534                 \textcolor{comment}{// Get the value of the matrix at this point}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05535}05535                 \textcolor{keywordtype}{double} value = el\_jacobian[m](\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05536}05536                 \textcolor{comment}{// Only bother to add to the vector if it's non-\/zero}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05537}05537                 \textcolor{keywordflow}{if} (std::fabs(value) > \mbox{\hyperlink{classoomph_1_1Problem_ad1a1ffc2bd685377ce7213452876b127}{Numerical\_zero\_for\_sparse\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05538}05538                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05539}05539                   \textcolor{comment}{// If it's compressed row storage, then our vector of maps}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05540}05540                   \textcolor{comment}{// is indexed by row (equation number)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05541}05541                   \textcolor{keywordflow}{if} (compressed\_row\_flag)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05542}05542                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05543}05543                     \textcolor{comment}{// Find the correct position and add the data into the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05544}05544                     \textcolor{comment}{// vectors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05545}05545                     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} size = matrix\_data[m][eqn\_number].size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05546}05546                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k <= size; k++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05547}05547                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05548}05548                       \textcolor{keywordflow}{if} (k == size)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05549}05549                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05550}05550                         matrix\_data[m][eqn\_number].push\_back(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05551}05551                           std::make\_pair(unknown, value));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05552}05552                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05553}05553                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05554}05554                       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (matrix\_data[m][eqn\_number][k].first == unknown)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05555}05555                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05556}05556                         matrix\_data[m][eqn\_number][k].second += value;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05557}05557                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05558}05558                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05559}05559                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05560}05560                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05561}05561                   \textcolor{comment}{// Otherwise it's compressed column storage and our vector is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05562}05562                   \textcolor{comment}{// indexed by column (the unknown)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05563}05563                   \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05564}05564                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05565}05565                     \textcolor{comment}{// Add the data into the vectors in the correct position}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05566}05566                     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} size = matrix\_data[m][unknown].size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05567}05567                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k <= size; k++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05568}05568                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05569}05569                       \textcolor{keywordflow}{if} (k == size)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05570}05570                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05571}05571                         matrix\_data[m][unknown].push\_back(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05572}05572                           std::make\_pair(eqn\_number, value));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05573}05573                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05574}05574                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05575}05575                       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (matrix\_data[m][unknown][k].first == eqn\_number)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05576}05576                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05577}05577                         matrix\_data[m][unknown][k].second += value;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05578}05578                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05579}05579                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05580}05580                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05581}05581                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05582}05582                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05583}05583               \} \textcolor{comment}{// End of loop over matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05584}05584             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05585}05585           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05586}05586 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05587}05587 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05588}05588         \} \textcolor{comment}{// endif halo element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05589}05589 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05590}05590 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05591}05591 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05592}05592 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05593}05593         \textcolor{comment}{// Time it?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05594}05594         \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05595}05595         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05596}05596           \mbox{\hyperlink{classoomph_1_1Problem_a2b2bcde2b051f47278ccf8446699bbfb}{Elemental\_assembly\_time}}[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05597}05597             \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}() -\/ t\_assemble\_start;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05598}05598         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05599}05599 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05600}05600 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05601}05601       \} \textcolor{comment}{// End of loop over the elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05602}05602 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05603}05603 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05604}05604     \} \textcolor{comment}{// End of vector assembly}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05605}05605 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05606}05606 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05607}05607 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05608}05608 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05609}05609     \textcolor{comment}{// Postprocess timing information and re-\/allocate distribution of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05610}05610     \textcolor{comment}{// elements during subsequent assemblies.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05611}05611     \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& (!\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}}) \&\&}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05612}05612         \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05613}05613     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05614}05614       \mbox{\hyperlink{classoomph_1_1Problem_aa9d808bb5d62db0da8e962fa29c24af9}{recompute\_load\_balanced\_assembly}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05615}05615     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05616}05616 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05617}05617     \textcolor{comment}{// We have determined load balancing for current setup.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05618}05618     \textcolor{comment}{// This can remain the same until assign\_eqn\_numbers() is called}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05619}05619     \textcolor{comment}{// again -\/-\/ the flag is re-\/set to true there.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05620}05620     \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05621}05621     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05622}05622       \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05623}05623     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05624}05624 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05625}05625 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05626}05626 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05627}05627 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05628}05628     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/Finally we need to convert this vector storage scheme}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05629}05629     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/to the containers required by SuperLU}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05630}05630 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05631}05631     \textcolor{comment}{// Loop over the number of matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05632}05632     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05633}05633     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05634}05634       \textcolor{comment}{// Set the number of rows or columns}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05635}05635       row\_or\_column\_start[m] = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}} + 1];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05636}05636 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05637}05637       \textcolor{comment}{// fill row\_or\_column\_start and find the number of entries}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05638}05638       row\_or\_column\_start[m][0] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05639}05639       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05640}05640       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05641}05641         row\_or\_column\_start[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + 1] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05642}05642           row\_or\_column\_start[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] + matrix\_data[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05643}05643       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05644}05644       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} entries = row\_or\_column\_start[m][\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05645}05645 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05646}05646       \textcolor{comment}{// resize vectors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05647}05647       column\_or\_row\_index[m] = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[entries];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05648}05648       value[m] = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[entries];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05649}05649       nnz[m] = entries;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05650}05650 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05651}05651       \textcolor{comment}{// Now we merely loop over the number of rows or columns}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05652}05652       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} i\_global = 0; i\_global < \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}; i\_global++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05653}05653       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05654}05654         \textcolor{comment}{// If there are no entries in the vector then skip the rest of the loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05655}05655         \textcolor{keywordflow}{if} (matrix\_data[m][i\_global].empty())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05656}05656         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05657}05657           \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05658}05658         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05659}05659 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05660}05660         \textcolor{comment}{// Loop over all the entries in the vectors corresponding to the given}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05661}05661         \textcolor{comment}{// row or column. It will NOT be ordered}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05662}05662         \textcolor{keywordtype}{unsigned} p = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05663}05663         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = row\_or\_column\_start[m][i\_global];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05664}05664              j < row\_or\_column\_start[m][i\_global + 1];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05665}05665              j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05666}05666         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05667}05667           column\_or\_row\_index[m][j] = matrix\_data[m][i\_global][p].first;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05668}05668           value[m][j] = matrix\_data[m][i\_global][p].second;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05669}05669           ++p;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05670}05670         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05671}05671       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05672}05672     \} \textcolor{comment}{// End of the loop over the matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05673}05673 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05674}05674     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aedefa8337ace6043c2fdfd5a2d19afd3}{Pause\_at\_end\_of\_sparse\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05675}05675     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05676}05676       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Pausing at end of sparse assembly."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05677}05677       \mbox{\hyperlink{namespaceoomph_a4a82243b0ce4c28469a290fe2d7cd2c4}{pause}}(\textcolor{stringliteral}{"{}Check memory usage now."{}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05678}05678     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05679}05679   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05680}05680 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05681}05681 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05682}05682   \textcolor{comment}{//=====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05683}05683 \textcolor{comment}{  /// This is a (private) helper function that is used to assemble system}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05684}05684 \textcolor{comment}{  /// matrices in compressed row or column format}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05685}05685 \textcolor{comment}{  /// and compute residual vectors using two vectors.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05686}05686 \textcolor{comment}{  /// The default action is to assemble the jacobian matrix and}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05687}05687 \textcolor{comment}{  /// residuals for the Newton method. The action can be}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05688}05688 \textcolor{comment}{  /// overloaded at an elemental level by chaging the default}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05689}05689 \textcolor{comment}{  /// behaviour of the function Element::get\_all\_vectors\_and\_matrices().}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05690}05690 \textcolor{comment}{  /// column\_or\_row\_index: Column [or row] index of given entry}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05691}05691 \textcolor{comment}{  /// row\_or\_column\_start: Index of first entry for given row [or column]}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05692}05692 \textcolor{comment}{  /// value              : Vector of nonzero entries}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05693}05693 \textcolor{comment}{  /// residuals          : Residual vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05694}05694 \textcolor{comment}{  /// compressed\_row\_flag: Bool flag to indicate if storage format is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05695}05695 \textcolor{comment}{  ///                      compressed row [if false interpretation of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05696}05696 \textcolor{comment}{  ///                      arguments is as stated in square brackets].}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05697}05697 \textcolor{comment}{}  \textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05698}\mbox{\hyperlink{classoomph_1_1Problem_a767f7064ccbdcc2a039e0360b98dc48d}{05698}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a767f7064ccbdcc2a039e0360b98dc48d}{Problem::sparse\_assemble\_row\_or\_column\_compressed\_with\_two\_vectors}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05699}05699     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}}\& column\_or\_row\_index,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05700}05700     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}}\& row\_or\_column\_start,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05701}05701     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}}\& value,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05702}05702     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& nnz,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05703}05703     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}}\& residuals,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05704}05704     \textcolor{keywordtype}{bool} compressed\_row\_flag)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05705}05705   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05706}05706     \textcolor{comment}{// Total number of elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05707}05707     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_elements = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05708}05708 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05709}05709     \textcolor{comment}{// Default range of elements for distributed problems}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05710}05710     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} el\_lo = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05711}05711     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} el\_hi = n\_elements -\/ 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05712}05712 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05713}05713 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05714}05714 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05715}05715     \textcolor{comment}{// Otherwise just loop over a fraction of the elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05716}05716     \textcolor{comment}{// (This will either have been initialised in}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05717}05717     \textcolor{comment}{// Problem::set\_default\_first\_and\_last\_element\_for\_assembly() or}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05718}05718     \textcolor{comment}{// will have been re-\/assigned during a previous assembly loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05719}05719     \textcolor{comment}{// Note that following the re-\/assignment only the entries}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05720}05720     \textcolor{comment}{// for the current processor are relevant.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05721}05721     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05722}05722     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05723}05723       el\_lo = \mbox{\hyperlink{classoomph_1_1Problem_a0caac0918eaaea840238ce83f5be7836}{First\_el\_for\_assembly}}[\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>my\_rank()];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05724}05724       el\_hi = \mbox{\hyperlink{classoomph_1_1Problem_a4842a9a213197905b5a8e182a3c02cce}{Last\_el\_plus\_one\_for\_assembly}}[\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>my\_rank()] -\/ 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05725}05725     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05726}05726 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05727}05727 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05728}05728     \textcolor{comment}{// number of local eqns}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05729}05729     \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}} = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05730}05730 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05731}05731     \textcolor{comment}{// Find the number of vectors to be assembled}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05732}05732     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_vector = residuals.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05733}05733 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05734}05734     \textcolor{comment}{// Find the number of matrices to be assembled}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05735}05735     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_matrix = column\_or\_row\_index.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05736}05736 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05737}05737     \textcolor{comment}{// Locally cache pointer to assembly handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05738}05738     \mbox{\hyperlink{classoomph_1_1AssemblyHandler}{AssemblyHandler}}* \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}} = \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05739}05739 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05740}05740 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05741}05741     \textcolor{keywordtype}{bool} doing\_residuals = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05742}05742     \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1ParallelResidualsHandler}{ParallelResidualsHandler}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}}) != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05743}05743     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05744}05744       doing\_residuals = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05745}05745     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05746}05746 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05747}05747 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05748}05748 \textcolor{comment}{// Error check dimensions}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05749}05749 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05750}05750     \textcolor{keywordflow}{if} (row\_or\_column\_start.size() != n\_matrix)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05751}05751     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05752}05752       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05753}05753       error\_stream << \textcolor{stringliteral}{"{}Error: "{}} << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05754}05754                    << \textcolor{stringliteral}{"{}row\_or\_column\_start.size() "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05755}05755                    << row\_or\_column\_start.size() << \textcolor{stringliteral}{"{} does not equal "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05756}05756                    << \textcolor{stringliteral}{"{}column\_or\_row\_index.size() "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05757}05757                    << column\_or\_row\_index.size() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05758}05758       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05759}05759         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05760}05760     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05761}05761 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05762}05762     \textcolor{keywordflow}{if} (value.size() != n\_matrix)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05763}05763     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05764}05764       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05765}05765       error\_stream << \textcolor{stringliteral}{"{}Error: "{}} << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05766}05766                    << \textcolor{stringliteral}{"{}value.size() "{}} << value.size() << \textcolor{stringliteral}{"{} does not equal "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05767}05767                    << \textcolor{stringliteral}{"{}column\_or\_row\_index.size() "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05768}05768                    << column\_or\_row\_index.size() << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05769}05769                    << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05770}05770                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05771}05771       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05772}05772         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05773}05773     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05774}05774 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05775}05775 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05776}05776     \textcolor{comment}{// The idea behind this sparse assembly routine is to use Vectors of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05777}05777     \textcolor{comment}{// Vectors for the entries in each complete matrix. And a second}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05778}05778     \textcolor{comment}{// Vector of Vectors stores the global row (or column) indeces. This}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05779}05779     \textcolor{comment}{// will not have the memory overheads associated with the methods using}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05780}05780     \textcolor{comment}{// lists or maps, but insertion will be more costly.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05781}05781 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05782}05782     \textcolor{comment}{// Set up two vector of vectors to store the entries of each  matrix,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05783}05783     \textcolor{comment}{// indexed by either the column or row. The entries of the vector for}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05784}05784     \textcolor{comment}{// each matrix correspond to all the rows or columns of that matrix.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05785}05785     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<Vector<unsigned>}}>> matrix\_row\_or\_col\_indices(n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05786}05786     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<Vector<double>}}>> matrix\_values(n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05787}05787 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05788}05788     \textcolor{comment}{// Loop over the number of matrices being assembled and resize}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05789}05789     \textcolor{comment}{// each vector of vectors to the number of rows or columns of the matrix}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05790}05790     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05791}05791     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05792}05792       matrix\_row\_or\_col\_indices[m].resize(\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05793}05793       matrix\_values[m].resize(\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05794}05794     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05795}05795 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05796}05796     \textcolor{comment}{// Resize the residuals vectors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05797}05797     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05798}05798     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05799}05799       residuals[v] = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05800}05800       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05801}05801       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05802}05802         residuals[v][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05803}05803       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05804}05804     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05805}05805 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05806}05806 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05807}05807 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05808}05808     \textcolor{comment}{// Storage for assembly time for elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05809}05809     \textcolor{keywordtype}{double} t\_assemble\_start = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05810}05810 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05811}05811     \textcolor{comment}{// Storage for assembly times}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05812}05812     \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05813}05813     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05814}05814       \mbox{\hyperlink{classoomph_1_1Problem_a2b2bcde2b051f47278ccf8446699bbfb}{Elemental\_assembly\_time}}.resize(n\_elements);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05815}05815     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05816}05816 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05817}05817 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05818}05818 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05819}05819 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05820}05820     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/Assemble and populate the vector storage scheme-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05821}05821     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05822}05822       \textcolor{comment}{// Allocate local storage for the element's contribution to the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05823}05823       \textcolor{comment}{// residuals vectors and system matrices of the size of the maximum}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05824}05824       \textcolor{comment}{// number of dofs in any element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05825}05825       \textcolor{comment}{// This means that the storage will only be allocated (and deleted) once}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05826}05826       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<double>}}> el\_residuals(n\_vector);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05827}05827       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DenseMatrix<double>}}> el\_jacobian(n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05828}05828 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05829}05829       \textcolor{comment}{// Loop over the elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05830}05830       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = el\_lo; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} <= el\_hi; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05831}05831       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05832}05832 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05833}05833         \textcolor{comment}{// Time it?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05834}05834         \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05835}05835         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05836}05836           t\_assemble\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05837}05837         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05838}05838 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05839}05839 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05840}05840         \textcolor{comment}{// Get the pointer to the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05841}05841         \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05842}05842 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05843}05843 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05844}05844         \textcolor{comment}{// Ignore halo elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05845}05845         \textcolor{keywordflow}{if} (!elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a0d9869eaf7d6e104c1e465b0d3cd6a9b}{is\_halo}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05846}05846         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05847}05847 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05848}05848 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05849}05849           \textcolor{comment}{// Find number of degrees of freedom in the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05850}05850           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nvar = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a09213be8f4aa009e0366460a7ed78e68}{ndof}}(elem\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05851}05851 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05852}05852           \textcolor{comment}{// Resize the storage for elemental jacobian and residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05853}05853           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05854}05854           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05855}05855             el\_residuals[v].resize(nvar);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05856}05856           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05857}05857           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05858}05858           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05859}05859             el\_jacobian[m].resize(nvar);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05860}05860           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05861}05861 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05862}05862           \textcolor{comment}{// Now get the residuals and jacobian for the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05863}05863           \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_ab2e4ee4623116b18245ca90cfe9ba144}{get\_all\_vectors\_and\_matrices}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05864}05864             elem\_pt, el\_residuals, el\_jacobian);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05865}05865 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05866}05866           \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/Insert the values into the vectors-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05867}05867 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05868}05868           \textcolor{comment}{// Loop over the first index of local variables}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05869}05869           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nvar; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05870}05870           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05871}05871             \textcolor{comment}{// Get the local equation number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05872}05872             \textcolor{keywordtype}{unsigned} eqn\_number = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05873}05873 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05874}05874             \textcolor{comment}{// Add the contribution to the residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05875}05875             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05876}05876             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05877}05877               \textcolor{comment}{// Fill in each residuals vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05878}05878               residuals[v][eqn\_number] += el\_residuals[v][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05879}05879             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05880}05880 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05881}05881             \textcolor{comment}{// Now loop over the other index}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05882}05882             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < nvar; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05883}05883             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05884}05884               \textcolor{comment}{// Get the number of the unknown}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05885}05885               \textcolor{keywordtype}{unsigned} unknown = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05886}05886 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05887}05887               \textcolor{comment}{// Loop over the matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05888}05888               \textcolor{comment}{// If it's compressed row storage, then our vector of maps}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05889}05889               \textcolor{comment}{// is indexed by row (equation number)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05890}05890               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05891}05891               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05892}05892                 \textcolor{comment}{// Get the value of the matrix at this point}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05893}05893                 \textcolor{keywordtype}{double} value = el\_jacobian[m](\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05894}05894                 \textcolor{comment}{// Only bother to add to the vector if it's non-\/zero}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05895}05895                 \textcolor{keywordflow}{if} (std::fabs(value) > \mbox{\hyperlink{classoomph_1_1Problem_ad1a1ffc2bd685377ce7213452876b127}{Numerical\_zero\_for\_sparse\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05896}05896                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05897}05897                   \textcolor{comment}{// If it's compressed row storage, then our vector of maps}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05898}05898                   \textcolor{comment}{// is indexed by row (equation number)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05899}05899                   \textcolor{keywordflow}{if} (compressed\_row\_flag)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05900}05900                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05901}05901                     \textcolor{comment}{// Find the correct position and add the data into the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05902}05902                     \textcolor{comment}{// vectors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05903}05903                     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} size =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05904}05904                       matrix\_row\_or\_col\_indices[m][eqn\_number].size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05905}05905 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05906}05906                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k <= size; k++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05907}05907                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05908}05908                       \textcolor{keywordflow}{if} (k == size)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05909}05909                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05910}05910                         matrix\_row\_or\_col\_indices[m][eqn\_number].push\_back(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05911}05911                           unknown);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05912}05912                         matrix\_values[m][eqn\_number].push\_back(value);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05913}05913                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05914}05914                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05915}05915                       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (matrix\_row\_or\_col\_indices[m][eqn\_number][k] ==}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05916}05916                                unknown)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05917}05917                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05918}05918                         matrix\_values[m][eqn\_number][k] += value;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05919}05919                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05920}05920                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05921}05921                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05922}05922                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05923}05923                   \textcolor{comment}{// Otherwise it's compressed column storage and our vector is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05924}05924                   \textcolor{comment}{// indexed by column (the unknown)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05925}05925                   \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05926}05926                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05927}05927                     \textcolor{comment}{// Add the data into the vectors in the correct position}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05928}05928                     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} size =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05929}05929                       matrix\_row\_or\_col\_indices[m][unknown].size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05930}05930                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k <= size; k++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05931}05931                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05932}05932                       \textcolor{keywordflow}{if} (k == size)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05933}05933                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05934}05934                         matrix\_row\_or\_col\_indices[m][unknown].push\_back(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05935}05935                           eqn\_number);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05936}05936                         matrix\_values[m][unknown].push\_back(value);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05937}05937                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05938}05938                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05939}05939                       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (matrix\_row\_or\_col\_indices[m][unknown][k] ==}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05940}05940                                eqn\_number)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05941}05941                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05942}05942                         matrix\_values[m][unknown][k] += value;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05943}05943                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05944}05944                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05945}05945                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05946}05946                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05947}05947                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05948}05948               \} \textcolor{comment}{// End of loop over matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05949}05949             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05950}05950           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05951}05951 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05952}05952 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05953}05953         \} \textcolor{comment}{// endif halo element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05954}05954 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05955}05955 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05956}05956 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05957}05957 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05958}05958         \textcolor{comment}{// Time it?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05959}05959         \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05960}05960         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05961}05961           \mbox{\hyperlink{classoomph_1_1Problem_a2b2bcde2b051f47278ccf8446699bbfb}{Elemental\_assembly\_time}}[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05962}05962             \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}() -\/ t\_assemble\_start;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05963}05963         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05964}05964 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05965}05965 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05966}05966       \} \textcolor{comment}{// End of loop over the elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05967}05967 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05968}05968     \} \textcolor{comment}{// End of vector assembly}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05969}05969 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05970}05970 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05971}05971 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05972}05972 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05973}05973     \textcolor{comment}{// Postprocess timing information and re-\/allocate distribution of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05974}05974     \textcolor{comment}{// elements during subsequent assemblies.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05975}05975     \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& (!\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}}) \&\&}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05976}05976         \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05977}05977     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05978}05978       \mbox{\hyperlink{classoomph_1_1Problem_aa9d808bb5d62db0da8e962fa29c24af9}{recompute\_load\_balanced\_assembly}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05979}05979     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05980}05980 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05981}05981     \textcolor{comment}{// We have determined load balancing for current setup.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05982}05982     \textcolor{comment}{// This can remain the same until assign\_eqn\_numbers() is called}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05983}05983     \textcolor{comment}{// again -\/-\/ the flag is re-\/set to true there.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05984}05984     \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05985}05985     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05986}05986       \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05987}05987     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05988}05988 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05989}05989 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05990}05990 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05991}05991     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/Finally we need to convert this lousy vector storage scheme}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05992}05992     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/to the containers required by SuperLU}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05993}05993 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05994}05994     \textcolor{comment}{// Loop over the number of matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05995}05995     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05996}05996     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05997}05997       \textcolor{comment}{// Set the number of rows or columns}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05998}05998       row\_or\_column\_start[m] = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}} + 1];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l05999}05999 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06000}06000       \textcolor{comment}{// fill row\_or\_column\_start and find the number of entries}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06001}06001       row\_or\_column\_start[m][0] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06002}06002       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06003}06003       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06004}06004         row\_or\_column\_start[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + 1] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06005}06005           row\_or\_column\_start[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] + matrix\_values[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06006}06006       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06007}06007       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} entries = row\_or\_column\_start[m][\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06008}06008 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06009}06009       \textcolor{comment}{// resize vectors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06010}06010       column\_or\_row\_index[m] = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[entries];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06011}06011       value[m] = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[entries];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06012}06012       nnz[m] = entries;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06013}06013 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06014}06014       \textcolor{comment}{// Now we merely loop over the number of rows or columns}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06015}06015       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} i\_global = 0; i\_global < \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}; i\_global++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06016}06016       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06017}06017         \textcolor{comment}{// If there are no entries in the vector then skip the rest of the loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06018}06018         \textcolor{keywordflow}{if} (matrix\_values[m][i\_global].empty())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06019}06019         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06020}06020           \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06021}06021         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06022}06022 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06023}06023         \textcolor{comment}{// Loop over all the entries in the vectors corresponding to the given}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06024}06024         \textcolor{comment}{// row or column. It will NOT be ordered}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06025}06025         \textcolor{keywordtype}{unsigned} p = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06026}06026         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = row\_or\_column\_start[m][i\_global];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06027}06027              j < row\_or\_column\_start[m][i\_global + 1];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06028}06028              j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06029}06029         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06030}06030           column\_or\_row\_index[m][j] = matrix\_row\_or\_col\_indices[m][i\_global][p];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06031}06031           value[m][j] = matrix\_values[m][i\_global][p];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06032}06032           ++p;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06033}06033         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06034}06034       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06035}06035     \} \textcolor{comment}{// End of the loop over the matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06036}06036 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06037}06037     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aedefa8337ace6043c2fdfd5a2d19afd3}{Pause\_at\_end\_of\_sparse\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06038}06038     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06039}06039       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Pausing at end of sparse assembly."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06040}06040       \mbox{\hyperlink{namespaceoomph_a4a82243b0ce4c28469a290fe2d7cd2c4}{pause}}(\textcolor{stringliteral}{"{}Check memory usage now."{}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06041}06041     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06042}06042   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06043}06043 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06044}06044 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06045}06045   \textcolor{comment}{//=====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06046}06046 \textcolor{comment}{  /// This is a (private) helper function that is used to assemble system}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06047}06047 \textcolor{comment}{  /// matrices in compressed row or column format}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06048}06048 \textcolor{comment}{  /// and compute residual vectors using two vectors.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06049}06049 \textcolor{comment}{  /// The default action is to assemble the jacobian matrix and}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06050}06050 \textcolor{comment}{  /// residuals for the Newton method. The action can be}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06051}06051 \textcolor{comment}{  /// overloaded at an elemental level by chaging the default}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06052}06052 \textcolor{comment}{  /// behaviour of the function Element::get\_all\_vectors\_and\_matrices().}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06053}06053 \textcolor{comment}{  /// column\_or\_row\_index: Column [or row] index of given entry}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06054}06054 \textcolor{comment}{  /// row\_or\_column\_start: Index of first entry for given row [or column]}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06055}06055 \textcolor{comment}{  /// value              : Vector of nonzero entries}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06056}06056 \textcolor{comment}{  /// residuals          : Residual vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06057}06057 \textcolor{comment}{  /// compressed\_row\_flag: Bool flag to indicate if storage format is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06058}06058 \textcolor{comment}{  ///                      compressed row [if false interpretation of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06059}06059 \textcolor{comment}{  ///                      arguments is as stated in square brackets].}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06060}06060 \textcolor{comment}{}  \textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06061}\mbox{\hyperlink{classoomph_1_1Problem_a19520f8a38dc1dabb33cd7f397ff3506}{06061}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a19520f8a38dc1dabb33cd7f397ff3506}{Problem::sparse\_assemble\_row\_or\_column\_compressed\_with\_two\_arrays}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06062}06062     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}}\& column\_or\_row\_index,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06063}06063     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}}\& row\_or\_column\_start,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06064}06064     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}}\& value,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06065}06065     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& nnz,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06066}06066     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}}\& residuals,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06067}06067     \textcolor{keywordtype}{bool} compressed\_row\_flag)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06068}06068   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06069}06069     \textcolor{comment}{// Total number of elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06070}06070     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_elements = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06071}06071 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06072}06072     \textcolor{comment}{// Default range of elements for distributed problems}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06073}06073     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} el\_lo = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06074}06074     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} el\_hi = n\_elements -\/ 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06075}06075 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06076}06076 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06077}06077 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06078}06078     \textcolor{comment}{// Otherwise just loop over a fraction of the elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06079}06079     \textcolor{comment}{// (This will either have been initialised in}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06080}06080     \textcolor{comment}{// Problem::set\_default\_first\_and\_last\_element\_for\_assembly() or}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06081}06081     \textcolor{comment}{// will have been re-\/assigned during a previous assembly loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06082}06082     \textcolor{comment}{// Note that following the re-\/assignment only the entries}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06083}06083     \textcolor{comment}{// for the current processor are relevant.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06084}06084     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06085}06085     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06086}06086       el\_lo = \mbox{\hyperlink{classoomph_1_1Problem_a0caac0918eaaea840238ce83f5be7836}{First\_el\_for\_assembly}}[\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>my\_rank()];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06087}06087       el\_hi = \mbox{\hyperlink{classoomph_1_1Problem_a4842a9a213197905b5a8e182a3c02cce}{Last\_el\_plus\_one\_for\_assembly}}[\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>my\_rank()] -\/ 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06088}06088     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06089}06089 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06090}06090 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06091}06091     \textcolor{comment}{// number of local eqns}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06092}06092     \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}} = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06093}06093 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06094}06094     \textcolor{comment}{// Find the number of vectors to be assembled}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06095}06095     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_vector = residuals.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06096}06096 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06097}06097     \textcolor{comment}{// Find the number of matrices to be assembled}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06098}06098     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_matrix = column\_or\_row\_index.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06099}06099 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06100}06100     \textcolor{comment}{// Locally cache pointer to assembly handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06101}06101     \mbox{\hyperlink{classoomph_1_1AssemblyHandler}{AssemblyHandler}}* \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}} = \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06102}06102 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06103}06103 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06104}06104     \textcolor{keywordtype}{bool} doing\_residuals = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06105}06105     \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1ParallelResidualsHandler}{ParallelResidualsHandler}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}}) != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06106}06106     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06107}06107       doing\_residuals = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06108}06108     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06109}06109 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06110}06110 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06111}06111 \textcolor{comment}{// Error check dimensions}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06112}06112 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06113}06113     \textcolor{keywordflow}{if} (row\_or\_column\_start.size() != n\_matrix)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06114}06114     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06115}06115       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06116}06116       error\_stream << \textcolor{stringliteral}{"{}Error: "{}} << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06117}06117                    << \textcolor{stringliteral}{"{}row\_or\_column\_start.size() "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06118}06118                    << row\_or\_column\_start.size() << \textcolor{stringliteral}{"{} does not equal "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06119}06119                    << \textcolor{stringliteral}{"{}column\_or\_row\_index.size() "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06120}06120                    << column\_or\_row\_index.size() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06121}06121       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06122}06122         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06123}06123     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06124}06124 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06125}06125     \textcolor{keywordflow}{if} (value.size() != n\_matrix)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06126}06126     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06127}06127       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06128}06128       error\_stream << \textcolor{stringliteral}{"{}Error: "{}} << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06129}06129                    << \textcolor{stringliteral}{"{}value.size() "{}} << value.size() << \textcolor{stringliteral}{"{} does not equal "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06130}06130                    << \textcolor{stringliteral}{"{}column\_or\_row\_index.size() "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06131}06131                    << column\_or\_row\_index.size() << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06132}06132                    << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06133}06133                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06134}06134       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06135}06135         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06136}06136     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06137}06137 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06138}06138 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06139}06139     \textcolor{comment}{// The idea behind this sparse assembly routine is to use Vectors of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06140}06140     \textcolor{comment}{// Vectors for the entries in each complete matrix. And a second}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06141}06141     \textcolor{comment}{// Vector of Vectors stores the global row (or column) indeces. This}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06142}06142     \textcolor{comment}{// will not have the memory overheads associated with the methods using}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06143}06143     \textcolor{comment}{// lists or maps, but insertion will be more costly.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06144}06144 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06145}06145     \textcolor{comment}{// Set up two vector of vectors to store the entries of each  matrix,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06146}06146     \textcolor{comment}{// indexed by either the column or row. The entries of the vector for}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06147}06147     \textcolor{comment}{// each matrix correspond to all the rows or columns of that matrix.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06148}06148     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned**>}} matrix\_row\_or\_col\_indices(n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06149}06149     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double**>}} matrix\_values(n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06150}06150 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06151}06151     \textcolor{comment}{// Loop over the number of matrices being assembled and resize}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06152}06152     \textcolor{comment}{// each vector of vectors to the number of rows or columns of the matrix}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06153}06153     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06154}06154     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06155}06155       matrix\_row\_or\_col\_indices[m] = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}*[\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06156}06156       matrix\_values[m] = \textcolor{keyword}{new} \textcolor{keywordtype}{double}*[\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06157}06157     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06158}06158 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06159}06159     \textcolor{comment}{// Resize the residuals vectors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06160}06160     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06161}06161     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06162}06162       residuals[v] = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06163}06163       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06164}06164       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06165}06165         residuals[v][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06166}06166       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06167}06167     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06168}06168 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06169}06169 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06170}06170 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06171}06171     \textcolor{comment}{// Storage for assembly time for elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06172}06172     \textcolor{keywordtype}{double} t\_assemble\_start = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06173}06173 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06174}06174     \textcolor{comment}{// Storage for assembly times}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06175}06175     \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06176}06176     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06177}06177       \mbox{\hyperlink{classoomph_1_1Problem_a2b2bcde2b051f47278ccf8446699bbfb}{Elemental\_assembly\_time}}.resize(n\_elements);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06178}06178     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06179}06179 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06180}06180 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06181}06181 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06182}06182     \textcolor{comment}{// number of coefficients in each row}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06183}06183     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<unsigned>}}> ncoef(n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06184}06184     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06185}06185     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06186}06186       ncoef[m].resize(\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06187}06187     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06188}06188 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06189}06189     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}.size() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06190}06190     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06191}06191       \mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}.resize(n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06192}06192       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06193}06193       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06194}06194         \mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}[m].resize(\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06195}06195       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06196}06196     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06197}06197 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06198}06198     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/Assemble and populate the vector storage scheme-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06199}06199     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06200}06200       \textcolor{comment}{// Allocate local storage for the element's contribution to the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06201}06201       \textcolor{comment}{// residuals vectors and system matrices of the size of the maximum}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06202}06202       \textcolor{comment}{// number of dofs in any element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06203}06203       \textcolor{comment}{// This means that the storage will only be allocated (and deleted) once}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06204}06204       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<double>}}> el\_residuals(n\_vector);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06205}06205       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DenseMatrix<double>}}> el\_jacobian(n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06206}06206 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06207}06207       \textcolor{comment}{// Loop over the elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06208}06208       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = el\_lo; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} <= el\_hi; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06209}06209       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06210}06210 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06211}06211         \textcolor{comment}{// Time it?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06212}06212         \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06213}06213         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06214}06214           t\_assemble\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06215}06215         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06216}06216 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06217}06217 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06218}06218         \textcolor{comment}{// Get the pointer to the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06219}06219         \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06220}06220 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06221}06221 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06222}06222         \textcolor{comment}{// Ignore halo elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06223}06223         \textcolor{keywordflow}{if} (!elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a0d9869eaf7d6e104c1e465b0d3cd6a9b}{is\_halo}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06224}06224         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06225}06225 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06226}06226 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06227}06227           \textcolor{comment}{// Find number of degrees of freedom in the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06228}06228           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nvar = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a09213be8f4aa009e0366460a7ed78e68}{ndof}}(elem\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06229}06229 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06230}06230           \textcolor{comment}{// Resize the storage for elemental jacobian and residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06231}06231           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06232}06232           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06233}06233             el\_residuals[v].resize(nvar);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06234}06234           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06235}06235           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06236}06236           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06237}06237             el\_jacobian[m].resize(nvar);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06238}06238           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06239}06239 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06240}06240           \textcolor{comment}{// Now get the residuals and jacobian for the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06241}06241           \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_ab2e4ee4623116b18245ca90cfe9ba144}{get\_all\_vectors\_and\_matrices}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06242}06242             elem\_pt, el\_residuals, el\_jacobian);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06243}06243 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06244}06244           \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/Insert the values into the vectors-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06245}06245 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06246}06246           \textcolor{comment}{// Loop over the first index of local variables}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06247}06247           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nvar; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06248}06248           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06249}06249             \textcolor{comment}{// Get the local equation number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06250}06250             \textcolor{keywordtype}{unsigned} eqn\_number = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06251}06251 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06252}06252             \textcolor{comment}{// Add the contribution to the residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06253}06253             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06254}06254             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06255}06255               \textcolor{comment}{// Fill in each residuals vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06256}06256               residuals[v][eqn\_number] += el\_residuals[v][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06257}06257             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06258}06258 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06259}06259             \textcolor{comment}{// Now loop over the other index}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06260}06260             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < nvar; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06261}06261             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06262}06262               \textcolor{comment}{// Get the number of the unknown}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06263}06263               \textcolor{keywordtype}{unsigned} unknown = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06264}06264 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06265}06265               \textcolor{comment}{// Loop over the matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06266}06266               \textcolor{comment}{// If it's compressed row storage, then our vector of maps}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06267}06267               \textcolor{comment}{// is indexed by row (equation number)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06268}06268               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06269}06269               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06270}06270                 \textcolor{comment}{// Get the value of the matrix at this point}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06271}06271                 \textcolor{keywordtype}{double} value = el\_jacobian[m](\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06272}06272                 \textcolor{comment}{// Only bother to add to the vector if it's non-\/zero}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06273}06273                 \textcolor{keywordflow}{if} (std::fabs(value) > \mbox{\hyperlink{classoomph_1_1Problem_ad1a1ffc2bd685377ce7213452876b127}{Numerical\_zero\_for\_sparse\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06274}06274                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06275}06275                   \textcolor{comment}{// number of entrys in this row}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06276}06276                   \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} size = ncoef[m][eqn\_number];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06277}06277 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06278}06278                   \textcolor{comment}{// if no data has been allocated for this row then allocate}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06279}06279                   \textcolor{keywordflow}{if} (size == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06280}06280                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06281}06281                     \textcolor{comment}{// do we have previous allocation data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06282}06282                     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06283}06283                           [m][eqn\_number] != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06284}06284                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06285}06285                       matrix\_row\_or\_col\_indices[m][eqn\_number] = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06286}06286                         [\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06287}06287                            [m][eqn\_number]];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06288}06288                       matrix\_values[m][eqn\_number] = \textcolor{keyword}{new} \textcolor{keywordtype}{double}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06289}06289                         [\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06290}06290                            [m][eqn\_number]];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06291}06291                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06292}06292                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06293}06293                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06294}06294                       matrix\_row\_or\_col\_indices[m][eqn\_number] = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06295}06295                         [\mbox{\hyperlink{classoomph_1_1Problem_ad2d5f8e18619fafcff11727b1c55b3eb}{Sparse\_assemble\_with\_arrays\_initial\_allocation}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06296}06296                       matrix\_values[m][eqn\_number] = \textcolor{keyword}{new} \textcolor{keywordtype}{double}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06297}06297                         [\mbox{\hyperlink{classoomph_1_1Problem_ad2d5f8e18619fafcff11727b1c55b3eb}{Sparse\_assemble\_with\_arrays\_initial\_allocation}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06298}06298                       \mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06299}06299                         [m][eqn\_number] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06300}06300                           \mbox{\hyperlink{classoomph_1_1Problem_ad2d5f8e18619fafcff11727b1c55b3eb}{Sparse\_assemble\_with\_arrays\_initial\_allocation}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06301}06301                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06302}06302                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06303}06303 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06304}06304                   \textcolor{comment}{// If it's compressed row storage, then our vector of maps}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06305}06305                   \textcolor{comment}{// is indexed by row (equation number)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06306}06306                   \textcolor{keywordflow}{if} (compressed\_row\_flag)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06307}06307                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06308}06308                     \textcolor{comment}{// next add the data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06309}06309                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k <= size; k++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06310}06310                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06311}06311                       \textcolor{keywordflow}{if} (k == size)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06312}06312                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06313}06313                         \textcolor{comment}{// do we need to allocate more storage}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06314}06314                         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06315}06315                               [m][eqn\_number] == ncoef[m][eqn\_number])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06316}06316                         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06317}06317                           \textcolor{keywordtype}{unsigned} new\_allocation =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06318}06318                             ncoef[m][eqn\_number] +}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06319}06319                             \mbox{\hyperlink{classoomph_1_1Problem_aeb58a3cead4d10697c4471523f705130}{Sparse\_assemble\_with\_arrays\_allocation\_increment}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06320}06320                           \textcolor{keywordtype}{double}* new\_values = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[new\_allocation];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06321}06321                           \textcolor{keywordtype}{unsigned}* new\_indices = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}[new\_allocation];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06322}06322                           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} c = 0; c < ncoef[m][eqn\_number]; c++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06323}06323                           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06324}06324                             new\_values[c] = matrix\_values[m][eqn\_number][c];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06325}06325                             new\_indices[c] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06326}06326                               matrix\_row\_or\_col\_indices[m][eqn\_number][c];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06327}06327                           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06328}06328                           \textcolor{keyword}{delete}[] matrix\_values[m][eqn\_number];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06329}06329                           \textcolor{keyword}{delete}[] matrix\_row\_or\_col\_indices[m][eqn\_number];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06330}06330                           matrix\_values[m][eqn\_number] = new\_values;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06331}06331                           matrix\_row\_or\_col\_indices[m][eqn\_number] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06332}06332                             new\_indices;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06333}06333                           \mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06334}06334                             [m][eqn\_number] = new\_allocation;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06335}06335                         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06336}06336                         \textcolor{comment}{// and now add the data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06337}06337                         \textcolor{keywordtype}{unsigned} entry = ncoef[m][eqn\_number];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06338}06338                         ncoef[m][eqn\_number]++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06339}06339                         matrix\_row\_or\_col\_indices[m][eqn\_number][entry] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06340}06340                           unknown;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06341}06341                         matrix\_values[m][eqn\_number][entry] = value;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06342}06342                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06343}06343                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06344}06344                       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (matrix\_row\_or\_col\_indices[m][eqn\_number][k] ==}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06345}06345                                unknown)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06346}06346                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06347}06347                         matrix\_values[m][eqn\_number][k] += value;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06348}06348                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06349}06349                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06350}06350                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06351}06351                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06352}06352                   \textcolor{comment}{// Otherwise it's compressed column storage and our vector is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06353}06353                   \textcolor{comment}{// indexed by column (the unknown)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06354}06354                   \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06355}06355                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06356}06356                     \textcolor{comment}{// Add the data into the vectors in the correct position}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06357}06357                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k <= size; k++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06358}06358                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06359}06359                       \textcolor{keywordflow}{if} (k == size)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06360}06360                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06361}06361                         \textcolor{comment}{// do we need to allocate more storage}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06362}06362                         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06363}06363                               [m][unknown] == ncoef[m][unknown])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06364}06364                         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06365}06365                           \textcolor{keywordtype}{unsigned} new\_allocation =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06366}06366                             ncoef[m][unknown] +}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06367}06367                             \mbox{\hyperlink{classoomph_1_1Problem_aeb58a3cead4d10697c4471523f705130}{Sparse\_assemble\_with\_arrays\_allocation\_increment}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06368}06368                           \textcolor{keywordtype}{double}* new\_values = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[new\_allocation];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06369}06369                           \textcolor{keywordtype}{unsigned}* new\_indices = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}[new\_allocation];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06370}06370                           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} c = 0; c < ncoef[m][unknown]; c++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06371}06371                           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06372}06372                             new\_values[c] = matrix\_values[m][unknown][c];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06373}06373                             new\_indices[c] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06374}06374                               matrix\_row\_or\_col\_indices[m][unknown][c];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06375}06375                           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06376}06376                           \textcolor{keyword}{delete}[] matrix\_values[m][unknown];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06377}06377                           \textcolor{keyword}{delete}[] matrix\_row\_or\_col\_indices[m][unknown];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06378}06378                           \mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06379}06379                             [m][unknown] = new\_allocation;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06380}06380                         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06381}06381                         \textcolor{comment}{// and now add the data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06382}06382                         \textcolor{keywordtype}{unsigned} entry = ncoef[m][unknown];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06383}06383                         ncoef[m][unknown]++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06384}06384                         matrix\_row\_or\_col\_indices[m][unknown][entry] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06385}06385                           eqn\_number;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06386}06386                         matrix\_values[m][unknown][entry] = value;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06387}06387                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06388}06388                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06389}06389                       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (matrix\_row\_or\_col\_indices[m][unknown][k] ==}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06390}06390                                eqn\_number)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06391}06391                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06392}06392                         matrix\_values[m][unknown][k] += value;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06393}06393                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06394}06394                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06395}06395                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06396}06396                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06397}06397                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06398}06398               \} \textcolor{comment}{// End of loop over matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06399}06399             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06400}06400           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06401}06401 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06402}06402 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06403}06403         \} \textcolor{comment}{// endif halo element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06404}06404 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06405}06405 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06406}06406 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06407}06407 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06408}06408         \textcolor{comment}{// Time it?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06409}06409         \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06410}06410         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06411}06411           \mbox{\hyperlink{classoomph_1_1Problem_a2b2bcde2b051f47278ccf8446699bbfb}{Elemental\_assembly\_time}}[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06412}06412             \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}() -\/ t\_assemble\_start;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06413}06413         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06414}06414 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06415}06415 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06416}06416       \} \textcolor{comment}{// End of loop over the elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06417}06417 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06418}06418     \} \textcolor{comment}{// End of vector assembly}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06419}06419 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06420}06420 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06421}06421 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06422}06422 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06423}06423     \textcolor{comment}{// Postprocess timing information and re-\/allocate distribution of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06424}06424     \textcolor{comment}{// elements during subsequent assemblies.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06425}06425     \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& (!\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}}) \&\&}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06426}06426         \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06427}06427     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06428}06428       \mbox{\hyperlink{classoomph_1_1Problem_aa9d808bb5d62db0da8e962fa29c24af9}{recompute\_load\_balanced\_assembly}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06429}06429     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06430}06430 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06431}06431     \textcolor{comment}{// We have determined load balancing for current setup.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06432}06432     \textcolor{comment}{// This can remain the same until assign\_eqn\_numbers() is called}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06433}06433     \textcolor{comment}{// again -\/-\/ the flag is re-\/set to true there.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06434}06434     \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06435}06435     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06436}06436       \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06437}06437     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06438}06438 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06439}06439 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06440}06440 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06441}06441     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/Finally we need to convert this lousy vector storage scheme}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06442}06442     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/to the containers required by SuperLU}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06443}06443 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06444}06444     \textcolor{comment}{// Loop over the number of matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06445}06445     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06446}06446     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06447}06447       \textcolor{comment}{// Set the number of rows or columns}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06448}06448       row\_or\_column\_start[m] = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}} + 1];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06449}06449 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06450}06450       \textcolor{comment}{// fill row\_or\_column\_start and find the number of entries}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06451}06451       row\_or\_column\_start[m][0] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06452}06452       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06453}06453       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06454}06454         row\_or\_column\_start[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + 1] = row\_or\_column\_start[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] + ncoef[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06455}06455         \mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = ncoef[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06456}06456       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06457}06457       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} entries = row\_or\_column\_start[m][\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06458}06458 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06459}06459       \textcolor{comment}{// resize vectors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06460}06460       column\_or\_row\_index[m] = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[entries];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06461}06461       value[m] = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[entries];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06462}06462       nnz[m] = entries;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06463}06463 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06464}06464       \textcolor{comment}{// Now we merely loop over the number of rows or columns}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06465}06465       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} i\_global = 0; i\_global < \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}; i\_global++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06466}06466       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06467}06467         \textcolor{comment}{// If there are no entries in the vector then skip the rest of the loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06468}06468         \textcolor{keywordflow}{if} (ncoef[m][i\_global] == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06469}06469         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06470}06470           \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06471}06471         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06472}06472 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06473}06473         \textcolor{comment}{// Loop over all the entries in the vectors corresponding to the given}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06474}06474         \textcolor{comment}{// row or column. It will NOT be ordered}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06475}06475         \textcolor{keywordtype}{unsigned} p = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06476}06476         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = row\_or\_column\_start[m][i\_global];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06477}06477              j < row\_or\_column\_start[m][i\_global + 1];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06478}06478              j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06479}06479         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06480}06480           column\_or\_row\_index[m][j] = matrix\_row\_or\_col\_indices[m][i\_global][p];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06481}06481           value[m][j] = matrix\_values[m][i\_global][p];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06482}06482           ++p;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06483}06483         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06484}06484 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06485}06485         \textcolor{comment}{// and delete}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06486}06486         \textcolor{keyword}{delete}[] matrix\_row\_or\_col\_indices[m][i\_global];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06487}06487         \textcolor{keyword}{delete}[] matrix\_values[m][i\_global];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06488}06488       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06489}06489 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06490}06490       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06491}06491       \textcolor{keyword}{delete}[] matrix\_row\_or\_col\_indices[m];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06492}06492       \textcolor{keyword}{delete}[] matrix\_values[m];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06493}06493     \} \textcolor{comment}{// End of the loop over the matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06494}06494 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06495}06495     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aedefa8337ace6043c2fdfd5a2d19afd3}{Pause\_at\_end\_of\_sparse\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06496}06496     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06497}06497       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Pausing at end of sparse assembly."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06498}06498       \mbox{\hyperlink{namespaceoomph_a4a82243b0ce4c28469a290fe2d7cd2c4}{pause}}(\textcolor{stringliteral}{"{}Check memory usage now."{}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06499}06499     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06500}06500   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06501}06501 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06502}06502 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06503}06503 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06504}06504   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06505}06505 \textcolor{comment}{  /// Helper method that returns the global equations to which}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06506}06506 \textcolor{comment}{  /// the elements in the range el\_lo to el\_hi contribute on this}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06507}06507 \textcolor{comment}{  /// processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06508}06508 \textcolor{comment}{}  \textcolor{comment}{//=======================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06509}\mbox{\hyperlink{classoomph_1_1Problem_ae222ce1fa229441a733d350105dfd1f7}{06509}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ae222ce1fa229441a733d350105dfd1f7}{Problem::get\_my\_eqns}}(\mbox{\hyperlink{classoomph_1_1AssemblyHandler}{AssemblyHandler}}* \textcolor{keyword}{const}\& assembly\_handler\_pt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06510}06510                             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& el\_lo,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06511}06511                             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& el\_hi,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06512}06512                             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& my\_eqns)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06513}06513   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06514}06514     \textcolor{comment}{// Index to keep track of the equations counted}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06515}06515     \textcolor{keywordtype}{unsigned} my\_eqns\_index = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06516}06516 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06517}06517     \textcolor{comment}{// Loop over the selection of elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06518}06518     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = el\_lo; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} <= el\_hi; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06519}06519     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06520}06520       \textcolor{comment}{// Get the pointer to the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06521}06521       \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06522}06522 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06523}06523       \textcolor{comment}{// Ignore halo elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06524}06524       \textcolor{keywordflow}{if} (!elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a0d9869eaf7d6e104c1e465b0d3cd6a9b}{is\_halo}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06525}06525       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06526}06526         \textcolor{comment}{// Find number of degrees of freedom in the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06527}06527         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nvar = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a09213be8f4aa009e0366460a7ed78e68}{ndof}}(elem\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06528}06528         \textcolor{comment}{// Add the number of dofs to the current size of my\_eqns}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06529}06529         my\_eqns.resize(my\_eqns\_index + nvar);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06530}06530 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06531}06531         \textcolor{comment}{// Loop over the first index of local variables}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06532}06532         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nvar; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06533}06533         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06534}06534           \textcolor{comment}{// Get the local equation number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06535}06535           \textcolor{keywordtype}{unsigned} global\_eqn\_number =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06536}06536             \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06537}06537           \textcolor{comment}{// Add into the vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06538}06538           my\_eqns[my\_eqns\_index + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = global\_eqn\_number;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06539}06539         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06540}06540         \textcolor{comment}{// Update the number of elements in the vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06541}06541         my\_eqns\_index += nvar;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06542}06542       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06543}06543     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06544}06544 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06545}06545     \textcolor{comment}{//  now sort and remove duplicate entries in the vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06546}06546     std::sort(my\_eqns.begin(), my\_eqns.end());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06547}06547     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>::iterator}} it = std::unique(my\_eqns.begin(), my\_eqns.end());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06548}06548     my\_eqns.resize(it -\/ my\_eqns.begin());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06549}06549   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06550}06550 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06551}06551 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06552}06552   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06553}06553 \textcolor{comment}{  /// Helper method to assemble CRDoubleMatrices from distributed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06554}06554 \textcolor{comment}{  /// on multiple processors.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06555}06555 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06556}\mbox{\hyperlink{classoomph_1_1Problem_a0487a7ef40e6cc4dad88e99ac96193e2}{06556}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a0487a7ef40e6cc4dad88e99ac96193e2}{Problem::parallel\_sparse\_assemble}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06557}06557     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* \textcolor{keyword}{const}\& target\_dist\_pt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06558}06558     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}}\& column\_indices,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06559}06559     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}}\& row\_start,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06560}06560     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}}\& values,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06561}06561     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& nnz,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06562}06562     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}}\& residuals)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06563}06563   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06564}06564     \textcolor{comment}{// Time assembly}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06565}06565     \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06566}06566 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06567}06567     \textcolor{comment}{// my rank and nproc}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06568}06568     \textcolor{keywordtype}{unsigned} my\_rank = \mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06569}06569     \textcolor{keywordtype}{unsigned} nproc = \mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>nproc();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06570}06570 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06571}06571     \textcolor{comment}{// Total number of elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06572}06572     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_elements = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06573}06573 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06574}06574 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06575}06575     \textcolor{comment}{// No elements? This is usually a sign that the problem distribution has}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06576}06576     \textcolor{comment}{// led to one processor not having any elements. Either}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06577}06577     \textcolor{comment}{// a sign of something having gone wrong or a relatively small}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06578}06578     \textcolor{comment}{// problem on a huge number of processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06579}06579     \textcolor{keywordflow}{if} (n\_elements == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06580}06580     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06581}06581       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06582}06582       error\_stream << \textcolor{stringliteral}{"{}Processsor "{}} << my\_rank << \textcolor{stringliteral}{"{} has no elements. \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06583}06583                    << \textcolor{stringliteral}{"{}This is usually a sign that the problem distribution \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06584}06584                    << \textcolor{stringliteral}{"{}or the load balancing have gone wrong."{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06585}06585       \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06586}06586                       \textcolor{stringliteral}{"{}Problem::parallel\_sparse\_assemble()"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06587}06587                       OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06588}06588     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06589}06589 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06590}06590 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06591}06591 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06592}06592     \textcolor{comment}{// Default range of elements for distributed problems.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06593}06593     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} el\_lo = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06594}06594     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} el\_hi\_plus\_one = n\_elements;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06595}06595 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06596}06596     \textcolor{comment}{// Otherwise just loop over a fraction of the elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06597}06597     \textcolor{comment}{// (This will either have been initialised in}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06598}06598     \textcolor{comment}{// Problem::set\_default\_first\_and\_last\_element\_for\_assembly() or}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06599}06599     \textcolor{comment}{// will have been re-\/assigned during a previous assembly loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06600}06600     \textcolor{comment}{// Note that following the re-\/assignment only the entries}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06601}06601     \textcolor{comment}{// for the current processor are relevant.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06602}06602     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06603}06603     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06604}06604       el\_lo = \mbox{\hyperlink{classoomph_1_1Problem_a0caac0918eaaea840238ce83f5be7836}{First\_el\_for\_assembly}}[my\_rank];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06605}06605       el\_hi\_plus\_one = \mbox{\hyperlink{classoomph_1_1Problem_a4842a9a213197905b5a8e182a3c02cce}{Last\_el\_plus\_one\_for\_assembly}}[my\_rank];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06606}06606     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06607}06607 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06608}06608     \textcolor{comment}{// Find the number of vectors to be assembled}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06609}06609     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_vector = residuals.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06610}06610 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06611}06611     \textcolor{comment}{// Find the number of matrices to be assembled}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06612}06612     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_matrix = column\_indices.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06613}06613 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06614}06614     \textcolor{comment}{// Locally cache pointer to assembly handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06615}06615     \mbox{\hyperlink{classoomph_1_1AssemblyHandler}{AssemblyHandler}}* \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}} = \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06616}06616 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06617}06617     \textcolor{keywordtype}{bool} doing\_residuals = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06618}06618     \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1ParallelResidualsHandler}{ParallelResidualsHandler}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}}) != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06619}06619     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06620}06620       doing\_residuals = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06621}06621     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06622}06622 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06623}06623 \textcolor{comment}{// Error check dimensions}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06624}06624 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06625}06625     \textcolor{keywordflow}{if} (row\_start.size() != n\_matrix)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06626}06626     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06627}06627       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06628}06628       error\_stream << \textcolor{stringliteral}{"{}Error: "{}} << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06629}06629                    << \textcolor{stringliteral}{"{}row\_or\_column\_start.size() "{}} << row\_start.size()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06630}06630                    << \textcolor{stringliteral}{"{} does not equal "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06631}06631                    << \textcolor{stringliteral}{"{}column\_or\_row\_index.size() "{}} << column\_indices.size()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06632}06632                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06633}06633       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06634}06634         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06635}06635     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06636}06636 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06637}06637     \textcolor{keywordflow}{if} (values.size() != n\_matrix)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06638}06638     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06639}06639       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06640}06640       error\_stream << \textcolor{stringliteral}{"{}Error: "{}} << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06641}06641                    << \textcolor{stringliteral}{"{}value.size() "{}} << values.size() << \textcolor{stringliteral}{"{} does not equal "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06642}06642                    << \textcolor{stringliteral}{"{}column\_or\_row\_index.size() "{}} << column\_indices.size()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06643}06643                    << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06644}06644                    << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06645}06645                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06646}06646       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06647}06647         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06648}06648     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06649}06649 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06650}06650 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06651}06651 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06652}06652     \textcolor{comment}{// start by assembling the sorted set of equations to which this processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06653}06653     \textcolor{comment}{// contributes. Essentially this is every global equation that features in}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06654}06654     \textcolor{comment}{// all the non-\/halo elements. This may not be the same as the locally-\/stored}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06655}06655     \textcolor{comment}{// dofs because some of the Nodes in non-\/halo elements may actually}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06656}06656     \textcolor{comment}{// be halos.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06657}06657     \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06658}06658     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} my\_eqns;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06659}06659     \textcolor{keywordflow}{if} (n\_elements != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06660}06660     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06661}06661       this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae222ce1fa229441a733d350105dfd1f7}{get\_my\_eqns}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06662}06662         assembly\_handler\_pt, el\_lo, el\_hi\_plus\_one -\/ 1, my\_eqns);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06663}06663     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06664}06664 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06665}06665     \textcolor{comment}{// number of equations}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06666}06666     \textcolor{keywordtype}{unsigned} my\_n\_eqn = my\_eqns.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06667}06667 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06668}06668     \textcolor{comment}{// next we assemble the data into an array of arrays}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06669}06669     \textcolor{comment}{// =================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06670}06670     \textcolor{comment}{// The idea behind this sparse assembly routine is to use an array of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06671}06671     \textcolor{comment}{// arrays for the entries in each complete matrix. And a second}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06672}06672     \textcolor{comment}{// array of arrays stores the global row (or column) indeces.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06673}06673 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06674}06674     \textcolor{comment}{// Set up two vector of vectors to store the entries of each  matrix,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06675}06675     \textcolor{comment}{// indexed by either the column or row. The entries of the vector for}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06676}06676     \textcolor{comment}{// each matrix correspond to all the rows or columns of that matrix.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06677}06677     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned**>}} matrix\_col\_indices(n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06678}06678     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double**>}} matrix\_values(n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06679}06679 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06680}06680     \textcolor{comment}{// Loop over the number of matrices being assembled and resize}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06681}06681     \textcolor{comment}{// each vector of vectors to the number of rows or columns of the matrix}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06682}06682     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06683}06683     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06684}06684       matrix\_col\_indices[m] = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}*[my\_n\_eqn];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06685}06685       matrix\_values[m] = \textcolor{keyword}{new} \textcolor{keywordtype}{double}*[my\_n\_eqn];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06686}06686       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < my\_n\_eqn; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06687}06687       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06688}06688         matrix\_col\_indices[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06689}06689         matrix\_values[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06690}06690       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06691}06691     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06692}06692 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06693}06693     \textcolor{comment}{// Resize the residuals vectors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06694}06694     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}} residuals\_data(n\_vector);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06695}06695     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06696}06696     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06697}06697       residuals\_data[v] = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[my\_n\_eqn];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06698}06698       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < my\_n\_eqn; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06699}06699       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06700}06700         residuals\_data[v][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06701}06701       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06702}06702     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06703}06703 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06704}06704     \textcolor{comment}{// Storage for assembly time for elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06705}06705     \textcolor{keywordtype}{double} t\_assemble\_start = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06706}06706 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06707}06707     \textcolor{comment}{// Storage for assembly times}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06708}06708     \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06709}06709     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06710}06710       \mbox{\hyperlink{classoomph_1_1Problem_a2b2bcde2b051f47278ccf8446699bbfb}{Elemental\_assembly\_time}}.resize(n\_elements);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06711}06711     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06712}06712 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06713}06713     \textcolor{comment}{// number of coefficients in each row}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06714}06714     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<unsigned>}}> ncoef(n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06715}06715     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06716}06716     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06717}06717       ncoef[m].resize(my\_n\_eqn, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06718}06718     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06719}06719 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06720}06720     \textcolor{comment}{// Sparse\_assemble\_with\_arrays\_previous\_allocation stores the number of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06721}06721     \textcolor{comment}{// coefs in each row.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06722}06722     \textcolor{comment}{// if a matrix of this size has not been assembled before then resize this}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06723}06723     \textcolor{comment}{// storage}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06724}06724     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}.size() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06725}06725     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06726}06726       \mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}.resize(n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06727}06727       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06728}06728       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06729}06729         \mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}[m].resize(my\_n\_eqn, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06730}06730       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06731}06731     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06732}06732 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06733}06733 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06734}06734     \textcolor{comment}{// assemble and populate an array based storage scheme}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06735}06735     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06736}06736       \textcolor{comment}{// Allocate local storage for the element's contribution to the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06737}06737       \textcolor{comment}{// residuals vectors and system matrices of the size of the maximum}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06738}06738       \textcolor{comment}{// number of dofs in any element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06739}06739       \textcolor{comment}{// This means that the storage will only be allocated (and deleted) once}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06740}06740       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<double>}}> el\_residuals(n\_vector);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06741}06741       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DenseMatrix<double>}}> el\_jacobian(n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06742}06742 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06743}06743       \textcolor{comment}{// Loop over the elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06744}06744       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = el\_lo; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < el\_hi\_plus\_one; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06745}06745       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06746}06746         \textcolor{comment}{// Time it?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06747}06747         \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06748}06748         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06749}06749           t\_assemble\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06750}06750         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06751}06751 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06752}06752         \textcolor{comment}{// Get the pointer to the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06753}06753         \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06754}06754 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06755}06755         \textcolor{comment}{// Ignore halo elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06756}06756         \textcolor{keywordflow}{if} (!elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a0d9869eaf7d6e104c1e465b0d3cd6a9b}{is\_halo}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06757}06757         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06758}06758           \textcolor{comment}{// Find number of degrees of freedom in the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06759}06759           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nvar = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a09213be8f4aa009e0366460a7ed78e68}{ndof}}(elem\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06760}06760 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06761}06761           \textcolor{comment}{// Resize the storage for elemental jacobian and residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06762}06762           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06763}06763           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06764}06764             el\_residuals[v].resize(nvar);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06765}06765           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06766}06766           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06767}06767           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06768}06768             el\_jacobian[m].resize(nvar);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06769}06769           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06770}06770 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06771}06771           \textcolor{comment}{// Now get the residuals and jacobian for the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06772}06772           \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_ab2e4ee4623116b18245ca90cfe9ba144}{get\_all\_vectors\_and\_matrices}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06773}06773             elem\_pt, el\_residuals, el\_jacobian);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06774}06774 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06775}06775           \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/Insert the values into the vectors-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06776}06776 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06777}06777           \textcolor{comment}{// Loop over the first index of local variables}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06778}06778           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nvar; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06779}06779           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06780}06780             \textcolor{comment}{// Get the local equation number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06781}06781             \textcolor{keywordtype}{unsigned} global\_eqn\_number =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06782}06782               \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06783}06783 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06784}06784             \textcolor{comment}{// determine the element number in my set of eqns using the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06785}06785             \textcolor{comment}{// bisection method}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06786}06786             \textcolor{keywordtype}{int} left = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06787}06787             \textcolor{keywordtype}{int} right = my\_n\_eqn -\/ 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06788}06788             \textcolor{keywordtype}{int} eqn\_number = right / 2;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06789}06789             \textcolor{keywordflow}{while} (my\_eqns[eqn\_number] != global\_eqn\_number)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06790}06790             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06791}06791               \textcolor{keywordflow}{if} (left == right)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06792}06792               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06793}06793                 \textcolor{comment}{// Check that the residuals associated with the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06794}06794                 \textcolor{comment}{// eqn number that can't be found are all zero}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06795}06795                 \textcolor{keywordtype}{bool} broken = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06796}06796                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06797}06797                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06798}06798                   \textcolor{keywordflow}{if} (el\_residuals[v][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] != 0.0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06799}06799                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06800}06800                     broken = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06801}06801                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06802}06802                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06803}06803                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06804}06804 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06805}06805                 \textcolor{comment}{// Now loop over the other index to check the entries}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06806}06806                 \textcolor{comment}{// in the appropriate row of the Jacobians are zero too}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06807}06807                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < nvar; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06808}06808                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06809}06809                   \textcolor{comment}{// Get the number of the unknown}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06810}06810                   \textcolor{comment}{// unsigned unknown =}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06811}06811                   \textcolor{comment}{// assembly\_handler\_pt-\/>eqn\_number(elem\_pt,j);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06812}06812 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06813}06813                   \textcolor{comment}{// Loop over the matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06814}06814                   \textcolor{comment}{// If it's compressed row storage, then our vector of maps}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06815}06815                   \textcolor{comment}{// is indexed by row (equation number)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06816}06816                   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06817}06817                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06818}06818                     \textcolor{comment}{// Get the value of the matrix at this point}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06819}06819                     \textcolor{keywordtype}{double} value = el\_jacobian[m](\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06820}06820                     \textcolor{keywordflow}{if} (value != 0.0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06821}06821                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06822}06822                       broken = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06823}06823                       \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06824}06824                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06825}06825                     \textcolor{keywordflow}{if} (broken) \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06826}06826                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06827}06827                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06828}06828 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06829}06829                 \textcolor{keywordflow}{if} (broken)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06830}06830                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06831}06831                   std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06832}06832                   error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06833}06833                     << \textcolor{stringliteral}{"{}Internal Error: "{}} << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06834}06834                     << \textcolor{stringliteral}{"{}Could not find global equation number "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06835}06835                     << global\_eqn\_number}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06836}06836                     << \textcolor{stringliteral}{"{} in my\_eqns vector of equation numbers but\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06837}06837                     << \textcolor{stringliteral}{"{}at least one entry in the residual vector is nonzero."{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06838}06838                   \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06839}06839                                       OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06840}06840                                       OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06841}06841                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06842}06842                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06843}06843                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06844}06844                   \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06845}06845                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06846}06846               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06847}06847               \textcolor{keywordflow}{if} (my\_eqns[eqn\_number] > global\_eqn\_number)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06848}06848               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06849}06849                 right = std::max(eqn\_number -\/ 1, left);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06850}06850               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06851}06851               \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06852}06852               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06853}06853                 left = std::min(eqn\_number + 1, right);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06854}06854               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06855}06855               eqn\_number = (right + left) / 2;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06856}06856             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06857}06857 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06858}06858             \textcolor{comment}{// Add the contribution to the residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06859}06859             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06860}06860             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06861}06861               \textcolor{comment}{// Fill in each residuals vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06862}06862               residuals\_data[v][eqn\_number] += el\_residuals[v][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06863}06863             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06864}06864 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06865}06865             \textcolor{comment}{// Now loop over the other index}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06866}06866             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < nvar; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06867}06867             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06868}06868               \textcolor{comment}{// Get the number of the unknown}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06869}06869               \textcolor{keywordtype}{unsigned} unknown = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06870}06870 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06871}06871               \textcolor{comment}{// Loop over the matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06872}06872               \textcolor{comment}{// If it's compressed row storage, then our vector of maps}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06873}06873               \textcolor{comment}{// is indexed by row (equation number)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06874}06874               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06875}06875               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06876}06876                 \textcolor{comment}{// Get the value of the matrix at this point}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06877}06877                 \textcolor{keywordtype}{double} value = el\_jacobian[m](\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06878}06878                 \textcolor{comment}{// Only bother to add to the vector if it's non-\/zero}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06879}06879                 \textcolor{keywordflow}{if} (std::fabs(value) > \mbox{\hyperlink{classoomph_1_1Problem_ad1a1ffc2bd685377ce7213452876b127}{Numerical\_zero\_for\_sparse\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06880}06880                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06881}06881                   \textcolor{comment}{// number of entrys in this row}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06882}06882                   \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} size = ncoef[m][eqn\_number];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06883}06883 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06884}06884                   \textcolor{comment}{// if no data has been allocated for this row then allocate}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06885}06885                   \textcolor{keywordflow}{if} (size == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06886}06886                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06887}06887                     \textcolor{comment}{// do we have previous allocation data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06888}06888                     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06889}06889                           [m][eqn\_number] != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06890}06890                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06891}06891                       matrix\_col\_indices[m][eqn\_number] = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06892}06892                         [\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06893}06893                            [m][eqn\_number]];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06894}06894 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06895}06895                       matrix\_values[m][eqn\_number] = \textcolor{keyword}{new} \textcolor{keywordtype}{double}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06896}06896                         [\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06897}06897                            [m][eqn\_number]];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06898}06898                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06899}06899                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06900}06900                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06901}06901                       matrix\_col\_indices[m][eqn\_number] = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06902}06902                         [\mbox{\hyperlink{classoomph_1_1Problem_ad2d5f8e18619fafcff11727b1c55b3eb}{Sparse\_assemble\_with\_arrays\_initial\_allocation}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06903}06903 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06904}06904                       matrix\_values[m][eqn\_number] = \textcolor{keyword}{new} \textcolor{keywordtype}{double}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06905}06905                         [\mbox{\hyperlink{classoomph_1_1Problem_ad2d5f8e18619fafcff11727b1c55b3eb}{Sparse\_assemble\_with\_arrays\_initial\_allocation}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06906}06906 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06907}06907                       \mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06908}06908                         [m][eqn\_number] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06909}06909                           \mbox{\hyperlink{classoomph_1_1Problem_ad2d5f8e18619fafcff11727b1c55b3eb}{Sparse\_assemble\_with\_arrays\_initial\_allocation}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06910}06910                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06911}06911                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06912}06912 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06913}06913                   \textcolor{comment}{// next add the data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06914}06914                   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k <= size; k++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06915}06915                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06916}06916                     \textcolor{keywordflow}{if} (k == size)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06917}06917                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06918}06918                       \textcolor{comment}{// do we need to allocate more storage}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06919}06919                       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06920}06920                             [m][eqn\_number] == ncoef[m][eqn\_number])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06921}06921                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06922}06922                         \textcolor{keywordtype}{unsigned} new\_allocation =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06923}06923                           ncoef[m][eqn\_number] +}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06924}06924                           \mbox{\hyperlink{classoomph_1_1Problem_aeb58a3cead4d10697c4471523f705130}{Sparse\_assemble\_with\_arrays\_allocation\_increment}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06925}06925                         \textcolor{keywordtype}{double}* new\_values = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[new\_allocation];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06926}06926                         \textcolor{keywordtype}{unsigned}* new\_indices = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}[new\_allocation];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06927}06927                         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} c = 0; c < ncoef[m][eqn\_number]; c++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06928}06928                         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06929}06929                           new\_values[c] = matrix\_values[m][eqn\_number][c];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06930}06930                           new\_indices[c] = matrix\_col\_indices[m][eqn\_number][c];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06931}06931                         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06932}06932                         \textcolor{keyword}{delete}[] matrix\_values[m][eqn\_number];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06933}06933                         \textcolor{keyword}{delete}[] matrix\_col\_indices[m][eqn\_number];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06934}06934 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06935}06935                         matrix\_values[m][eqn\_number] = new\_values;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06936}06936                         matrix\_col\_indices[m][eqn\_number] = new\_indices;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06937}06937 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06938}06938                         \mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06939}06939                           [m][eqn\_number] = new\_allocation;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06940}06940                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06941}06941                       \textcolor{comment}{// and now add the data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06942}06942                       \textcolor{keywordtype}{unsigned} entry = ncoef[m][eqn\_number];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06943}06943                       ncoef[m][eqn\_number]++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06944}06944                       matrix\_col\_indices[m][eqn\_number][entry] = unknown;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06945}06945                       matrix\_values[m][eqn\_number][entry] = value;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06946}06946                       \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06947}06947                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06948}06948                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (matrix\_col\_indices[m][eqn\_number][k] == unknown)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06949}06949                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06950}06950                       matrix\_values[m][eqn\_number][k] += value;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06951}06951                       \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06952}06952                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06953}06953                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06954}06954                 \} \textcolor{comment}{// numerical zero check}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06955}06955               \} \textcolor{comment}{// End of loop over matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06956}06956             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06957}06957           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06958}06958         \} \textcolor{comment}{// endif halo element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06959}06959 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06960}06960         \textcolor{comment}{// Time it?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06961}06961         \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06962}06962         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06963}06963           \mbox{\hyperlink{classoomph_1_1Problem_a2b2bcde2b051f47278ccf8446699bbfb}{Elemental\_assembly\_time}}[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06964}06964             \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}() -\/ t\_assemble\_start;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06965}06965         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06966}06966       \} \textcolor{comment}{// End of loop over the elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06967}06967     \} \textcolor{comment}{// End of vector assembly}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06968}06968 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06969}06969 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06970}06970     \textcolor{comment}{// Doc?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06971}06971     \textcolor{keywordtype}{double} t\_end = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06972}06972     \textcolor{keywordtype}{double} t\_local = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06973}06973     \textcolor{keywordtype}{double} t\_max = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06974}06974     \textcolor{keywordtype}{double} t\_min = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06975}06975     \textcolor{keywordtype}{double} t\_sum = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06976}06976     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a9a20957e3ef4c8142261363c85f6e276}{Doc\_imbalance\_in\_parallel\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06977}06977     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06978}06978       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06979}06979       t\_local = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06980}06980       t\_max = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06981}06981       t\_min = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06982}06982       t\_sum = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06983}06983       MPI\_Allreduce(\&t\_local,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06984}06984                     \&t\_max,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06985}06985                     1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06986}06986                     MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06987}06987                     MPI\_MAX,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06988}06988                     this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06989}06989       MPI\_Allreduce(\&t\_local,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06990}06990                     \&t\_min,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06991}06991                     1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06992}06992                     MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06993}06993                     MPI\_MIN,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06994}06994                     this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06995}06995       MPI\_Allreduce(\&t\_local,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06996}06996                     \&t\_sum,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06997}06997                     1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06998}06998                     MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l06999}06999                     MPI\_SUM,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07000}07000                     this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07001}07001       \textcolor{keywordtype}{double} imbalance = (t\_max -\/ t\_min) / (t\_sum / \textcolor{keywordtype}{double}(nproc)) * 100.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07002}07002 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07003}07003       \textcolor{keywordflow}{if} (doing\_residuals)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07004}07004       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07005}07005         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)nCPU for residual computation (loc/max/min/imbal): "{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07006}07006       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07007}07007       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07008}07008       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07009}07009         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)nCPU for Jacobian computation (loc/max/min/imbal): "{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07010}07010       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07011}07011       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << t\_local << \textcolor{stringliteral}{"{} "{}} << t\_max << \textcolor{stringliteral}{"{} "{}} << t\_min << \textcolor{stringliteral}{"{} "{}} << imbalance}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07012}07012                  << \textcolor{stringliteral}{"{}\%\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07013}07013 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07014}07014       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07015}07015     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07016}07016 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07017}07017 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07018}07018     \textcolor{comment}{// Adjust number of coefficients in each row}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07019}07019     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07020}07020     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07021}07021       \textcolor{keywordtype}{unsigned} max = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07022}07022       \textcolor{keywordtype}{unsigned} min = INT\_MAX;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07023}07023       \textcolor{keywordtype}{unsigned} sum = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07024}07024       \textcolor{keywordtype}{unsigned} sum\_total = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07025}07025       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < my\_n\_eqn; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07026}07026       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07027}07027         sum += ncoef[m][\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07028}07028         sum\_total += \mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}[m][\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07029}07029         \textcolor{keywordflow}{if} (ncoef[m][\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] > max) max = ncoef[m][\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07030}07030         \textcolor{keywordflow}{if} (ncoef[m][\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] < min) min = ncoef[m][\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07031}07031 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07032}07032         \textcolor{comment}{// Now shrink the storage to what we actually need}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07033}07033         \textcolor{keywordtype}{unsigned} new\_allocation = ncoef[m][\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07034}07034         \textcolor{keywordtype}{double}* new\_values = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[new\_allocation];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07035}07035         \textcolor{keywordtype}{unsigned}* new\_indices = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}[new\_allocation];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07036}07036         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} c = 0; c < ncoef[m][\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]; c++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07037}07037         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07038}07038           new\_values[c] = matrix\_values[m][\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}][c];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07039}07039           new\_indices[c] = matrix\_col\_indices[m][\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}][c];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07040}07040         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07041}07041         \textcolor{keyword}{delete}[] matrix\_values[m][\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07042}07042         \textcolor{keyword}{delete}[] matrix\_col\_indices[m][\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07043}07043 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07044}07044         matrix\_values[m][\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = new\_values;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07045}07045         matrix\_col\_indices[m][\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = new\_indices;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07046}07046       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07047}07047     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07048}07048 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07049}07049 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07050}07050     \textcolor{comment}{// Postprocess timing information and re-\/allocate distribution of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07051}07051     \textcolor{comment}{// elements during subsequent assemblies.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07052}07052     \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& (!\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}}) \&\&}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07053}07053         \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07054}07054     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07055}07055       \mbox{\hyperlink{classoomph_1_1Problem_aa9d808bb5d62db0da8e962fa29c24af9}{recompute\_load\_balanced\_assembly}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07056}07056     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07057}07057 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07058}07058     \textcolor{comment}{// We have determined load balancing for current setup.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07059}07059     \textcolor{comment}{// This can remain the same until assign\_eqn\_numbers() is called}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07060}07060     \textcolor{comment}{// again -\/-\/ the flag is re-\/set to true there.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07061}07061     \textcolor{keywordflow}{if} ((!doing\_residuals) \&\& \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07062}07062     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07063}07063       \mbox{\hyperlink{classoomph_1_1Problem_aab187e716f470b32a01d7f0cee7f3bf4}{Must\_recompute\_load\_balance\_for\_assembly}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07064}07064     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07065}07065 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07066}07066 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07067}07067     \textcolor{comment}{// next we compute the number of equations and number of non-\/zeros to be}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07068}07068     \textcolor{comment}{// sent to each processor, and send/recv that information}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07069}07069     \textcolor{comment}{// =====================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07070}07070 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07071}07071     \textcolor{comment}{// determine the number of eqns to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07072}07072     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} n\_eqn\_for\_proc(nproc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07073}07073     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} first\_eqn\_element\_for\_proc(nproc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07074}07074     \textcolor{comment}{// If no equations are assembled then we don't need to do any of this}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07075}07075     \textcolor{keywordflow}{if} (my\_n\_eqn > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07076}07076     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07077}07077       \textcolor{keywordtype}{unsigned} current\_p = target\_dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_acd5ffc5ff4b91a8e63677f9677cd0039}{rank\_of\_global\_row}}(my\_eqns[0]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07078}07078       first\_eqn\_element\_for\_proc[current\_p] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07079}07079       n\_eqn\_for\_proc[current\_p] = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07080}07080       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 1; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < my\_n\_eqn; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07081}07081       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07082}07082         \textcolor{keywordtype}{unsigned} next\_p = target\_dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_acd5ffc5ff4b91a8e63677f9677cd0039}{rank\_of\_global\_row}}(my\_eqns[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07083}07083         \textcolor{keywordflow}{if} (next\_p != current\_p)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07084}07084         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07085}07085           current\_p = next\_p;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07086}07086           first\_eqn\_element\_for\_proc[current\_p] = \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07087}07087         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07088}07088         n\_eqn\_for\_proc[current\_p]++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07089}07089       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07090}07090     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07091}07091 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07092}07092     \textcolor{comment}{// determine the number of non-\/zeros to be sent to each processor for each}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07093}07093     \textcolor{comment}{// matrix (if n\_eqn\_for\_proc[p]=0, then nothing will be assembled)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07094}07094     \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<unsigned>}} nnz\_for\_proc(nproc, n\_matrix, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07095}07095     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07096}07096     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07097}07097       \textcolor{keywordtype}{int} first\_eqn\_element = first\_eqn\_element\_for\_proc[p];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07098}07098       \textcolor{keywordtype}{int} last\_eqn\_element = (int)(first\_eqn\_element + n\_eqn\_for\_proc[p]) -\/ 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07099}07099       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07100}07100       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07101}07101         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = first\_eqn\_element; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} <= last\_eqn\_element; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07102}07102         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07103}07103           nnz\_for\_proc(p, m) += ncoef[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07104}07104         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07105}07105       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07106}07106     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07107}07107 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07108}07108     \textcolor{comment}{// next post the sends and recvs to the corresponding processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07109}07109     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned*>}} temp\_send\_storage(nproc);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07110}07110     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned*>}} temp\_recv\_storage(nproc);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07111}07111     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Request>}} send\_nnz\_reqs;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07112}07112     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Request>}} recv\_nnz\_reqs;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07113}07113     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07114}07114     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07115}07115       \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07116}07116       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07117}07117         temp\_send\_storage[p] = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}[n\_matrix + 1];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07118}07118         temp\_send\_storage[p][0] = n\_eqn\_for\_proc[p];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07119}07119         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07120}07120         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07121}07121           temp\_send\_storage[p][m + 1] = nnz\_for\_proc(p, m);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07122}07122         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07123}07123         MPI\_Request sreq;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07124}07124         MPI\_Isend(temp\_send\_storage[p],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07125}07125                   n\_matrix + 1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07126}07126                   MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07127}07127                   p,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07128}07128                   0,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07129}07129                   \mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07130}07130                   \&sreq);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07131}07131         send\_nnz\_reqs.push\_back(sreq);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07132}07132         temp\_recv\_storage[p] = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}[n\_matrix + 1];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07133}07133         MPI\_Request rreq;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07134}07134         MPI\_Irecv(temp\_recv\_storage[p],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07135}07135                   n\_matrix + 1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07136}07136                   MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07137}07137                   p,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07138}07138                   0,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07139}07139                   \mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07140}07140                   \&rreq);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07141}07141         recv\_nnz\_reqs.push\_back(rreq);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07142}07142       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07143}07143     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07144}07144 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07145}07145     \textcolor{comment}{// assemble the data to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07146}07146     \textcolor{comment}{// ==============================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07147}07147 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07148}07148     \textcolor{comment}{// storage}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07149}07149     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned*>}} eqns\_for\_proc(nproc);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07150}07150     \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double*>}} residuals\_for\_proc(nproc, n\_vector);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07151}07151     \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<unsigned*>}} row\_start\_for\_proc(nproc, n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07152}07152     \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<unsigned*>}} column\_indices\_for\_proc(nproc, n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07153}07153     \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double*>}} values\_for\_proc(nproc, n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07154}07154 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07155}07155     \textcolor{comment}{// equation numbers}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07156}07156     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07157}07157     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07158}07158       \textcolor{keywordtype}{unsigned} n\_eqns\_p = n\_eqn\_for\_proc[p];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07159}07159       \textcolor{keywordflow}{if} (n\_eqns\_p > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07160}07160       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07161}07161         \textcolor{keywordtype}{unsigned} first\_eqn\_element = first\_eqn\_element\_for\_proc[p];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07162}07162         \textcolor{keywordtype}{unsigned} first\_row = target\_dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2634e540a78fe1ee3f5c907aff500b58}{first\_row}}(p);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07163}07163         eqns\_for\_proc[p] = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}[n\_eqns\_p];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07164}07164         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_eqns\_p; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07165}07165         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07166}07166           eqns\_for\_proc[p][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = my\_eqns[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + first\_eqn\_element] -\/ first\_row;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07167}07167         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07168}07168       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07169}07169     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07170}07170 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07171}07171     \textcolor{comment}{// residuals for p}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07172}07172     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07173}07173     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07174}07174       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07175}07175       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07176}07176         \textcolor{keywordtype}{unsigned} n\_eqns\_p = n\_eqn\_for\_proc[p];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07177}07177         \textcolor{keywordflow}{if} (n\_eqns\_p > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07178}07178         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07179}07179           \textcolor{keywordtype}{unsigned} first\_eqn\_element = first\_eqn\_element\_for\_proc[p];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07180}07180           residuals\_for\_proc(p, v) = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[n\_eqns\_p];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07181}07181           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_eqns\_p; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07182}07182           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07183}07183             residuals\_for\_proc(p, v)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07184}07184               residuals\_data[v][first\_eqn\_element + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07185}07185           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07186}07186         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07187}07187       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07188}07188       \textcolor{keyword}{delete}[] residuals\_data[v];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07189}07189     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07190}07190 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07191}07191     \textcolor{comment}{// matrices for p}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07192}07192     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07193}07193     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07194}07194       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07195}07195       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07196}07196         \textcolor{keywordtype}{unsigned} n\_eqns\_p = n\_eqn\_for\_proc[p];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07197}07197         \textcolor{keywordflow}{if} (n\_eqns\_p > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07198}07198         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07199}07199           \textcolor{keywordtype}{unsigned} first\_eqn\_element = first\_eqn\_element\_for\_proc[p];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07200}07200           row\_start\_for\_proc(p, m) = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}[n\_eqns\_p + 1];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07201}07201           column\_indices\_for\_proc(p, m) = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}[nnz\_for\_proc(p, m)];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07202}07202           values\_for\_proc(p, m) = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[nnz\_for\_proc(p, m)];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07203}07203           \textcolor{keywordtype}{unsigned} entry = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07204}07204           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_eqns\_p; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07205}07205           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07206}07206             row\_start\_for\_proc(p, m)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = entry;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07207}07207             \textcolor{keywordtype}{unsigned} n\_coef\_in\_row = ncoef[m][first\_eqn\_element + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07208}07208             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_coef\_in\_row; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07209}07209             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07210}07210               column\_indices\_for\_proc(p, m)[entry] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07211}07211                 matrix\_col\_indices[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + first\_eqn\_element][j];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07212}07212               values\_for\_proc(p, m)[entry] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07213}07213                 matrix\_values[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + first\_eqn\_element][j];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07214}07214               entry++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07215}07215             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07216}07216           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07217}07217           row\_start\_for\_proc(p, m)[n\_eqns\_p] = entry;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07218}07218         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07219}07219       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07220}07220       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < my\_n\_eqn; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07221}07221       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07222}07222         \textcolor{keyword}{delete}[] matrix\_col\_indices[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07223}07223         \textcolor{keyword}{delete}[] matrix\_values[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07224}07224       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07225}07225       \textcolor{keyword}{delete}[] matrix\_col\_indices[m];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07226}07226       \textcolor{keyword}{delete}[] matrix\_values[m];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07227}07227     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07228}07228 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07229}07229     \textcolor{comment}{// need to wait for the recv nnzs to complete}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07230}07230     \textcolor{comment}{// before we can allocate storage for the matrix recvs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07231}07231     \textcolor{comment}{// ===================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07232}07232 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07233}07233     \textcolor{comment}{// recv and copy the datafrom the recv storage to}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07234}07234     \textcolor{comment}{// + nnz\_from\_proc}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07235}07235     \textcolor{comment}{// + n\_eqn\_from\_proc}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07236}07236     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Status>}} recv\_nnz\_stat(nproc -\/ 1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07237}07237     MPI\_Waitall(nproc -\/ 1, \&recv\_nnz\_reqs[0], \&recv\_nnz\_stat[0]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07238}07238     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} n\_eqn\_from\_proc(nproc);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07239}07239     \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<unsigned>}} nnz\_from\_proc(nproc, n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07240}07240     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07241}07241     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07242}07242       \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07243}07243       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07244}07244         n\_eqn\_from\_proc[p] = temp\_recv\_storage[p][0];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07245}07245         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07246}07246         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07247}07247           nnz\_from\_proc(p, m) = temp\_recv\_storage[p][m + 1];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07248}07248         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07249}07249         \textcolor{keyword}{delete}[] temp\_recv\_storage[p];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07250}07250       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07251}07251       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07252}07252       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07253}07253         n\_eqn\_from\_proc[p] = n\_eqn\_for\_proc[p];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07254}07254         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07255}07255         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07256}07256           nnz\_from\_proc(p, m) = nnz\_for\_proc(p, m);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07257}07257         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07258}07258       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07259}07259     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07260}07260     recv\_nnz\_stat.clear();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07261}07261     recv\_nnz\_reqs.clear();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07262}07262 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07263}07263     \textcolor{comment}{// allocate the storage for the data to be recv and post the sends recvs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07264}07264     \textcolor{comment}{// =====================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07265}07265 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07266}07266     \textcolor{comment}{// storage}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07267}07267     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned*>}} eqns\_from\_proc(nproc);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07268}07268     \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double*>}} residuals\_from\_proc(nproc, n\_vector);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07269}07269     \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<unsigned*>}} row\_start\_from\_proc(nproc, n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07270}07270     \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<unsigned*>}} column\_indices\_from\_proc(nproc, n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07271}07271     \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double*>}} values\_from\_proc(nproc, n\_matrix);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07272}07272 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07273}07273     \textcolor{comment}{// allocate and post sends and recvs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07274}07274     \textcolor{keywordtype}{double} base;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07275}07275     MPI\_Aint communication\_base;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07276}07276     MPI\_Get\_address(\&base, \&communication\_base);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07277}07277     \textcolor{keywordtype}{unsigned} n\_comm\_types = 1 + 1 * n\_vector + 3 * n\_matrix;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07278}07278     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Request>}} recv\_reqs;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07279}07279     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Request>}} send\_reqs;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07280}07280     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07281}07281     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07282}07282       \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07283}07283       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07284}07284         \textcolor{comment}{// allocate}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07285}07285         \textcolor{keywordflow}{if} (n\_eqn\_from\_proc[p] > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07286}07286         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07287}07287           eqns\_from\_proc[p] = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}[n\_eqn\_from\_proc[p]];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07288}07288           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07289}07289           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07290}07290             residuals\_from\_proc(p, v) = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[n\_eqn\_from\_proc[p]];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07291}07291           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07292}07292           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07293}07293           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07294}07294             row\_start\_from\_proc(p, m) = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}[n\_eqn\_from\_proc[p] + 1];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07295}07295             column\_indices\_from\_proc(p, m) = \textcolor{keyword}{new} \textcolor{keywordtype}{unsigned}[nnz\_from\_proc(p, m)];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07296}07296             values\_from\_proc(p, m) = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[nnz\_from\_proc(p, m)];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07297}07297           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07298}07298         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07299}07299 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07300}07300         \textcolor{comment}{// recv}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07301}07301         \textcolor{keywordflow}{if} (n\_eqn\_from\_proc[p] > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07302}07302         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07303}07303           MPI\_Datatype types[n\_comm\_types];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07304}07304           MPI\_Aint offsets[n\_comm\_types];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07305}07305           \textcolor{keywordtype}{int} count[n\_comm\_types];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07306}07306           \textcolor{keywordtype}{int} pt = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07307}07307 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07308}07308           \textcolor{comment}{// equations}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07309}07309           count[pt] = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07310}07310           MPI\_Get\_address(eqns\_from\_proc[p], \&offsets[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07311}07311           offsets[pt] -\/= communication\_base;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07312}07312           MPI\_Type\_contiguous(n\_eqn\_from\_proc[p], MPI\_UNSIGNED, \&types[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07313}07313           MPI\_Type\_commit(\&types[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07314}07314           pt++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07315}07315 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07316}07316           \textcolor{comment}{// vectors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07317}07317           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07318}07318           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07319}07319             count[pt] = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07320}07320             MPI\_Get\_address(residuals\_from\_proc(p, v), \&offsets[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07321}07321             offsets[pt] -\/= communication\_base;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07322}07322             MPI\_Type\_contiguous(n\_eqn\_from\_proc[p], MPI\_DOUBLE, \&types[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07323}07323             MPI\_Type\_commit(\&types[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07324}07324             pt++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07325}07325           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07326}07326 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07327}07327           \textcolor{comment}{// matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07328}07328           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07329}07329           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07330}07330             \textcolor{comment}{// row start}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07331}07331             count[pt] = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07332}07332             MPI\_Get\_address(row\_start\_from\_proc(p, m), \&offsets[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07333}07333             offsets[pt] -\/= communication\_base;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07334}07334             MPI\_Type\_contiguous(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07335}07335               n\_eqn\_from\_proc[p] + 1, MPI\_UNSIGNED, \&types[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07336}07336             MPI\_Type\_commit(\&types[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07337}07337             pt++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07338}07338 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07339}07339 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07340}07340             \textcolor{comment}{// column indices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07341}07341             count[pt] = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07342}07342             MPI\_Get\_address(column\_indices\_from\_proc(p, m), \&offsets[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07343}07343             offsets[pt] -\/= communication\_base;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07344}07344             MPI\_Type\_contiguous(nnz\_from\_proc(p, m), MPI\_UNSIGNED, \&types[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07345}07345             MPI\_Type\_commit(\&types[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07346}07346             pt++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07347}07347 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07348}07348             \textcolor{comment}{// values}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07349}07349             count[pt] = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07350}07350             MPI\_Get\_address(values\_from\_proc(p, m), \&offsets[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07351}07351             offsets[pt] -\/= communication\_base;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07352}07352             MPI\_Type\_contiguous(nnz\_from\_proc(p, m), MPI\_DOUBLE, \&types[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07353}07353             MPI\_Type\_commit(\&types[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07354}07354             pt++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07355}07355           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07356}07356 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07357}07357           \textcolor{comment}{// build the combined type}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07358}07358           MPI\_Datatype recv\_type;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07359}07359           MPI\_Type\_create\_struct(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07360}07360             n\_comm\_types, count, offsets, types, \&recv\_type);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07361}07361           MPI\_Type\_commit(\&recv\_type);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07362}07362           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}} = 0; \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}} < n\_comm\_types; \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07363}07363           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07364}07364             MPI\_Type\_free(\&types[\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07365}07365           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07366}07366           MPI\_Request req;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07367}07367           MPI\_Irecv(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07368}07368             \&base, 1, recv\_type, p, 1, \mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>mpi\_comm(), \&req);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07369}07369           MPI\_Type\_free(\&recv\_type);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07370}07370           recv\_reqs.push\_back(req);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07371}07371         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07372}07372 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07373}07373         \textcolor{comment}{// send}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07374}07374         \textcolor{keywordflow}{if} (n\_eqn\_for\_proc[p] > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07375}07375         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07376}07376           MPI\_Datatype types[n\_comm\_types];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07377}07377           MPI\_Aint offsets[n\_comm\_types];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07378}07378           \textcolor{keywordtype}{int} count[n\_comm\_types];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07379}07379           \textcolor{keywordtype}{int} pt = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07380}07380 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07381}07381           \textcolor{comment}{// equations}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07382}07382           count[pt] = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07383}07383           MPI\_Get\_address(eqns\_for\_proc[p], \&offsets[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07384}07384           offsets[pt] -\/= communication\_base;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07385}07385           MPI\_Type\_contiguous(n\_eqn\_for\_proc[p], MPI\_UNSIGNED, \&types[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07386}07386           MPI\_Type\_commit(\&types[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07387}07387           pt++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07388}07388 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07389}07389           \textcolor{comment}{// vectors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07390}07390           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07391}07391           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07392}07392             count[pt] = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07393}07393             MPI\_Get\_address(residuals\_for\_proc(p, v), \&offsets[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07394}07394             offsets[pt] -\/= communication\_base;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07395}07395             MPI\_Type\_contiguous(n\_eqn\_for\_proc[p], MPI\_DOUBLE, \&types[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07396}07396             MPI\_Type\_commit(\&types[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07397}07397             pt++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07398}07398           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07399}07399 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07400}07400           \textcolor{comment}{// matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07401}07401           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07402}07402           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07403}07403             \textcolor{comment}{// row start}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07404}07404             count[pt] = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07405}07405             MPI\_Get\_address(row\_start\_for\_proc(p, m), \&offsets[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07406}07406             offsets[pt] -\/= communication\_base;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07407}07407             MPI\_Type\_contiguous(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07408}07408               n\_eqn\_for\_proc[p] + 1, MPI\_UNSIGNED, \&types[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07409}07409             MPI\_Type\_commit(\&types[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07410}07410             pt++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07411}07411 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07412}07412 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07413}07413             \textcolor{comment}{// column indices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07414}07414             count[pt] = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07415}07415             MPI\_Get\_address(column\_indices\_for\_proc(p, m), \&offsets[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07416}07416             offsets[pt] -\/= communication\_base;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07417}07417             MPI\_Type\_contiguous(nnz\_for\_proc(p, m), MPI\_UNSIGNED, \&types[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07418}07418             MPI\_Type\_commit(\&types[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07419}07419             pt++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07420}07420 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07421}07421             \textcolor{comment}{// values}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07422}07422             count[pt] = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07423}07423             MPI\_Get\_address(values\_for\_proc(p, m), \&offsets[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07424}07424             offsets[pt] -\/= communication\_base;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07425}07425             MPI\_Type\_contiguous(nnz\_for\_proc(p, m), MPI\_DOUBLE, \&types[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07426}07426             MPI\_Type\_commit(\&types[pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07427}07427             pt++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07428}07428           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07429}07429 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07430}07430           \textcolor{comment}{// build the combined type}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07431}07431           MPI\_Datatype send\_type;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07432}07432           MPI\_Type\_create\_struct(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07433}07433             n\_comm\_types, count, offsets, types, \&send\_type);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07434}07434           MPI\_Type\_commit(\&send\_type);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07435}07435           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}} = 0; \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}} < n\_comm\_types; \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07436}07436           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07437}07437             MPI\_Type\_free(\&types[\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07438}07438           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07439}07439           MPI\_Request req;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07440}07440           MPI\_Isend(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07441}07441             \&base, 1, send\_type, p, 1, \mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>mpi\_comm(), \&req);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07442}07442           MPI\_Type\_free(\&send\_type);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07443}07443           send\_reqs.push\_back(req);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07444}07444         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07445}07445       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07446}07446       \textcolor{comment}{// otherwise send to self}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07447}07447       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07448}07448       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07449}07449         eqns\_from\_proc[p] = eqns\_for\_proc[p];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07450}07450         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07451}07451         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07452}07452           residuals\_from\_proc(p, v) = residuals\_for\_proc(p, v);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07453}07453         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07454}07454         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07455}07455         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07456}07456           row\_start\_from\_proc(p, m) = row\_start\_for\_proc(p, m);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07457}07457           column\_indices\_from\_proc(p, m) = column\_indices\_for\_proc(p, m);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07458}07458           values\_from\_proc(p, m) = values\_for\_proc(p, m);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07459}07459         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07460}07460       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07461}07461     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07462}07462 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07463}07463     \textcolor{comment}{// wait for the recvs to complete}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07464}07464     \textcolor{keywordtype}{unsigned} n\_recv\_req = recv\_reqs.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07465}07465     \textcolor{keywordflow}{if} (n\_recv\_req > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07466}07466     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07467}07467       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Status>}} recv\_stat(n\_recv\_req);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07468}07468       MPI\_Waitall(n\_recv\_req, \&recv\_reqs[0], \&recv\_stat[0]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07469}07469     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07470}07470 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07471}07471     \textcolor{comment}{// ==============================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07472}07472     \textcolor{keywordtype}{unsigned} target\_nrow\_local = target\_dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07473}07473 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07474}07474     \textcolor{comment}{// loop over the matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07475}07475     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07476}07476     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07477}07477       \textcolor{comment}{// allocate row\_start}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07478}07478       row\_start[m] = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[target\_nrow\_local + 1];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07479}07479       row\_start[m][0] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07480}07480 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07481}07481       \textcolor{comment}{// initially allocate storage based on the maximum number of non-\/zeros}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07482}07482       \textcolor{comment}{// from any one processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07483}07483       \textcolor{keywordtype}{unsigned} nnz\_allocation = \mbox{\hyperlink{classoomph_1_1Problem_a6a96b64a44cb378db1c0a07c562f7dae}{Parallel\_sparse\_assemble\_previous\_allocation}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07484}07484       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07485}07485       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07486}07486         nnz\_allocation = std::max(nnz\_allocation, nnz\_from\_proc(p, m));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07487}07487       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07488}07488       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}} values\_chunk(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07489}07489       values\_chunk[0] = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[nnz\_allocation];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07490}07490       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}} column\_indices\_chunk(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07491}07491       column\_indices\_chunk[0] = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nnz\_allocation];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07492}07492       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} ncoef\_in\_chunk(1, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07493}07493       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} size\_of\_chunk(1, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07494}07494       size\_of\_chunk[0] = nnz\_allocation;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07495}07495       \textcolor{keywordtype}{unsigned} current\_chunk = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07496}07496 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07497}07497       \textcolor{comment}{// for each row on this processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07498}07498       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < target\_nrow\_local; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07499}07499       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07500}07500         row\_start[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07501}07501 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07502}07502         \textcolor{comment}{// determine the processors that this row is on}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07503}07503         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} row\_on\_proc(nproc, -\/1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07504}07504         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07505}07505         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07506}07506           \textcolor{keywordflow}{if} (n\_eqn\_from\_proc[p] == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07507}07507           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07508}07508             row\_on\_proc[p] = -\/1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07509}07509           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07510}07510           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07511}07511           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07512}07512             \textcolor{keywordtype}{int} left = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07513}07513             \textcolor{keywordtype}{int} right = n\_eqn\_from\_proc[p] -\/ 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07514}07514             \textcolor{keywordtype}{int} midpoint = right / 2;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07515}07515             \textcolor{keywordtype}{bool} complete = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07516}07516             \textcolor{keywordflow}{while} (!complete)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07517}07517             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07518}07518               midpoint = (right + left) / 2;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07519}07519               \textcolor{keywordflow}{if} (midpoint > right)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07520}07520               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07521}07521                 midpoint = right;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07522}07522               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07523}07523               \textcolor{keywordflow}{if} (midpoint < left)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07524}07524               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07525}07525                 midpoint = left;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07526}07526               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07527}07527               \textcolor{keywordflow}{if} (left == right)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07528}07528               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07529}07529                 \textcolor{keywordflow}{if} (eqns\_from\_proc[p][midpoint] == \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07530}07530                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07531}07531                   midpoint = left;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07532}07532                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07533}07533                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07534}07534                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07535}07535                   midpoint = -\/1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07536}07536                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07537}07537                 complete = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07538}07538               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07539}07539               \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (eqns\_from\_proc[p][midpoint] == \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07540}07540               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07541}07541                 complete = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07542}07542               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07543}07543               \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (eqns\_from\_proc[p][midpoint] > \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07544}07544               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07545}07545                 right = std::max(midpoint -\/ 1, left);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07546}07546               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07547}07547               \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07548}07548               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07549}07549                 left = std::min(midpoint + 1, right);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07550}07550               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07551}07551             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07552}07552             row\_on\_proc[p] = midpoint;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07553}07553           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07554}07554         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07555}07555 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07556}07556         \textcolor{comment}{// for each processor build this row of the matrix}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07557}07557         \textcolor{keywordtype}{unsigned} check\_first = ncoef\_in\_chunk[current\_chunk];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07558}07558         \textcolor{keywordtype}{unsigned} check\_last = check\_first;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07559}07559         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07560}07560         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07561}07561           \textcolor{keywordflow}{if} (row\_on\_proc[p] != -\/1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07562}07562           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07563}07563             \textcolor{keywordtype}{int} row = row\_on\_proc[p];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07564}07564             \textcolor{keywordtype}{unsigned} first = row\_start\_from\_proc(p, m)[row];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07565}07565             \textcolor{keywordtype}{unsigned} last = row\_start\_from\_proc(p, m)[row + 1];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07566}07566             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} l = first; l < last; l++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07567}07567             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07568}07568               \textcolor{keywordtype}{bool} done = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07569}07569               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = check\_first; j <= check\_last \&\& !done; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07570}07570               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07571}07571                 \textcolor{keywordflow}{if} (j == check\_last)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07572}07572                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07573}07573                   \textcolor{comment}{// is this temp array full, do we need to allocate}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07574}07574                   \textcolor{comment}{// a new temp array}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07575}07575                   \textcolor{keywordflow}{if} (ncoef\_in\_chunk[current\_chunk] ==}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07576}07576                       size\_of\_chunk[current\_chunk])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07577}07577                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07578}07578                     \textcolor{comment}{// number of chunks allocated}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07579}07579                     \textcolor{keywordtype}{unsigned} n\_chunk = values\_chunk.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07580}07580 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07581}07581                     \textcolor{comment}{// determine the number of non-\/zeros added so far}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07582}07582                     \textcolor{comment}{// (excluding the current row)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07583}07583                     \textcolor{keywordtype}{unsigned} nnz\_so\_far = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07584}07584                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} c = 0; c < n\_chunk; c++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07585}07585                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07586}07586                       nnz\_so\_far += ncoef\_in\_chunk[c];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07587}07587                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07588}07588                     nnz\_so\_far -\/= row\_start[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07589}07589 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07590}07590                     \textcolor{comment}{// average number of non-\/zeros per row}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07591}07591                     \textcolor{keywordtype}{unsigned} avg\_nnz = nnz\_so\_far / (\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + 1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07592}07592 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07593}07593                     \textcolor{comment}{// number of rows left +1}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07594}07594                     \textcolor{keywordtype}{unsigned} nrows\_left = target\_nrow\_local -\/ \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07595}07595 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07596}07596                     \textcolor{comment}{// allocation for next chunk}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07597}07597                     \textcolor{keywordtype}{unsigned} next\_chunk\_size =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07598}07598                       avg\_nnz * nrows\_left + row\_start[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07599}07599 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07600}07600                     \textcolor{comment}{// allocate storage in next chunk}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07601}07601                     current\_chunk++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07602}07602                     n\_chunk++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07603}07603                     values\_chunk.resize(n\_chunk);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07604}07604                     values\_chunk[current\_chunk] = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[next\_chunk\_size];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07605}07605                     column\_indices\_chunk.resize(n\_chunk);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07606}07606                     column\_indices\_chunk[current\_chunk] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07607}07607                       \textcolor{keyword}{new} \textcolor{keywordtype}{int}[next\_chunk\_size];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07608}07608                     size\_of\_chunk.resize(n\_chunk);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07609}07609                     size\_of\_chunk[current\_chunk] = next\_chunk\_size;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07610}07610                     ncoef\_in\_chunk.resize(n\_chunk);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07611}07611 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07612}07612                     \textcolor{comment}{// copy current row from previous chunk to new chunk}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07613}07613                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = check\_first; k < check\_last; k++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07614}07614                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07615}07615                       values\_chunk[current\_chunk][k -\/ check\_first] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07616}07616                         values\_chunk[current\_chunk -\/ 1][k];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07617}07617                       column\_indices\_chunk[current\_chunk][k -\/ check\_first] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07618}07618                         column\_indices\_chunk[current\_chunk -\/ 1][k];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07619}07619                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07620}07620                     ncoef\_in\_chunk[current\_chunk -\/ 1] -\/= row\_start[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07621}07621                     ncoef\_in\_chunk[current\_chunk] = row\_start[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07622}07622 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07623}07623                     \textcolor{comment}{// update first\_check and last\_check}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07624}07624                     check\_first = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07625}07625                     check\_last = row\_start[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07626}07626                     j = check\_last;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07627}07627                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07628}07628 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07629}07629                   \textcolor{comment}{// add the coefficient}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07630}07630                   values\_chunk[current\_chunk][j] = values\_from\_proc(p, m)[l];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07631}07631                   column\_indices\_chunk[current\_chunk][j] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07632}07632                     column\_indices\_from\_proc(p, m)[l];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07633}07633                   ncoef\_in\_chunk[current\_chunk]++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07634}07634                   row\_start[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07635}07635                   check\_last++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07636}07636                   done = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07637}07637                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07638}07638                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (column\_indices\_chunk[current\_chunk][j] ==}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07639}07639                          (\textcolor{keywordtype}{int})column\_indices\_from\_proc(p, m)[l])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07640}07640                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07641}07641                   values\_chunk[current\_chunk][j] += values\_from\_proc(p, m)[l];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07642}07642                   done = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07643}07643                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07644}07644               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07645}07645             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07646}07646           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07647}07647         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07648}07648       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07649}07649 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07650}07650       \textcolor{comment}{// delete recv data for this matrix}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07651}07651       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07652}07652       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07653}07653         \textcolor{keywordflow}{if} (n\_eqn\_from\_proc[p] > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07654}07654         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07655}07655           \textcolor{keyword}{delete}[] row\_start\_from\_proc(p, m);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07656}07656           \textcolor{keyword}{delete}[] column\_indices\_from\_proc(p, m);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07657}07657           \textcolor{keyword}{delete}[] values\_from\_proc(p, m);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07658}07658         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07659}07659       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07660}07660 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07661}07661       \textcolor{comment}{// next we take the chunk base storage of the column indices and values}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07662}07662       \textcolor{comment}{// and copy into a single contiguous block of memory}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07663}07663       \textcolor{comment}{// ====================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07664}07664       \textcolor{keywordtype}{unsigned} n\_chunk = values\_chunk.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07665}07665       nnz[m] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07666}07666       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} c = 0; c < n\_chunk; c++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07667}07667       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07668}07668         nnz[m] += ncoef\_in\_chunk[c];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07669}07669       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07670}07670       \mbox{\hyperlink{classoomph_1_1Problem_a6a96b64a44cb378db1c0a07c562f7dae}{Parallel\_sparse\_assemble\_previous\_allocation}} = nnz[m];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07671}07671 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07672}07672       \textcolor{comment}{// allocate}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07673}07673       values[m] = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[nnz[m]];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07674}07674       column\_indices[m] = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nnz[m]];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07675}07675 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07676}07676       \textcolor{comment}{// copy}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07677}07677       \textcolor{keywordtype}{unsigned} pt = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07678}07678       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} c = 0; c < n\_chunk; c++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07679}07679       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07680}07680         \textcolor{keywordtype}{unsigned} nc = ncoef\_in\_chunk[c];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07681}07681         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nc; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07682}07682         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07683}07683           values[m][pt + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = values\_chunk[c][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07684}07684           column\_indices[m][pt + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = column\_indices\_chunk[c][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07685}07685         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07686}07686         pt += nc;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07687}07687         \textcolor{keyword}{delete}[] values\_chunk[c];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07688}07688         \textcolor{keyword}{delete}[] column\_indices\_chunk[c];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07689}07689       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07690}07690 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07691}07691       \textcolor{comment}{// the row\_start vector currently contains the number of coefs in each}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07692}07692       \textcolor{comment}{// row. Update}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07693}07693       \textcolor{comment}{// ===================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07694}07694       \textcolor{keywordtype}{unsigned} g = row\_start[m][0];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07695}07695       row\_start[m][0] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07696}07696       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 1; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < target\_nrow\_local; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07697}07697       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07698}07698         \textcolor{keywordtype}{unsigned} h = g + row\_start[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07699}07699         row\_start[m][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = g;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07700}07700         g = h;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07701}07701       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07702}07702       row\_start[m][target\_nrow\_local] = g;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07703}07703     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07704}07704 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07705}07705     \textcolor{comment}{// next accumulate the residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07706}07706     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07707}07707     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07708}07708       residuals[v] = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[target\_nrow\_local];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07709}07709       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < target\_nrow\_local; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07710}07710       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07711}07711         residuals[v][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07712}07712       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07713}07713       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07714}07714       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07715}07715         \textcolor{keywordflow}{if} (n\_eqn\_from\_proc[p] > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07716}07716         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07717}07717           \textcolor{keywordtype}{unsigned} n\_eqn\_p = n\_eqn\_from\_proc[p];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07718}07718           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_eqn\_p; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07719}07719           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07720}07720             residuals[v][eqns\_from\_proc[p][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]] += residuals\_from\_proc(p, v)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07721}07721           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07722}07722           \textcolor{keyword}{delete}[] residuals\_from\_proc(p, v);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07723}07723         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07724}07724       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07725}07725     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07726}07726 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07727}07727     \textcolor{comment}{// delete list of eqns from proc}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07728}07728     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07729}07729     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07730}07730       \textcolor{keywordflow}{if} (n\_eqn\_from\_proc[p] > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07731}07731       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07732}07732         \textcolor{keyword}{delete}[] eqns\_from\_proc[p];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07733}07733       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07734}07734     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07735}07735 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07736}07736     \textcolor{comment}{// and wait for sends to complete}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07737}07737     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Status>}} send\_nnz\_stat(nproc -\/ 1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07738}07738     MPI\_Waitall(nproc -\/ 1, \&send\_nnz\_reqs[0], \&send\_nnz\_stat[0]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07739}07739     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07740}07740     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07741}07741       \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07742}07742       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07743}07743         \textcolor{keyword}{delete}[] temp\_send\_storage[p];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07744}07744       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07745}07745     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07746}07746     send\_nnz\_stat.clear();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07747}07747     send\_nnz\_reqs.clear();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07748}07748 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07749}07749     \textcolor{comment}{// wait for the matrix data sends to complete and delete the data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07750}07750     \textcolor{keywordtype}{unsigned} n\_send\_reqs = send\_reqs.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07751}07751     \textcolor{keywordflow}{if} (n\_send\_reqs > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07752}07752     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07753}07753       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Status>}} send\_stat(n\_send\_reqs);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07754}07754       MPI\_Waitall(n\_send\_reqs, \&send\_reqs[0], \&send\_stat[0]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07755}07755       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07756}07756       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07757}07757         \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07758}07758         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07759}07759           \textcolor{keywordflow}{if} (n\_eqn\_for\_proc[p])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07760}07760           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07761}07761             \textcolor{keyword}{delete}[] eqns\_for\_proc[p];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07762}07762             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_matrix; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07763}07763             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07764}07764               \textcolor{keyword}{delete}[] row\_start\_for\_proc(p, m);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07765}07765               \textcolor{keyword}{delete}[] column\_indices\_for\_proc(p, m);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07766}07766               \textcolor{keyword}{delete}[] values\_for\_proc(p, m);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07767}07767             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07768}07768             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} v = 0; v < n\_vector; v++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07769}07769             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07770}07770               \textcolor{keyword}{delete}[] residuals\_for\_proc(p, v);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07771}07771             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07772}07772           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07773}07773         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07774}07774       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07775}07775     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07776}07776 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07777}07777     \textcolor{comment}{// Doc?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07778}07778     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a9a20957e3ef4c8142261363c85f6e276}{Doc\_imbalance\_in\_parallel\_assembly}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07779}07779     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07780}07780       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07781}07781       t\_local = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07782}07782       t\_max = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07783}07783       t\_min = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07784}07784       t\_sum = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07785}07785       MPI\_Allreduce(\&t\_local,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07786}07786                     \&t\_max,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07787}07787                     1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07788}07788                     MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07789}07789                     MPI\_MAX,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07790}07790                     this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07791}07791       MPI\_Allreduce(\&t\_local,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07792}07792                     \&t\_min,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07793}07793                     1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07794}07794                     MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07795}07795                     MPI\_MIN,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07796}07796                     this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07797}07797       MPI\_Allreduce(\&t\_local,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07798}07798                     \&t\_sum,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07799}07799                     1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07800}07800                     MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07801}07801                     MPI\_SUM,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07802}07802                     this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07803}07803       \textcolor{keywordtype}{double} imbalance = (t\_max -\/ t\_min) / (t\_sum / \textcolor{keywordtype}{double}(nproc)) * 100.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07804}07804       \textcolor{keywordflow}{if} (doing\_residuals)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07805}07805       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07806}07806         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}CPU for residual distribut.  (loc/max/min/imbal): "{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07807}07807       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07808}07808       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07809}07809       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07810}07810         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}CPU for Jacobian distribut.  (loc/max/min/imbal): "{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07811}07811       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07812}07812       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << t\_local << \textcolor{stringliteral}{"{} "{}} << t\_max << \textcolor{stringliteral}{"{} "{}} << t\_min << \textcolor{stringliteral}{"{} "{}} << imbalance}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07813}07813                  << \textcolor{stringliteral}{"{}\%\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07814}07814     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07815}07815   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07816}07816 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07817}07817 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07818}07818 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07819}07819 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07820}07820   \textcolor{comment}{//================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07821}07821 \textcolor{comment}{  /// Get the full Jacobian by finite differencing}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07822}07822 \textcolor{comment}{}  \textcolor{comment}{//================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07823}\mbox{\hyperlink{classoomph_1_1Problem_a74f6540dc7228b21f5bc07c0477dfbe7}{07823}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a74f6540dc7228b21f5bc07c0477dfbe7}{Problem::get\_fd\_jacobian}}(\mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& residuals,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07824}07824                                 \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}}\& jacobian)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07825}07825   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07826}07826 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07827}07827 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07828}07828     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07829}07829     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07830}07830       \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(\textcolor{stringliteral}{"{}This is unlikely to work with a distributed problem"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07831}07831                       \textcolor{stringliteral}{"{} Problem::get\_fd\_jacobian()"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07832}07832                       OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07833}07833     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07834}07834 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07835}07835 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07836}07836 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07837}07837     \textcolor{comment}{// Find number of dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07838}07838     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_dof = \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07839}07839 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07840}07840     \textcolor{comment}{// Advanced residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07841}07841     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} residuals\_pls;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07842}07842 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07843}07843     \textcolor{comment}{// Get reference residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07844}07844     \mbox{\hyperlink{classoomph_1_1Problem_a7300386d91390e3e5be993aca7459498}{get\_residuals}}(residuals);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07845}07845 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07846}07846     \textcolor{keyword}{const} \textcolor{keywordtype}{double} \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}} = 1.0e-\/8;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07847}07847 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07848}07848     \textcolor{comment}{// Make sure the Jacobian is the right size (since we don't care about}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07849}07849     \textcolor{comment}{// speed).}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07850}07850     jacobian.\mbox{\hyperlink{classoomph_1_1DenseMatrix_adec1ef741b1c5048a12ba9a540c2719c}{resize}}(n\_dof, n\_dof);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07851}07851 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07852}07852     \textcolor{comment}{// Loop over all dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07853}07853     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} jdof = 0; jdof < n\_dof; jdof++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07854}07854     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07855}07855       \textcolor{keywordtype}{double} backup = *\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[jdof];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07856}07856       *\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[jdof] += \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07857}07857 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07858}07858       \textcolor{comment}{// We're checking if the new values for Dof\_pt[] actually}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07859}07859       \textcolor{comment}{// solve the entire problem -\/-\/> update as if problem had}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07860}07860       \textcolor{comment}{// been solved}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07861}07861       \mbox{\hyperlink{classoomph_1_1Problem_a0c8d70891f7369bb4bf8412fa1a08ecb}{actions\_before\_newton\_solve}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07862}07862       \mbox{\hyperlink{classoomph_1_1Problem_ae6ad96ddf5d48b517b89c9a9b879bc4b}{actions\_before\_newton\_convergence\_check}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07863}07863       \mbox{\hyperlink{classoomph_1_1Problem_a033ec7301123deeb7e56d04c38f9f1da}{actions\_after\_newton\_solve}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07864}07864 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07865}07865       \textcolor{comment}{// Get advanced residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07866}07866       \mbox{\hyperlink{classoomph_1_1Problem_a7300386d91390e3e5be993aca7459498}{get\_residuals}}(residuals\_pls);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07867}07867 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07868}07868       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} ieqn = 0; ieqn < n\_dof; ieqn++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07869}07869       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07870}07870         jacobian(ieqn, jdof) =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07871}07871           (residuals\_pls[ieqn] -\/ residuals[ieqn]) / \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07872}07872       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07873}07873 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07874}07874       *\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[jdof] = backup;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07875}07875     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07876}07876 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07877}07877     \textcolor{comment}{// Reset problem to state it was in}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07878}07878     \mbox{\hyperlink{classoomph_1_1Problem_a0c8d70891f7369bb4bf8412fa1a08ecb}{actions\_before\_newton\_solve}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07879}07879     \mbox{\hyperlink{classoomph_1_1Problem_ae6ad96ddf5d48b517b89c9a9b879bc4b}{actions\_before\_newton\_convergence\_check}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07880}07880     \mbox{\hyperlink{classoomph_1_1Problem_a033ec7301123deeb7e56d04c38f9f1da}{actions\_after\_newton\_solve}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07881}07881   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07882}07882 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07883}07883   \textcolor{comment}{//======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07884}07884 \textcolor{comment}{  /// Get derivative of the residuals vector wrt a global parameter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07885}07885 \textcolor{comment}{  /// This is required in continuation problems}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07886}07886 \textcolor{comment}{}  \textcolor{comment}{//=======================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07887}\mbox{\hyperlink{classoomph_1_1Problem_af4d959a47ef6a8d50b394a6761dfab5a}{07887}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_af4d959a47ef6a8d50b394a6761dfab5a}{Problem::get\_derivative\_wrt\_global\_parameter}}(\textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07888}07888                                                     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07889}07889   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07890}07890     \textcolor{comment}{// If we are doing the calculation analytically then call the appropriate}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07891}07891     \textcolor{comment}{// handler and then calling get\_residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07892}07892     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a41a7b9cf8e6fe1156fc92baa43c3fe4b}{is\_dparameter\_calculated\_analytically}}(parameter\_pt))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07893}07893     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07894}07894       \textcolor{comment}{// Locally cache pointer to assembly handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07895}07895       \mbox{\hyperlink{classoomph_1_1AssemblyHandler}{AssemblyHandler}}* \textcolor{keyword}{const} old\_assembly\_handler\_pt = \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07896}07896       \textcolor{comment}{// Create a new assembly handler that replaces get\_residuals by}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07897}07897       \textcolor{comment}{// get\_dresiduals\_dparameter for each element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07898}07898       \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}} =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07899}07899         \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1ParameterDerivativeHandler}{ParameterDerivativeHandler}}(old\_assembly\_handler\_pt, parameter\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07900}07900       \textcolor{comment}{// Get the residuals, which will be dresiduals by dparameter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07901}07901       this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a7300386d91390e3e5be993aca7459498}{get\_residuals}}(result);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07902}07902       \textcolor{comment}{// Delete the parameter derivative handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07903}07903       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07904}07904       \textcolor{comment}{// Reset the assembly handler to the original handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07905}07905       \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}} = old\_assembly\_handler\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07906}07906 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07907}07907       \textcolor{comment}{/*AssemblyHandler* const assembly\_handler\_pt = Assembly\_handler\_pt;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07908}07908 \textcolor{comment}{      //Loop over all the elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07909}07909 \textcolor{comment}{      unsigned long Element\_pt\_range = Mesh\_pt-\/>nelement();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07910}07910 \textcolor{comment}{      for(unsigned long e=0;e<Element\_pt\_range;e++)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07911}07911 \textcolor{comment}{       \{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07912}07912 \textcolor{comment}{        //Get the pointer to the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07913}07913 \textcolor{comment}{        GeneralisedElement* elem\_pt = Mesh\_pt-\/>element\_pt(e);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07914}07914 \textcolor{comment}{        //Find number of dofs in the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07915}07915 \textcolor{comment}{        unsigned n\_element\_dofs = assembly\_handler\_pt-\/>ndof(elem\_pt);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07916}07916 \textcolor{comment}{        //Set up an array}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07917}07917 \textcolor{comment}{        Vector<double> element\_residuals(n\_element\_dofs);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07918}07918 \textcolor{comment}{        //Fill the array}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07919}07919 \textcolor{comment}{        assembly\_handler\_pt-\/>get\_dresiduals\_dparameter(elem\_pt,parameter\_pt,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07920}07920 \textcolor{comment}{                                                       element\_residuals);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07921}07921 \textcolor{comment}{        //Now loop over the dofs and assign values to global Vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07922}07922 \textcolor{comment}{        for(unsigned l=0;l<n\_element\_dofs;l++)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07923}07923 \textcolor{comment}{         \{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07924}07924 \textcolor{comment}{          result[assembly\_handler\_pt-\/>eqn\_number(elem\_pt,l)]}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07925}07925 \textcolor{comment}{           += element\_residuals[l];}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07926}07926 \textcolor{comment}{          \}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07927}07927 \textcolor{comment}{          \}*/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07928}07928 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07929}07929       \textcolor{comment}{// for(unsigned n=0;n<n\_dof;n++)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07930}07930       \textcolor{comment}{// \{std::cout << "{}BLA "{} << n << "{} "{} <<  result[n] << "{}\(\backslash\)n"{};\}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07931}07931     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07932}07932     \textcolor{comment}{// Otherwise use the finite difference default}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07933}07933     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07934}07934     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07935}07935       \textcolor{comment}{// Get the (global) residuals and store in the result vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07936}07936       \mbox{\hyperlink{classoomph_1_1Problem_a7300386d91390e3e5be993aca7459498}{get\_residuals}}(result);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07937}07937 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07938}07938       \textcolor{comment}{// Storage for the new residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07939}07939       \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} newres;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07940}07940 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07941}07941       \textcolor{comment}{// Increase the global parameter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07942}07942       \textcolor{keyword}{const} \textcolor{keywordtype}{double} \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}} = 1.0e-\/8;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07943}07943 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07944}07944       \textcolor{comment}{// Store the current value of the parameter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07945}07945       \textcolor{keywordtype}{double} param\_value = *parameter\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07946}07946 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07947}07947       \textcolor{comment}{// Increase the parameter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07948}07948       *parameter\_pt += \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07949}07949 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07950}07950       \textcolor{comment}{// Do any possible updates}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07951}07951       \mbox{\hyperlink{classoomph_1_1Problem_a1e90bbe5d279295b97ae704487259bcc}{actions\_after\_change\_in\_global\_parameter}}(parameter\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07952}07952 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07953}07953       \textcolor{comment}{// Get the new residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07954}07954       \mbox{\hyperlink{classoomph_1_1Problem_a7300386d91390e3e5be993aca7459498}{get\_residuals}}(newres);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07955}07955 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07956}07956       \textcolor{comment}{// Find the number of local rows}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07957}07957       \textcolor{comment}{//(I think it's a global vector, so that should be fine)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07958}07958       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} ndof\_local = result.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07959}07959 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07960}07960       \textcolor{comment}{// Do the finite differencing in the local variables}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07961}07961       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < ndof\_local; ++n)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07962}07962       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07963}07963         result[n] = (newres[n] -\/ result[n]) / \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07964}07964       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07965}07965 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07966}07966       \textcolor{comment}{// Reset the value of the parameter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07967}07967       *parameter\_pt = param\_value;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07968}07968 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07969}07969       \textcolor{comment}{// Do any possible updates}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07970}07970       \mbox{\hyperlink{classoomph_1_1Problem_a1e90bbe5d279295b97ae704487259bcc}{actions\_after\_change\_in\_global\_parameter}}(parameter\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07971}07971     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07972}07972   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07973}07973 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07974}07974 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07975}07975   \textcolor{comment}{//======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07976}07976 \textcolor{comment}{  /// Return the product of the global hessian (derivative of Jacobian}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07977}07977 \textcolor{comment}{  /// matrix  with respect to all variables) with}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07978}07978 \textcolor{comment}{  /// an eigenvector, Y, and any number of other specified vectors C}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07979}07979 \textcolor{comment}{  /// (d(J\_\{ij\})/d u\_\{k\}) Y\_\{j\} C\_\{k\}.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07980}07980 \textcolor{comment}{  /// This function is used in assembling and solving the augmented systems}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07981}07981 \textcolor{comment}{  /// associated with bifurcation tracking.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07982}07982 \textcolor{comment}{  /// The default implementation is to use finite differences at the global}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07983}07983 \textcolor{comment}{  /// level.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07984}07984 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07985}\mbox{\hyperlink{classoomph_1_1Problem_ac65cbe00a72cfc91ccaea10818f1a507}{07985}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ac65cbe00a72cfc91ccaea10818f1a507}{Problem::get\_hessian\_vector\_products}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07986}07986     \mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries}{DoubleVectorWithHaloEntries}} \textcolor{keyword}{const}\& Y,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07987}07987     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVectorWithHaloEntries>}} \textcolor{keyword}{const}\& C,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07988}07988     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVectorWithHaloEntries>}}\& product)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07989}07989   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07990}07990     \textcolor{comment}{// How many vector products must we construct}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07991}07991     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_vec = C.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07992}07992 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07993}07993     \textcolor{comment}{// currently only global (non-\/distributed) distributions are allowed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07994}07994     \textcolor{comment}{// LinearAlgebraDistribution* dist\_pt = new}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07995}07995     \textcolor{comment}{// LinearAlgebraDistribution(Communicator\_pt,n\_dof,false);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07996}07996 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07997}07997     \textcolor{comment}{// Cache the assembly hander}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07998}07998     \mbox{\hyperlink{classoomph_1_1AssemblyHandler}{AssemblyHandler}}* \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}} = \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l07999}07999 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08000}08000     \textcolor{comment}{// Rebuild the results vectors and initialise to zero}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08001}08001     \textcolor{comment}{// use the same distribution of the vector Y}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08002}08002     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_vec; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08003}08003     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08004}08004       product[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].build(Y.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08005}08005       product[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].\mbox{\hyperlink{classoomph_1_1Vector_ad526bb1acccf11b485ebe12c9cde44fd}{initialise}}(0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08006}08006     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08007}08007 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08008}08008 \textcolor{comment}{// Setup the halo schemes for the result}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08009}08009 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08010}08010     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08011}08011     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08012}08012       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_vec; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08013}08013       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08014}08014         product[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].build\_halo\_scheme(this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a1dcaa04975d69c616ab294cbfaf53d55}{Halo\_scheme\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08015}08015       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08016}08016     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08017}08017 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08018}08018 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08019}08019     \textcolor{comment}{// If we are doing the calculation analytically then call the appropriate}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08020}08020     \textcolor{comment}{// handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08021}08021     \textcolor{comment}{// A better way to do this is probably to hook into the get\_residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08022}08022     \textcolor{comment}{// framework but with a different member function of the assembly}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08023}08023     \textcolor{comment}{// handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08024}08024     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Problem_af6235ced9e7e85324f785f2681ab3872}{are\_hessian\_products\_calculated\_analytically}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08025}08025     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08026}08026       \textcolor{comment}{// Loop over all the elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08027}08027       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} Element\_pt\_range = \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08028}08028       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < Element\_pt\_range; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08029}08029       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08030}08030         \textcolor{comment}{// Get the pointer to the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08031}08031         \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08032}08032 \textcolor{comment}{// Do not loop over halo elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08033}08033 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08034}08034         \textcolor{keywordflow}{if} (!elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a0d9869eaf7d6e104c1e465b0d3cd6a9b}{is\_halo}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08035}08035         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08036}08036 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08037}08037           \textcolor{comment}{// Find number of dofs in the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08038}08038           \textcolor{keywordtype}{unsigned} n\_var = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a09213be8f4aa009e0366460a7ed78e68}{ndof}}(elem\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08039}08039           \textcolor{comment}{// Set up a matrix for the input and output}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08040}08040           \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} Y\_local(n\_var);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08041}08041           \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} C\_local(n\_vec, n\_var);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08042}08042           \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} product\_local(n\_vec, n\_var);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08043}08043 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08044}08044           \textcolor{comment}{// Translate the global input vectors into the local storage}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08045}08045           \textcolor{comment}{// Probably horribly inefficient, but otherwise things get really}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08046}08046           \textcolor{comment}{// messy at the elemental level}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08047}08047           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} l = 0; l < n\_var; l++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08048}08048           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08049}08049             \textcolor{comment}{// Cache the global equation number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08050}08050             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} eqn\_number =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08051}08051               \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, l);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08052}08052 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08053}08053             Y\_local[l] = Y.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(eqn\_number);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08054}08054             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_vec; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08055}08055             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08056}08056               C\_local(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, l) = C[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].global\_value(eqn\_number);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08057}08057             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08058}08058           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08059}08059 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08060}08060           \textcolor{comment}{// Fill the array}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08061}08061           \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a296bef49838d23522bb660c4c5207f03}{get\_hessian\_vector\_products}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08062}08062             elem\_pt, Y\_local, C\_local, product\_local);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08063}08063 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08064}08064           \textcolor{comment}{// Assign the local results to the global vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08065}08065           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} l = 0; l < n\_var; l++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08066}08066           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08067}08067             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} eqn\_number =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08068}08068               \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, l);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08069}08069 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08070}08070             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_vec; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08071}08071             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08072}08072               product[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].global\_value(eqn\_number) += product\_local(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, l);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08073}08073               \textcolor{comment}{// std::cout << "{}BLA "{} << e << "{} "{} << i << "{} "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08074}08074               \textcolor{comment}{//          << l << "{} "{} << product\_local(i,l) << "{}\(\backslash\)n"{};}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08075}08075             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08076}08076           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08077}08077 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08078}08078         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08079}08079 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08080}08080       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08081}08081     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08082}08082     \textcolor{comment}{// Otherwise calculate using finite differences by}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08083}08083     \textcolor{comment}{// perturbing the jacobian along a particular direction}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08084}08084     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08085}08085     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08086}08086       \textcolor{comment}{// Cache the finite difference step}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08087}08087 \textcolor{comment}{      /// Alice: My bifurcation tracking converges better with this FD\_step}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08088}08088 \textcolor{comment}{      /// as 1.0e-\/5. The default value remains at 1.0e-\/8.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08089}08089 \textcolor{comment}{}      \textcolor{keyword}{const} \textcolor{keywordtype}{double} \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}} = \mbox{\hyperlink{classoomph_1_1Problem_ad26c62f5aab816943144ac61fbf7725e}{FD\_step\_used\_in\_get\_hessian\_vector\_products}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08090}08090 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08091}08091       \textcolor{comment}{// We can now construct our multipliers}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08092}08092       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_dof\_local = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08093}08093       \textcolor{comment}{// Prepare to scale}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08094}08094       \textcolor{keywordtype}{double} dof\_length = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08095}08095       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} C\_length(n\_vec, 0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08096}08096 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08097}08097       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof\_local; n++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08098}08098       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08099}08099         \textcolor{keywordflow}{if} (std::fabs(this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(n)) > dof\_length)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08100}08100         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08101}08101           dof\_length = std::fabs(this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(n));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08102}08102         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08103}08103       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08104}08104 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08105}08105       \textcolor{comment}{// C is assumed to have the same distribution as the dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08106}08106       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_vec; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08107}08107       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08108}08108         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof\_local; n++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08109}08109         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08110}08110           \textcolor{keywordflow}{if} (std::fabs(C[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}][n]) > C\_length[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08111}08111           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08112}08112             C\_length[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = std::fabs(C[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}][n]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08113}08113           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08114}08114         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08115}08115       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08116}08116 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08117}08117       \textcolor{comment}{// Now broadcast the information, if distributed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08118}08118 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08119}08119       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08120}08120       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08121}08121         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_length = n\_vec + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08122}08122         \textcolor{keywordtype}{double} all\_length[n\_length];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08123}08123         all\_length[0] = dof\_length;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08124}08124         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_vec; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08125}08125         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08126}08126           all\_length[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + 1] = C\_length[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08127}08127         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08128}08128 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08129}08129         \textcolor{comment}{// Do the MPI call}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08130}08130         \textcolor{keywordtype}{double} all\_length\_reduce[n\_length];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08131}08131         MPI\_Allreduce(all\_length,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08132}08132                       all\_length\_reduce,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08133}08133                       n\_length,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08134}08134                       MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08135}08135                       MPI\_MAX,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08136}08136                       this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08137}08137 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08138}08138         \textcolor{comment}{// Read out the information}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08139}08139         dof\_length = all\_length\_reduce[0];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08140}08140         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_vec; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08141}08141         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08142}08142           C\_length[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = all\_length\_reduce[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + 1];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08143}08143         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08144}08144       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08145}08145 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08146}08146 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08147}08147       \textcolor{comment}{// Form the multipliers}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08148}08148       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} C\_mult(n\_vec, 0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08149}08149       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_vec; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08150}08150       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08151}08151         C\_mult[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = dof\_length / C\_length[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08152}08152         C\_mult[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] += \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08153}08153         C\_mult[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] *= \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08154}08154       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08155}08155 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08156}08156 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08157}08157       \textcolor{comment}{// Dummy vector to stand in the place of the residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08158}08158       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} dummy\_res;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08159}08159 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08160}08160       \textcolor{comment}{// Calculate the product of the jacobian matrices, etc by looping over the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08161}08161       \textcolor{comment}{// elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08162}08162       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_element = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08163}08163       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08164}08164       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08165}08165         \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08166}08166         \textcolor{comment}{// Ignore halo's of course}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08167}08167 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08168}08168         \textcolor{keywordflow}{if} (!elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a0d9869eaf7d6e104c1e465b0d3cd6a9b}{is\_halo}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08169}08169         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08170}08170 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08171}08171           \textcolor{comment}{// Loop over the ndofs in each element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08172}08172           \textcolor{keywordtype}{unsigned} n\_var = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a09213be8f4aa009e0366460a7ed78e68}{ndof}}(elem\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08173}08173           \textcolor{comment}{// Resize the dummy residuals vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08174}08174           dummy\_res.resize(n\_var);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08175}08175           \textcolor{comment}{// Allocate storage for the unperturbed jacobian matrix}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08176}08176           \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} jac(n\_var);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08177}08177           \textcolor{comment}{// Get unperturbed jacobian}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08178}08178           \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_ad43c3d8760be0ba6ebee8d82509458e5}{get\_jacobian}}(elem\_pt, dummy\_res, jac);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08179}08179 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08180}08180           \textcolor{comment}{// Backup the dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08181}08181           \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} dof\_bac(n\_var);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08182}08182           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08183}08183           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08184}08184             \textcolor{keywordtype}{unsigned} eqn\_number = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, n);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08185}08185             dof\_bac[n] = *this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a07460d9854a692ffda3d6e318e5ad395}{global\_dof\_pt}}(eqn\_number);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08186}08186           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08187}08187 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08188}08188           \textcolor{comment}{// Now loop over all vectors C}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08189}08189           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_vec; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08190}08190           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08191}08191             \textcolor{comment}{// Perturb the dofs by the appropriate vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08192}08192             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08193}08193             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08194}08194               \textcolor{keywordtype}{unsigned} eqn\_number = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, n);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08195}08195               \textcolor{comment}{// Perturb by vector C[i]}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08196}08196               *this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a07460d9854a692ffda3d6e318e5ad395}{global\_dof\_pt}}(eqn\_number) +=}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08197}08197                 C\_mult[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * C[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].global\_value(eqn\_number);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08198}08198             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08199}08199             \mbox{\hyperlink{classoomph_1_1Problem_ae6ad96ddf5d48b517b89c9a9b879bc4b}{actions\_before\_newton\_convergence\_check}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08200}08200 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08201}08201             \textcolor{comment}{// Allocate storage for the perturbed jacobian}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08202}08202             \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} jac\_C(n\_var);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08203}08203 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08204}08204             \textcolor{comment}{// Now get the new jacobian}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08205}08205             \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_ad43c3d8760be0ba6ebee8d82509458e5}{get\_jacobian}}(elem\_pt, dummy\_res, jac\_C);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08206}08206 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08207}08207             \textcolor{comment}{// Reset the dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08208}08208             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08209}08209             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08210}08210               \textcolor{keywordtype}{unsigned} eqn\_number = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, n);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08211}08211               *this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a07460d9854a692ffda3d6e318e5ad395}{global\_dof\_pt}}(eqn\_number) = dof\_bac[n];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08212}08212             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08213}08213             \mbox{\hyperlink{classoomph_1_1Problem_ae6ad96ddf5d48b517b89c9a9b879bc4b}{actions\_before\_newton\_convergence\_check}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08214}08214 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08215}08215             \textcolor{comment}{// Now work out the products}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08216}08216             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08217}08217             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08218}08218               \textcolor{keywordtype}{unsigned} eqn\_number = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, n);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08219}08219               \textcolor{keywordtype}{double} prod\_c = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08220}08220               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_var; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08221}08221               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08222}08222                 \textcolor{keywordtype}{unsigned} unknown = \mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, m);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08223}08223                 prod\_c += (jac\_C(n, m) -\/ jac(n, m)) * Y.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(unknown);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08224}08224               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08225}08225               \textcolor{comment}{// std::cout << "{}FD   "{} << e << "{} "{} << i << "{} "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08226}08226               \textcolor{comment}{//          << n << "{} "{} << prod\_c/C\_mult[i] << "{}\(\backslash\)n"{};}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08227}08227               product[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].global\_value(eqn\_number) += prod\_c / C\_mult[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08228}08228             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08229}08229           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08230}08230 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08231}08231         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08232}08232 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08233}08233       \} \textcolor{comment}{// End of loop over elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08234}08234     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08235}08235 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08236}08236     \textcolor{comment}{// If we have a distributed problem then gather all}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08237}08237     \textcolor{comment}{// values}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08238}08238 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08239}08239     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08240}08240     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08241}08241       \textcolor{comment}{// Sum all values if distributed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08242}08242       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_vec; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08243}08243       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08244}08244         product[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].sum\_all\_halo\_and\_haloed\_values();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08245}08245       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08246}08246     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08247}08247 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08248}08248   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08249}08249 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08250}08250 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08251}08251   \textcolor{comment}{//================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08252}08252 \textcolor{comment}{  /// Get derivative of an element in the problem wrt a global}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08253}08253 \textcolor{comment}{  /// parameter, to be used in continuation problems}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08254}08254 \textcolor{comment}{}  \textcolor{comment}{//================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08255}08255   \textcolor{comment}{/*void Problem::get\_derivative\_wrt\_global\_parameter(}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08256}08256 \textcolor{comment}{   double* const \&parameter\_pt,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08257}08257 \textcolor{comment}{   GeneralisedElement* const \&elem\_pt,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08258}08258 \textcolor{comment}{   Vector<double> \&result)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08259}08259 \textcolor{comment}{  \{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08260}08260 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08261}08261 \textcolor{comment}{  \#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08262}08262 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08263}08263 \textcolor{comment}{   if (Problem\_has\_been\_distributed)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08264}08264 \textcolor{comment}{    \{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08265}08265 \textcolor{comment}{     OomphLibWarning("{}This is unlikely to work with a distributed problem"{},}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08266}08266 \textcolor{comment}{                     "{}Problem::get\_derivative\_wrt\_global\_parameter()"{},}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08267}08267 \textcolor{comment}{                     OOMPH\_EXCEPTION\_LOCATION);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08268}08268 \textcolor{comment}{    \}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08269}08269 \textcolor{comment}{  \#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08270}08270 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08271}08271 \textcolor{comment}{   //Locally cache pointer to assembly handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08272}08272 \textcolor{comment}{   AssemblyHandler* const assembly\_handler\_pt = Assembly\_handler\_pt;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08273}08273 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08274}08274 \textcolor{comment}{   //Should definitely give this a more global scope}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08275}08275 \textcolor{comment}{   double FD\_Jstep = 1.0e-\/8;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08276}08276 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08277}08277 \textcolor{comment}{   //Find the number of variables in the element, e}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08278}08278 \textcolor{comment}{   unsigned nvar = assembly\_handler\_pt-\/>ndof(elem\_pt);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08279}08279 \textcolor{comment}{   //Create storage for residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08280}08280 \textcolor{comment}{   Vector<double> residuals(nvar), newres(nvar);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08281}08281 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08282}08282 \textcolor{comment}{   //Get the "{}original"{} residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08283}08283 \textcolor{comment}{   assembly\_handler\_pt-\/>get\_residuals(elem\_pt,residuals);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08284}08284 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08285}08285 \textcolor{comment}{   //Save the old value of the global parameter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08286}08286 \textcolor{comment}{   double old\_var = *parameter\_pt;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08287}08287 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08288}08288 \textcolor{comment}{   //Increment the value}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08289}08289 \textcolor{comment}{   *parameter\_pt += FD\_Jstep;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08290}08290 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08291}08291 \textcolor{comment}{   //Now do any possible updates}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08292}08292 \textcolor{comment}{   actions\_after\_change\_in\_global\_parameter();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08293}08293 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08294}08294 \textcolor{comment}{   //Get the "{}new"{} residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08295}08295 \textcolor{comment}{   assembly\_handler\_pt-\/>get\_residuals(elem\_pt,newres);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08296}08296 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08297}08297 \textcolor{comment}{   //Do the finite differences}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08298}08298 \textcolor{comment}{   for(unsigned m=0;m<nvar;m++)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08299}08299 \textcolor{comment}{    \{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08300}08300 \textcolor{comment}{     result[m] = (newres[m] -\/ residuals[m])/FD\_Jstep;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08301}08301 \textcolor{comment}{    \}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08302}08302 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08303}08303 \textcolor{comment}{   //Reset value of the global parameter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08304}08304 \textcolor{comment}{   *parameter\_pt = old\_var;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08305}08305 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08306}08306 \textcolor{comment}{   //Now do any possible updates}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08307}08307 \textcolor{comment}{   actions\_after\_change\_in\_global\_parameter();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08308}08308 \textcolor{comment}{  \}*/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08309}08309 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08310}08310   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08311}08311 \textcolor{comment}{  /// Solve the eigenproblem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08312}08312 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08313}\mbox{\hyperlink{classoomph_1_1Problem_afd4ce8fa26732998a40352542d0cecef}{08313}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_afd4ce8fa26732998a40352542d0cecef}{Problem::solve\_eigenproblem}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& n\_eval,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08314}08314                                    \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<std::complex<double>>\& eigenvalue,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08315}08315                                    \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& eigenvector,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08316}08316                                    \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& steady)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08317}08317   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08318}08318     \textcolor{comment}{// If the boolean flag is steady, then make all the timesteppers steady}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08319}08319     \textcolor{comment}{// before solving the eigenproblem. This will "{}switch off"{} the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08320}08320     \textcolor{comment}{// time-\/derivative terms in the jacobian matrix}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08321}08321     \textcolor{keywordflow}{if} (steady)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08322}08322     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08323}08323       \textcolor{comment}{// Find out how many timesteppers there are}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08324}08324       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_time\_steppers = \mbox{\hyperlink{classoomph_1_1Problem_ace3cdf55009c3bff21d2b7d3706d522a}{ntime\_stepper}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08325}08325 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08326}08326       \textcolor{comment}{// Vector of bools to store the is\_steady status of the various}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08327}08327       \textcolor{comment}{// timesteppers when we came in here}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08328}08328       std::vector<bool> was\_steady(n\_time\_steppers);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08329}08329 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08330}08330       \textcolor{comment}{// Loop over them all and make them (temporarily) static}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08331}08331       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_time\_steppers; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08332}08332       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08333}08333         was\_steady[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_ad341ba9e80265e1c26c1cda0f40c8292}{is\_steady}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08334}08334         \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_a81ea0ff2e66cef5e0184b616c608e418}{make\_steady}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08335}08335       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08336}08336 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08337}08337       \textcolor{comment}{// Call the Eigenproblem for the eigensolver}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08338}08338       \mbox{\hyperlink{classoomph_1_1Problem_ab7938313fa45df9be16515a6b0bfd324}{Eigen\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1EigenSolver_a6a6b09612ce16457b26fa0cfe996fa71}{solve\_eigenproblem}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08339}08339         \textcolor{keyword}{this}, n\_eval, eigenvalue, eigenvector);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08340}08340 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08341}08341       \textcolor{comment}{// Reset the is\_steady status of all timesteppers that}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08342}08342       \textcolor{comment}{// weren't already steady when we came in here and reset their}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08343}08343       \textcolor{comment}{// weights}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08344}08344       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_time\_steppers; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08345}08345       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08346}08346         \textcolor{keywordflow}{if} (!was\_steady[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08347}08347         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08348}08348           \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_aada05f89e86aae352bd5b32bfb173b18}{undo\_make\_steady}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08349}08349         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08350}08350       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08351}08351     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08352}08352     \textcolor{comment}{// Otherwise if we don't want to make the problem steady, just}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08353}08353     \textcolor{comment}{// assemble and solve the eigensystem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08354}08354     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08355}08355     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08356}08356       \textcolor{comment}{// Call the Eigenproblem for the eigensolver}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08357}08357       \mbox{\hyperlink{classoomph_1_1Problem_ab7938313fa45df9be16515a6b0bfd324}{Eigen\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1EigenSolver_a6a6b09612ce16457b26fa0cfe996fa71}{solve\_eigenproblem}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08358}08358         \textcolor{keyword}{this}, n\_eval, eigenvalue, eigenvector);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08359}08359     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08360}08360   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08361}08361 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08362}08362 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08363}08363   \textcolor{comment}{//===================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08364}08364 \textcolor{comment}{  /// Get the matrices required to solve an eigenproblem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08365}08365 \textcolor{comment}{  /// WARNING: temporarily this method only works with non-\/distributed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08366}08366 \textcolor{comment}{  /// matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08367}08367 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08368}\mbox{\hyperlink{classoomph_1_1Problem_a17e2d84700ac43c1db1d68143790ae5c}{08368}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a17e2d84700ac43c1db1d68143790ae5c}{Problem::get\_eigenproblem\_matrices}}(\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}\& mass\_matrix,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08369}08369                                           \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}\& main\_matrix,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08370}08370                                           \textcolor{keyword}{const} \textcolor{keywordtype}{double}\& shift)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08371}08371   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08372}08372     \textcolor{comment}{// Three different cases again here:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08373}08373     \textcolor{comment}{// 1) Compiled with MPI, but run in serial}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08374}08374     \textcolor{comment}{// 2) Compiled with MPI, but MPI not initialised in driver}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08375}08375     \textcolor{comment}{// 3) Serial version}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08376}08376 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08377}08377 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08378}08378 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08379}08379     \textcolor{keywordflow}{if} (mass\_matrix.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a8c35baa65e335043f62954c92c090a5a}{distribution\_built}}() \&\& main\_matrix.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a8c35baa65e335043f62954c92c090a5a}{distribution\_built}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08380}08380     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08381}08381       \textcolor{comment}{// Check that the distribution of the mass matrix and jacobian match}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08382}08382       \textcolor{keywordflow}{if} (!(*mass\_matrix.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() == *main\_matrix.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08383}08383       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08384}08384         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08385}08385         error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08386}08386           << \textcolor{stringliteral}{"{}The distributions of the jacobian and mass matrix are\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08387}08387           << \textcolor{stringliteral}{"{}not the same and they must be.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08388}08388         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08389}08389           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08390}08390       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08391}08391 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08392}08392       \textcolor{keywordflow}{if} (mass\_matrix.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_abd8d231b0549540144b4739a667b1e75}{nrow}}() != this-\/>ndof())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08393}08393       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08394}08394         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08395}08395         error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08396}08396           << \textcolor{stringliteral}{"{}mass\_matrix has a distribution, but the number of rows is not "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08397}08397           << \textcolor{stringliteral}{"{}equal to the number of degrees of freedom in the problem."{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08398}08398         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08399}08399           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08400}08400       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08401}08401 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08402}08402       \textcolor{keywordflow}{if} (main\_matrix.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_abd8d231b0549540144b4739a667b1e75}{nrow}}() != this-\/>ndof())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08403}08403       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08404}08404         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08405}08405         error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08406}08406           << \textcolor{stringliteral}{"{}main\_matrix has a distribution, but the number of rows is not "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08407}08407           << \textcolor{stringliteral}{"{}equal to the number of degrees of freedom in the problem."{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08408}08408         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08409}08409           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08410}08410       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08411}08411     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08412}08412     \textcolor{comment}{// If the distributions are not the same, then complain}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08413}08413     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (main\_matrix.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a8c35baa65e335043f62954c92c090a5a}{distribution\_built}}() !=}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08414}08414              mass\_matrix.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a8c35baa65e335043f62954c92c090a5a}{distribution\_built}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08415}08415     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08416}08416       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08417}08417       error\_stream << \textcolor{stringliteral}{"{}The distribution of the jacobian and mass matrix must "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08418}08418                    << \textcolor{stringliteral}{"{}both be setup or both not setup"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08419}08419       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08420}08420         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08421}08421     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08422}08422 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08423}08423 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08424}08424     \textcolor{comment}{// Store the old assembly handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08425}08425     \mbox{\hyperlink{classoomph_1_1AssemblyHandler}{AssemblyHandler}}* old\_assembly\_handler\_pt = \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08426}08426     \textcolor{comment}{// Now setup the eigenproblem handler, pass in the value of the shift}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08427}08427     \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1EigenProblemHandler}{EigenProblemHandler}}(shift);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08428}08428 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08429}08429     \textcolor{comment}{// Prepare the storage formats.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08430}08430     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}} column\_or\_row\_index(2);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08431}08431     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int*>}} row\_or\_column\_start(2);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08432}08432     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}} value(2);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08433}08433     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} nnz(2);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08434}08434     \textcolor{comment}{// Allocate pointer to residuals, although not used in these problems}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08435}08435     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}} residuals\_vectors(0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08436}08436 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08437}08437     \textcolor{comment}{// total number of rows in each matrix}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08438}08438     \textcolor{keywordtype}{unsigned} nrow = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08439}08439 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08440}08440     \textcolor{comment}{// determine the distribution for the jacobian (main matrix)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08441}08441     \textcolor{comment}{// IF the jacobian has distribution setup then use that}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08442}08442     \textcolor{comment}{// ELSE determine the distribution based on the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08443}08443     \textcolor{comment}{// distributed\_matrix\_distribution enum}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08444}08444     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* dist\_pt = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08445}08445     \textcolor{keywordflow}{if} (main\_matrix.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a8c35baa65e335043f62954c92c090a5a}{distribution\_built}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08446}08446     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08447}08447       dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(main\_matrix.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08448}08448     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08449}08449     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08450}08450     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08451}08451 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08452}08452       \textcolor{comment}{// if problem is only one one processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08453}08453       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>nproc() == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08454}08454       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08455}08455         dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}, nrow, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08456}08456       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08457}08457       \textcolor{comment}{// if the problem is not distributed then assemble the matrices with}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08458}08458       \textcolor{comment}{// a uniform distributed distribution}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08459}08459       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08460}08460       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08461}08461         dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}, nrow, \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08462}08462       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08463}08463       \textcolor{comment}{// otherwise the problem is a distributed problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08464}08464       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08465}08465       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08466}08466         \textcolor{keywordflow}{switch} (\mbox{\hyperlink{classoomph_1_1Problem_a1da221c501adc7d58bd21f630207c6c3}{Dist\_problem\_matrix\_distribution}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08467}08467         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08468}08468           \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1Problem_a8fc1f40f2a9309e9ff02772fa2258402a741cb51275fde6a02373b2ffacf1273f}{Uniform\_matrix\_distribution}}:}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08469}08469             dist\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08470}08470               \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}, nrow, \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08471}08471             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08472}08472           \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1Problem_a8fc1f40f2a9309e9ff02772fa2258402aed8521359adcaf514039424b29893796}{Problem\_matrix\_distribution}}:}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08473}08473             dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08474}08474             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08475}08475           \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1Problem_a8fc1f40f2a9309e9ff02772fa2258402ad7503f3fef4bc3556497018171c820e6}{Default\_matrix\_distribution}}:}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08476}08476             \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* uniform\_dist\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08477}08477               \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}, nrow, \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08478}08478             \textcolor{keywordtype}{bool} use\_problem\_dist = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08479}08479             \textcolor{keywordtype}{unsigned} nproc = \mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>nproc();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08480}08480             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08481}08481             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08482}08482               \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{double})\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}(p) >}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08483}08483                   ((\textcolor{keywordtype}{double})uniform\_dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}(p)) * 1.1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08484}08484               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08485}08485                 use\_problem\_dist = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08486}08486               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08487}08487             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08488}08488             \textcolor{keywordflow}{if} (use\_problem\_dist)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08489}08489             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08490}08490               dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08491}08491             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08492}08492             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08493}08493             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08494}08494               dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(uniform\_dist\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08495}08495             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08496}08496             \textcolor{keyword}{delete} uniform\_dist\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08497}08497             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08498}08498         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08499}08499       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08500}08500 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08501}08501       dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}, nrow, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08502}08502 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08503}08503     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08504}08504 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08505}08505 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08506}08506     \textcolor{comment}{// The matrix is in compressed row format}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08507}08507     \textcolor{keywordtype}{bool} compressed\_row\_flag = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08508}08508 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08509}08509 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08510}08510     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08511}08511     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>nproc() == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08512}08512     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08513}08513 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08514}08514 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08515}08515       \mbox{\hyperlink{classoomph_1_1Problem_a072f2894b20672be1a48783684c4a50b}{sparse\_assemble\_row\_or\_column\_compressed}}(column\_or\_row\_index,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08516}08516                                                row\_or\_column\_start,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08517}08517                                                value,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08518}08518                                                nnz,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08519}08519                                                residuals\_vectors,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08520}08520                                                compressed\_row\_flag);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08521}08521 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08522}08522       \textcolor{comment}{// The main matrix is the first entry}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08523}08523       main\_matrix.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{build}}(dist\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08524}08524       main\_matrix.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafb4d7de0a87b4bda560928e6a128060}{build\_without\_copy}}(dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_aafad0b69de2284808366b65bd63e493b}{nrow}}(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08525}08525                                      nnz[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08526}08526                                      value[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08527}08527                                      column\_or\_row\_index[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08528}08528                                      row\_or\_column\_start[0]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08529}08529       \textcolor{comment}{// The mass matrix is the second entry}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08530}08530       mass\_matrix.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{build}}(dist\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08531}08531       mass\_matrix.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafb4d7de0a87b4bda560928e6a128060}{build\_without\_copy}}(dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_aafad0b69de2284808366b65bd63e493b}{nrow}}(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08532}08532                                      nnz[1],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08533}08533                                      value[1],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08534}08534                                      column\_or\_row\_index[1],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08535}08535                                      row\_or\_column\_start[1]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08536}08536 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08537}08537     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08538}08538     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08539}08539     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08540}08540       \textcolor{keywordflow}{if} (dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a05842d032d28880ae37951deae804ad8}{distributed}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08541}08541       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08542}08542         \mbox{\hyperlink{classoomph_1_1Problem_a0487a7ef40e6cc4dad88e99ac96193e2}{parallel\_sparse\_assemble}}(dist\_pt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08543}08543                                  column\_or\_row\_index,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08544}08544                                  row\_or\_column\_start,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08545}08545                                  value,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08546}08546                                  nnz,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08547}08547                                  residuals\_vectors);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08548}08548         \textcolor{comment}{// The main matrix is the first entry}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08549}08549         main\_matrix.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{build}}(dist\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08550}08550         main\_matrix.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafb4d7de0a87b4bda560928e6a128060}{build\_without\_copy}}(dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_aafad0b69de2284808366b65bd63e493b}{nrow}}(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08551}08551                                        nnz[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08552}08552                                        value[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08553}08553                                        column\_or\_row\_index[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08554}08554                                        row\_or\_column\_start[0]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08555}08555         \textcolor{comment}{// The mass matrix is the second entry}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08556}08556         mass\_matrix.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{build}}(dist\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08557}08557         mass\_matrix.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafb4d7de0a87b4bda560928e6a128060}{build\_without\_copy}}(dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_aafad0b69de2284808366b65bd63e493b}{nrow}}(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08558}08558                                        nnz[1],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08559}08559                                        value[1],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08560}08560                                        column\_or\_row\_index[1],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08561}08561                                        row\_or\_column\_start[1]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08562}08562       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08563}08563       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08564}08564       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08565}08565         \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* temp\_dist\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08566}08566           \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}, dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_aafad0b69de2284808366b65bd63e493b}{nrow}}(), \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08567}08567         \mbox{\hyperlink{classoomph_1_1Problem_a0487a7ef40e6cc4dad88e99ac96193e2}{parallel\_sparse\_assemble}}(temp\_dist\_pt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08568}08568                                  column\_or\_row\_index,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08569}08569                                  row\_or\_column\_start,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08570}08570                                  value,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08571}08571                                  nnz,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08572}08572                                  residuals\_vectors);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08573}08573         \textcolor{comment}{// The main matrix is the first entry}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08574}08574         main\_matrix.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{build}}(temp\_dist\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08575}08575         main\_matrix.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafb4d7de0a87b4bda560928e6a128060}{build\_without\_copy}}(dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_aafad0b69de2284808366b65bd63e493b}{nrow}}(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08576}08576                                        nnz[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08577}08577                                        value[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08578}08578                                        column\_or\_row\_index[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08579}08579                                        row\_or\_column\_start[0]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08580}08580         main\_matrix.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9ba295a04e08e3153ae06bc0556f507d}{redistribute}}(dist\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08581}08581         \textcolor{comment}{// The mass matrix is the second entry}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08582}08582         mass\_matrix.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{build}}(temp\_dist\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08583}08583         mass\_matrix.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafb4d7de0a87b4bda560928e6a128060}{build\_without\_copy}}(dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_aafad0b69de2284808366b65bd63e493b}{nrow}}(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08584}08584                                        nnz[1],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08585}08585                                        value[1],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08586}08586                                        column\_or\_row\_index[1],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08587}08587                                        row\_or\_column\_start[1]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08588}08588         mass\_matrix.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9ba295a04e08e3153ae06bc0556f507d}{redistribute}}(dist\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08589}08589         \textcolor{keyword}{delete} temp\_dist\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08590}08590       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08591}08591     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08592}08592 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08593}08593 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08594}08594     \textcolor{comment}{// clean up dist\_pt and residuals\_vector pt}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08595}08595     \textcolor{keyword}{delete} dist\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08596}08596 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08597}08597     \textcolor{comment}{// Delete the eigenproblem handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08598}08598     \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08599}08599     \textcolor{comment}{// Reset the assembly handler to the original handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08600}08600     \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}} = old\_assembly\_handler\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08601}08601   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08602}08602 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08603}08603 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08604}08604   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08605}08605 \textcolor{comment}{  /// Stored the current values of the dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08606}08606 \textcolor{comment}{}  \textcolor{comment}{//=======================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08607}\mbox{\hyperlink{classoomph_1_1Problem_a5a2906b9a6a22445d1dbb8aebbce9fa7}{08607}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a5a2906b9a6a22445d1dbb8aebbce9fa7}{Problem::store\_current\_dof\_values}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08608}08608   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08609}08609     \textcolor{comment}{// If memory has not been allocated, then allocated memory for the saved}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08610}08610     \textcolor{comment}{// dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08611}08611     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aeef791a0158657ca7c298ffcb63ed54e}{Saved\_dof\_pt}} == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08612}08612     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08613}08613       \mbox{\hyperlink{classoomph_1_1Problem_aeef791a0158657ca7c298ffcb63ed54e}{Saved\_dof\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08614}08614     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08615}08615 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08616}08616 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08617}08617     \textcolor{comment}{// If the problem is distributed I have to do something different}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08618}08618     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08619}08619     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08620}08620       \textcolor{comment}{// How many entries do we store locally?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08621}08621       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_row\_local = \mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08622}08622 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08623}08623       \textcolor{comment}{// Resize the vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08624}08624       \mbox{\hyperlink{classoomph_1_1Problem_aeef791a0158657ca7c298ffcb63ed54e}{Saved\_dof\_pt}}-\/>resize(n\_row\_local);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08625}08625 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08626}08626       \textcolor{comment}{// Back 'em up}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08627}08627       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_row\_local; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08628}08628       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08629}08629         (*Saved\_dof\_pt)[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = *(this-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08630}08630       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08631}08631     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08632}08632     \textcolor{comment}{// Otherwise just store all the dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08633}08633     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08634}08634 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08635}08635     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08636}08636       \textcolor{comment}{// Find the number of dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08637}08637       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_dof = \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08638}08638 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08639}08639       \textcolor{comment}{// Resize the vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08640}08640       \mbox{\hyperlink{classoomph_1_1Problem_aeef791a0158657ca7c298ffcb63ed54e}{Saved\_dof\_pt}}-\/>resize(n\_dof);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08641}08641 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08642}08642       \textcolor{comment}{// Transfer the values over}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08643}08643       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n = 0; n < n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08644}08644       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08645}08645         (*Saved\_dof\_pt)[n] = \mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(n);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08646}08646       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08647}08647     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08648}08648   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08649}08649 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08650}08650   \textcolor{comment}{//====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08651}08651 \textcolor{comment}{  /// Restore the saved dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08652}08652 \textcolor{comment}{}  \textcolor{comment}{//====================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08653}\mbox{\hyperlink{classoomph_1_1Problem_ad19fe0723fe6356776cfbe28e46ea64b}{08653}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ad19fe0723fe6356776cfbe28e46ea64b}{Problem::restore\_dof\_values}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08654}08654   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08655}08655     \textcolor{comment}{// Check that we can do this}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08656}08656     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aeef791a0158657ca7c298ffcb63ed54e}{Saved\_dof\_pt}} == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08657}08657     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08658}08658       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08659}08659         \textcolor{stringliteral}{"{}There are no stored values, use store\_current\_dof\_values()\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08660}08660         OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08661}08661         OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08662}08662     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08663}08663 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08664}08664 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08665}08665 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08666}08666     \textcolor{comment}{// If the problem is distributed I have to do something different}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08667}08667     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08668}08668     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08669}08669       \textcolor{comment}{// How many entries do we store locally?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08670}08670       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_row\_local = \mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08671}08671 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08672}08672       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aeef791a0158657ca7c298ffcb63ed54e}{Saved\_dof\_pt}}-\/>size() != n\_row\_local)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08673}08673       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08674}08674         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}The number of stored values is not equal to the "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08675}08675                             \textcolor{stringliteral}{"{}current number of dofs\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08676}08676                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08677}08677                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08678}08678       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08679}08679 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08680}08680       \textcolor{comment}{// Transfer the values over}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08681}08681       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n = 0; n < n\_row\_local; n++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08682}08682       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08683}08683         *(this-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[n]) = (*\mbox{\hyperlink{classoomph_1_1Problem_aeef791a0158657ca7c298ffcb63ed54e}{Saved\_dof\_pt}})[n];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08684}08684       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08685}08685     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08686}08686     \textcolor{comment}{// Otherwise just restore all the dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08687}08687     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08688}08688 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08689}08689     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08690}08690       \textcolor{comment}{// Find the number of dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08691}08691       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_dof = \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08692}08692 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08693}08693       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aeef791a0158657ca7c298ffcb63ed54e}{Saved\_dof\_pt}}-\/>size() != n\_dof)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08694}08694       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08695}08695         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}The number of stored values is not equal to the "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08696}08696                             \textcolor{stringliteral}{"{}current number of dofs\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08697}08697                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08698}08698                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08699}08699       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08700}08700 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08701}08701       \textcolor{comment}{// Transfer the values over}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08702}08702       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n = 0; n < n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08703}08703       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08704}08704         \mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(n) = (*Saved\_dof\_pt)[n];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08705}08705       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08706}08706     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08707}08707 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08708}08708     \textcolor{comment}{// Delete the memory}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08709}08709     \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1Problem_aeef791a0158657ca7c298ffcb63ed54e}{Saved\_dof\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08710}08710     \mbox{\hyperlink{classoomph_1_1Problem_aeef791a0158657ca7c298ffcb63ed54e}{Saved\_dof\_pt}} = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08711}08711   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08712}08712 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08713}08713   \textcolor{comment}{//======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08714}08714 \textcolor{comment}{  /// Assign the eigenvector passed to the function to the dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08715}08715 \textcolor{comment}{}  \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08716}\mbox{\hyperlink{classoomph_1_1Problem_a8f93315e1076dd9672167ed0a845ea34}{08716}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a8f93315e1076dd9672167ed0a845ea34}{Problem::assign\_eigenvector\_to\_dofs}}(\mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& eigenvector)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08717}08717   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08718}08718     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_dof = \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08719}08719     \textcolor{comment}{// Check that the eigenvector has the correct size}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08720}08720     \textcolor{keywordflow}{if} (eigenvector.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}() != n\_dof)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08721}08721     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08722}08722       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08723}08723       error\_message << \textcolor{stringliteral}{"{}Eigenvector has size "{}} << eigenvector.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08724}08724                     << \textcolor{stringliteral}{"{}, not equal to the number of dofs in the problem,"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08725}08725                     << n\_dof << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08726}08726 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08727}08727       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08728}08728         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08729}08729     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08730}08730 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08731}08731     \textcolor{comment}{// Loop over the dofs and assign the eigenvector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08732}08732     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n = 0; n < eigenvector.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}}(); n++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08733}08733     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08734}08734       \mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(n) = eigenvector[n];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08735}08735     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08736}08736 \textcolor{comment}{// Of course we now need to synchronise}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08737}08737 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08738}08738     this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5d9a3ba5696a7bcd275223ff16b7392e}{synchronise\_all\_dofs}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08739}08739 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08740}08740   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08741}08741 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08742}08742 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08743}08743   \textcolor{comment}{//======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08744}08744 \textcolor{comment}{  /// Add the eigenvector passed to the function to the dofs with}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08745}08745 \textcolor{comment}{  /// magnitude epsilon}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08746}08746 \textcolor{comment}{}  \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08747}\mbox{\hyperlink{classoomph_1_1Problem_aa803fbccb2c8c70702b2c39837e7ad2e}{08747}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_aa803fbccb2c8c70702b2c39837e7ad2e}{Problem::add\_eigenvector\_to\_dofs}}(\textcolor{keyword}{const} \textcolor{keywordtype}{double}\& epsilon,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08748}08748                                         \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& eigenvector)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08749}08749   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08750}08750     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_dof = \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08751}08751     \textcolor{comment}{// Check that the eigenvector has the correct size}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08752}08752     \textcolor{keywordflow}{if} (eigenvector.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}() != n\_dof)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08753}08753     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08754}08754       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08755}08755       error\_message << \textcolor{stringliteral}{"{}Eigenvector has size "{}} << eigenvector.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08756}08756                     << \textcolor{stringliteral}{"{}, not equal to the number of dofs in the problem,"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08757}08757                     << n\_dof << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08758}08758 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08759}08759       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08760}08760         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08761}08761     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08762}08762 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08763}08763     \textcolor{comment}{// Loop over the dofs and add the eigenvector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08764}08764     \textcolor{comment}{// Only use local values}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08765}08765     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n = 0; n < eigenvector.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}}(); n++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08766}08766     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08767}08767       \mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(n) += epsilon * eigenvector[n];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08768}08768     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08769}08769 \textcolor{comment}{// Of course we now need to synchronise}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08770}08770 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08771}08771     this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5d9a3ba5696a7bcd275223ff16b7392e}{synchronise\_all\_dofs}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08772}08772 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08773}08773   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08774}08774 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08775}08775 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08776}08776   \textcolor{comment}{//================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08777}08777 \textcolor{comment}{  /// General Newton solver. Requires only a convergence tolerance.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08778}08778 \textcolor{comment}{  /// The linear solver takes a pointer to the problem (which defines}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08779}08779 \textcolor{comment}{  /// the Jacobian \(\backslash\)b J and the residual Vector \(\backslash\)b r) and returns}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08780}08780 \textcolor{comment}{  /// the solution \(\backslash\)b x of the system}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08781}08781 \textcolor{comment}{  /// \(\backslash\)f[ \{\(\backslash\)bf J\} \{\(\backslash\)bf x\} = -\/ \(\backslash\)bf\{r\} \(\backslash\)f].}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08782}08782 \textcolor{comment}{}  \textcolor{comment}{//================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08783}\mbox{\hyperlink{classoomph_1_1Problem_a62a989ae9a9169b9d905f844db59787f}{08783}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a62a989ae9a9169b9d905f844db59787f}{Problem::newton\_solve}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08784}08784   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08785}08785     \textcolor{comment}{// Initialise timers}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08786}08786     \textcolor{keywordtype}{double} total\_linear\_solver\_time = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08787}08787     \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08788}08788     \mbox{\hyperlink{classoomph_1_1Problem_ab6f510bea9bdfcaf229415440a0a1c98}{Max\_res}}.clear();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08789}08789 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08790}08790     \textcolor{comment}{// Find total number of dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08791}08791     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_dofs = \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08792}08792 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08793}08793     \textcolor{comment}{// Set up the Vector to hold the solution}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08794}08794     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} dx;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08795}08795 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08796}08796     \textcolor{comment}{//-\/-\/-\/-\/-\/Variables for the globally convergent Newton method-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08797}08797 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08798}08798     \textcolor{comment}{// Set up the vector to hold the gradient}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08799}08799     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} gradient;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08800}08800 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08801}08801     \textcolor{comment}{// Other variables}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08802}08802     \textcolor{keywordtype}{double} half\_residual\_squared = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08803}08803     \textcolor{keywordtype}{double} max\_step = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08804}08804 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08805}08805     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08806}08806 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08807}08807     \textcolor{comment}{// Set the counter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08808}08808     \textcolor{keywordtype}{unsigned} count = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08809}08809     \textcolor{comment}{// Set the loop flag}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08810}08810     \textcolor{keywordtype}{unsigned} LOOP\_FLAG = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08811}08811 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08812}08812     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_acf8b1ec937efdf2a0f892a41c18c0c53}{Use\_globally\_convergent\_newton\_method}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08813}08813     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08814}08814 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08815}08815       \textcolor{comment}{// Break if running in parallel}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08816}08816       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1MPI__Helpers_aa376d403f6bc99e8595d227135932b0e}{MPI\_Helpers::mpi\_has\_been\_initialised}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08817}08817       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08818}08818         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08819}08819         error\_stream << \textcolor{stringliteral}{"{}Globally convergent Newton method has not been "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08820}08820                      << \textcolor{stringliteral}{"{}implemented in parallel yet!"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08821}08821         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08822}08822           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08823}08823       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08824}08824 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08825}08825 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08826}08826       \textcolor{comment}{// Get gradient}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08827}08827       \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a37f1f8b8c6d45115e649739abd5d2f5d}{enable\_computation\_of\_gradient}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08828}08828       \textcolor{comment}{// Reset the gradient (clear it), since the number of dofs and}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08829}08829       \textcolor{comment}{// hence the size of the DoubleVector might have changed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08830}08830       \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_aceef502cbdf826cdf6aa31f5803982e0}{reset\_gradient}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08831}08831     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08832}08832 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08833}08833     \textcolor{comment}{// Update anything that needs updating}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08834}08834     \mbox{\hyperlink{classoomph_1_1Problem_a0c8d70891f7369bb4bf8412fa1a08ecb}{actions\_before\_newton\_solve}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08835}08835 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08836}08836     \textcolor{comment}{// Reset number of Newton iterations taken}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08837}08837     \mbox{\hyperlink{classoomph_1_1Problem_a3c05eefd6891808a1ef01e51288e0108}{Nnewton\_iter\_taken}} = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08838}08838 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08839}08839     \textcolor{comment}{// Now do the Newton loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08840}08840     \textcolor{keywordflow}{do}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08841}08841     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08842}08842       count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08843}08843 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08844}08844       \textcolor{comment}{// Do any updates that are required}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08845}08845       \mbox{\hyperlink{classoomph_1_1Problem_a07fc81781c74b25c8a426ec18295b0d0}{actions\_before\_newton\_step}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08846}08846 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08847}08847 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08848}08848       \textcolor{comment}{// No degrees of freedom? What are you solving for?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08849}08849       \textcolor{keywordflow}{if} (n\_dofs == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08850}08850       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08851}08851         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl << std::endl << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08852}08852         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}This is a bit bizarre: The problem has no dofs."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08853}08853                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08854}08854         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08855}08855           << \textcolor{stringliteral}{"{}I'll just return from the Newton solver without doing anything."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08856}08856           << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08857}08857 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08858}08858         \textcolor{comment}{// Do any updates that would have been performed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08859}08859         \mbox{\hyperlink{classoomph_1_1Problem_ae6ad96ddf5d48b517b89c9a9b879bc4b}{actions\_before\_newton\_convergence\_check}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08860}08860         \mbox{\hyperlink{classoomph_1_1Problem_aed8bc6e7b0bb45b86d5b44737b554d50}{actions\_after\_newton\_step}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08861}08861         \mbox{\hyperlink{classoomph_1_1Problem_ae6ad96ddf5d48b517b89c9a9b879bc4b}{actions\_before\_newton\_convergence\_check}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08862}08862         \mbox{\hyperlink{classoomph_1_1Problem_a033ec7301123deeb7e56d04c38f9f1da}{actions\_after\_newton\_solve}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08863}08863 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08864}08864         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}I hope this is what you intended me to do..."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08865}08865                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08866}08866         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08867}08867                    << \textcolor{stringliteral}{"{}Note: All actions\_...() functions were called"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08868}08868                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08869}08869         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl << \textcolor{stringliteral}{"{}      before returning."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08870}08870         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl << std::endl << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08871}08871         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08872}08872       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08873}08873 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08874}08874       \textcolor{comment}{// Calculate initial residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08875}08875       \textcolor{keywordflow}{if} (count == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08876}08876       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08877}08877         \textcolor{comment}{// Is the problem nonlinear? If not ignore the pre-\/iteration}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08878}08878         \textcolor{comment}{// convergence check.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08879}08879         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_ade2d3efba34f69aafaefc076ddb3b8d4}{Problem\_is\_nonlinear}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08880}08880         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08881}08881 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08882}08882           \textcolor{comment}{// Synchronise the solution on different processors (on each submesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08883}08883           this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5d9a3ba5696a7bcd275223ff16b7392e}{synchronise\_all\_dofs}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08884}08884 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08885}08885 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08886}08886           \mbox{\hyperlink{classoomph_1_1Problem_ae6ad96ddf5d48b517b89c9a9b879bc4b}{actions\_before\_newton\_convergence\_check}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08887}08887           dx.\mbox{\hyperlink{classoomph_1_1DoubleVector_af1677445056759263b1b076966e7bfae}{clear}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08888}08888           \mbox{\hyperlink{classoomph_1_1Problem_a7300386d91390e3e5be993aca7459498}{get\_residuals}}(dx);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08889}08889 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08890}08890           \textcolor{comment}{// Get half of squared residual and find maximum step length}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08891}08891           \textcolor{comment}{// for step length control}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08892}08892           \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_acf8b1ec937efdf2a0f892a41c18c0c53}{Use\_globally\_convergent\_newton\_method}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08893}08893           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08894}08894             half\_residual\_squared = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08895}08895             \textcolor{keywordtype}{double} sum = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08896}08896             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dofs; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08897}08897             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08898}08898               sum += (*\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]) * (*\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08899}08899               half\_residual\_squared += dx[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * dx[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08900}08900             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08901}08901             half\_residual\_squared *= 0.5;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08902}08902             max\_step = 100.0 * std::max(sqrt(sum), \textcolor{keywordtype}{double}(n\_dofs));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08903}08903           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08904}08904 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08905}08905           \textcolor{comment}{// Get maximum residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08906}08906           \textcolor{keywordtype}{double} maxres = dx.\mbox{\hyperlink{classoomph_1_1DoubleVector_a4c176b562f503701d65882a930d5b8f5}{max}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08907}08907           \mbox{\hyperlink{classoomph_1_1Problem_ab6f510bea9bdfcaf229415440a0a1c98}{Max\_res}}.push\_back(maxres);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08908}08908 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08909}08909           \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_ab4a3743c23a2d1eed56981484636c958}{Shut\_up\_in\_newton\_solve}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08910}08910           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08911}08911             \textcolor{comment}{// Let's output the residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08912}08912             \textcolor{comment}{// unsigned n\_row\_local = dx.distribution\_pt()-\/>nrow\_local();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08913}08913             \textcolor{comment}{// unsigned first\_row = dx.distribution\_pt()-\/>first\_row();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08914}08914             \textcolor{comment}{// for(unsigned n=0;n<n\_row\_local;n++)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08915}08915             \textcolor{comment}{//\{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08916}08916             \textcolor{comment}{// oomph\_info << "{}residual: "{} << n + first\_row << "{} "{} << dx[n] <<}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08917}08917             \textcolor{comment}{// "{}\(\backslash\)n"{};}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08918}08918             \textcolor{comment}{//\}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08919}08919 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08920}08920             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)nInitial Maximum residuals "{}} << maxres << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08921}08921           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08922}08922 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08923}08923           \textcolor{keywordflow}{if} ((maxres < \mbox{\hyperlink{classoomph_1_1Problem_a94536b381e949edf5bb4d44434e08925}{Newton\_solver\_tolerance}}) \&\&}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08924}08924               (!\mbox{\hyperlink{classoomph_1_1Problem_a01d7376ab9cc06e4d5619b34fd39dee2}{Always\_take\_one\_newton\_step}}))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08925}08925           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08926}08926             LOOP\_FLAG = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08927}08927             \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08928}08928           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08929}08929         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08930}08930         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08931}08931         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08932}08932           \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_ab4a3743c23a2d1eed56981484636c958}{Shut\_up\_in\_newton\_solve}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08933}08933           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08934}08934             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08935}08935               << \textcolor{stringliteral}{"{}Linear problem -\/-\/ convergence in one iteration assumed."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08936}08936               << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08937}08937           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08938}08938         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08939}08939       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08940}08940 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08941}08941 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08942}08942       \textcolor{comment}{// Increment number of Newton iterations taken}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08943}08943       \mbox{\hyperlink{classoomph_1_1Problem_a3c05eefd6891808a1ef01e51288e0108}{Nnewton\_iter\_taken}}++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08944}08944 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08945}08945       \textcolor{comment}{// Initialise timer for linear solver}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08946}08946       \textcolor{keywordtype}{double} t\_solver\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08947}08947 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08948}08948       \textcolor{comment}{// Now do the linear solve -\/-\/ recycling Jacobian if requested}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08949}08949       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a022796f2c96f2dff6ed1db2338c93aaf}{Jacobian\_reuse\_is\_enabled}} \&\& \mbox{\hyperlink{classoomph_1_1Problem_a2c4702c75739c967ed582dbd0a7ba56f}{Jacobian\_has\_been\_computed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08950}08950       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08951}08951         \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_ab4a3743c23a2d1eed56981484636c958}{Shut\_up\_in\_newton\_solve}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08952}08952         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08953}08953           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Not recomputing Jacobian! "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08954}08954         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08955}08955 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08956}08956         \textcolor{comment}{// If we're doing the first iteration and the problem is nonlinear,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08957}08957         \textcolor{comment}{// the residuals have already been computed above during the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08958}08958         \textcolor{comment}{// initial convergence check. Otherwise compute them here.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08959}08959         \textcolor{keywordflow}{if} ((count != 1) || (!\mbox{\hyperlink{classoomph_1_1Problem_ade2d3efba34f69aafaefc076ddb3b8d4}{Problem\_is\_nonlinear}})) \mbox{\hyperlink{classoomph_1_1Problem_a7300386d91390e3e5be993aca7459498}{get\_residuals}}(dx);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08960}08960 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08961}08961         \textcolor{comment}{// Backup residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08962}08962         \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} resid(dx);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08963}08963 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08964}08964         \textcolor{comment}{// Resolve}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08965}08965         \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(resid, dx);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08966}08966       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08967}08967       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08968}08968       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08969}08969         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a022796f2c96f2dff6ed1db2338c93aaf}{Jacobian\_reuse\_is\_enabled}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08970}08970         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08971}08971           \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_ab4a3743c23a2d1eed56981484636c958}{Shut\_up\_in\_newton\_solve}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08972}08972           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08973}08973             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Enabling resolve"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08974}08974           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08975}08975           \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3000ebd9becb3468d8a6a821a9cc0cd9}{enable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08976}08976         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08977}08977         \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a15ce22542b74ed1826ea485edacbeb6e}{solve}}(\textcolor{keyword}{this}, dx);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08978}08978         \mbox{\hyperlink{classoomph_1_1Problem_a2c4702c75739c967ed582dbd0a7ba56f}{Jacobian\_has\_been\_computed}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08979}08979       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08980}08980 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08981}08981       \textcolor{comment}{// End of linear solver}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08982}08982       \textcolor{keywordtype}{double} t\_solver\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08983}08983       total\_linear\_solver\_time += t\_solver\_end -\/ t\_solver\_start;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08984}08984 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08985}08985       \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_ab4a3743c23a2d1eed56981484636c958}{Shut\_up\_in\_newton\_solve}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08986}08986       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08987}08987         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08988}08988         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for linear solver (ndof="{}} << n\_dofs << \textcolor{stringliteral}{"{}): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08989}08989                    << \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_ae746b756dfb86c00c7cf37558a7870f3}{TimingHelpers::convert\_secs\_to\_formatted\_string}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08990}08990                         t\_solver\_end -\/ t\_solver\_start)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08991}08991                    << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08992}08992                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08993}08993       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08994}08994 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08995}08995       \textcolor{comment}{// Subtract the new values from the true dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08996}08996       dx.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08997}08997       \textcolor{keywordtype}{double}* dx\_pt = dx.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08998}08998       \textcolor{keywordtype}{unsigned} ndof\_local = \mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l08999}08999 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09000}09000       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_acf8b1ec937efdf2a0f892a41c18c0c53}{Use\_globally\_convergent\_newton\_method}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09001}09001       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09002}09002         \textcolor{comment}{// Get the gradient}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09003}09003         \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a6733411e85f0a1d6d82200c802481681}{get\_gradient}}(gradient);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09004}09004 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09005}09005         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < ndof\_local; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09006}09006         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09007}09007           dx\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] *= -\/1.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09008}09008         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09009}09009 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09010}09010         \textcolor{comment}{// Update with steplength control}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09011}09011         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} unknowns\_old(ndof\_local);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09012}09012 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09013}09013         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < ndof\_local; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09014}09014         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09015}09015           unknowns\_old[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = *\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09016}09016         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09017}09017 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09018}09018         \textcolor{keywordtype}{double} half\_residual\_squared\_old = half\_residual\_squared;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09019}09019         \mbox{\hyperlink{classoomph_1_1Problem_ac60d7455a13ee171060c3a81623840b2}{globally\_convergent\_line\_search}}(unknowns\_old,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09020}09020                                         half\_residual\_squared\_old,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09021}09021                                         gradient,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09022}09022                                         dx,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09023}09023                                         half\_residual\_squared,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09024}09024                                         max\_step);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09025}09025       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09026}09026       \textcolor{comment}{// direct Newton update}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09027}09027       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09028}09028       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09029}09029         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} l = 0; l < ndof\_local; l++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09030}09030         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09031}09031           *\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[l] -\/= \mbox{\hyperlink{classoomph_1_1Problem_a86c4feb98ec982a08dc84fb664f53abc}{Relaxation\_factor}} * dx\_pt[l];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09032}09032         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09033}09033       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09034}09034 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09035}09035       \textcolor{comment}{// Synchronise the solution on different processors (on each submesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09036}09036       this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5d9a3ba5696a7bcd275223ff16b7392e}{synchronise\_all\_dofs}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09037}09037 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09038}09038 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09039}09039       \textcolor{comment}{// Do any updates that are required}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09040}09040       \mbox{\hyperlink{classoomph_1_1Problem_aed8bc6e7b0bb45b86d5b44737b554d50}{actions\_after\_newton\_step}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09041}09041       \mbox{\hyperlink{classoomph_1_1Problem_ae6ad96ddf5d48b517b89c9a9b879bc4b}{actions\_before\_newton\_convergence\_check}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09042}09042 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09043}09043       \textcolor{comment}{// Maximum residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09044}09044       \textcolor{keywordtype}{double} maxres = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09045}09045       \textcolor{comment}{// If the user has declared that the Problem is linear}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09046}09046       \textcolor{comment}{// we ignore the convergence check}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09047}09047       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_ade2d3efba34f69aafaefc076ddb3b8d4}{Problem\_is\_nonlinear}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09048}09048       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09049}09049         \textcolor{comment}{// Get the maximum residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09050}09050         \textcolor{comment}{// maxres = std::fabs(*std::max\_element(dx.begin(),dx.end(),}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09051}09051         \textcolor{comment}{//                                    AbsCmp<double>()));}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09052}09052         \textcolor{comment}{// oomph\_info << "{}Maxres correction "{} << maxres << "{}\(\backslash\)n"{};}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09053}09053 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09054}09054         \textcolor{comment}{// Calculate the new residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09055}09055         dx.\mbox{\hyperlink{classoomph_1_1DoubleVector_af1677445056759263b1b076966e7bfae}{clear}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09056}09056         \mbox{\hyperlink{classoomph_1_1Problem_a7300386d91390e3e5be993aca7459498}{get\_residuals}}(dx);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09057}09057 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09058}09058         \textcolor{comment}{// Get the maximum residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09059}09059         maxres = dx.\mbox{\hyperlink{classoomph_1_1DoubleVector_a4c176b562f503701d65882a930d5b8f5}{max}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09060}09060         \mbox{\hyperlink{classoomph_1_1Problem_ab6f510bea9bdfcaf229415440a0a1c98}{Max\_res}}.push\_back(maxres);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09061}09061 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09062}09062         \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_ab4a3743c23a2d1eed56981484636c958}{Shut\_up\_in\_newton\_solve}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09063}09063         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09064}09064           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Newton Step "{}} << count << \textcolor{stringliteral}{"{}: Maximum residuals "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09065}09065                      << maxres << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09066}09066                      << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09067}09067         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09068}09068       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09069}09069 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09070}09070       \textcolor{comment}{// If we have converged jump straight to the test at the end of the loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09071}09071       \textcolor{keywordflow}{if} (maxres < \mbox{\hyperlink{classoomph_1_1Problem_a94536b381e949edf5bb4d44434e08925}{Newton\_solver\_tolerance}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09072}09072       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09073}09073         LOOP\_FLAG = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09074}09074         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09075}09075       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09076}09076 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09077}09077       \textcolor{comment}{// This section will not be reached if we have converged already}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09078}09078       \textcolor{comment}{// If the maximum number of residuals is too high or the maximum number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09079}09079       \textcolor{comment}{// of iterations has been reached}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09080}09080       \textcolor{keywordflow}{if} ((maxres > \mbox{\hyperlink{classoomph_1_1Problem_accb8811cdf32f14be497917e922c623e}{Max\_residuals}}) || (count == \mbox{\hyperlink{classoomph_1_1Problem_a52a58a98c3e2e7dbaefcfb1ee7830c35}{Max\_newton\_iterations}}))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09081}09081       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09082}09082         \textcolor{comment}{// Print a warning -\/-\/ regardless of what the throw does}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09083}09083         \textcolor{keywordflow}{if} (maxres > \mbox{\hyperlink{classoomph_1_1Problem_accb8811cdf32f14be497917e922c623e}{Max\_residuals}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09084}09084         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09085}09085           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Max. residual ("{}} << \mbox{\hyperlink{classoomph_1_1Problem_accb8811cdf32f14be497917e922c623e}{Max\_residuals}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09086}09086                      << \textcolor{stringliteral}{"{}) has been exceeded in Newton solver."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09087}09087         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09088}09088         \textcolor{keywordflow}{if} (count == \mbox{\hyperlink{classoomph_1_1Problem_a52a58a98c3e2e7dbaefcfb1ee7830c35}{Max\_newton\_iterations}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09089}09089         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09090}09090           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Reached max. number of iterations ("{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09091}09091                      << \mbox{\hyperlink{classoomph_1_1Problem_a52a58a98c3e2e7dbaefcfb1ee7830c35}{Max\_newton\_iterations}} << \textcolor{stringliteral}{"{}) in Newton solver."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09092}09092                      << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09093}09093         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09094}09094         \textcolor{comment}{// Now throw...}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09095}09095         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1NewtonSolverError}{NewtonSolverError}}(count, maxres);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09096}09096       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09097}09097 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09098}09098     \} \textcolor{keywordflow}{while} (LOOP\_FLAG);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09099}09099 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09100}09100     \textcolor{comment}{// Now update anything that needs updating}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09101}09101     \mbox{\hyperlink{classoomph_1_1Problem_a033ec7301123deeb7e56d04c38f9f1da}{actions\_after\_newton\_solve}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09102}09102 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09103}09103     \textcolor{comment}{// Finalise/doc timings}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09104}09104     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_ab4a3743c23a2d1eed56981484636c958}{Shut\_up\_in\_newton\_solve}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09105}09105     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09106}09106       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09107}09107       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Total time for linear solver (ndof="{}} << n\_dofs << \textcolor{stringliteral}{"{}): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09108}09108                  << \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_ae746b756dfb86c00c7cf37558a7870f3}{TimingHelpers::convert\_secs\_to\_formatted\_string}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09109}09109                       total\_linear\_solver\_time)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09110}09110                  << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09111}09111     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09112}09112 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09113}09113     \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09114}09114     \textcolor{keywordtype}{double} total\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09115}09115 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09116}09116     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_ab4a3743c23a2d1eed56981484636c958}{Shut\_up\_in\_newton\_solve}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09117}09117     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09118}09118       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Total time for Newton solver (ndof="{}} << n\_dofs << \textcolor{stringliteral}{"{}): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09119}09119                  << \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_ae746b756dfb86c00c7cf37558a7870f3}{TimingHelpers::convert\_secs\_to\_formatted\_string}}(total\_time)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09120}09120                  << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09121}09121     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09122}09122     \textcolor{keywordflow}{if} (total\_time > 0.0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09123}09123     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09124}09124       \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_ab4a3743c23a2d1eed56981484636c958}{Shut\_up\_in\_newton\_solve}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09125}09125       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09126}09126         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time outside linear solver        : "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09127}09127                    << (total\_time -\/ total\_linear\_solver\_time) / total\_time *}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09128}09128                         100.0}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09129}09129                    << \textcolor{stringliteral}{"{} \%"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09130}09130       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09131}09131     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09132}09132     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09133}09133     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09134}09134       \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_ab4a3743c23a2d1eed56981484636c958}{Shut\_up\_in\_newton\_solve}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09135}09135       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09136}09136         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time outside linear solver        : "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09137}09137                    << \textcolor{stringliteral}{"{}[too fast]"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09138}09138       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09139}09139     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09140}09140     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_ab4a3743c23a2d1eed56981484636c958}{Shut\_up\_in\_newton\_solve}}) \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09141}09141   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09142}09142 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09143}09143   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09144}09144 \textcolor{comment}{  /// Helper function for the globally convergent Newton solver}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09145}09145 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09146}\mbox{\hyperlink{classoomph_1_1Problem_ac60d7455a13ee171060c3a81623840b2}{09146}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ac60d7455a13ee171060c3a81623840b2}{Problem::globally\_convergent\_line\_search}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09147}09147     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& x\_old,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09148}09148     \textcolor{keyword}{const} \textcolor{keywordtype}{double}\& half\_residual\_squared\_old,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09149}09149     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& gradient,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09150}09150     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& newton\_dir,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09151}09151     \textcolor{keywordtype}{double}\& half\_residual\_squared,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09152}09152     \textcolor{keyword}{const} \textcolor{keywordtype}{double}\& stpmax)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09153}09153   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09154}09154     \textcolor{keyword}{const} \textcolor{keywordtype}{double} min\_fct\_decrease = 1.0e-\/4;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09155}09155     \textcolor{keywordtype}{double} convergence\_tol\_on\_x = 1.0e-\/16;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09156}09156     \textcolor{keywordtype}{double} f\_aux = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09157}09157     \textcolor{keywordtype}{double} lambda\_aux = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09158}09158     \textcolor{keywordtype}{double} proposed\_lambda;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09159}09159     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_dof = \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09160}09160     \textcolor{keywordtype}{double} sum = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09161}09161     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09162}09162     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09163}09163       sum += newton\_dir[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * newton\_dir[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09164}09164     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09165}09165     sum = sqrt(sum);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09166}09166     \textcolor{keywordflow}{if} (sum > stpmax)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09167}09167     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09168}09168       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09169}09169       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09170}09170         newton\_dir[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] *= stpmax / sum;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09171}09171       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09172}09172     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09173}09173     \textcolor{keywordtype}{double} slope = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09174}09174     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09175}09175     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09176}09176       slope += gradient[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * newton\_dir[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09177}09177     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09178}09178     \textcolor{keywordflow}{if} (slope >= 0.0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09179}09179     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09180}09180       std::ostringstream warn\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09181}09181       warn\_message << \textcolor{stringliteral}{"{}WARNING: Non-\/negative slope, probably due to a "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09182}09182                    << \textcolor{stringliteral}{"{} roundoff \(\backslash\)nproblem in the linesearch: slope="{}} << slope}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09183}09183                    << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09184}09184       \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(warn\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09185}09185                       \textcolor{stringliteral}{"{}Problem::globally\_convergent\_line\_search()"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09186}09186                       OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09187}09187     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09188}09188     \textcolor{keywordtype}{double} test = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09189}09189     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09190}09190     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09191}09191       \textcolor{keywordtype}{double} temp =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09192}09192         std::fabs(newton\_dir[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]) / std::max(std::fabs(x\_old[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]), 1.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09193}09193       \textcolor{keywordflow}{if} (temp > test) test = temp;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09194}09194     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09195}09195     \textcolor{keywordtype}{double} lambda\_min = convergence\_tol\_on\_x / test;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09196}09196     \textcolor{keywordtype}{double} lambda = 1.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09197}09197     \textcolor{keywordflow}{while} (\textcolor{keyword}{true})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09198}09198     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09199}09199       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09200}09200       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09201}09201         *\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = x\_old[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] + lambda * newton\_dir[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09202}09202       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09203}09203 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09204}09204       \textcolor{comment}{// Evaluate current residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09205}09205       \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} residuals;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09206}09206       \mbox{\hyperlink{classoomph_1_1Problem_a7300386d91390e3e5be993aca7459498}{get\_residuals}}(residuals);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09207}09207       half\_residual\_squared = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09208}09208       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09209}09209       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09210}09210         half\_residual\_squared += residuals[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * residuals[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09211}09211       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09212}09212       half\_residual\_squared *= 0.5;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09213}09213 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09214}09214       \textcolor{keywordflow}{if} (lambda < lambda\_min)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09215}09215       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09216}09216         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++) *\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = x\_old[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09217}09217 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09218}09218         std::ostringstream warn\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09219}09219         warn\_message << \textcolor{stringliteral}{"{}WARNING: Line search converged on x only!\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09220}09220         \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(warn\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09221}09221                         \textcolor{stringliteral}{"{}Problem::globally\_convergent\_line\_search()"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09222}09222                         OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09223}09223         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09224}09224       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09225}09225       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (half\_residual\_squared <=}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09226}09226                half\_residual\_squared\_old + min\_fct\_decrease * lambda * slope)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09227}09227       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09228}09228         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Returning from linesearch with lambda="{}} << lambda}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09229}09229                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09230}09230         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09231}09231       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09232}09232       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09233}09233       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09234}09234         \textcolor{keywordflow}{if} (lambda == 1.0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09235}09235         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09236}09236           proposed\_lambda =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09237}09237             -\/slope /}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09238}09238             (2.0 * (half\_residual\_squared -\/ half\_residual\_squared\_old -\/ slope));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09239}09239         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09240}09240         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09241}09241         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09242}09242           \textcolor{keywordtype}{double} r1 =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09243}09243             half\_residual\_squared -\/ half\_residual\_squared\_old -\/ lambda * slope;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09244}09244           \textcolor{keywordtype}{double} r2 = f\_aux -\/ half\_residual\_squared\_old -\/ lambda\_aux * slope;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09245}09245           \textcolor{keywordtype}{double} a\_poly =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09246}09246             (r1 / (lambda * lambda) -\/ r2 / (lambda\_aux * lambda\_aux)) /}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09247}09247             (lambda -\/ lambda\_aux);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09248}09248           \textcolor{keywordtype}{double} b\_poly = (-\/lambda\_aux * r1 / (lambda * lambda) +}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09249}09249                            lambda * r2 / (lambda\_aux * lambda\_aux)) /}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09250}09250                           (lambda -\/ lambda\_aux);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09251}09251           \textcolor{keywordflow}{if} (a\_poly == 0.0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09252}09252           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09253}09253             proposed\_lambda = -\/slope / (2.0 * b\_poly);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09254}09254           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09255}09255           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09256}09256           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09257}09257             \textcolor{keywordtype}{double} discriminant = b\_poly * b\_poly -\/ 3.0 * a\_poly * slope;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09258}09258             \textcolor{keywordflow}{if} (discriminant < 0.0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09259}09259             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09260}09260               proposed\_lambda = 0.5 * lambda;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09261}09261             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09262}09262             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (b\_poly <= 0.0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09263}09263             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09264}09264               proposed\_lambda = (-\/b\_poly + sqrt(discriminant)) / (3.0 * a\_poly);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09265}09265             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09266}09266             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09267}09267             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09268}09268               proposed\_lambda = -\/slope / (b\_poly + sqrt(discriminant));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09269}09269             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09270}09270           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09271}09271           \textcolor{keywordflow}{if} (proposed\_lambda > 0.5 * lambda)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09272}09272           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09273}09273             proposed\_lambda = 0.5 * lambda;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09274}09274           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09275}09275         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09276}09276       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09277}09277       lambda\_aux = lambda;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09278}09278       f\_aux = half\_residual\_squared;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09279}09279       lambda = std::max(proposed\_lambda, 0.1 * lambda);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09280}09280     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09281}09281   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09282}09282 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09283}09283 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09284}09284   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09285}09285 \textcolor{comment}{  /// Solve a steady problem, in the context of an overall unsteady problem.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09286}09286 \textcolor{comment}{  /// This is achieved by setting the weights in the timesteppers to be zero}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09287}09287 \textcolor{comment}{  /// which has the effect of rendering them steady timesteppers}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09288}09288 \textcolor{comment}{  /// The optional argument max\_adapt specifies the max. number of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09289}09289 \textcolor{comment}{  /// adaptations of all refineable submeshes are performed to}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09290}09290 \textcolor{comment}{  /// achieve the the error targets specified in the refineable submeshes.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09291}09291 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09292}\mbox{\hyperlink{classoomph_1_1Problem_a6de9b126bf5c8fce5d8e9602fa151090}{09292}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a6de9b126bf5c8fce5d8e9602fa151090}{Problem::steady\_newton\_solve}}(\textcolor{keywordtype}{unsigned} \textcolor{keyword}{const}\& max\_adapt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09293}09293   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09294}09294     \textcolor{comment}{// Find out how many timesteppers there are}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09295}09295     \textcolor{keywordtype}{unsigned} n\_time\_steppers = \mbox{\hyperlink{classoomph_1_1Problem_ace3cdf55009c3bff21d2b7d3706d522a}{ntime\_stepper}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09296}09296 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09297}09297     \textcolor{comment}{// Vector of bools to store the is\_steady status of the various}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09298}09298     \textcolor{comment}{// timesteppers when we came in here}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09299}09299     std::vector<bool> was\_steady(n\_time\_steppers);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09300}09300 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09301}09301     \textcolor{comment}{// Loop over them all and make them (temporarily) static}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09302}09302     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_time\_steppers; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09303}09303     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09304}09304       was\_steady[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_ad341ba9e80265e1c26c1cda0f40c8292}{is\_steady}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09305}09305       \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_a81ea0ff2e66cef5e0184b616c608e418}{make\_steady}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09306}09306     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09307}09307 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09308}09308     \textcolor{keywordflow}{try}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09309}09309     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09310}09310       \textcolor{comment}{// Solve the non-\/linear problem with Newton's method}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09311}09311       \textcolor{keywordflow}{if} (max\_adapt == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09312}09312       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09313}09313         \mbox{\hyperlink{classoomph_1_1Problem_a62a989ae9a9169b9d905f844db59787f}{newton\_solve}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09314}09314       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09315}09315       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09316}09316       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09317}09317         \mbox{\hyperlink{classoomph_1_1Problem_a62a989ae9a9169b9d905f844db59787f}{newton\_solve}}(max\_adapt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09318}09318       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09319}09319     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09320}09320     \textcolor{comment}{// Catch any exceptions thrown in the Newton solver}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09321}09321     \textcolor{keywordflow}{catch} (\mbox{\hyperlink{classoomph_1_1NewtonSolverError}{NewtonSolverError}}\& error)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09322}09322     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09323}09323       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09324}09324                  << \textcolor{stringliteral}{"{}USER-\/DEFINED ERROR IN NEWTON SOLVER "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09325}09325       \textcolor{comment}{// Check whether it's the linear solver}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09326}09326       \textcolor{keywordflow}{if} (error.\mbox{\hyperlink{classoomph_1_1NewtonSolverError_a30a00b1e2e2baaf733f6197572399875}{linear\_solver\_error}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09327}09327       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09328}09328         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}ERROR IN THE LINEAR SOLVER"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09329}09329       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09330}09330       \textcolor{comment}{// Check to see whether we have reached Max\_iterations}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09331}09331       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (error.\mbox{\hyperlink{classoomph_1_1NewtonSolverError_aaae34aeb5b4128c87e03c89de1de60a8}{iterations}} == \mbox{\hyperlink{classoomph_1_1Problem_a52a58a98c3e2e7dbaefcfb1ee7830c35}{Max\_newton\_iterations}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09332}09332       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09333}09333         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}MAXIMUM NUMBER OF ITERATIONS ("{}} << error.\mbox{\hyperlink{classoomph_1_1NewtonSolverError_aaae34aeb5b4128c87e03c89de1de60a8}{iterations}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09334}09334                    << \textcolor{stringliteral}{"{}) REACHED WITHOUT CONVERGENCE "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09335}09335       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09336}09336       \textcolor{comment}{// If not, it must be that we have exceeded the maximum residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09337}09337       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09338}09338       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09339}09339         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}MAXIMUM RESIDUALS: "{}} << error.\mbox{\hyperlink{classoomph_1_1NewtonSolverError_ae9ee0ef969c2fbf869afb7c4a75dcbe0}{maxres}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09340}09340                    << \textcolor{stringliteral}{"{} EXCEEDS PREDEFINED MAXIMUM "{}} << \mbox{\hyperlink{classoomph_1_1Problem_accb8811cdf32f14be497917e922c623e}{Max\_residuals}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09341}09341                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09342}09342       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09343}09343 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09344}09344       \textcolor{comment}{// Die horribly!!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09345}09345       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09346}09346       error\_stream << \textcolor{stringliteral}{"{}Error occured in Newton solver. "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09347}09347       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09348}09348         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09349}09349     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09350}09350 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09351}09351 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09352}09352     \textcolor{comment}{// Reset the is\_steady status of all timesteppers that}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09353}09353     \textcolor{comment}{// weren't already steady when we came in here and reset their}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09354}09354     \textcolor{comment}{// weights}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09355}09355     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_time\_steppers; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09356}09356     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09357}09357       \textcolor{keywordflow}{if} (!was\_steady[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09358}09358       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09359}09359         \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_aada05f89e86aae352bd5b32bfb173b18}{undo\_make\_steady}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09360}09360       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09361}09361     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09362}09362 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09363}09363     \textcolor{comment}{// Since we performed a steady solve, the history values}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09364}09364     \textcolor{comment}{// now have to be set as if we had performed an impulsive start from}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09365}09365     \textcolor{comment}{// the current solution. This ensures that the time-\/derivatives}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09366}09366     \textcolor{comment}{// evaluate to zero even now that the timesteppers have been}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09367}09367     \textcolor{comment}{// reactivated.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09368}09368     \mbox{\hyperlink{classoomph_1_1Problem_a10e5dc4d944dfb2b141918e18e5e3de8}{assign\_initial\_values\_impulsive}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09369}09369   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09370}09370 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09371}09371   \textcolor{comment}{//===========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09372}09372 \textcolor{comment}{  /// Perform a basic continuation step using Newton's method. The governing}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09373}09373 \textcolor{comment}{  /// parameter of the problem is passed as a pointer to the routine. The}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09374}09374 \textcolor{comment}{  /// number of Newton steps taken is returned}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09375}09375 \textcolor{comment}{}  \textcolor{comment}{//==========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09376}\mbox{\hyperlink{classoomph_1_1Problem_aea0efdeb4814de433fa2ffb3065831ce}{09376}}   \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1Problem_aea0efdeb4814de433fa2ffb3065831ce}{Problem::newton\_solve\_continuation}}(\textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09377}09377   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09378}09378     \textcolor{comment}{// Set up memory for z}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09379}09379     \textcolor{comment}{// unsigned long n\_dofs = ndof();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09380}09380     \textcolor{comment}{// LinearAlgebraDistribution dist(Communicator\_pt,n\_dofs,false);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09381}09381     \textcolor{comment}{// DoubleVector z(\&dist,0.0);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09382}09382     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} z;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09383}09383     \textcolor{comment}{// Call the solver}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09384}09384     \textcolor{keywordflow}{return} \mbox{\hyperlink{classoomph_1_1Problem_aea0efdeb4814de433fa2ffb3065831ce}{newton\_solve\_continuation}}(parameter\_pt, z);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09385}09385   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09386}09386 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09387}09387 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09388}09388   \textcolor{comment}{//===================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09389}09389 \textcolor{comment}{  /// This function performs a basic continuation step using the Newton method.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09390}09390 \textcolor{comment}{  /// The number of Newton steps taken is returned, to be used in any}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09391}09391 \textcolor{comment}{  /// external step-\/size control routines.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09392}09392 \textcolor{comment}{  /// The governing parameter of the problem is passed as a pointer to the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09393}09393 \textcolor{comment}{  /// routine, as is the sign of the Jacobian and a Vector in which}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09394}09394 \textcolor{comment}{  /// to store the derivatives wrt the parameter, if required.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09395}09395 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09396}\mbox{\hyperlink{classoomph_1_1Problem_aa539429593ad9ffe3a400a72db2063bd}{09396}}   \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1Problem_aea0efdeb4814de433fa2ffb3065831ce}{Problem::newton\_solve\_continuation}}(\textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09397}09397                                               \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& z)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09398}09398   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09399}09399     \textcolor{comment}{// Find the total number of dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09400}09400     \textcolor{comment}{// unsigned long n\_dofs = ndof();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09401}09401 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09402}09402     \textcolor{comment}{// Find the local number of dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09403}09403     \textcolor{keywordtype}{unsigned} ndof\_local = \mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09404}09404 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09405}09405     \textcolor{comment}{// create the distribution (not distributed)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09406}09406     \textcolor{comment}{// LinearAlgebraDistribution dist(this-\/>communicator\_pt(),n\_dofs,false);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09407}09407 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09408}09408     \textcolor{comment}{// Assign memory for solutions of the equations}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09409}09409     \textcolor{comment}{// DoubleVector y(\&dist,0.0);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09410}09410     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} y;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09411}09411 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09412}09412     \textcolor{comment}{// Assign memory for the dot products of the uderivatives and y and z}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09413}09413     \textcolor{keywordtype}{double} uderiv\_dot\_y = 0.0, uderiv\_dot\_z = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09414}09414     \textcolor{comment}{// Set and initialise the counter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09415}09415     \textcolor{keywordtype}{unsigned} count = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09416}09416     \textcolor{comment}{// Set the loop flag}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09417}09417     \textcolor{keywordtype}{unsigned} LOOP\_FLAG = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09418}09418 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09419}09419     \textcolor{comment}{// Update anything that needs updating}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09420}09420     \mbox{\hyperlink{classoomph_1_1Problem_a0c8d70891f7369bb4bf8412fa1a08ecb}{actions\_before\_newton\_solve}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09421}09421 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09422}09422     \textcolor{comment}{// Check the arc-\/length constraint}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09423}09423     \textcolor{keywordtype}{double} arc\_length\_constraint\_residual = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09424}09424 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09425}09425     \textcolor{comment}{// Are we storing the matrix in the linear solve}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09426}09426     \textcolor{keywordtype}{bool} enable\_resolve = \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_ae1e4d34a7e2b1537d36153f87e8a62a6}{is\_resolve\_enabled}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09427}09427 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09428}09428     \textcolor{comment}{// For this problem, we must store the residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09429}09429     \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3000ebd9becb3468d8a6a821a9cc0cd9}{enable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09430}09430 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09431}09431     \textcolor{comment}{// Now do the Newton loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09432}09432     \textcolor{keywordflow}{do}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09433}09433     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09434}09434       count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09435}09435 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09436}09436       \textcolor{comment}{// Do any updates that are required}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09437}09437       \mbox{\hyperlink{classoomph_1_1Problem_a07fc81781c74b25c8a426ec18295b0d0}{actions\_before\_newton\_step}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09438}09438 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09439}09439       \textcolor{comment}{// Calculate initial residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09440}09440       \textcolor{keywordflow}{if} (count == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09441}09441       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09442}09442 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09443}09443         \textcolor{comment}{// Synchronise the solution on different processors (on each submesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09444}09444         this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5d9a3ba5696a7bcd275223ff16b7392e}{synchronise\_all\_dofs}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09445}09445 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09446}09446 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09447}09447         \mbox{\hyperlink{classoomph_1_1Problem_ae6ad96ddf5d48b517b89c9a9b879bc4b}{actions\_before\_newton\_convergence\_check}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09448}09448         y.\mbox{\hyperlink{classoomph_1_1DoubleVector_af1677445056759263b1b076966e7bfae}{clear}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09449}09449         \mbox{\hyperlink{classoomph_1_1Problem_a7300386d91390e3e5be993aca7459498}{get\_residuals}}(y);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09450}09450         \textcolor{comment}{// Get maximum residuals, using our own abscmp function}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09451}09451         \textcolor{keywordtype}{double} maxres = y.\mbox{\hyperlink{classoomph_1_1DoubleVector_a4c176b562f503701d65882a930d5b8f5}{max}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09452}09452 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09453}09453         \textcolor{comment}{// Assemble the residuals for the arc-\/length step}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09454}09454         arc\_length\_constraint\_residual = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09455}09455         \textcolor{comment}{// Add the variables}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09456}09456         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} l = 0; l < ndof\_local; l++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09457}09457         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09458}09458           arc\_length\_constraint\_residual +=}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09459}09459             \mbox{\hyperlink{classoomph_1_1Problem_a5aa9936836b7e342c61ac0daba155ec5}{dof\_derivative}}(l) * (*\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[l] -\/ \mbox{\hyperlink{classoomph_1_1Problem_a187fca413da164551f4d3344c7baf861}{dof\_current}}(l));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09460}09460         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09461}09461 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09462}09462         \textcolor{comment}{// Now reduce if we have been distributed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09463}09463 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09464}09464         \textcolor{keywordtype}{double} arc\_length\_cons\_res2 = arc\_length\_constraint\_residual;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09465}09465         \textcolor{keywordflow}{if} ((\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a05842d032d28880ae37951deae804ad8}{distributed}}()) \&\&}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09466}09466             (\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2760847d45ab334f6d902efc2620b615}{communicator\_pt}}()-\/>nproc() > 1))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09467}09467         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09468}09468           MPI\_Allreduce(\&arc\_length\_constraint\_residual,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09469}09469                         \&arc\_length\_cons\_res2,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09470}09470                         1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09471}09471                         MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09472}09472                         MPI\_SUM,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09473}09473                         \mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2760847d45ab334f6d902efc2620b615}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09474}09474         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09475}09475         arc\_length\_constraint\_residual = arc\_length\_cons\_res2;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09476}09476 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09477}09477 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09478}09478         arc\_length\_constraint\_residual *= \mbox{\hyperlink{classoomph_1_1Problem_a123843ca2ed6384342939ef2b19477ef}{Theta\_squared}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09479}09479         arc\_length\_constraint\_residual +=}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09480}09480           \mbox{\hyperlink{classoomph_1_1Problem_aa5082325ca4cafe5a9ec03ef79c67a6f}{Parameter\_derivative}} * (*parameter\_pt -\/ \mbox{\hyperlink{classoomph_1_1Problem_a8e29673eb80559888d1c6148c4f11e57}{Parameter\_current}}) -\/}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09481}09481           \mbox{\hyperlink{classoomph_1_1Problem_ad412d49617d0b0998e5eb440c7a20f3f}{Ds\_current}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09482}09482 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09483}09483         \textcolor{comment}{// Is it the max}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09484}09484         \textcolor{keywordflow}{if} (std::fabs(arc\_length\_constraint\_residual) > maxres)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09485}09485         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09486}09486           maxres = std::fabs(arc\_length\_constraint\_residual);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09487}09487         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09488}09488 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09489}09489         \textcolor{comment}{// Find the max}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09490}09490         \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_ab4a3743c23a2d1eed56981484636c958}{Shut\_up\_in\_newton\_solve}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09491}09491         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09492}09492           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Initial Maximum residuals "{}} << maxres << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09493}09493         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09494}09494 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09495}09495         \textcolor{comment}{// If we are below the Tolerance, then return immediately}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09496}09496         \textcolor{keywordflow}{if} ((maxres < \mbox{\hyperlink{classoomph_1_1Problem_a94536b381e949edf5bb4d44434e08925}{Newton\_solver\_tolerance}}) \&\&}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09497}09497             (!\mbox{\hyperlink{classoomph_1_1Problem_a01d7376ab9cc06e4d5619b34fd39dee2}{Always\_take\_one\_newton\_step}}))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09498}09498         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09499}09499           LOOP\_FLAG = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09500}09500           count = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09501}09501           \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09502}09502         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09503}09503       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09504}09504 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09505}09505       \textcolor{comment}{// If it's the block hopf solver we need to solve for both rhs's}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09506}09506       \textcolor{comment}{// simultaneously. This is because the block decomposition involves}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09507}09507       \textcolor{comment}{// solves with two different matrices and storing both at once to}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09508}09508       \textcolor{comment}{// allow general resolves would be more expensive than necessary.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09509}09509       \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver}{BlockHopfLinearSolver}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}}))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09510}09510       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09511}09511         \textcolor{comment}{// Get the vector dresiduals/dparameter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09512}09512         z.\mbox{\hyperlink{classoomph_1_1DoubleVector_af1677445056759263b1b076966e7bfae}{clear}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09513}09513         \mbox{\hyperlink{classoomph_1_1Problem_af4d959a47ef6a8d50b394a6761dfab5a}{get\_derivative\_wrt\_global\_parameter}}(parameter\_pt, z);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09514}09514 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09515}09515         \textcolor{comment}{// Copy rhs vector into local storage so it doesn't get overwritten}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09516}09516         \textcolor{comment}{// if the linear solver decides to initialise the solution vector, say,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09517}09517         \textcolor{comment}{// which it's quite entitled to do!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09518}09518         \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} input\_z(z);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09519}09519 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09520}09520         \textcolor{comment}{// Solve the system for the two right-\/hand sides.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09521}09521         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver}{BlockHopfLinearSolver}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09522}09522           -\/>solve\_for\_two\_rhs(\textcolor{keyword}{this}, y, input\_z, z);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09523}09523       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09524}09524       \textcolor{comment}{// Otherwise}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09525}09525       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09526}09526       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09527}09527         \textcolor{comment}{// Solve the standard problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09528}09528         \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a15ce22542b74ed1826ea485edacbeb6e}{solve}}(\textcolor{keyword}{this}, y);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09529}09529 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09530}09530         \textcolor{comment}{// Get the vector dresiduals/dparameter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09531}09531         z.\mbox{\hyperlink{classoomph_1_1DoubleVector_af1677445056759263b1b076966e7bfae}{clear}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09532}09532         \mbox{\hyperlink{classoomph_1_1Problem_af4d959a47ef6a8d50b394a6761dfab5a}{get\_derivative\_wrt\_global\_parameter}}(parameter\_pt, z);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09533}09533 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09534}09534         \textcolor{comment}{// Copy rhs vector into local storage so it doesn't get overwritten}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09535}09535         \textcolor{comment}{// if the linear solver decides to initialise the solution vector, say,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09536}09536         \textcolor{comment}{// which it's quite entitled to do!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09537}09537         \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} input\_z(z);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09538}09538 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09539}09539         \textcolor{comment}{// Redistribute the RHS to match the linear solver}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09540}09540         \textcolor{comment}{// input\_z.redistribute(Linear\_solver\_pt-\/>distribution\_pt());}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09541}09541         \textcolor{comment}{// Do not clear z because we assume that it has dR/dparam}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09542}09542         z.\mbox{\hyperlink{classoomph_1_1DoubleVector_af1677445056759263b1b076966e7bfae}{clear}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09543}09543         \textcolor{comment}{// Now resolve the system with the new RHS}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09544}09544         \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(input\_z, z);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09545}09545       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09546}09546 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09547}09547       \textcolor{comment}{// Redistribute the results into the natural distribution}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09548}09548       y.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09549}09549       z.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09550}09550 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09551}09551       \textcolor{comment}{// Now we need to calculate dparam, for which we must calculate the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09552}09552       \textcolor{comment}{// dot product of the derivatives and y and z}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09553}09553       \textcolor{comment}{// Reset these values to zero}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09554}09554       uderiv\_dot\_y = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09555}09555       uderiv\_dot\_z = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09556}09556       \textcolor{comment}{// Now calculate the dot products of the derivative and the solutions}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09557}09557       \textcolor{comment}{// of the linear system}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09558}09558       \textcolor{comment}{// Cache pointers to the data in the distributed vectors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09559}09559       \textcolor{keywordtype}{double}* \textcolor{keyword}{const} y\_pt = y.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09560}09560       \textcolor{keywordtype}{double}* \textcolor{keyword}{const} z\_pt = z.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09561}09561       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} l = 0; l < ndof\_local; l++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09562}09562       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09563}09563         uderiv\_dot\_y += \mbox{\hyperlink{classoomph_1_1Problem_a5aa9936836b7e342c61ac0daba155ec5}{dof\_derivative}}(l) * y\_pt[l];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09564}09564         uderiv\_dot\_z += \mbox{\hyperlink{classoomph_1_1Problem_a5aa9936836b7e342c61ac0daba155ec5}{dof\_derivative}}(l) * z\_pt[l];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09565}09565       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09566}09566 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09567}09567       \textcolor{comment}{// Now reduce if we have been distributed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09568}09568 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09569}09569       \textcolor{comment}{// Create send and receive arrays of size two}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09570}09570       \textcolor{keywordtype}{double} uderiv\_dot[2];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09571}09571       \textcolor{keywordtype}{double} uderiv\_dot2[2];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09572}09572       uderiv\_dot[0] = uderiv\_dot\_y;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09573}09573       uderiv\_dot[1] = uderiv\_dot\_z;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09574}09574       uderiv\_dot2[0] = uderiv\_dot\_y;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09575}09575       uderiv\_dot2[1] = uderiv\_dot\_z;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09576}09576       \textcolor{comment}{// Now reduce both together}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09577}09577       \textcolor{keywordflow}{if} ((\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a05842d032d28880ae37951deae804ad8}{distributed}}()) \&\&}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09578}09578           (\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2760847d45ab334f6d902efc2620b615}{communicator\_pt}}()-\/>nproc() > 1))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09579}09579       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09580}09580         MPI\_Allreduce(uderiv\_dot,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09581}09581                       uderiv\_dot2,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09582}09582                       2,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09583}09583                       MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09584}09584                       MPI\_SUM,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09585}09585                       \mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2760847d45ab334f6d902efc2620b615}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09586}09586       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09587}09587       uderiv\_dot\_y = uderiv\_dot2[0];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09588}09588       uderiv\_dot\_z = uderiv\_dot2[1];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09589}09589 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09590}09590 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09591}09591       \textcolor{comment}{// Now scale the results}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09592}09592       uderiv\_dot\_y *= \mbox{\hyperlink{classoomph_1_1Problem_a123843ca2ed6384342939ef2b19477ef}{Theta\_squared}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09593}09593       uderiv\_dot\_z *= \mbox{\hyperlink{classoomph_1_1Problem_a123843ca2ed6384342939ef2b19477ef}{Theta\_squared}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09594}09594 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09595}09595       \textcolor{comment}{// The set the change in the parameter, given by the pseudo-\/arclength}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09596}09596       \textcolor{comment}{// equation. Note that here we are assuming that the arc-\/length}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09597}09597       \textcolor{comment}{// equation is always exactly zero,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09598}09598       \textcolor{comment}{// which seems to work OK, and saves on some storage.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09599}09599       \textcolor{comment}{// In fact, it's more subtle than that. If we include this}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09600}09600       \textcolor{comment}{// proper residual then we will have to solve the eigenproblem.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09601}09601       \textcolor{comment}{// This will make the solver more robust and *should* be done}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09602}09602       \textcolor{comment}{// ... at some point.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09603}09603       \textcolor{keywordtype}{double} dparam = (arc\_length\_constraint\_residual -\/ uderiv\_dot\_y) /}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09604}09604                       (\mbox{\hyperlink{classoomph_1_1Problem_aa5082325ca4cafe5a9ec03ef79c67a6f}{Parameter\_derivative}} -\/ uderiv\_dot\_z);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09605}09605 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09606}09606       \textcolor{comment}{// Set the new value of the parameter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09607}09607       *parameter\_pt -\/= dparam;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09608}09608 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09609}09609       \textcolor{comment}{// Update the values of the other degrees of freedom}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09610}09610       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} l = 0; l < ndof\_local; l++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09611}09611       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09612}09612         *\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[l] -\/= y\_pt[l] -\/ dparam * z\_pt[l];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09613}09613       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09614}09614 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09615}09615       \textcolor{comment}{// Calculate the new residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09616}09616 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09617}09617       \textcolor{comment}{// Synchronise the solution on different processors (on each submesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09618}09618       this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5d9a3ba5696a7bcd275223ff16b7392e}{synchronise\_all\_dofs}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09619}09619 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09620}09620 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09621}09621       \textcolor{comment}{// Do any updates that are required}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09622}09622       \mbox{\hyperlink{classoomph_1_1Problem_aed8bc6e7b0bb45b86d5b44737b554d50}{actions\_after\_newton\_step}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09623}09623       \mbox{\hyperlink{classoomph_1_1Problem_ae6ad96ddf5d48b517b89c9a9b879bc4b}{actions\_before\_newton\_convergence\_check}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09624}09624 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09625}09625       y.\mbox{\hyperlink{classoomph_1_1DoubleVector_af1677445056759263b1b076966e7bfae}{clear}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09626}09626       \mbox{\hyperlink{classoomph_1_1Problem_a7300386d91390e3e5be993aca7459498}{get\_residuals}}(y);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09627}09627 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09628}09628       \textcolor{comment}{// Get the maximum residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09629}09629       \textcolor{keywordtype}{double} maxres = y.\mbox{\hyperlink{classoomph_1_1DoubleVector_a4c176b562f503701d65882a930d5b8f5}{max}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09630}09630 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09631}09631       \textcolor{comment}{// Assemble the residuals for the arc-\/length step}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09632}09632       arc\_length\_constraint\_residual = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09633}09633       \textcolor{comment}{// Add the variables}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09634}09634       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} l = 0; l < ndof\_local; l++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09635}09635       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09636}09636         arc\_length\_constraint\_residual +=}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09637}09637           \mbox{\hyperlink{classoomph_1_1Problem_a5aa9936836b7e342c61ac0daba155ec5}{dof\_derivative}}(l) * (*\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[l] -\/ \mbox{\hyperlink{classoomph_1_1Problem_a187fca413da164551f4d3344c7baf861}{dof\_current}}(l));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09638}09638       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09639}09639 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09640}09640       \textcolor{comment}{// Now reduce if we have been distributed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09641}09641 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09642}09642       \textcolor{keywordtype}{double} arc\_length\_cons\_res2 = arc\_length\_constraint\_residual;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09643}09643       \textcolor{keywordflow}{if} ((\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a05842d032d28880ae37951deae804ad8}{distributed}}()) \&\&}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09644}09644           (\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2760847d45ab334f6d902efc2620b615}{communicator\_pt}}()-\/>nproc() > 1))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09645}09645       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09646}09646         MPI\_Allreduce(\&arc\_length\_constraint\_residual,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09647}09647                       \&arc\_length\_cons\_res2,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09648}09648                       1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09649}09649                       MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09650}09650                       MPI\_SUM,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09651}09651                       \mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2760847d45ab334f6d902efc2620b615}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09652}09652       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09653}09653       arc\_length\_constraint\_residual = arc\_length\_cons\_res2;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09654}09654 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09655}09655 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09656}09656       arc\_length\_constraint\_residual *= \mbox{\hyperlink{classoomph_1_1Problem_a123843ca2ed6384342939ef2b19477ef}{Theta\_squared}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09657}09657       arc\_length\_constraint\_residual +=}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09658}09658         \mbox{\hyperlink{classoomph_1_1Problem_aa5082325ca4cafe5a9ec03ef79c67a6f}{Parameter\_derivative}} * (*parameter\_pt -\/ \mbox{\hyperlink{classoomph_1_1Problem_a8e29673eb80559888d1c6148c4f11e57}{Parameter\_current}}) -\/ \mbox{\hyperlink{classoomph_1_1Problem_ad412d49617d0b0998e5eb440c7a20f3f}{Ds\_current}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09659}09659 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09660}09660       \textcolor{comment}{// Is it the max}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09661}09661       \textcolor{keywordflow}{if} (std::fabs(arc\_length\_constraint\_residual) > maxres)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09662}09662       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09663}09663         maxres = std::fabs(arc\_length\_constraint\_residual);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09664}09664       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09665}09665 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09666}09666       \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_ab4a3743c23a2d1eed56981484636c958}{Shut\_up\_in\_newton\_solve}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09667}09667       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09668}09668         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Continuation Step "{}} << count << \textcolor{stringliteral}{"{}:  Maximum residuals "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09669}09669                    << maxres << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09670}09670       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09671}09671 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09672}09672       \textcolor{comment}{// If we have converged jump straight to the test at the end of the loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09673}09673       \textcolor{keywordflow}{if} (maxres < \mbox{\hyperlink{classoomph_1_1Problem_a94536b381e949edf5bb4d44434e08925}{Newton\_solver\_tolerance}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09674}09674       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09675}09675         LOOP\_FLAG = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09676}09676         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09677}09677       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09678}09678 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09679}09679       \textcolor{comment}{// This section will not be reached if we have converged already}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09680}09680       \textcolor{comment}{// If the maximum number of residuals is too high or the maximum number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09681}09681       \textcolor{comment}{// of iterations has been reached}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09682}09682       \textcolor{keywordflow}{if} ((maxres > \mbox{\hyperlink{classoomph_1_1Problem_accb8811cdf32f14be497917e922c623e}{Max\_residuals}}) || (count == \mbox{\hyperlink{classoomph_1_1Problem_a52a58a98c3e2e7dbaefcfb1ee7830c35}{Max\_newton\_iterations}}))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09683}09683       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09684}09684         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1NewtonSolverError}{NewtonSolverError}}(count, maxres);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09685}09685       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09686}09686 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09687}09687     \} \textcolor{keywordflow}{while} (LOOP\_FLAG);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09688}09688 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09689}09689     \textcolor{comment}{// Now update anything that needs updating}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09690}09690     \mbox{\hyperlink{classoomph_1_1Problem_a033ec7301123deeb7e56d04c38f9f1da}{actions\_after\_newton\_solve}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09691}09691 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09692}09692     \textcolor{comment}{// Reset the storage of the matrix on the linear solver to what it was}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09693}09693     \textcolor{comment}{// on entry to this routine}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09694}09694     \textcolor{keywordflow}{if} (enable\_resolve)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09695}09695     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09696}09696       \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3000ebd9becb3468d8a6a821a9cc0cd9}{enable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09697}09697     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09698}09698     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09699}09699     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09700}09700       \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_ad61c63af94c5961830bd9807225a48d6}{disable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09701}09701     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09702}09702 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09703}09703     \textcolor{comment}{// Return the number of Newton Steps taken}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09704}09704     \textcolor{keywordflow}{return} count;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09705}09705   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09706}09706 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09707}09707   \textcolor{comment}{//=========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09708}09708 \textcolor{comment}{  /// A function to calculate the derivatives wrt the arc-\/length. This version}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09709}09709 \textcolor{comment}{  /// of the function actually does a linear solve so that the derivatives}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09710}09710 \textcolor{comment}{  /// are calculated "{}exactly"{} rather than using the values at the Newton}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09711}09711 \textcolor{comment}{  /// step just before convergence. This is only necessary in spatially adaptive}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09712}09712 \textcolor{comment}{  /// problems, in which the number of degrees of freedom changes and so}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09713}09713 \textcolor{comment}{  /// the appropriate derivatives must be calculated for the new variables.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09714}09714 \textcolor{comment}{}  \textcolor{comment}{//=========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09715}\mbox{\hyperlink{classoomph_1_1Problem_a58f16ae8f6da042d40fddf01ee3ebd31}{09715}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a58f16ae8f6da042d40fddf01ee3ebd31}{Problem::calculate\_continuation\_derivatives}}(\textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09716}09716   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09717}09717     \textcolor{comment}{// Find the number of degrees of freedom in the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09718}09718     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_dofs = \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09719}09719 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09720}09720     \textcolor{comment}{// create a non-\/distributed z vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09721}09721     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} dist(\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}, n\_dofs, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09722}09722 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09723}09723     \textcolor{comment}{// Assign memory for solutions of the equations}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09724}09724     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} z(\&dist, 0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09725}09725 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09726}09726     \textcolor{comment}{// If it's the block hopf solver need to solve for both RHS}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09727}09727     \textcolor{comment}{// at once, but this would all be alleviated if we have the solve}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09728}09728     \textcolor{comment}{// for the non-\/residuals RHS.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09729}09729     \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver}{BlockHopfLinearSolver}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}}))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09730}09730     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09731}09731       \textcolor{comment}{// Get the vector dresiduals/dparameter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09732}09732       \mbox{\hyperlink{classoomph_1_1Problem_af4d959a47ef6a8d50b394a6761dfab5a}{get\_derivative\_wrt\_global\_parameter}}(parameter\_pt, z);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09733}09733 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09734}09734       \textcolor{comment}{// Copy rhs vector into local storage so it doesn't get overwritten}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09735}09735       \textcolor{comment}{// if the linear solver decides to initialise the solution vector, say,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09736}09736       \textcolor{comment}{// which it's quite entitled to do!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09737}09737       \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} dummy(\&dist, 0.0), input\_z(z);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09738}09738 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09739}09739       \textcolor{comment}{// Solve for the two RHSs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09740}09740       \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver}{BlockHopfLinearSolver}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09741}09741         -\/>solve\_for\_two\_rhs(\textcolor{keyword}{this}, dummy, input\_z, z);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09742}09742     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09743}09743     \textcolor{comment}{// Otherwise we can use the normal resolve}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09744}09744     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09745}09745     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09746}09746       \textcolor{comment}{// Save the status before entry to this routine}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09747}09747       \textcolor{keywordtype}{bool} enable\_resolve = \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_ae1e4d34a7e2b1537d36153f87e8a62a6}{is\_resolve\_enabled}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09748}09748 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09749}09749       \textcolor{comment}{// We need to do resolves}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09750}09750       \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3000ebd9becb3468d8a6a821a9cc0cd9}{enable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09751}09751 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09752}09752       \textcolor{comment}{// Solve the standard problem, we only want to make sure that}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09753}09753       \textcolor{comment}{// we factorise the matrix, if it has not been factorised. We shall}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09754}09754       \textcolor{comment}{// ignore the return value of z.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09755}09755       \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a15ce22542b74ed1826ea485edacbeb6e}{solve}}(\textcolor{keyword}{this}, z);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09756}09756 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09757}09757       \textcolor{comment}{// Get the vector dresiduals/dparameter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09758}09758       \mbox{\hyperlink{classoomph_1_1Problem_af4d959a47ef6a8d50b394a6761dfab5a}{get\_derivative\_wrt\_global\_parameter}}(parameter\_pt, z);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09759}09759 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09760}09760 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09761}09761       \textcolor{comment}{// Copy rhs vector into local storage so it doesn't get overwritten}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09762}09762       \textcolor{comment}{// if the linear solver decides to initialise the solution vector, say,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09763}09763       \textcolor{comment}{// which it's quite entitled to do!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09764}09764       \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} input\_z(z);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09765}09765 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09766}09766       \textcolor{comment}{// Now resolve the system with the new RHS and overwrite the solution}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09767}09767       \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(input\_z, z);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09768}09768 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09769}09769       \textcolor{comment}{// Restore the storage status of the linear solver}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09770}09770       \textcolor{keywordflow}{if} (enable\_resolve)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09771}09771       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09772}09772         \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3000ebd9becb3468d8a6a821a9cc0cd9}{enable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09773}09773       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09774}09774       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09775}09775       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09776}09776         \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_ad61c63af94c5961830bd9807225a48d6}{disable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09777}09777       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09778}09778     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09779}09779 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09780}09780     \textcolor{comment}{// Now, we can calculate the derivatives, etc}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09781}09781     \mbox{\hyperlink{classoomph_1_1Problem_a58f16ae8f6da042d40fddf01ee3ebd31}{calculate\_continuation\_derivatives}}(z);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09782}09782   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09783}09783 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09784}09784   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09785}09785 \textcolor{comment}{  /// A function to calculate the derivatives with respect to the arc-\/length}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09786}09786 \textcolor{comment}{  /// required for continuation. The arguments is the solution of the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09787}09787 \textcolor{comment}{  /// linear system,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09788}09788 \textcolor{comment}{  /// Jz = dR/dparameter, that gives du/dparameter and the direction}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09789}09789 \textcolor{comment}{  /// output from the newton\_solve\_continuation function. The derivatives}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09790}09790 \textcolor{comment}{  /// are stored in the ContinuationParameters namespace.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09791}09791 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09792}\mbox{\hyperlink{classoomph_1_1Problem_a58edae16dc24830521b0df67452db1f7}{09792}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a58f16ae8f6da042d40fddf01ee3ebd31}{Problem::calculate\_continuation\_derivatives}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& z)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09793}09793   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09794}09794     \textcolor{comment}{// Calculate the continuation derivatives}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09795}09795     \mbox{\hyperlink{classoomph_1_1Problem_a9e860f40a5ca15767d2174893c9084d4}{calculate\_continuation\_derivatives\_helper}}(z);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09796}09796 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09797}09797     \textcolor{comment}{// Scale the value of theta if the control flag is set}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09798}09798     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a708322baf423e373970384006c2ca4db}{Scale\_arc\_length}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09799}09799     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09800}09800       \textcolor{comment}{// Don't divide by zero!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09801}09801       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aa5082325ca4cafe5a9ec03ef79c67a6f}{Parameter\_derivative}} != 1.0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09802}09802       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09803}09803         \mbox{\hyperlink{classoomph_1_1Problem_a123843ca2ed6384342939ef2b19477ef}{Theta\_squared}} *= (\mbox{\hyperlink{classoomph_1_1Problem_aa5082325ca4cafe5a9ec03ef79c67a6f}{Parameter\_derivative}} * \mbox{\hyperlink{classoomph_1_1Problem_aa5082325ca4cafe5a9ec03ef79c67a6f}{Parameter\_derivative}} /}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09804}09804                           \mbox{\hyperlink{classoomph_1_1Problem_a37fb791188428c8186ffd5c52b6cf576}{Desired\_proportion\_of\_arc\_length}}) *}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09805}09805                          ((1.0 -\/ \mbox{\hyperlink{classoomph_1_1Problem_a37fb791188428c8186ffd5c52b6cf576}{Desired\_proportion\_of\_arc\_length}}) /}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09806}09806                           (1.0 -\/ \mbox{\hyperlink{classoomph_1_1Problem_aa5082325ca4cafe5a9ec03ef79c67a6f}{Parameter\_derivative}} * \mbox{\hyperlink{classoomph_1_1Problem_aa5082325ca4cafe5a9ec03ef79c67a6f}{Parameter\_derivative}}));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09807}09807 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09808}09808         \textcolor{comment}{// Recalculate the continuation derivatives with the new scaled values}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09809}09809         \mbox{\hyperlink{classoomph_1_1Problem_a9e860f40a5ca15767d2174893c9084d4}{calculate\_continuation\_derivatives\_helper}}(z);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09810}09810       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09811}09811     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09812}09812   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09813}09813 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09814}09814   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09815}09815 \textcolor{comment}{  /// A function to calculate the derivatives with respect to the arc-\/length}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09816}09816 \textcolor{comment}{  /// required for continuation using finite differences.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09817}09817 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09818}\mbox{\hyperlink{classoomph_1_1Problem_addc838287129a35ef60e38ea854b939c}{09818}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_addc838287129a35ef60e38ea854b939c}{Problem::calculate\_continuation\_derivatives\_fd}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09819}09819     \textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09820}09820   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09821}09821     \textcolor{comment}{// Calculate the continuation derivatives}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09822}09822     \mbox{\hyperlink{classoomph_1_1Problem_a668e4c384b0513a943dee9411e640d74}{calculate\_continuation\_derivatives\_fd\_helper}}(parameter\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09823}09823 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09824}09824     \textcolor{comment}{// Scale the value of theta if the control flag is set}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09825}09825     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a708322baf423e373970384006c2ca4db}{Scale\_arc\_length}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09826}09826     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09827}09827       \textcolor{comment}{// Don't divide by zero!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09828}09828       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aa5082325ca4cafe5a9ec03ef79c67a6f}{Parameter\_derivative}} != 1.0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09829}09829       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09830}09830         \mbox{\hyperlink{classoomph_1_1Problem_a123843ca2ed6384342939ef2b19477ef}{Theta\_squared}} *= (\mbox{\hyperlink{classoomph_1_1Problem_aa5082325ca4cafe5a9ec03ef79c67a6f}{Parameter\_derivative}} * \mbox{\hyperlink{classoomph_1_1Problem_aa5082325ca4cafe5a9ec03ef79c67a6f}{Parameter\_derivative}} /}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09831}09831                           \mbox{\hyperlink{classoomph_1_1Problem_a37fb791188428c8186ffd5c52b6cf576}{Desired\_proportion\_of\_arc\_length}}) *}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09832}09832                          ((1.0 -\/ \mbox{\hyperlink{classoomph_1_1Problem_a37fb791188428c8186ffd5c52b6cf576}{Desired\_proportion\_of\_arc\_length}}) /}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09833}09833                           (1.0 -\/ \mbox{\hyperlink{classoomph_1_1Problem_aa5082325ca4cafe5a9ec03ef79c67a6f}{Parameter\_derivative}} * \mbox{\hyperlink{classoomph_1_1Problem_aa5082325ca4cafe5a9ec03ef79c67a6f}{Parameter\_derivative}}));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09834}09834 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09835}09835         \textcolor{comment}{// Recalculate the continuation derivatives with the new scaled values}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09836}09836         \mbox{\hyperlink{classoomph_1_1Problem_a668e4c384b0513a943dee9411e640d74}{calculate\_continuation\_derivatives\_fd\_helper}}(parameter\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09837}09837       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09838}09838     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09839}09839   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09840}09840 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09841}09841   \textcolor{comment}{//======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09842}09842 \textcolor{comment}{  /// Function that returns a boolean flag to indicate whether the pointer}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09843}09843 \textcolor{comment}{  /// parameter\_pt refers to memory that is a value in a Data object used}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09844}09844 \textcolor{comment}{  /// within the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09845}09845 \textcolor{comment}{}  \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09846}\mbox{\hyperlink{classoomph_1_1Problem_af7a83b109e7662abd52ea552d89163cc}{09846}}   \textcolor{keywordtype}{bool} \mbox{\hyperlink{classoomph_1_1Problem_af7a83b109e7662abd52ea552d89163cc}{Problem::does\_pointer\_correspond\_to\_problem\_data}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09847}09847     \textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09848}09848   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09849}09849     \textcolor{comment}{// Firstly check the global data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09850}09850     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_global = \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09851}09851     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_global; ++\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09852}09852     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09853}09853       \textcolor{comment}{// If we find it then return true}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09854}09854       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]-\/>does\_pointer\_correspond\_to\_value(parameter\_pt))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09855}09855       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09856}09856         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09857}09857       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09858}09858     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09859}09859 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09860}09860     \textcolor{comment}{// If we find the pointer in the mesh data return true}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09861}09861     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a13712b3fb8f01107772db51e01dbeee0}{does\_pointer\_correspond\_to\_mesh\_data}}(parameter\_pt))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09862}09862     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09863}09863       \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09864}09864     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09865}09865 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09866}09866     \textcolor{comment}{// Loop over the submeshes to handle the case of spine data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09867}09867     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_sub\_mesh = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09868}09868     \textcolor{comment}{// If there is only one mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09869}09869     \textcolor{keywordflow}{if} (n\_sub\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09870}09870     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09871}09871       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1SpineMesh}{SpineMesh}}* \textcolor{keyword}{const} spine\_mesh\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SpineMesh}{SpineMesh}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09872}09872       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09873}09873         \textcolor{keywordflow}{if} (spine\_mesh\_pt-\/>does\_pointer\_correspond\_to\_spine\_data(parameter\_pt))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09874}09874         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09875}09875           \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09876}09876         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09877}09877       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09878}09878     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09879}09879     \textcolor{comment}{// Otherwise loop over the sub meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09880}09880     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09881}09881     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09882}09882       \textcolor{comment}{// Assign global equation numbers first}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09883}09883       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_sub\_mesh; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09884}09884       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09885}09885         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1SpineMesh}{SpineMesh}}* \textcolor{keyword}{const} spine\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09886}09886               \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SpineMesh}{SpineMesh}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ab65f6fc9c49860e6324457a7e6e76346}{Sub\_mesh\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09887}09887         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09888}09888           \textcolor{keywordflow}{if} (spine\_mesh\_pt-\/>does\_pointer\_correspond\_to\_spine\_data(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09889}09889                 parameter\_pt))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09890}09890           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09891}09891             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09892}09892           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09893}09893         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09894}09894       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09895}09895     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09896}09896 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09897}09897     \textcolor{comment}{// If we have got here then the data is not stored in the problem, so return}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09898}09898     \textcolor{comment}{// false}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09899}09899     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09900}09900   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09901}09901 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09902}09902 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09903}09903   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09904}09904 \textcolor{comment}{  /// A private helper function to}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09905}09905 \textcolor{comment}{  /// calculate the derivatives with respect to the arc-\/length}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09906}09906 \textcolor{comment}{  /// required for continuation. The arguments is the solution of the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09907}09907 \textcolor{comment}{  /// linear system,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09908}09908 \textcolor{comment}{  /// Jz = dR/dparameter, that gives du/dparameter and the direction}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09909}09909 \textcolor{comment}{  /// output from the newton\_solve\_continuation function. The derivatives}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09910}09910 \textcolor{comment}{  /// are stored in the ContinuationParameters namespace.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09911}09911 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09912}\mbox{\hyperlink{classoomph_1_1Problem_a9e860f40a5ca15767d2174893c9084d4}{09912}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a9e860f40a5ca15767d2174893c9084d4}{Problem::calculate\_continuation\_derivatives\_helper}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& z)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09913}09913   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09914}09914     \textcolor{comment}{// Find the number of degrees of freedom in the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09915}09915     \textcolor{comment}{// unsigned long n\_dofs = ndof();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09916}09916     \textcolor{comment}{// Find the number of local dofs in the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09917}09917     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} ndof\_local = \mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09918}09918 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09919}09919     \textcolor{comment}{// Work out the continuation direction}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09920}09920     \textcolor{comment}{// The idea is that (du/ds)\_\{old\} . (du/ds)\_\{new\} >= 0}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09921}09921     \textcolor{comment}{// if the direction is to remain the same.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09922}09922     \textcolor{comment}{// du/ds\_\{new\} = [dlambda/ds; du/ds] = [dlambda/ds ; -\/ dlambda/ds z]}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09923}09923     \textcolor{comment}{// so (du/ds)\_\{new\} . (du/ds)\_\{old\}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09924}09924     \textcolor{comment}{// = dlambda/ds [1 ; -\/ z] . [ Parameter\_derivative ; Dof\_derivatives]}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09925}09925     \textcolor{comment}{// = dlambda/ds (Parameter\_derivative -\/ Dof\_derivative . z)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09926}09926 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09927}09927     \textcolor{comment}{// Create a local copy of z that can be redistributed without breaking}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09928}09928     \textcolor{comment}{// the constness of z}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09929}09929     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} local\_z(z);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09930}09930 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09931}09931     \textcolor{comment}{// Redistribute z so that it has the (natural) dof distribution}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09932}09932     local\_z.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09933}09933 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09934}09934     \textcolor{comment}{// Calculate the local contribution to the Continuation direction}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09935}09935     \mbox{\hyperlink{classoomph_1_1Problem_a6904003416e9a9257db70c009bdc69ed}{Continuation\_direction}} = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09936}09936     \textcolor{comment}{// Cache the pointer to z}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09937}09937     \textcolor{keywordtype}{double}* \textcolor{keyword}{const} local\_z\_pt = local\_z.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09938}09938     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} l = 0; l < ndof\_local; l++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09939}09939     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09940}09940       \mbox{\hyperlink{classoomph_1_1Problem_a6904003416e9a9257db70c009bdc69ed}{Continuation\_direction}} -\/= \mbox{\hyperlink{classoomph_1_1Problem_a5aa9936836b7e342c61ac0daba155ec5}{dof\_derivative}}(l) * local\_z\_pt[l];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09941}09941     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09942}09942 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09943}09943     \textcolor{comment}{// Now reduce if we have been distributed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09944}09944 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09945}09945     \textcolor{keywordtype}{double} cont\_dir2 = \mbox{\hyperlink{classoomph_1_1Problem_a6904003416e9a9257db70c009bdc69ed}{Continuation\_direction}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09946}09946     \textcolor{keywordflow}{if} ((\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a05842d032d28880ae37951deae804ad8}{distributed}}()) \&\&}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09947}09947         (\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2760847d45ab334f6d902efc2620b615}{communicator\_pt}}()-\/>nproc() > 1))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09948}09948     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09949}09949       MPI\_Allreduce(\&\mbox{\hyperlink{classoomph_1_1Problem_a6904003416e9a9257db70c009bdc69ed}{Continuation\_direction}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09950}09950                     \&cont\_dir2,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09951}09951                     1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09952}09952                     MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09953}09953                     MPI\_SUM,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09954}09954                     \mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2760847d45ab334f6d902efc2620b615}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09955}09955     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09956}09956     \mbox{\hyperlink{classoomph_1_1Problem_a6904003416e9a9257db70c009bdc69ed}{Continuation\_direction}} = cont\_dir2;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09957}09957 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09958}09958 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09959}09959     \textcolor{comment}{// Add parameter derivative}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09960}09960     \mbox{\hyperlink{classoomph_1_1Problem_a6904003416e9a9257db70c009bdc69ed}{Continuation\_direction}} += \mbox{\hyperlink{classoomph_1_1Problem_aa5082325ca4cafe5a9ec03ef79c67a6f}{Parameter\_derivative}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09961}09961 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09962}09962     \textcolor{comment}{// Calculate the magnitude of the du/ds Vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09963}09963 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09964}09964     \textcolor{comment}{// Note that actually, we are usually approximating by using the value at}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09965}09965     \textcolor{comment}{// newton step just before convergence, which saves one additional}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09966}09966     \textcolor{comment}{// Newton solve.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09967}09967 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09968}09968     \textcolor{comment}{// First calculate the magnitude of du/dparameter, chi}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09969}09969     \textcolor{keywordtype}{double} chi = local\_z.\mbox{\hyperlink{classoomph_1_1DoubleVector_abd20e2e394c8e08749ed34c7228c8506}{dot}}(local\_z);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09970}09970 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09971}09971     \textcolor{comment}{// Calculate the current derivative of the parameter wrt the arc-\/length}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09972}09972     \mbox{\hyperlink{classoomph_1_1Problem_aa5082325ca4cafe5a9ec03ef79c67a6f}{Parameter\_derivative}} = 1.0 / sqrt(1.0 + \mbox{\hyperlink{classoomph_1_1Problem_a123843ca2ed6384342939ef2b19477ef}{Theta\_squared}} * chi);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09973}09973 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09974}09974     \textcolor{comment}{// If the dot product of the current derivative wrt the Direction}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09975}09975     \textcolor{comment}{// is less than zero, switch the sign of the derivative to ensure}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09976}09976     \textcolor{comment}{// smooth continuation}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09977}09977     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aa5082325ca4cafe5a9ec03ef79c67a6f}{Parameter\_derivative}} * \mbox{\hyperlink{classoomph_1_1Problem_a6904003416e9a9257db70c009bdc69ed}{Continuation\_direction}} < 0.0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09978}09978     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09979}09979       \mbox{\hyperlink{classoomph_1_1Problem_aa5082325ca4cafe5a9ec03ef79c67a6f}{Parameter\_derivative}} *= -\/1.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09980}09980     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09981}09981 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09982}09982     \textcolor{comment}{// Resize the derivatives array, if necessary}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09983}09983     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_adbecce0cb1bd7b6b21285568e41ee3eb}{Use\_continuation\_timestepper}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09984}09984     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09985}09985       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a1861321b2d129707935bf1191238daca}{Dof\_derivative}}.size() != ndof\_local)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09986}09986       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09987}09987         \mbox{\hyperlink{classoomph_1_1Problem_a1861321b2d129707935bf1191238daca}{Dof\_derivative}}.resize(ndof\_local, 0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09988}09988       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09989}09989     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09990}09990     \textcolor{comment}{// Calculate the new derivatives wrt the arc-\/length}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09991}09991     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} l = 0; l < ndof\_local; l++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09992}09992     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09993}09993       \textcolor{comment}{// This comes from the formulation J u\_dot + dr/dlambda  lambda\_dot = 0}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09994}09994       \textcolor{comment}{// on the curve and then it follows that.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09995}09995       \mbox{\hyperlink{classoomph_1_1Problem_a5aa9936836b7e342c61ac0daba155ec5}{dof\_derivative}}(l) = -\/\mbox{\hyperlink{classoomph_1_1Problem_aa5082325ca4cafe5a9ec03ef79c67a6f}{Parameter\_derivative}} * local\_z\_pt[l];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09996}09996     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09997}09997   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09998}09998 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l09999}09999   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10000}10000 \textcolor{comment}{  /// A private helper function to}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10001}10001 \textcolor{comment}{  /// calculate the derivatives with respect to the arc-\/length}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10002}10002 \textcolor{comment}{  /// required for continuation using finite differences.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10003}10003 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10004}\mbox{\hyperlink{classoomph_1_1Problem_a668e4c384b0513a943dee9411e640d74}{10004}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a668e4c384b0513a943dee9411e640d74}{Problem::calculate\_continuation\_derivatives\_fd\_helper}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10005}10005     \textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10006}10006   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10007}10007     \textcolor{comment}{// Find the number of values}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10008}10008     \textcolor{comment}{// const unsigned long n\_dofs = this-\/>ndof();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10009}10009     \textcolor{comment}{// Find the number of local dofs in the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10010}10010     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} ndof\_local = \mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10011}10011 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10012}10012     \textcolor{comment}{// Temporary storage for the finite-\/difference approximation to the helper}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10013}10013     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} z(ndof\_local);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10014}10014     \textcolor{keywordtype}{double} length = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10015}10015     \textcolor{comment}{// Calculate the change in values and contribution to total length}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10016}10016     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} l = 0; l < ndof\_local; l++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10017}10017     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10018}10018       z[l] = (*\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[l] -\/ \mbox{\hyperlink{classoomph_1_1Problem_a366b50c490e9fd3ddafa05b2fbd0b883}{Dof\_current}}[l]) / \mbox{\hyperlink{classoomph_1_1Problem_ad412d49617d0b0998e5eb440c7a20f3f}{Ds\_current}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10019}10019       length += \mbox{\hyperlink{classoomph_1_1Problem_a123843ca2ed6384342939ef2b19477ef}{Theta\_squared}} * z[l] * z[l];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10020}10020     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10021}10021 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10022}10022     \textcolor{comment}{// Reduce if parallel}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10023}10023 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10024}10024     \textcolor{keywordtype}{double} length2 = length;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10025}10025     \textcolor{keywordflow}{if} ((\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a05842d032d28880ae37951deae804ad8}{distributed}}()) \&\&}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10026}10026         (\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2760847d45ab334f6d902efc2620b615}{communicator\_pt}}()-\/>nproc() > 1))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10027}10027     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10028}10028       MPI\_Allreduce(\&length,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10029}10029                     \&length2,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10030}10030                     1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10031}10031                     MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10032}10032                     MPI\_SUM,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10033}10033                     \mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2760847d45ab334f6d902efc2620b615}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10034}10034     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10035}10035     length = length2;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10036}10036 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10037}10037 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10038}10038     \textcolor{comment}{// Calculate change in parameter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10039}10039     \textcolor{keywordtype}{double} Z = (*parameter\_pt -\/ \mbox{\hyperlink{classoomph_1_1Problem_a8e29673eb80559888d1c6148c4f11e57}{Parameter\_current}}) / \mbox{\hyperlink{classoomph_1_1Problem_ad412d49617d0b0998e5eb440c7a20f3f}{Ds\_current}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10040}10040     length += Z * Z;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10041}10041 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10042}10042     \textcolor{comment}{// Scale the approximations to the derivatives}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10043}10043     length = sqrt(length);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10044}10044     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} l = 0; l < ndof\_local; l++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10045}10045     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10046}10046       \mbox{\hyperlink{classoomph_1_1Problem_a5aa9936836b7e342c61ac0daba155ec5}{dof\_derivative}}(l) = z[l] / length;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10047}10047     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10048}10048     \mbox{\hyperlink{classoomph_1_1Problem_aa5082325ca4cafe5a9ec03ef79c67a6f}{Parameter\_derivative}} = Z / length;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10049}10049   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10050}10050 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10051}10051 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10052}10052 \textcolor{comment}{  /// Virtual function that is used to symmetrise the problem so that}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10053}10053 \textcolor{comment}{  /// the current solution exactly satisfies any symmetries within the system.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10054}10054 \textcolor{comment}{  /// Used when adpativly solving pitchfork detection problems when small}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10055}10055 \textcolor{comment}{  /// asymmetries in the coarse solution can be magnified}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10056}10056 \textcolor{comment}{  /// leading to very inaccurate answers on the fine mesh.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10057}10057 \textcolor{comment}{  /// This is always problem-\/specific and must be filled in by the user}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10058}10058 \textcolor{comment}{  /// The default issues a warning}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10059}\mbox{\hyperlink{classoomph_1_1Problem_abbcf4965b6052758e49cf511947fd3f0}{10059}} \textcolor{comment}{}  \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_abbcf4965b6052758e49cf511947fd3f0}{Problem::symmetrise\_eigenfunction\_for\_adaptive\_pitchfork\_tracking}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10060}10060   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10061}10061     std::ostringstream warn\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10062}10062     warn\_message}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10063}10063       << \textcolor{stringliteral}{"{}Warning: This function is called after spatially adapting the\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10064}10064       << \textcolor{stringliteral}{"{}eigenfunction associated with a pitchfork bifurcation and should\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10065}10065       << \textcolor{stringliteral}{"{}ensure that the exact (anti-\/)symmetries of problem are enforced\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10066}10066       << \textcolor{stringliteral}{"{}within that eigenfunction. It is problem specific and must be\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10067}10067       << \textcolor{stringliteral}{"{}filled in by the user if required.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10068}10068       << \textcolor{stringliteral}{"{}A sign of problems is if the slack paramter gets too large and\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10069}10069       << \textcolor{stringliteral}{"{}if the solution at the Pitchfork is not symmetric.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10070}10070     \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10071}10071       warn\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10072}10072       \textcolor{stringliteral}{"{}Problem::symmetrise\_eigenfunction\_for\_adaptive\_pitchfork\_tracking()"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10073}10073       OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10074}10074   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10075}10075 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10076}10076   \textcolor{comment}{//====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10077}10077 \textcolor{comment}{  /// Return pointer to the parameter that is used in the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10078}10078 \textcolor{comment}{  /// bifurcation detection. If we are not tracking a bifurcation then}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10079}10079 \textcolor{comment}{  /// an error will be thrown by the AssemblyHandler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10080}10080 \textcolor{comment}{}  \textcolor{comment}{//====================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10081}\mbox{\hyperlink{classoomph_1_1Problem_a3cf79b3067d1d794062ebb27e414dea9}{10081}}   \textcolor{keywordtype}{double}* \mbox{\hyperlink{classoomph_1_1Problem_a3cf79b3067d1d794062ebb27e414dea9}{Problem::bifurcation\_parameter\_pt}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10082}10082 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10083}10083     \textcolor{keywordflow}{return} \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a3e369ec692c3d36a4a2a8a64dab7fe2b}{bifurcation\_parameter\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10084}10084   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10085}10085 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10086}10086   \textcolor{comment}{//====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10087}10087 \textcolor{comment}{  /// Return the eigenfunction calculated as part of a}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10088}10088 \textcolor{comment}{  /// bifurcation tracking process. If we are not tracking a bifurcation}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10089}10089 \textcolor{comment}{  /// then an error will be thrown by the AssemblyHandler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10090}10090 \textcolor{comment}{}  \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10091}\mbox{\hyperlink{classoomph_1_1Problem_a85b240c17750bdc32afafee35b50225a}{10091}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a85b240c17750bdc32afafee35b50225a}{Problem::get\_bifurcation\_eigenfunction}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10092}10092     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& eigenfunction)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10093}10093   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10094}10094     \textcolor{comment}{// Simply call the appropriate assembly handler function}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10095}10095     \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a6d614b1b3809d0eb7ceb393e3ae9594f}{get\_eigenfunction}}(eigenfunction);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10096}10096   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10097}10097 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10098}10098   \textcolor{comment}{//============================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10099}10099 \textcolor{comment}{  /// Activate the fold tracking system by changing the assembly}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10100}10100 \textcolor{comment}{  /// handler and initialising it using the parameter addressed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10101}10101 \textcolor{comment}{  /// by parameter\_pt.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10102}10102 \textcolor{comment}{}  \textcolor{comment}{//============================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10103}\mbox{\hyperlink{classoomph_1_1Problem_acf20e92281911dfbb423ea82542c0485}{10103}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_acf20e92281911dfbb423ea82542c0485}{Problem::activate\_fold\_tracking}}(\textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10104}10104                                        \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& block\_solve)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10105}10105   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10106}10106     \textcolor{comment}{// Reset the assembly handler to default}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10107}10107     \mbox{\hyperlink{classoomph_1_1Problem_aecb590c73e64b0a85f7bec0053e2c51d}{reset\_assembly\_handler\_to\_default}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10108}10108     \textcolor{comment}{// Set the new assembly handler. Note that the constructor actually}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10109}10109     \textcolor{comment}{// solves the original problem to get some initial conditions, but}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10110}10110     \textcolor{comment}{// this is OK because the RHS is always evaluated before assignment.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10111}10111     \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1Problem_a1d79584bd556f960d5b92474681e0159}{FoldHandler}}(\textcolor{keyword}{this}, parameter\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10112}10112 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10113}10113     \textcolor{comment}{// If we are using a block solver, we must set the linear solver pointer}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10114}10114     \textcolor{comment}{// to the block fold solver. The present linear solver is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10115}10115     \textcolor{comment}{// used by the block solver and so must be passed as an argument.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10116}10116     \textcolor{comment}{// The destructor of the Fold handler returns the linear}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10117}10117     \textcolor{comment}{// solver to the original non-\/block version.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10118}10118     \textcolor{keywordflow}{if} (block\_solve)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10119}10119     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10120}10120       \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1Problem_a29d9c39e6a14d2a4cc4e0d7c716579fe}{AugmentedBlockFoldLinearSolver}}(\mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10121}10121     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10122}10122   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10123}10123 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10124}10124   \textcolor{comment}{//===============================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10125}10125 \textcolor{comment}{  /// Activate the generic bifurcation ///tracking system by changing the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10126}10126 \textcolor{comment}{  /// assembly handler and initialising it using the parameter addressed by}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10127}10127 \textcolor{comment}{  /// parameter\_pt.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10128}10128 \textcolor{comment}{}  \textcolor{comment}{//============================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10129}\mbox{\hyperlink{classoomph_1_1Problem_a95359def89a0ee3d3df8976ab54c6591}{10129}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a95359def89a0ee3d3df8976ab54c6591}{Problem::activate\_bifurcation\_tracking}}(\textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10130}10130                                               \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& eigenvector,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10131}10131                                               \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& block\_solve)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10132}10132   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10133}10133     \textcolor{comment}{// Reset the assembly handler to default}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10134}10134     \mbox{\hyperlink{classoomph_1_1Problem_aecb590c73e64b0a85f7bec0053e2c51d}{reset\_assembly\_handler\_to\_default}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10135}10135     \textcolor{comment}{// Set the new assembly handler. Note that the constructor actually}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10136}10136     \textcolor{comment}{// solves the original problem to get some initial conditions, but}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10137}10137     \textcolor{comment}{// this is OK because the RHS is always evaluated before assignment.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10138}10138     \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1Problem_a1d79584bd556f960d5b92474681e0159}{FoldHandler}}(\textcolor{keyword}{this}, parameter\_pt, eigenvector);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10139}10139 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10140}10140     \textcolor{comment}{// If we are using a block solver, we must set the linear solver pointer}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10141}10141     \textcolor{comment}{// to the block fold solver. The present linear solver is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10142}10142     \textcolor{comment}{// used by the block solver and so must be passed as an argument.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10143}10143     \textcolor{comment}{// The destructor of the Fold handler returns the linear}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10144}10144     \textcolor{comment}{// solver to the original non-\/block version.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10145}10145     \textcolor{keywordflow}{if} (block\_solve)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10146}10146     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10147}10147       \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1Problem_a29d9c39e6a14d2a4cc4e0d7c716579fe}{AugmentedBlockFoldLinearSolver}}(\mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10148}10148     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10149}10149   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10150}10150 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10151}10151 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10152}10152   \textcolor{comment}{//===============================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10153}10153 \textcolor{comment}{  /// Activate the generic bifurcation ///tracking system by changing the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10154}10154 \textcolor{comment}{  /// assembly handler and initialising it using the parameter addressed by}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10155}10155 \textcolor{comment}{  /// parameter\_pt.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10156}10156 \textcolor{comment}{}  \textcolor{comment}{//============================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10157}\mbox{\hyperlink{classoomph_1_1Problem_a4610ef4c4f4d7c1d7001fabf074c930c}{10157}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a95359def89a0ee3d3df8976ab54c6591}{Problem::activate\_bifurcation\_tracking}}(\textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10158}10158                                               \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& eigenvector,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10159}10159                                               \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& normalisation,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10160}10160                                               \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& block\_solve)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10161}10161   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10162}10162     \textcolor{comment}{// Reset the assembly handler to default}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10163}10163     \mbox{\hyperlink{classoomph_1_1Problem_aecb590c73e64b0a85f7bec0053e2c51d}{reset\_assembly\_handler\_to\_default}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10164}10164     \textcolor{comment}{// Set the new assembly handler. Note that the constructor actually}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10165}10165     \textcolor{comment}{// solves the original problem to get some initial conditions, but}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10166}10166     \textcolor{comment}{// this is OK because the RHS is always evaluated before assignment.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10167}10167     \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}} =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10168}10168       \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1Problem_a1d79584bd556f960d5b92474681e0159}{FoldHandler}}(\textcolor{keyword}{this}, parameter\_pt, eigenvector, normalisation);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10169}10169 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10170}10170     \textcolor{comment}{// If we are using a block solver, we must set the linear solver pointer}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10171}10171     \textcolor{comment}{// to the block fold solver. The present linear solver is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10172}10172     \textcolor{comment}{// used by the block solver and so must be passed as an argument.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10173}10173     \textcolor{comment}{// The destructor of the Fold handler returns the linear}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10174}10174     \textcolor{comment}{// solver to the original non-\/block version.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10175}10175     \textcolor{keywordflow}{if} (block\_solve)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10176}10176     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10177}10177       \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1Problem_a29d9c39e6a14d2a4cc4e0d7c716579fe}{AugmentedBlockFoldLinearSolver}}(\mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10178}10178     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10179}10179   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10180}10180 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10181}10181 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10182}10182   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10183}10183 \textcolor{comment}{  /// Activate the pitchfork tracking system by changing the assembly}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10184}10184 \textcolor{comment}{  /// handler and initialising it using the parameter addressed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10185}10185 \textcolor{comment}{  /// by parameter\_pt and a symmetry vector. The boolean flag is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10186}10186 \textcolor{comment}{  /// used to specify whether a block solver is used, default is true.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10187}10187 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10188}\mbox{\hyperlink{classoomph_1_1Problem_a7f5eb1f88a957cb3d8a11b558002d484}{10188}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a7f5eb1f88a957cb3d8a11b558002d484}{Problem::activate\_pitchfork\_tracking}}(\textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10189}10189                                             \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& symmetry\_vector,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10190}10190                                             \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& block\_solve)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10191}10191   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10192}10192     \textcolor{comment}{// Reset the assembly handler to default}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10193}10193     \mbox{\hyperlink{classoomph_1_1Problem_aecb590c73e64b0a85f7bec0053e2c51d}{reset\_assembly\_handler\_to\_default}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10194}10194 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10195}10195     \textcolor{comment}{// Set the new assembly handler. Note that the constructor actually}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10196}10196     \textcolor{comment}{// solves the original problem to get some initial conditions, but}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10197}10197     \textcolor{comment}{// this is OK because the RHS is always evaluated before assignment.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10198}10198     \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1Problem_a58bcd2e5d47842c64018e2c842bff302}{PitchForkHandler}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10199}10199       \textcolor{keyword}{this}, this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}(), parameter\_pt, symmetry\_vector);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10200}10200 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10201}10201     \textcolor{comment}{// If we are using a block solver, we must set the linear solver pointer}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10202}10202     \textcolor{comment}{// to the block pitchfork solver. The present linear solver is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10203}10203     \textcolor{comment}{// used by the block solver and so must be passed as an argument.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10204}10204     \textcolor{comment}{// The destructor of the PitchFork handler returns the linear}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10205}10205     \textcolor{comment}{// solver to the original non-\/block version.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10206}10206     \textcolor{keywordflow}{if} (block\_solve)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10207}10207     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10208}10208       \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1Problem_aba62ac8cc057be07657972adc4a78b45}{BlockPitchForkLinearSolver}}(\mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10209}10209     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10210}10210   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10211}10211 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10212}10212 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10213}10213   \textcolor{comment}{//============================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10214}10214 \textcolor{comment}{  /// Activate the hopf tracking system by changing the assembly}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10215}10215 \textcolor{comment}{  /// handler and initialising it using the parameter addressed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10216}10216 \textcolor{comment}{  /// by parameter\_pt.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10217}10217 \textcolor{comment}{}  \textcolor{comment}{//============================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10218}\mbox{\hyperlink{classoomph_1_1Problem_ac5966d1a184e722195f96d797b52e64c}{10218}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ac5966d1a184e722195f96d797b52e64c}{Problem::activate\_hopf\_tracking}}(\textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10219}10219                                        \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& block\_solve)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10220}10220   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10221}10221     \textcolor{comment}{// Reset the assembly handler to default}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10222}10222     \mbox{\hyperlink{classoomph_1_1Problem_aecb590c73e64b0a85f7bec0053e2c51d}{reset\_assembly\_handler\_to\_default}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10223}10223     \textcolor{comment}{// Set the new assembly handler. Note that the constructor actually}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10224}10224     \textcolor{comment}{// solves the original problem to get some initial conditions, but}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10225}10225     \textcolor{comment}{// this is OK because the RHS is always evaluated before assignment.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10226}10226     \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1Problem_a5653c9ce9d673e348e945594469ce0d3}{HopfHandler}}(\textcolor{keyword}{this}, parameter\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10227}10227 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10228}10228     \textcolor{comment}{// If we are using a block solver, we must set the linear solver pointer}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10229}10229     \textcolor{comment}{// to the block hopf solver. The present linear solver is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10230}10230     \textcolor{comment}{// used by the block solver and so must be passed as an argument.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10231}10231     \textcolor{comment}{// The destructor of the Hopf handler returns the linear}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10232}10232     \textcolor{comment}{// solver to the original non-\/block version.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10233}10233     \textcolor{keywordflow}{if} (block\_solve)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10234}10234     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10235}10235       \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1Problem_a199677d64d3b2f908690d10a2398b737}{BlockHopfLinearSolver}}(\mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10236}10236     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10237}10237   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10238}10238 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10239}10239 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10240}10240   \textcolor{comment}{//============================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10241}10241 \textcolor{comment}{  /// Activate the hopf tracking system by changing the assembly}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10242}10242 \textcolor{comment}{  /// handler and initialising it using the parameter addressed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10243}10243 \textcolor{comment}{  /// by parameter\_pt and the frequency and null vectors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10244}10244 \textcolor{comment}{  /// specified.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10245}10245 \textcolor{comment}{}  \textcolor{comment}{//============================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10246}\mbox{\hyperlink{classoomph_1_1Problem_aa0e2d0e105da6b676262d75481bcc8e3}{10246}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ac5966d1a184e722195f96d797b52e64c}{Problem::activate\_hopf\_tracking}}(\textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10247}10247                                        \textcolor{keyword}{const} \textcolor{keywordtype}{double}\& omega,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10248}10248                                        \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& null\_real,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10249}10249                                        \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& null\_imag,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10250}10250                                        \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& block\_solve)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10251}10251   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10252}10252     \textcolor{comment}{// Reset the assembly handler to default}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10253}10253     \mbox{\hyperlink{classoomph_1_1Problem_aecb590c73e64b0a85f7bec0053e2c51d}{reset\_assembly\_handler\_to\_default}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10254}10254     \textcolor{comment}{// Set the new assembly handler. Note that the constructor actually}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10255}10255     \textcolor{comment}{// solves the original problem to get some initial conditions, but}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10256}10256     \textcolor{comment}{// this is OK because the RHS is always evaluated before assignment.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10257}10257     \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}} =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10258}10258       \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1Problem_a5653c9ce9d673e348e945594469ce0d3}{HopfHandler}}(\textcolor{keyword}{this}, parameter\_pt, omega, null\_real, null\_imag);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10259}10259 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10260}10260     \textcolor{comment}{// If we are using a block solver, we must set the linear solver pointer}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10261}10261     \textcolor{comment}{// to the block hopf solver. The present linear solver is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10262}10262     \textcolor{comment}{// used by the block solver and so must be passed as an argument.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10263}10263     \textcolor{comment}{// The destructor of the Hopf handler returns the linear}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10264}10264     \textcolor{comment}{// solver to the original non-\/block version.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10265}10265     \textcolor{keywordflow}{if} (block\_solve)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10266}10266     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10267}10267       \mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1Problem_a199677d64d3b2f908690d10a2398b737}{BlockHopfLinearSolver}}(\mbox{\hyperlink{classoomph_1_1Problem_a519de6f6f70c8b0f6bacbde5e0a35cd7}{Linear\_solver\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10268}10268     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10269}10269   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10270}10270 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10271}10271 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10272}10272   \textcolor{comment}{//===============================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10273}10273 \textcolor{comment}{  /// Reset the assembly handler to default}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10274}10274 \textcolor{comment}{}  \textcolor{comment}{//===============================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10275}\mbox{\hyperlink{classoomph_1_1Problem_aecb590c73e64b0a85f7bec0053e2c51d}{10275}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_aecb590c73e64b0a85f7bec0053e2c51d}{Problem::reset\_assembly\_handler\_to\_default}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10276}10276   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10277}10277     \textcolor{comment}{// If we have a non-\/default handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10278}10278     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}} != \mbox{\hyperlink{classoomph_1_1Problem_ae0cebe288c8daddd9663bd10d8f1caa0}{Default\_assembly\_handler\_pt}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10279}10279     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10280}10280       \textcolor{comment}{// Delete the current assembly handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10281}10281       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10282}10282       \textcolor{comment}{// Reset the assembly handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10283}10283       \mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}} = \mbox{\hyperlink{classoomph_1_1Problem_ae0cebe288c8daddd9663bd10d8f1caa0}{Default\_assembly\_handler\_pt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10284}10284     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10285}10285   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10286}10286 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10287}10287   \textcolor{comment}{//===================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10288}10288 \textcolor{comment}{  /// This function takes one step of length ds in pseudo-\/arclength.The}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10289}10289 \textcolor{comment}{  /// argument parameter\_pt is a pointer to the parameter (global variable)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10290}10290 \textcolor{comment}{  /// that is being traded for arc-\/length. The function returns the next desired}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10291}10291 \textcolor{comment}{  /// arc-\/length according to criteria based upon the desired number of Newton}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10292}10292 \textcolor{comment}{  /// Iterations per solve.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10293}10293 \textcolor{comment}{}  \textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10294}\mbox{\hyperlink{classoomph_1_1Problem_ad8414efbd8099d3e6cf3f4daea06cc8f}{10294}}   \textcolor{keywordtype}{double} \mbox{\hyperlink{classoomph_1_1Problem_ad8414efbd8099d3e6cf3f4daea06cc8f}{Problem::arc\_length\_step\_solve}}(\textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10295}10295                                         \textcolor{keyword}{const} \textcolor{keywordtype}{double}\& ds,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10296}10296                                         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& max\_adapt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10297}10297   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10298}10298     \textcolor{comment}{// First check that we shouldn't use the other interface}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10299}10299     \textcolor{comment}{// by checking that the parameter isn't already stored as data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10300}10300     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_af7a83b109e7662abd52ea552d89163cc}{does\_pointer\_correspond\_to\_problem\_data}}(parameter\_pt))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10301}10301     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10302}10302       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10303}10303       error\_message}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10304}10304         << \textcolor{stringliteral}{"{}The parameter addressed by "{}} << parameter\_pt << \textcolor{stringliteral}{"{} with the value "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10305}10305         << *parameter\_pt}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10306}10306         << \textcolor{stringliteral}{"{}\(\backslash\)n is supposed to be used for arc-\/length contiunation,\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10307}10307         << \textcolor{stringliteral}{"{} but it is stored in a Data object used by the problem.\(\backslash\)n\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10308}10308         << \textcolor{stringliteral}{"{}This is bad for two reasons:\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10309}10309         << \textcolor{stringliteral}{"{}1. If it's a variable in the problem, it must already have an\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10310}10310            \textcolor{stringliteral}{"{}associated equation, so it can't be used for continuation;\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10311}10311         << \textcolor{stringliteral}{"{}2. The problem data will be reorganised in memory during "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10312}10312            \textcolor{stringliteral}{"{}continuation,\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10313}10313         << \textcolor{stringliteral}{"{}   which means that the pointer will become invalid.\(\backslash\)n\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10314}10314         << \textcolor{stringliteral}{"{}If you are sure that this is what you want to do you must:\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10315}10315         << \textcolor{stringliteral}{"{}A. Ensure that the value is pinned (don't worry we'll shout again "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10316}10316            \textcolor{stringliteral}{"{}if not)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10317}10317         << \textcolor{stringliteral}{"{}B. Use the alternative interface\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10318}10318         << \textcolor{stringliteral}{"{}   Problem::arc\_length\_step\_solve(Data*,unsigned,...)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10319}10319         << \textcolor{stringliteral}{"{}   which uses a pointer to the data object and not the raw double "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10320}10320            \textcolor{stringliteral}{"{}pointer."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10321}10321         << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10322}10322       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10323}10323         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10324}10324     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10325}10325 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10326}10326 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10327}10327     \textcolor{comment}{// If we are using the continuation timestepper}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10328}10328     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_adbecce0cb1bd7b6b21285568e41ee3eb}{Use\_continuation\_timestepper}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10329}10329     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10330}10330       \textcolor{comment}{// Has the timestepper already been added to the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10331}10331       \textcolor{keywordtype}{bool} continuation\_time\_stepper\_added = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10332}10332       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_time\_steppers = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ace3cdf55009c3bff21d2b7d3706d522a}{ntime\_stepper}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10333}10333       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_time\_steppers; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10334}10334       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10335}10335         \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) == \&\mbox{\hyperlink{classoomph_1_1Problem_ade29c0a82218d50136b4b3860055ad30}{Continuation\_time\_stepper}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10336}10336         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10337}10337           continuation\_time\_stepper\_added = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10338}10338           \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10339}10339         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10340}10340       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10341}10341 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10342}10342       \textcolor{comment}{// If not add it}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10343}10343       \textcolor{keywordflow}{if} (!continuation\_time\_stepper\_added)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10344}10344       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10345}10345         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Adding the continuation time stepper\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10346}10346         this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a8856eae2daa9cea05e99bfcd4ef340a4}{add\_time\_stepper\_pt}}(\&\mbox{\hyperlink{classoomph_1_1Problem_ade29c0a82218d50136b4b3860055ad30}{Continuation\_time\_stepper}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10347}10347       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10348}10348 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10349}10349       \textcolor{comment}{// Need to treat case of eigenproblems and bifurcation detection/tracking}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10350}10350       \textcolor{comment}{// here}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10351}10351 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10352}10352       \textcolor{comment}{// Backup the current timesteppers for each mesh!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10353}10353 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10354}10354 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10355}10355       \textcolor{comment}{// If an arc length step has not been taken then set the timestepper}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10356}10356       \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_a8109bf56e9203d248ae30a50bb9cfe90}{Arc\_length\_step\_taken}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10357}10357       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10358}10358         \textcolor{comment}{// Set the continuation timestepper for all data in the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10359}10359         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a7be66e9917b39eaea90b91389f5a72fb}{set\_timestepper\_for\_all\_data}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10360}10360                         \&\mbox{\hyperlink{classoomph_1_1Problem_ade29c0a82218d50136b4b3860055ad30}{Continuation\_time\_stepper}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10361}10361                    << \textcolor{stringliteral}{"{} equation numbers allocated for continuation\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10362}10362       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10363}10363 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10364}10364     \} \textcolor{comment}{// End of continuation time stepper case}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10365}10365 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10366}10366 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10367}10367     \textcolor{comment}{// Just call the helper function (parameter is not from data)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10368}10368     \textcolor{keywordflow}{return} \mbox{\hyperlink{classoomph_1_1Problem_afaa9689a9c73bb76caea5d24980e6788}{arc\_length\_step\_solve\_helper}}(parameter\_pt, ds, max\_adapt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10369}10369   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10370}10370 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10371}10371 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10372}10372   \textcolor{comment}{//===================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10373}10373 \textcolor{comment}{  /// This function takes one step of length ds in pseudo-\/arclength.The}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10374}10374 \textcolor{comment}{  /// argument data\_pt is a pointer to the data that holds the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10375}10375 \textcolor{comment}{  /// parameter (global variable)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10376}10376 \textcolor{comment}{  /// that is being traded for arc-\/length. The exact value is located at}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10377}10377 \textcolor{comment}{  /// the location given by data\_index.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10378}10378 \textcolor{comment}{  /// The function returns the next desired}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10379}10379 \textcolor{comment}{  /// arc-\/length according to criteria based upon the desired number of Newton}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10380}10380 \textcolor{comment}{  /// Iterations per solve.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10381}10381 \textcolor{comment}{}  \textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10382}\mbox{\hyperlink{classoomph_1_1Problem_aefb723728ed26abe410b61ec38d42688}{10382}}   \textcolor{keywordtype}{double} \mbox{\hyperlink{classoomph_1_1Problem_ad8414efbd8099d3e6cf3f4daea06cc8f}{Problem::arc\_length\_step\_solve}}(\mbox{\hyperlink{classoomph_1_1Data}{Data}}* \textcolor{keyword}{const}\& data\_pt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10383}10383                                         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& data\_index,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10384}10384                                         \textcolor{keyword}{const} \textcolor{keywordtype}{double}\& ds,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10385}10385                                         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& max\_adapt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10386}10386   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10387}10387     \textcolor{comment}{// Firstly check that the data is pinned}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10388}10388     \textcolor{keywordflow}{if} (!data\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_aedd0c445396ddcd650c814d17fef77dc}{is\_pinned}}(data\_index))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10389}10389     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10390}10390       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10391}10391       error\_stream << \textcolor{stringliteral}{"{}The value at index "{}} << data\_index}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10392}10392                    << \textcolor{stringliteral}{"{} in the data object to be used for continuation\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10393}10393                    << \textcolor{stringliteral}{"{}is not pinned, which means that it is already a\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10394}10394                    << \textcolor{stringliteral}{"{}variable in the problem "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10395}10395                    << \textcolor{stringliteral}{"{}and cannot be used for continuation.\(\backslash\)n\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10396}10396                    << \textcolor{stringliteral}{"{}Please correct your formulation by either:\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10397}10397                    << \textcolor{stringliteral}{"{}A. Pinning the value"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10398}10398                    << \textcolor{stringliteral}{"{}\(\backslash\)n or \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10399}10399                    << \textcolor{stringliteral}{"{}B. Using a different parameter for continuation"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10400}10400                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10401}10401       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10402}10402         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10403}10403     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10404}10404 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10405}10405 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10406}10406     \textcolor{comment}{// If we are using the continuation timestepper}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10407}10407     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_adbecce0cb1bd7b6b21285568e41ee3eb}{Use\_continuation\_timestepper}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10408}10408     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10409}10409       \textcolor{comment}{// Has the timestepper already been added to the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10410}10410       \textcolor{keywordtype}{bool} continuation\_time\_stepper\_added = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10411}10411       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_time\_steppers = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ace3cdf55009c3bff21d2b7d3706d522a}{ntime\_stepper}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10412}10412       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_time\_steppers; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10413}10413       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10414}10414         \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) == \&\mbox{\hyperlink{classoomph_1_1Problem_ade29c0a82218d50136b4b3860055ad30}{Continuation\_time\_stepper}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10415}10415         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10416}10416           continuation\_time\_stepper\_added = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10417}10417           \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10418}10418         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10419}10419       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10420}10420 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10421}10421       \textcolor{comment}{// If not add it}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10422}10422       \textcolor{keywordflow}{if} (!continuation\_time\_stepper\_added)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10423}10423       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10424}10424         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Adding the continuation time stepper\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10425}10425         this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a8856eae2daa9cea05e99bfcd4ef340a4}{add\_time\_stepper\_pt}}(\&\mbox{\hyperlink{classoomph_1_1Problem_ade29c0a82218d50136b4b3860055ad30}{Continuation\_time\_stepper}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10426}10426       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10427}10427 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10428}10428       \textcolor{comment}{// Need to treat case of eigenproblems and bifurcation detection/tracking}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10429}10429       \textcolor{comment}{// here}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10430}10430 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10431}10431 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10432}10432       \textcolor{comment}{// Backup the current timesteppers for each mesh!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10433}10433 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10434}10434 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10435}10435       \textcolor{comment}{// If an arc length step has not been taken then set the timestepper}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10436}10436       \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_a8109bf56e9203d248ae30a50bb9cfe90}{Arc\_length\_step\_taken}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10437}10437       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10438}10438         \textcolor{comment}{// Set the continuation timestepper for all data in the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10439}10439         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a7be66e9917b39eaea90b91389f5a72fb}{set\_timestepper\_for\_all\_data}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10440}10440                         \&\mbox{\hyperlink{classoomph_1_1Problem_ade29c0a82218d50136b4b3860055ad30}{Continuation\_time\_stepper}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10441}10441                    << \textcolor{stringliteral}{"{} equation numbers allocated for continuation\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10442}10442       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10443}10443 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10444}10444 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10445}10445     \} \textcolor{comment}{// End of continuation time stepper case}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10446}10446 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10447}10447 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10448}10448     \textcolor{comment}{// Now make a pointer to the (newly allocated) data object}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10449}10449     \textcolor{keywordtype}{double}* parameter\_pt = data\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_af545f88ca20583f0c1b66e4da6076aa3}{value\_pt}}(data\_index);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10450}10450     \textcolor{comment}{// Call the helper function, this will change the parameter\_pt if}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10451}10451     \textcolor{comment}{// the data storage is changed (if the timestepper has to be changed,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10452}10452     \textcolor{comment}{// which happens if this is the first time that a continuation step is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10453}10453     \textcolor{comment}{// taken)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10454}10454     \textcolor{comment}{// ALH: Don't think this is true because it has happened above....}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10455}10455     \textcolor{keywordflow}{return} \mbox{\hyperlink{classoomph_1_1Problem_afaa9689a9c73bb76caea5d24980e6788}{arc\_length\_step\_solve\_helper}}(parameter\_pt, ds, max\_adapt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10456}10456   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10457}10457 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10458}10458   \textcolor{comment}{//======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10459}10459 \textcolor{comment}{  /// Private helper function that is used to set the appropriate}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10460}10460 \textcolor{comment}{  /// pinned values for continuation. If the data is pinned, the its}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10461}10461 \textcolor{comment}{  /// current value is always the same as the original value and}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10462}10462 \textcolor{comment}{  /// the derivative is always zero. If these are not set properly}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10463}10463 \textcolor{comment}{  /// then interpolation and projection in spatial adaptivity will}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10464}10464 \textcolor{comment}{  /// not give the best answers.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10465}10465 \textcolor{comment}{}  \textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10466}\mbox{\hyperlink{classoomph_1_1Problem_a9494223b38728ea186a68d6c70b7ebd4}{10466}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a9494223b38728ea186a68d6c70b7ebd4}{Problem::set\_consistent\_pinned\_values\_for\_continuation}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10467}10467   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10468}10468     \textcolor{comment}{// Set the consistent values for the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10469}10469     \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ac8d6a5dcf3af2df66625079975d84c19}{set\_consistent\_pinned\_values\_for\_continuation}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10470}10470       \&\mbox{\hyperlink{classoomph_1_1Problem_ade29c0a82218d50136b4b3860055ad30}{Continuation\_time\_stepper}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10471}10471 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10472}10472     \textcolor{comment}{// Deal with the spine meshes additional numbering separately}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10473}10473     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_sub\_mesh = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10474}10474     \textcolor{comment}{// If there is only one mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10475}10475     \textcolor{keywordflow}{if} (n\_sub\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10476}10476     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10477}10477       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1SpineMesh}{SpineMesh}}* \textcolor{keyword}{const} spine\_mesh\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SpineMesh}{SpineMesh}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10478}10478       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10479}10479         spine\_mesh\_pt-\/>set\_consistent\_pinned\_spine\_values\_for\_continuation(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10480}10480           \&\mbox{\hyperlink{classoomph_1_1Problem_ade29c0a82218d50136b4b3860055ad30}{Continuation\_time\_stepper}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10481}10481       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10482}10482       \textcolor{comment}{// If it's a triangle mesh the we need to set the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10483}10483     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10484}10484     \textcolor{comment}{// Otherwise loop over the sub meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10485}10485     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10486}10486     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10487}10487       \textcolor{comment}{// Assign global equation numbers first}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10488}10488       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_sub\_mesh; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10489}10489       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10490}10490         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1SpineMesh}{SpineMesh}}* \textcolor{keyword}{const} spine\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10491}10491               \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SpineMesh}{SpineMesh}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ab65f6fc9c49860e6324457a7e6e76346}{Sub\_mesh\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10492}10492         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10493}10493           spine\_mesh\_pt-\/>set\_consistent\_pinned\_spine\_values\_for\_continuation(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10494}10494             \&\mbox{\hyperlink{classoomph_1_1Problem_ade29c0a82218d50136b4b3860055ad30}{Continuation\_time\_stepper}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10495}10495         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10496}10496       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10497}10497     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10498}10498 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10499}10499     \textcolor{comment}{// Also set time stepper for global data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10500}10500     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_global = \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10501}10501     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_global; ++\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10502}10502     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10503}10503       \mbox{\hyperlink{classoomph_1_1Problem_ade29c0a82218d50136b4b3860055ad30}{Continuation\_time\_stepper}}.\mbox{\hyperlink{classoomph_1_1ContinuationStorageScheme_a279e4c16176c0374b9bba05519a17b0c}{set\_consistent\_pinned\_values}}(\mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10504}10504     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10505}10505   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10506}10506 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10507}10507 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10508}10508   \textcolor{comment}{//===================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10509}10509 \textcolor{comment}{  /// This function takes one step of length ds in pseudo-\/arclength.The}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10510}10510 \textcolor{comment}{  /// argument parameter\_pt is a pointer to the parameter (global variable)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10511}10511 \textcolor{comment}{  /// that is being traded for arc-\/length. The function returns the next desired}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10512}10512 \textcolor{comment}{  /// arc-\/length according to criteria based upon the desired number of Newton}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10513}10513 \textcolor{comment}{  /// Iterations per solve.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10514}10514 \textcolor{comment}{}  \textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10515}\mbox{\hyperlink{classoomph_1_1Problem_afaa9689a9c73bb76caea5d24980e6788}{10515}}   \textcolor{keywordtype}{double} \mbox{\hyperlink{classoomph_1_1Problem_afaa9689a9c73bb76caea5d24980e6788}{Problem::arc\_length\_step\_solve\_helper}}(\textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10516}10516                                                \textcolor{keyword}{const} \textcolor{keywordtype}{double}\& ds,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10517}10517                                                \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& max\_adapt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10518}10518   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10519}10519     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/MAKE THE PROBLEM STEADY-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10520}10520     \textcolor{comment}{// Loop over the timesteppers and make them (temporarily) steady.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10521}10521     \textcolor{comment}{// We can only do continuation for steady problems!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10522}10522     \textcolor{keywordtype}{unsigned} n\_time\_steppers = \mbox{\hyperlink{classoomph_1_1Problem_ace3cdf55009c3bff21d2b7d3706d522a}{ntime\_stepper}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10523}10523     \textcolor{comment}{// Vector of bools to store the is\_steady status of the various}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10524}10524     \textcolor{comment}{// timesteppers when we came in here}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10525}10525     std::vector<bool> was\_steady(n\_time\_steppers);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10526}10526 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10527}10527     \textcolor{comment}{// Loop over them all and make them (temporarily) static}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10528}10528     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_time\_steppers; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10529}10529     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10530}10530       was\_steady[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_ad341ba9e80265e1c26c1cda0f40c8292}{is\_steady}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10531}10531       \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_a81ea0ff2e66cef5e0184b616c608e418}{make\_steady}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10532}10532     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10533}10533 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10534}10534 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10535}10535     \textcolor{comment}{// Max number of solves}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10536}10536     \textcolor{keywordtype}{unsigned} max\_solve = max\_adapt + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10537}10537     \textcolor{comment}{// Storage for newton steps in each adaptation}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10538}10538     \textcolor{keywordtype}{unsigned} max\_count\_in\_adapt\_loop = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10539}10539 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10540}10540 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10541}10541     \textcolor{comment}{//-\/-\/-\/-\/SET UP MEMORY FOR QUANTITIES THAT ARE REQUIRED OUTSIDE THE LOOP-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10542}10542 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10543}10543     \textcolor{comment}{// Assign memory for solutions of the equations Jz = du/dparameter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10544}10544     \textcolor{comment}{// This is needed here (outside the loop), so that we can save on}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10545}10545     \textcolor{comment}{// one linear solve when calculating the derivatives wrt the arc-\/length}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10546}10546     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} z;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10547}10547 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10548}10548 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10549}10549     \textcolor{comment}{// Store sign of the Jacobian, used for bifurcation detection}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10550}10550     \textcolor{comment}{// If this is the first time that we are calling the arc-\/length solver,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10551}10551     \textcolor{comment}{// this should not be used.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10552}10552     \textcolor{keywordtype}{int} previous\_sign = \mbox{\hyperlink{classoomph_1_1Problem_aca97d61840e46edc914e3cb4b98fd437}{Sign\_of\_jacobian}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10553}10553 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10554}10554     \textcolor{comment}{// Flag to indicate a sign change}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10555}10555     \textcolor{keywordtype}{bool} SIGN\_CHANGE = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10556}10556 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10557}10557 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10558}10558     \textcolor{comment}{// Adaptation loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10559}10559     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} isolve = 0; isolve < max\_solve; ++isolve)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10560}10560     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10561}10561       \textcolor{comment}{// Only adapt after the first solve has been done}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10562}10562       \textcolor{keywordflow}{if} (isolve > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10563}10563       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10564}10564         \textcolor{keywordtype}{unsigned} n\_refined;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10565}10565         \textcolor{keywordtype}{unsigned} n\_unrefined;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10566}10566 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10567}10567         \textcolor{comment}{// Adapt problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10568}10568         \mbox{\hyperlink{classoomph_1_1Problem_a0b9e09ddfa2411f14fc723c3207decd1}{adapt}}(n\_refined, n\_unrefined);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10569}10569 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10570}10570 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10571}10571         \textcolor{comment}{// Adaptation only converges if ALL the processes have no}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10572}10572         \textcolor{comment}{// refinement or unrefinement to perform}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10573}10573         \textcolor{keywordtype}{unsigned} total\_refined = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10574}10574         \textcolor{keywordtype}{unsigned} total\_unrefined = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10575}10575         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10576}10576         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10577}10577           MPI\_Allreduce(\&n\_refined,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10578}10578                         \&total\_refined,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10579}10579                         1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10580}10580                         MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10581}10581                         MPI\_SUM,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10582}10582                         this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10583}10583           n\_refined = total\_refined;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10584}10584           MPI\_Allreduce(\&n\_unrefined,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10585}10585                         \&total\_unrefined,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10586}10586                         1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10587}10587                         MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10588}10588                         MPI\_SUM,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10589}10589                         this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10590}10590           n\_unrefined = total\_unrefined;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10591}10591         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10592}10592 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10593}10593 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10594}10594         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}-\/-\/-\/> "{}} << n\_refined << \textcolor{stringliteral}{"{} elements were refined, and "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10595}10595                    << n\_unrefined << \textcolor{stringliteral}{"{} were unrefined"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10596}10596 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10597}10597                    << \textcolor{stringliteral}{"{}, in total (over all processors).\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10598}10598 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10599}10599                    << \textcolor{stringliteral}{"{}.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10600}10600 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10601}10601 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10602}10602 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10603}10603         \textcolor{comment}{// Check convergence of adaptation cycle}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10604}10604         \textcolor{keywordflow}{if} ((n\_refined == 0) \&\& (n\_unrefined == 0))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10605}10605         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10606}10606           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)n \(\backslash\)n Solution is fully converged in "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10607}10607                      << \textcolor{stringliteral}{"{}Problem::newton\_solver(). \(\backslash\)n \(\backslash\)n "{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10608}10608           \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10609}10609         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10610}10610       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10611}10611 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10612}10612       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/SAVE THE INITIAL VALUES, IN CASE THE STEP FAILS-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10613}10613 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10614}10614       \textcolor{comment}{// Find the number of local dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10615}10615       \textcolor{keywordtype}{unsigned} ndof\_local = \mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10616}10616 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10617}10617       \textcolor{comment}{// Only need to do this in the first loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10618}10618       \textcolor{keywordflow}{if} (isolve == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10619}10619       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10620}10620         \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_adbecce0cb1bd7b6b21285568e41ee3eb}{Use\_continuation\_timestepper}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10621}10621         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10622}10622           \textcolor{comment}{// Safety check, set up the array of dof derivatives, if necessary}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10623}10623           \textcolor{comment}{// The distribution is the same as the (natural) distribution of the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10624}10624           \textcolor{comment}{// dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10625}10625           \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a1861321b2d129707935bf1191238daca}{Dof\_derivative}}.size() != ndof\_local)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10626}10626           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10627}10627             \mbox{\hyperlink{classoomph_1_1Problem_a1861321b2d129707935bf1191238daca}{Dof\_derivative}}.resize(ndof\_local, 0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10628}10628           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10629}10629 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10630}10630           \textcolor{comment}{// Safety check, set up the array of curren values, if necessary}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10631}10631           \textcolor{comment}{// Again the distribution reflects the (natural) distribution of the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10632}10632           \textcolor{comment}{// dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10633}10633           \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a366b50c490e9fd3ddafa05b2fbd0b883}{Dof\_current}}.size() != ndof\_local)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10634}10634           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10635}10635             \mbox{\hyperlink{classoomph_1_1Problem_a366b50c490e9fd3ddafa05b2fbd0b883}{Dof\_current}}.resize(ndof\_local);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10636}10636           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10637}10637         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10638}10638 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10639}10639         \textcolor{comment}{// Save the current value of the parameter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10640}10640         \mbox{\hyperlink{classoomph_1_1Problem_a8e29673eb80559888d1c6148c4f11e57}{Parameter\_current}} = *parameter\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10641}10641 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10642}10642         \textcolor{comment}{// Save the current values of the degrees of freedom}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10643}10643         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} l = 0; l < ndof\_local; l++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10644}10644         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10645}10645           \mbox{\hyperlink{classoomph_1_1Problem_a187fca413da164551f4d3344c7baf861}{dof\_current}}(l) = *\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[l];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10646}10646         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10647}10647 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10648}10648         \textcolor{comment}{// Set the value of ds\_current}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10649}10649         \mbox{\hyperlink{classoomph_1_1Problem_ad412d49617d0b0998e5eb440c7a20f3f}{Ds\_current}} = ds;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10650}10650       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10651}10651 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10652}10652       \textcolor{comment}{// Counter for the number of newton steps}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10653}10653       \textcolor{keywordtype}{unsigned} count = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10654}10654 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10655}10655       \textcolor{comment}{// Flag to indicate a successful step}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10656}10656       \textcolor{keywordtype}{bool} STEP\_REJECTED = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10657}10657 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10658}10658 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10659}10659       \textcolor{comment}{// Set the appropriate initial conditions for the pinned data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10660}10660       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_adbecce0cb1bd7b6b21285568e41ee3eb}{Use\_continuation\_timestepper}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10661}10661       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10662}10662         this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a9494223b38728ea186a68d6c70b7ebd4}{set\_consistent\_pinned\_values\_for\_continuation}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10663}10663       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10664}10664 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10665}10665       \textcolor{comment}{// Loop around the step in arc-\/length}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10666}10666       \textcolor{keywordflow}{do}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10667}10667       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10668}10668         \textcolor{comment}{// Check that the step has not fallen below the minimum tolerance}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10669}10669         \textcolor{keywordflow}{if} (std::fabs(\mbox{\hyperlink{classoomph_1_1Problem_ad412d49617d0b0998e5eb440c7a20f3f}{Ds\_current}}) < \mbox{\hyperlink{classoomph_1_1Problem_ad0f8bb126a4f5ddeb559c23a8d451d8d}{Minimum\_ds}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10670}10670         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10671}10671           std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10672}10672           error\_message << \textcolor{stringliteral}{"{}DESIRED ARC-\/LENGTH STEP "{}} << \mbox{\hyperlink{classoomph_1_1Problem_ad412d49617d0b0998e5eb440c7a20f3f}{Ds\_current}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10673}10673                         << \textcolor{stringliteral}{"{} HAS FALLEN BELOW MINIMUM TOLERANCE, "{}} << \mbox{\hyperlink{classoomph_1_1Problem_ad0f8bb126a4f5ddeb559c23a8d451d8d}{Minimum\_ds}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10674}10674                         << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10675}10675 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10676}10676           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10677}10677                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10678}10678                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10679}10679         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10680}10680 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10681}10681         \textcolor{comment}{// Assume that we shall accept the step}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10682}10682         STEP\_REJECTED = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10683}10683 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10684}10684         \textcolor{comment}{// Set initial value of the parameter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10685}10685         *parameter\_pt = \mbox{\hyperlink{classoomph_1_1Problem_a8e29673eb80559888d1c6148c4f11e57}{Parameter\_current}} + \mbox{\hyperlink{classoomph_1_1Problem_aa5082325ca4cafe5a9ec03ef79c67a6f}{Parameter\_derivative}} * \mbox{\hyperlink{classoomph_1_1Problem_ad412d49617d0b0998e5eb440c7a20f3f}{Ds\_current}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10686}10686 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10687}10687         \textcolor{comment}{// Perform any actions...}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10688}10688         \mbox{\hyperlink{classoomph_1_1Problem_a54e18ddf6073f9debd478f6b21a717de}{actions\_after\_parameter\_increase}}(parameter\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10689}10689 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10690}10690         \mbox{\hyperlink{classoomph_1_1Problem_ad412d49617d0b0998e5eb440c7a20f3f}{Ds\_current}} = (*parameter\_pt -\/ \mbox{\hyperlink{classoomph_1_1Problem_a8e29673eb80559888d1c6148c4f11e57}{Parameter\_current}}) / \mbox{\hyperlink{classoomph_1_1Problem_aa5082325ca4cafe5a9ec03ef79c67a6f}{Parameter\_derivative}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10691}10691 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10692}10692         \textcolor{comment}{// Loop over the (local) variables and set their initial values}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10693}10693         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} l = 0; l < ndof\_local; l++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10694}10694         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10695}10695           *\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[l] = \mbox{\hyperlink{classoomph_1_1Problem_a187fca413da164551f4d3344c7baf861}{dof\_current}}(l) + \mbox{\hyperlink{classoomph_1_1Problem_a5aa9936836b7e342c61ac0daba155ec5}{dof\_derivative}}(l) * \mbox{\hyperlink{classoomph_1_1Problem_ad412d49617d0b0998e5eb440c7a20f3f}{Ds\_current}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10696}10696         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10697}10697 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10698}10698         \textcolor{comment}{// Actually do the newton solve stage for the continuation problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10699}10699         \textcolor{keywordflow}{try}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10700}10700         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10701}10701           count = \mbox{\hyperlink{classoomph_1_1Problem_aea0efdeb4814de433fa2ffb3065831ce}{newton\_solve\_continuation}}(parameter\_pt, z);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10702}10702         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10703}10703         \textcolor{comment}{// Catch any exceptions thrown in the Newton solver}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10704}10704         \textcolor{keywordflow}{catch} (\mbox{\hyperlink{classoomph_1_1NewtonSolverError}{NewtonSolverError}}\& error)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10705}10705         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10706}10706           \textcolor{comment}{// Check whether it's the linear solver}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10707}10707           \textcolor{keywordflow}{if} (error.\mbox{\hyperlink{classoomph_1_1NewtonSolverError_a30a00b1e2e2baaf733f6197572399875}{linear\_solver\_error}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10708}10708           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10709}10709             std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10710}10710             error\_stream << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10711}10711                          << \textcolor{stringliteral}{"{}USER-\/DEFINED ERROR IN NEWTON SOLVER "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10712}10712             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}ERROR IN THE LINEAR SOLVER"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10713}10713             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10714}10714                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10715}10715                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10716}10716           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10717}10717           \textcolor{comment}{// Otherwise mark the step as having failed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10718}10718           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10719}10719           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10720}10720             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}STEP REJECTED -\/-\/-\/ TRYING AGAIN"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10721}10721             STEP\_REJECTED = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10722}10722             \textcolor{comment}{// Let's take a smaller step}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10723}10723             \mbox{\hyperlink{classoomph_1_1Problem_ad412d49617d0b0998e5eb440c7a20f3f}{Ds\_current}} *= (2.0 / 3.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10724}10724           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10725}10725         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10726}10726       \} \textcolor{keywordflow}{while} (STEP\_REJECTED); \textcolor{comment}{// continue until a step is accepted}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10727}10727 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10728}10728       \textcolor{comment}{// Set the maximum count}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10729}10729       \textcolor{keywordflow}{if} (count > max\_count\_in\_adapt\_loop)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10730}10730       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10731}10731         max\_count\_in\_adapt\_loop = count;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10732}10732       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10733}10733     \} \textcolor{comment}{/// end of adaptation loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10734}10734 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10735}10735     \textcolor{comment}{// Only recalculate the derivatives if there has been a Newton solve}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10736}10736     \textcolor{comment}{// If not, the previous values should be close enough}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10737}10737     \textcolor{keywordflow}{if} (max\_count\_in\_adapt\_loop > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10738}10738     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10739}10739       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/CHECK FOR POTENTIAL BIFURCATIONS-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10740}10740       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a08dfc704030bb65cea3d9784c5271af0}{Bifurcation\_detection}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10741}10741       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10742}10742         \textcolor{comment}{// If the sign of the jacobian is zero issue a warning}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10743}10743         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aca97d61840e46edc914e3cb4b98fd437}{Sign\_of\_jacobian}} == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10744}10744         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10745}10745           \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} error\_message =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10746}10746             \textcolor{stringliteral}{"{}The sign of the jacobian is zero after a linear solve\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10747}10747           error\_message += \textcolor{stringliteral}{"{}Either the matrix is singular (unlikely),\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10748}10748           error\_message += \textcolor{stringliteral}{"{}or the linear solver cannot compute the "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10749}10749                            \textcolor{stringliteral}{"{}determinant of the matrix;\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10750}10750           error\_message += \textcolor{stringliteral}{"{}e.g. an iterative linear solver.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10751}10751           error\_message +=}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10752}10752             \textcolor{stringliteral}{"{}If the latter, bifurcation detection must be via an eigensolver\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10753}10753           \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(error\_message,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10754}10754                           \textcolor{stringliteral}{"{}Problem::arc\_length\_step\_solve"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10755}10755                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10756}10756         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10757}10757         \textcolor{comment}{// If this is the first step, we cannot rely on the previous value}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10758}10758         \textcolor{comment}{// of the jacobian so set the previous sign to the present sign}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10759}10759         \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_a8109bf56e9203d248ae30a50bb9cfe90}{Arc\_length\_step\_taken}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10760}10760         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10761}10761           previous\_sign = \mbox{\hyperlink{classoomph_1_1Problem_aca97d61840e46edc914e3cb4b98fd437}{Sign\_of\_jacobian}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10762}10762         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10763}10763         \textcolor{comment}{// If we have detected a sign change in the last converged Jacobian,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10764}10764         \textcolor{comment}{// it must be a turning point or bifurcation}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10765}10765         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aca97d61840e46edc914e3cb4b98fd437}{Sign\_of\_jacobian}} != previous\_sign)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10766}10766         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10767}10767           \textcolor{comment}{// There has been, at least, one sign change}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10768}10768           \mbox{\hyperlink{classoomph_1_1Problem_a643f61299463a3bbf7be3f6a112aa130}{First\_jacobian\_sign\_change}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10769}10769 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10770}10770           \textcolor{comment}{// The sign has changed this time}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10771}10771           SIGN\_CHANGE = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10772}10772 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10773}10773           \textcolor{comment}{// Calculate the dot product of the approximate null vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10774}10774           \textcolor{comment}{// of the Jacobian matrix ((badly) approximated by z)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10775}10775           \textcolor{comment}{// and the vectors of derivatives of the residuals wrt the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10776}10776           \textcolor{comment}{// global parameter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10777}10777           \textcolor{comment}{// If this is small it is a bifurcation rather than a turning point.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10778}10778           \textcolor{comment}{// Get the derivative wrt global parameter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10779}10779           \textcolor{comment}{// DoubleVector dparam;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10780}10780           \textcolor{comment}{// get\_derivative\_wrt\_global\_parameter(parameter\_pt,dparam);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10781}10781           \textcolor{comment}{// Calculate the dot product}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10782}10782           \textcolor{comment}{// double dot=0.0;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10783}10783           \textcolor{comment}{// for(unsigned long n=0;n<n\_dofs;++n) \{dot += dparam[n]*z[n];\}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10784}10784           \textcolor{comment}{// z.dot(dparam);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10785}10785 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10786}10786           \textcolor{comment}{// Write the output message}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10787}10787           std::ostringstream message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10788}10788           message}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10789}10789             << \textcolor{stringliteral}{"{}-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10790}10790           message << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10791}10791                   << \textcolor{stringliteral}{"{}SIGN CHANGE IN DETERMINANT OF JACOBIAN: "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10792}10792           message << \textcolor{stringliteral}{"{}BIFURCATION OR TURNING POINT DETECTED BETWEEN "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10793}10793                   << \mbox{\hyperlink{classoomph_1_1Problem_a8e29673eb80559888d1c6148c4f11e57}{Parameter\_current}} << \textcolor{stringliteral}{"{} AND "{}} << *parameter\_pt << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10794}10794           \textcolor{comment}{// message << "{}APPROXIMATE DOT PRODUCT : "{} << dot << "{},"{} << std::endl;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10795}10795           \textcolor{comment}{// message << "{}IF CLOSE TO ZERO WE HAVE A BIFURCATION; "{};}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10796}10796           \textcolor{comment}{// message << "{}OTHERWISE A TURNING POINT"{} << std::endl;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10797}10797           message}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10798}10798             << \textcolor{stringliteral}{"{}-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10799}10799             << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10800}10800 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10801}10801           \textcolor{comment}{// Write the message to standard output}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10802}10802           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << message.str();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10803}10803 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10804}10804           \textcolor{comment}{// Open the information file for appending}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10805}10805           std::ofstream bifurcation\_info(\textcolor{stringliteral}{"{}bifurcation\_info"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10806}10806                                          std::ios\_base::app);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10807}10807           \textcolor{comment}{// Write the message to the file}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10808}10808           bifurcation\_info << message.str();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10809}10809           bifurcation\_info.close();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10810}10810         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10811}10811       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10812}10812 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10813}10813       \textcolor{comment}{// Calculate the derivatives required for the next stage of continuation}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10814}10814       \textcolor{comment}{// In this we pass the last value of z (i.e. approximation)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10815}10815       \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_a80dac9f70c77302805bb782cc6f1ad0f}{Use\_finite\_differences\_for\_continuation\_derivatives}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10816}10816       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10817}10817         \mbox{\hyperlink{classoomph_1_1Problem_a58f16ae8f6da042d40fddf01ee3ebd31}{calculate\_continuation\_derivatives}}(z);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10818}10818       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10819}10819       \textcolor{comment}{// Or use finite differences}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10820}10820       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10821}10821       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10822}10822         \mbox{\hyperlink{classoomph_1_1Problem_addc838287129a35ef60e38ea854b939c}{calculate\_continuation\_derivatives\_fd}}(parameter\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10823}10823       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10824}10824 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10825}10825       \textcolor{comment}{// If it's the first step then the value of the next step should}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10826}10826       \textcolor{comment}{// be the change in parameter divided by the parameter derivative}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10827}10827       \textcolor{comment}{// to obtain approximately the same parameter change}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10828}10828       \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_a8109bf56e9203d248ae30a50bb9cfe90}{Arc\_length\_step\_taken}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10829}10829       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10830}10830         \mbox{\hyperlink{classoomph_1_1Problem_ad412d49617d0b0998e5eb440c7a20f3f}{Ds\_current}} = (*parameter\_pt -\/ \mbox{\hyperlink{classoomph_1_1Problem_a8e29673eb80559888d1c6148c4f11e57}{Parameter\_current}}) / \mbox{\hyperlink{classoomph_1_1Problem_aa5082325ca4cafe5a9ec03ef79c67a6f}{Parameter\_derivative}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10831}10831       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10832}10832 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10833}10833       \textcolor{comment}{// We have taken our first step}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10834}10834       \mbox{\hyperlink{classoomph_1_1Problem_a8109bf56e9203d248ae30a50bb9cfe90}{Arc\_length\_step\_taken}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10835}10835     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10836}10836     \textcolor{comment}{// If there has not been a newton step then we still need to estimate}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10837}10837     \textcolor{comment}{// the derivatives in the arc length direction}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10838}10838     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10839}10839     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10840}10840       \textcolor{comment}{// Default is to calculate the continuation derivatives by solving the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10841}10841       \textcolor{comment}{// linear system. We must do this to ensure that the derivatives are in}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10842}10842       \textcolor{comment}{// sync It could lead to problems near turning points when we should}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10843}10843       \textcolor{comment}{// really be solving an eigenproblem, but seems OK so far!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10844}10844 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10845}10845       \textcolor{comment}{// Save the current sign of the jacobian}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10846}10846       \textcolor{keywordtype}{int} temp\_sign = \mbox{\hyperlink{classoomph_1_1Problem_aca97d61840e46edc914e3cb4b98fd437}{Sign\_of\_jacobian}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10847}10847 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10848}10848       \textcolor{comment}{// Calculate the continuation derivatives, which includes a solve}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10849}10849       \textcolor{comment}{// of the linear system if not using finite differences}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10850}10850       \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_a80dac9f70c77302805bb782cc6f1ad0f}{Use\_finite\_differences\_for\_continuation\_derivatives}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10851}10851       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10852}10852         \mbox{\hyperlink{classoomph_1_1Problem_a58f16ae8f6da042d40fddf01ee3ebd31}{calculate\_continuation\_derivatives}}(parameter\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10853}10853       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10854}10854       \textcolor{comment}{// Otherwise use finite differences}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10855}10855       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10856}10856       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10857}10857         \mbox{\hyperlink{classoomph_1_1Problem_addc838287129a35ef60e38ea854b939c}{calculate\_continuation\_derivatives\_fd}}(parameter\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10858}10858       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10859}10859 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10860}10860       \textcolor{comment}{// Reset the sign of the jacobian, just in case the sign has changed when}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10861}10861       \textcolor{comment}{// solving the continuation derivatives. The sign change will be picked}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10862}10862       \textcolor{comment}{// up on the next continuation step.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10863}10863       \mbox{\hyperlink{classoomph_1_1Problem_aca97d61840e46edc914e3cb4b98fd437}{Sign\_of\_jacobian}} = temp\_sign;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10864}10864     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10865}10865 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10866}10866     \textcolor{comment}{// Reset the is\_steady status of all timesteppers that}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10867}10867     \textcolor{comment}{// weren't already steady when we came in here and reset their}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10868}10868     \textcolor{comment}{// weights}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10869}10869     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_time\_steppers; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10870}10870     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10871}10871       \textcolor{keywordflow}{if} (!was\_steady[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10872}10872       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10873}10873         \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_aada05f89e86aae352bd5b32bfb173b18}{undo\_make\_steady}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10874}10874       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10875}10875     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10876}10876 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10877}10877     \textcolor{comment}{// If we are trying to find a bifurcation and the first sign change}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10878}10878     \textcolor{comment}{// has occured, use bisection}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10879}10879     \textcolor{keywordflow}{if} ((\mbox{\hyperlink{classoomph_1_1Problem_a08dfc704030bb65cea3d9784c5271af0}{Bifurcation\_detection}}) \&\& (\mbox{\hyperlink{classoomph_1_1Problem_ab805e5e5fb94f941cc7ff1b850d83269}{Bisect\_to\_find\_bifurcation}}) \&\&}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10880}10880         (\mbox{\hyperlink{classoomph_1_1Problem_a643f61299463a3bbf7be3f6a112aa130}{First\_jacobian\_sign\_change}}))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10881}10881     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10882}10882       \textcolor{comment}{// If there has been a sign change we need to half the step size}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10883}10883       \textcolor{comment}{// and reverse the direction}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10884}10884       \textcolor{keywordflow}{if} (SIGN\_CHANGE)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10885}10885       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10886}10886         \mbox{\hyperlink{classoomph_1_1Problem_ad412d49617d0b0998e5eb440c7a20f3f}{Ds\_current}} *= -\/0.5;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10887}10887       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10888}10888       \textcolor{comment}{// Otherwise}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10889}10889       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10890}10890       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10891}10891         \textcolor{comment}{// The size of the bracketed interval is always}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10892}10892         \textcolor{comment}{// 2ds -\/ Ds\_current (this will work even if the original step failed)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10893}10893         \textcolor{comment}{// We want our new step size to be half this}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10894}10894         \mbox{\hyperlink{classoomph_1_1Problem_ad412d49617d0b0998e5eb440c7a20f3f}{Ds\_current}} = ds -\/ 0.5 * \mbox{\hyperlink{classoomph_1_1Problem_ad412d49617d0b0998e5eb440c7a20f3f}{Ds\_current}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10895}10895       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10896}10896       \textcolor{comment}{// Return the desired value of the step}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10897}10897       \textcolor{keywordflow}{return} \mbox{\hyperlink{classoomph_1_1Problem_ad412d49617d0b0998e5eb440c7a20f3f}{Ds\_current}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10898}10898     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10899}10899 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10900}10900     \textcolor{comment}{// If fewer than the desired number of Newton Iterations, increase the step}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10901}10901     \textcolor{keywordflow}{if} (max\_count\_in\_adapt\_loop < \mbox{\hyperlink{classoomph_1_1Problem_abfe8db162a0bda98add0062a45f41cbf}{Desired\_newton\_iterations\_ds}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10902}10902     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10903}10903       \textcolor{keywordflow}{return} \mbox{\hyperlink{classoomph_1_1Problem_ad412d49617d0b0998e5eb440c7a20f3f}{Ds\_current}} * 1.5;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10904}10904     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10905}10905     \textcolor{comment}{// If more than the desired number of Newton Iterations, reduce the step}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10906}10906     \textcolor{keywordflow}{if} (max\_count\_in\_adapt\_loop > \mbox{\hyperlink{classoomph_1_1Problem_abfe8db162a0bda98add0062a45f41cbf}{Desired\_newton\_iterations\_ds}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10907}10907     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10908}10908       \textcolor{keywordflow}{return} \mbox{\hyperlink{classoomph_1_1Problem_ad412d49617d0b0998e5eb440c7a20f3f}{Ds\_current}} * (2.0 / 3.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10909}10909     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10910}10910     \textcolor{comment}{// Otherwise return the step just taken}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10911}10911     \textcolor{keywordflow}{return} \mbox{\hyperlink{classoomph_1_1Problem_ad412d49617d0b0998e5eb440c7a20f3f}{Ds\_current}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10912}10912   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10913}10913 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10914}10914 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10915}10915   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10916}10916 \textcolor{comment}{  /// Take an explicit timestep of size dt}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10917}10917 \textcolor{comment}{}  \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10918}\mbox{\hyperlink{classoomph_1_1Problem_ab8b74c5b1499b2d712a8545cccbd97c2}{10918}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ab8b74c5b1499b2d712a8545cccbd97c2}{Problem::explicit\_timestep}}(\textcolor{keyword}{const} \textcolor{keywordtype}{double}\& dt, \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& shift\_values)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10919}10919   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10920}10920 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10921}10921     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ab69ae6020f1886e7b288180b6130b7ed}{explicit\_time\_stepper\_pt}}() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10922}10922     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10923}10923       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Explicit time stepper pointer is null in problem."{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10924}10924                           OOMPH\_EXCEPTION\_LOCATION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10925}10925                           OOMPH\_CURRENT\_FUNCTION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10926}10926     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10927}10927 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10928}10928 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10929}10929     \textcolor{comment}{// Firstly we shift the time values}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10930}10930     \textcolor{keywordflow}{if} (shift\_values)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10931}10931     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10932}10932       \mbox{\hyperlink{classoomph_1_1Problem_aab27bdd1968e57cb3dffe78c1d63f762}{shift\_time\_values}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10933}10933     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10934}10934     \textcolor{comment}{// Set the current value of dt, if we can}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10935}10935     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>ndt() > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10936}10936     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10937}10937       \mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_abd4c96948929a36a14a3ceaafa52bd42}{dt}}() = dt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10938}10938     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10939}10939 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10940}10940     \textcolor{comment}{// Take the explicit step}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10941}10941     this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ab69ae6020f1886e7b288180b6130b7ed}{explicit\_time\_stepper\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1ExplicitTimeStepper_ab43bbab17960d0f50b8842e996f5c765}{timestep}}(\textcolor{keyword}{this}, dt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10942}10942   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10943}10943 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10944}10944 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10945}10945   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10946}10946 \textcolor{comment}{  /// Do one timestep of size dt using Newton's method with the specified}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10947}10947 \textcolor{comment}{  /// tolerance and linear solver defined as member data of the Problem class.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10948}10948 \textcolor{comment}{  /// This will be the most commonly used version}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10949}10949 \textcolor{comment}{  /// of  unsteady\_newton\_solve, in which the time values are always shifted}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10950}10950 \textcolor{comment}{  /// This does not include any kind of adaptativity. If the solution fails to}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10951}10951 \textcolor{comment}{  /// converge the program will end.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10952}10952 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10953}\mbox{\hyperlink{classoomph_1_1Problem_aef22157aadc15a512cca93e4c423ff73}{10953}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_aef22157aadc15a512cca93e4c423ff73}{Problem::unsteady\_newton\_solve}}(\textcolor{keyword}{const} \textcolor{keywordtype}{double}\& dt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10954}10954   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10955}10955     \textcolor{comment}{// We shift the values, so shift\_values is true}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10956}10956     \mbox{\hyperlink{classoomph_1_1Problem_aef22157aadc15a512cca93e4c423ff73}{unsteady\_newton\_solve}}(dt, \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10957}10957   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10958}10958 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10959}10959   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10960}10960 \textcolor{comment}{  /// Do one timestep forward of size dt using Newton's method with the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10961}10961 \textcolor{comment}{  /// specified tolerance and linear solver defined via member data of the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10962}10962 \textcolor{comment}{  /// Problem class.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10963}10963 \textcolor{comment}{  /// The boolean flag shift\_values is used to control whether the time values}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10964}10964 \textcolor{comment}{  /// should be shifted or not.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10965}10965 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10966}\mbox{\hyperlink{classoomph_1_1Problem_abf8b8c9ee09df0ba8934382740a588de}{10966}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_aef22157aadc15a512cca93e4c423ff73}{Problem::unsteady\_newton\_solve}}(\textcolor{keyword}{const} \textcolor{keywordtype}{double}\& dt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10967}10967                                       \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& shift\_values)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10968}10968   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10969}10969     \textcolor{comment}{// Shift the time values and the dts, according to the control flag}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10970}10970     \textcolor{keywordflow}{if} (shift\_values)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10971}10971     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10972}10972       \mbox{\hyperlink{classoomph_1_1Problem_aab27bdd1968e57cb3dffe78c1d63f762}{shift\_time\_values}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10973}10973     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10974}10974 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10975}10975     \textcolor{comment}{// Advance global time and set current value of dt}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10976}10976     \mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_a43461269b799134f4b7a9aca3e79a7c8}{time}}() += dt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10977}10977     \mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_abd4c96948929a36a14a3ceaafa52bd42}{dt}}() = dt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10978}10978 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10979}10979     \textcolor{comment}{// Find out how many timesteppers there are}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10980}10980     \textcolor{keywordtype}{unsigned} n\_time\_steppers = \mbox{\hyperlink{classoomph_1_1Problem_ace3cdf55009c3bff21d2b7d3706d522a}{ntime\_stepper}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10981}10981 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10982}10982     \textcolor{comment}{// Loop over them all and set the weights}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10983}10983     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_time\_steppers; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10984}10984     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10985}10985       \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_a028fa3a8d3c6db6b0ddf580cb0468d55}{set\_weights}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10986}10986     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10987}10987 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10988}10988     \textcolor{comment}{// Run the individual timesteppers actions before timestep. These need to}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10989}10989     \textcolor{comment}{// be before the problem's actions\_before\_implicit\_timestep so that the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10990}10990     \textcolor{comment}{// boundary conditions are set consistently.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10991}10991     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_time\_steppers; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10992}10992     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10993}10993       \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_a36cbcee0c1127085ba3aa2331bfc0f74}{actions\_before\_timestep}}(\textcolor{keyword}{this});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10994}10994     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10995}10995 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10996}10996     \textcolor{comment}{// Now update anything that needs updating before the timestep}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10997}10997     \textcolor{comment}{// This could be time-\/dependent boundary conditions, for example.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10998}10998     \mbox{\hyperlink{classoomph_1_1Problem_a4f19896906d2c0274ad6798cd3ac38dc}{actions\_before\_implicit\_timestep}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l10999}10999 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11000}11000     \textcolor{keywordflow}{try}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11001}11001     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11002}11002       \textcolor{comment}{// Solve the non-\/linear problem for this timestep with Newton's method}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11003}11003       \mbox{\hyperlink{classoomph_1_1Problem_a62a989ae9a9169b9d905f844db59787f}{newton\_solve}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11004}11004     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11005}11005     \textcolor{comment}{// Catch any exceptions thrown in the Newton solver}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11006}11006     \textcolor{keywordflow}{catch} (\mbox{\hyperlink{classoomph_1_1NewtonSolverError}{NewtonSolverError}}\& error)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11007}11007     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11008}11008       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11009}11009                  << \textcolor{stringliteral}{"{}USER-\/DEFINED ERROR IN NEWTON SOLVER "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11010}11010       \textcolor{comment}{// Check whether it's the linear solver}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11011}11011       \textcolor{keywordflow}{if} (error.\mbox{\hyperlink{classoomph_1_1NewtonSolverError_a30a00b1e2e2baaf733f6197572399875}{linear\_solver\_error}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11012}11012       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11013}11013         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}ERROR IN THE LINEAR SOLVER"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11014}11014       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11015}11015       \textcolor{comment}{// Check to see whether we have reached Max\_iterations}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11016}11016       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (error.\mbox{\hyperlink{classoomph_1_1NewtonSolverError_aaae34aeb5b4128c87e03c89de1de60a8}{iterations}} == \mbox{\hyperlink{classoomph_1_1Problem_a52a58a98c3e2e7dbaefcfb1ee7830c35}{Max\_newton\_iterations}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11017}11017       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11018}11018         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}MAXIMUM NUMBER OF ITERATIONS ("{}} << error.\mbox{\hyperlink{classoomph_1_1NewtonSolverError_aaae34aeb5b4128c87e03c89de1de60a8}{iterations}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11019}11019                    << \textcolor{stringliteral}{"{}) REACHED WITHOUT CONVERGENCE "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11020}11020       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11021}11021       \textcolor{comment}{// If not, it must be that we have exceeded the maximum residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11022}11022       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11023}11023       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11024}11024         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}MAXIMUM RESIDUALS: "{}} << error.\mbox{\hyperlink{classoomph_1_1NewtonSolverError_ae9ee0ef969c2fbf869afb7c4a75dcbe0}{maxres}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11025}11025                    << \textcolor{stringliteral}{"{} EXCEEDS PREDEFINED MAXIMUM "{}} << \mbox{\hyperlink{classoomph_1_1Problem_accb8811cdf32f14be497917e922c623e}{Max\_residuals}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11026}11026                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11027}11027       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11028}11028       \textcolor{comment}{// Die horribly!!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11029}11029       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11030}11030       error\_stream << \textcolor{stringliteral}{"{}Error occured in unsteady Newton solver. "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11031}11031       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11032}11032         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11033}11033     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11034}11034 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11035}11035     \textcolor{comment}{// Run the individual timesteppers actions, these need to be before the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11036}11036     \textcolor{comment}{// problem's actions\_after\_implicit\_timestep so that the time step is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11037}11037     \textcolor{comment}{// finished before the problem does any auxiliary calculations (e.g. in}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11038}11038     \textcolor{comment}{// semi-\/implicit micromagnetics the calculation of magnetostatic field).}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11039}11039     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_time\_steppers; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11040}11040     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11041}11041       \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_a3a0fabf83f9bdc89800cd3501df2c586}{actions\_after\_timestep}}(\textcolor{keyword}{this});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11042}11042     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11043}11043 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11044}11044 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11045}11045     \textcolor{comment}{// Now update anything that needs updating after the timestep}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11046}11046     \mbox{\hyperlink{classoomph_1_1Problem_a012692496c968960f4ea27db4e89cc7d}{actions\_after\_implicit\_timestep}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11047}11047     \mbox{\hyperlink{classoomph_1_1Problem_a38d914a74e7998ddc74c205884d36d57}{actions\_after\_implicit\_timestep\_and\_error\_estimation}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11048}11048   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11049}11049 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11050}11050   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11051}11051 \textcolor{comment}{  /// Attempt to take one timestep forward using dt\_desired. The error control}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11052}11052 \textcolor{comment}{  /// parameter, epsilon, is used to specify the desired approximate value of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11053}11053 \textcolor{comment}{  /// the global error norm per timestep. The routine returns the value an}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11054}11054 \textcolor{comment}{  /// estimate of the next value of dt that should be taken.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11055}11055 \textcolor{comment}{}  \textcolor{comment}{//=======================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11056}\mbox{\hyperlink{classoomph_1_1Problem_abf6681f21f614ed7f15cc675ed6f692a}{11056}}   \textcolor{keywordtype}{double} \mbox{\hyperlink{classoomph_1_1Problem_abf6681f21f614ed7f15cc675ed6f692a}{Problem::adaptive\_unsteady\_newton\_solve}}(\textcolor{keyword}{const} \textcolor{keywordtype}{double}\& dt\_desired,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11057}11057                                                  \textcolor{keyword}{const} \textcolor{keywordtype}{double}\& epsilon)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11058}11058   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11059}11059     \textcolor{comment}{// We always want to shift the time values}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11060}11060     \textcolor{keywordflow}{return} \mbox{\hyperlink{classoomph_1_1Problem_abf6681f21f614ed7f15cc675ed6f692a}{adaptive\_unsteady\_newton\_solve}}(dt\_desired, epsilon, \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11061}11061   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11062}11062 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11063}11063 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11064}11064   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11065}11065 \textcolor{comment}{  /// Attempt to take  one timestep forward using the dt\_desired.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11066}11066 \textcolor{comment}{  /// This is the driver for a number of adaptive solvers. If the solution}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11067}11067 \textcolor{comment}{  /// fails to converge at a given timestep, the routine will automatically}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11068}11068 \textcolor{comment}{  /// halve the time step and try again, until the time step falls below the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11069}11069 \textcolor{comment}{  /// specified minimum value. The routine returns the value an estimate}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11070}11070 \textcolor{comment}{  /// of the next value of dt that should be taken.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11071}11071 \textcolor{comment}{  /// Timestep is also rejected if the  error estimate post-\/solve}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11072}11072 \textcolor{comment}{  /// (computed by global\_temporal\_error\_norm()) exceeds epsilon.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11073}11073 \textcolor{comment}{  /// This behaviour can be over-\/ruled by setting the protected}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11074}11074 \textcolor{comment}{  /// boolean Problem::Keep\_temporal\_error\_below\_tolerance to false.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11075}11075 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11076}\mbox{\hyperlink{classoomph_1_1Problem_a3f5bde6d7fa8972e01a20c522b5fb2ef}{11076}}   \textcolor{keywordtype}{double} \mbox{\hyperlink{classoomph_1_1Problem_abf6681f21f614ed7f15cc675ed6f692a}{Problem::adaptive\_unsteady\_newton\_solve}}(\textcolor{keyword}{const} \textcolor{keywordtype}{double}\& dt\_desired,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11077}11077                                                  \textcolor{keyword}{const} \textcolor{keywordtype}{double}\& epsilon,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11078}11078                                                  \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& shift\_values)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11079}11079   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11080}11080     \textcolor{comment}{// First, we need to backup the existing dofs, in case the timestep is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11081}11081     \textcolor{comment}{// rejected}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11082}11082 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11083}11083     \textcolor{comment}{// Find total number of dofs on current processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11084}11084     \textcolor{keywordtype}{unsigned} n\_dof\_local = \mbox{\hyperlink{classoomph_1_1Problem_a8bb8d8763e755fac464c836c1427c412}{dof\_distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11085}11085 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11086}11086     \textcolor{comment}{// Now set up a Vector to hold current values}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11087}11087     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} dofs\_current(n\_dof\_local);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11088}11088 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11089}11089     \textcolor{comment}{// Load values into dofs\_current}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11090}11090     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof\_local; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++) dofs\_current[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = \mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11091}11091 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11092}11092     \textcolor{comment}{// Store the time}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11093}11093     \textcolor{keywordtype}{double} time\_current = \mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_a43461269b799134f4b7a9aca3e79a7c8}{time}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11094}11094 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11095}11095     \textcolor{comment}{// Flag to detect whether the timestep has been rejected or not}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11096}11096     \textcolor{keywordtype}{bool} reject\_timestep = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11097}11097 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11098}11098     \textcolor{comment}{// Flag to detect whether any of the timesteppers are adaptive}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11099}11099     \textcolor{keywordtype}{unsigned} adaptive\_flag = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11100}11100 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11101}11101     \textcolor{comment}{// The value of the actual timestep, by default the same as desired timestep}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11102}11102     \textcolor{keywordtype}{double} dt\_actual = dt\_desired;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11103}11103 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11104}11104     \textcolor{comment}{// Find out whether any of the timesteppers are adaptive}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11105}11105     \textcolor{keywordtype}{unsigned} n\_time\_steppers = \mbox{\hyperlink{classoomph_1_1Problem_ace3cdf55009c3bff21d2b7d3706d522a}{ntime\_stepper}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11106}11106     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_time\_steppers; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11107}11107     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11108}11108       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>adaptive\_flag())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11109}11109       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11110}11110         adaptive\_flag = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11111}11111         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11112}11112       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11113}11113     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11114}11114 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11115}11115     \textcolor{comment}{// Shift the time\_values according to the control flag}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11116}11116     \textcolor{keywordflow}{if} (shift\_values)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11117}11117     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11118}11118       \mbox{\hyperlink{classoomph_1_1Problem_aab27bdd1968e57cb3dffe78c1d63f762}{shift\_time\_values}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11119}11119     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11120}11120 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11121}11121     \textcolor{comment}{// This loop surrounds the adaptive time-\/stepping and will not be broken}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11122}11122     \textcolor{comment}{// until a timestep is accepted}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11123}11123     \textcolor{keywordflow}{do}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11124}11124     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11125}11125       \textcolor{comment}{// Initially we assume that this step will succeed and that this dt}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11126}11126       \textcolor{comment}{// value is ok.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11127}11127       reject\_timestep = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11128}11128       \textcolor{keywordtype}{double} dt\_rescaling\_factor = 1.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11129}11129 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11130}11130       \textcolor{comment}{// Set the new time and value of dt}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11131}11131       \mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_a43461269b799134f4b7a9aca3e79a7c8}{time}}() += dt\_actual;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11132}11132       \mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_abd4c96948929a36a14a3ceaafa52bd42}{dt}}() = dt\_actual;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11133}11133 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11134}11134       \textcolor{comment}{// Loop over all timesteppers and set the weights and predictor weights}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11135}11135       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_time\_steppers; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11136}11136       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11137}11137         \textcolor{comment}{// If the time\_stepper is non-\/adaptive, this will be zero}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11138}11138         \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_a2dfb949155ba433066fd69dc427ba1ce}{set\_predictor\_weights}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11139}11139         \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_a028fa3a8d3c6db6b0ddf580cb0468d55}{set\_weights}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11140}11140       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11141}11141 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11142}11142       \textcolor{comment}{// Now calculate the predicted values for the all data and all positions}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11143}11143       \mbox{\hyperlink{classoomph_1_1Problem_a474deeb0947b767566fa1d4630ad8b4a}{calculate\_predictions}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11144}11144 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11145}11145       \textcolor{comment}{// Run the individual timesteppers actions before timestep. These need to}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11146}11146       \textcolor{comment}{// be before the problem's actions\_before\_implicit\_timestep so that the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11147}11147       \textcolor{comment}{// boundary conditions are set consistently.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11148}11148       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_time\_steppers; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11149}11149       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11150}11150         \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_a36cbcee0c1127085ba3aa2331bfc0f74}{actions\_before\_timestep}}(\textcolor{keyword}{this});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11151}11151       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11152}11152 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11153}11153       \textcolor{comment}{// Do any updates/boundary conditions changes here}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11154}11154       \mbox{\hyperlink{classoomph_1_1Problem_a4f19896906d2c0274ad6798cd3ac38dc}{actions\_before\_implicit\_timestep}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11155}11155 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11156}11156       \textcolor{comment}{// Attempt to solve the non-\/linear system}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11157}11157       \textcolor{keywordflow}{try}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11158}11158       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11159}11159         \textcolor{comment}{// Solve the non-\/linear problem at this timestep}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11160}11160         \mbox{\hyperlink{classoomph_1_1Problem_a62a989ae9a9169b9d905f844db59787f}{newton\_solve}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11161}11161       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11162}11162       \textcolor{comment}{// Catch any exceptions thrown}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11163}11163       \textcolor{keywordflow}{catch} (\mbox{\hyperlink{classoomph_1_1NewtonSolverError}{NewtonSolverError}}\& error)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11164}11164       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11165}11165         \textcolor{comment}{// If it's a solver error then die}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11166}11166         \textcolor{keywordflow}{if} (error.\mbox{\hyperlink{classoomph_1_1NewtonSolverError_a30a00b1e2e2baaf733f6197572399875}{linear\_solver\_error}} ||}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11167}11167             \mbox{\hyperlink{classoomph_1_1Problem_a3e9aecf88bde320bc2d169b5f3c99fee}{Time\_adaptive\_newton\_crash\_on\_solve\_fail}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11168}11168         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11169}11169           \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} error\_message = \textcolor{stringliteral}{"{}USER-\/DEFINED ERROR IN NEWTON SOLVER\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11170}11170           error\_message += \textcolor{stringliteral}{"{}ERROR IN THE LINEAR SOLVER\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11171}11171 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11172}11172           \textcolor{comment}{// Die}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11173}11173           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11174}11174             error\_message, OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11175}11175         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11176}11176         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11177}11177         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11178}11178           \textcolor{comment}{// Reject the timestep, if we have an exception}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11179}11179           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}TIMESTEP REJECTED"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11180}11180           reject\_timestep = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11181}11181 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11182}11182           \textcolor{comment}{// Half the time step}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11183}11183           dt\_rescaling\_factor = \mbox{\hyperlink{classoomph_1_1Problem_a359d1936bc2146e0a0ce697776efcf91}{Timestep\_reduction\_factor\_after\_nonconvergence}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11184}11184         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11185}11185       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11186}11186 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11187}11187       \textcolor{comment}{// Run the individual timesteppers actions, these need to be before the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11188}11188       \textcolor{comment}{// problem's actions\_after\_implicit\_timestep so that the time step is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11189}11189       \textcolor{comment}{// finished before the problem does any auxiliary calculations (e.g. in}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11190}11190       \textcolor{comment}{// semi-\/implicit micromagnetics the calculation of magnetostatic field).}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11191}11191       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_time\_steppers; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11192}11192       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11193}11193         \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_a3a0fabf83f9bdc89800cd3501df2c586}{actions\_after\_timestep}}(\textcolor{keyword}{this});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11194}11194       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11195}11195 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11196}11196       \textcolor{comment}{// Update anything that needs updating after the timestep}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11197}11197       \mbox{\hyperlink{classoomph_1_1Problem_a012692496c968960f4ea27db4e89cc7d}{actions\_after\_implicit\_timestep}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11198}11198 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11199}11199       \textcolor{comment}{// If we have an adapative timestepper (and we haven't already failed)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11200}11200       \textcolor{comment}{// then calculate the error estimate and rescaling factor.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11201}11201       \textcolor{keywordflow}{if} (adaptive\_flag \&\& !reject\_timestep)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11202}11202       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11203}11203         \textcolor{comment}{// Once timestep has been accepted can do fancy error processing}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11204}11204         \textcolor{comment}{// Set the error weights}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11205}11205         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_time\_steppers; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11206}11206         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11207}11207           \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_aee0c1da870a603e64efebb51dfc96a3d}{set\_error\_weights}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11208}11208         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11209}11209 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11210}11210         \textcolor{comment}{// Get a global error norm to use in adaptivity (as specified by the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11211}11211         \textcolor{comment}{// problem sub-\/class writer). Prevent a divide by zero if the solution}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11212}11212         \textcolor{comment}{// gives very close to zero error. Error norm should never be negative}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11213}11213         \textcolor{comment}{// but use absolute value just in case.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11214}11214         \textcolor{keywordtype}{double} error = std::max(std::abs(\mbox{\hyperlink{classoomph_1_1Problem_ac7667864b71a3889c95c29307422ac8e}{global\_temporal\_error\_norm}}()), 1\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}-\/12);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11215}11215 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11216}11216         \textcolor{comment}{// Calculate the scaling  factor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11217}11217         dt\_rescaling\_factor = std::pow(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11218}11218           (epsilon / error), (1.0 / (1.0 + \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}()-\/>order())));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11219}11219 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11220}11220         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Timestep scaling factor is  "{}} << dt\_rescaling\_factor}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11221}11221                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11222}11222         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Estimated timestepping error is "{}} << error << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11223}11223 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11224}11224 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11225}11225         \textcolor{comment}{// Do we have to do it again?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11226}11226         \textcolor{keywordflow}{if} (error > epsilon)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11227}11227         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11228}11228           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Estimated timestepping error "{}} << error}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11229}11229                      << \textcolor{stringliteral}{"{} exceeds tolerance "{}} << epsilon << \textcolor{stringliteral}{"{} "{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11230}11230           \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_ab27af4a444de9f59125ee50ac778d97a}{Keep\_temporal\_error\_below\_tolerance}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11231}11231           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11232}11232             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{} -\/-\/> rejecting timestep."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11233}11233             reject\_timestep = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11234}11234           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11235}11235           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11236}11236           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11237}11237             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{} ...but we're not rejecting the timestep"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11238}11238                        << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11239}11239           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11240}11240           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11241}11241             << \textcolor{stringliteral}{"{}Note: This behaviour can be adjusted by changing the protected "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11242}11242             << \textcolor{stringliteral}{"{}boolean"{}} << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11243}11243             << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11244}11244             << \textcolor{stringliteral}{"{}    Problem::Keep\_temporal\_error\_below\_tolerance"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11245}11245         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11246}11246 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11247}11247 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11248}11248       \} \textcolor{comment}{// End of if adaptive flag}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11249}11249 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11250}11250 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11251}11251       \textcolor{comment}{// Calculate the next time step size and check it's ok}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11252}11252       \textcolor{comment}{// ============================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11253}11253 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11254}11254       \textcolor{comment}{// Calculate the possible next time step, if no error conditions}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11255}11255       \textcolor{comment}{// trigger.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11256}11256       \textcolor{keywordtype}{double} new\_dt\_candidate = dt\_rescaling\_factor * dt\_actual;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11257}11257 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11258}11258       \textcolor{comment}{// Check that the scaling factor is within the allowed range}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11259}11259       \textcolor{keywordflow}{if} (dt\_rescaling\_factor > \mbox{\hyperlink{classoomph_1_1Problem_aaaeab9469b342a3b849ee5f2ef7051f3}{DTSF\_max\_increase}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11260}11260       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11261}11261         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Tried to increase dt by the ratio "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11262}11262                    << dt\_rescaling\_factor << \textcolor{stringliteral}{"{} which is above the maximum ("{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11263}11263                    << \mbox{\hyperlink{classoomph_1_1Problem_aaaeab9469b342a3b849ee5f2ef7051f3}{DTSF\_max\_increase}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11264}11264                    << \textcolor{stringliteral}{"{}). Attempting to increase by the maximum ratio instead."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11265}11265                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11266}11266         new\_dt\_candidate = \mbox{\hyperlink{classoomph_1_1Problem_aaaeab9469b342a3b849ee5f2ef7051f3}{DTSF\_max\_increase}} * dt\_actual;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11267}11267       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11268}11268       \textcolor{comment}{// If we have already rejected the timestep then don't do this check}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11269}11269       \textcolor{comment}{// because DTSF will definitely be too small.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11270}11270       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((!reject\_timestep) \&\& (dt\_rescaling\_factor <= \mbox{\hyperlink{classoomph_1_1Problem_abbb93979ed99d40eb845ba7296355965}{DTSF\_min\_decrease}}))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11271}11271       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11272}11272         \textcolor{comment}{// Handle this special case where we want to continue anyway (usually}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11273}11273         \textcolor{comment}{// Minimum\_dt\_but\_still\_proceed = -\/1 so this has no effect).}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11274}11274         \textcolor{keywordflow}{if} (new\_dt\_candidate < \mbox{\hyperlink{classoomph_1_1Problem_abdee700b2cec37540cf1e7e1462df6c3}{Minimum\_dt\_but\_still\_proceed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11275}11275         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11276}11276           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11277}11277             << \textcolor{stringliteral}{"{}Warning: Adaptation of timestep to ensure satisfaction\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11278}11278             << \textcolor{stringliteral}{"{}         of error bounds during adaptive timestepping\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11279}11279             << \textcolor{stringliteral}{"{}         would lower dt below \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11280}11280             << \textcolor{stringliteral}{"{}         Problem::Minimum\_dt\_but\_still\_proceed="{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11281}11281             << \mbox{\hyperlink{classoomph_1_1Problem_abdee700b2cec37540cf1e7e1462df6c3}{Minimum\_dt\_but\_still\_proceed}} << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11282}11282             << \textcolor{stringliteral}{"{}         -\/-\/-\/> We're continuing with present timestep.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11283}11283             << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11284}11284           dt\_rescaling\_factor = 1.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11285}11285           \textcolor{comment}{// ??ds shouldn't we set new\_dt\_candidate =}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11286}11286           \textcolor{comment}{// Minimum\_dt\_but\_still\_proceed here, rather than not changing dt at}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11287}11287           \textcolor{comment}{// all?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11288}11288         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11289}11289         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11290}11290         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11291}11291           \textcolor{comment}{// Otherwise reject}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11292}11292           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Timestep would decrease by "{}} << dt\_rescaling\_factor}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11293}11293                      << \textcolor{stringliteral}{"{} which is less than the minimum scaling factor "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11294}11294                      << \mbox{\hyperlink{classoomph_1_1Problem_abbb93979ed99d40eb845ba7296355965}{DTSF\_min\_decrease}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11295}11295           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}TIMESTEP REJECTED"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11296}11296           reject\_timestep = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11297}11297         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11298}11298       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11299}11299 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11300}11300       \textcolor{comment}{// Now check that the new dt is within the allowed range}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11301}11301       \textcolor{keywordflow}{if} (new\_dt\_candidate > \mbox{\hyperlink{classoomph_1_1Problem_a7b5fde48b00a7fdc5f1fbbee138d0414}{Maximum\_dt}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11302}11302       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11303}11303         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Tried to increase dt to "{}} << new\_dt\_candidate}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11304}11304                    << \textcolor{stringliteral}{"{} which is above the maximum ("{}} << \mbox{\hyperlink{classoomph_1_1Problem_a7b5fde48b00a7fdc5f1fbbee138d0414}{Maximum\_dt}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11305}11305                    << \textcolor{stringliteral}{"{}). I increased it to the maximum value instead."{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11306}11306         dt\_actual = \mbox{\hyperlink{classoomph_1_1Problem_a7b5fde48b00a7fdc5f1fbbee138d0414}{Maximum\_dt}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11307}11307       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11308}11308       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (new\_dt\_candidate < \mbox{\hyperlink{classoomph_1_1Problem_ad7456318933aa01114dc78498bfd6d79}{Minimum\_dt}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11309}11309       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11310}11310         std::ostringstream err;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11311}11311         err << \textcolor{stringliteral}{"{}Tried to reduce dt to "{}} << new\_dt\_candidate}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11312}11312             << \textcolor{stringliteral}{"{} which is less than the minimum dt ("{}} << \mbox{\hyperlink{classoomph_1_1Problem_ad7456318933aa01114dc78498bfd6d79}{Minimum\_dt}} << \textcolor{stringliteral}{"{})."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11313}11313             << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11314}11314         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11315}11315           err.str(), OOMPH\_EXCEPTION\_LOCATION, OOMPH\_CURRENT\_FUNCTION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11316}11316       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11317}11317       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11318}11318       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11319}11319         dt\_actual = new\_dt\_candidate;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11320}11320       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11321}11321 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11322}11322 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11323}11323       \mbox{\hyperlink{classoomph_1_1Problem_a38d914a74e7998ddc74c205884d36d57}{actions\_after\_implicit\_timestep\_and\_error\_estimation}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11324}11324 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11325}11325 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11326}11326       \textcolor{comment}{// If we are rejecting this attempt then revert the dofs etc.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11327}11327       \textcolor{keywordflow}{if} (reject\_timestep)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11328}11328       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11329}11329         \textcolor{comment}{// Reset the time}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11330}11330         \mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_a43461269b799134f4b7a9aca3e79a7c8}{time}}() = time\_current;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11331}11331 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11332}11332         \textcolor{comment}{// Reload the dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11333}11333         \textcolor{keywordtype}{unsigned} ni = dofs\_current.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11334}11334         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < ni; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11335}11335         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11336}11336           \mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) = dofs\_current[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11337}11337         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11338}11338 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11339}11339 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11340}11340         \textcolor{comment}{// Synchronise the solution on different processors (on each submesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11341}11341         this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5d9a3ba5696a7bcd275223ff16b7392e}{synchronise\_all\_dofs}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11342}11342 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11343}11343 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11344}11344         \textcolor{comment}{// Call all "{}after"{} actions, e.g. to handle mesh updates}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11345}11345         \mbox{\hyperlink{classoomph_1_1Problem_aed8bc6e7b0bb45b86d5b44737b554d50}{actions\_after\_newton\_step}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11346}11346         \mbox{\hyperlink{classoomph_1_1Problem_ae6ad96ddf5d48b517b89c9a9b879bc4b}{actions\_before\_newton\_convergence\_check}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11347}11347         \mbox{\hyperlink{classoomph_1_1Problem_a033ec7301123deeb7e56d04c38f9f1da}{actions\_after\_newton\_solve}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11348}11348         \mbox{\hyperlink{classoomph_1_1Problem_a012692496c968960f4ea27db4e89cc7d}{actions\_after\_implicit\_timestep}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11349}11349         \mbox{\hyperlink{classoomph_1_1Problem_a38d914a74e7998ddc74c205884d36d57}{actions\_after\_implicit\_timestep\_and\_error\_estimation}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11350}11350       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11351}11351 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11352}11352     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11353}11353     \textcolor{comment}{// Keep this loop going until we accept the timestep}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11354}11354     \textcolor{keywordflow}{while} (reject\_timestep);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11355}11355 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11356}11356     \textcolor{comment}{// Once the timestep has been accepted, return the time step that should be}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11357}11357     \textcolor{comment}{// used next time.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11358}11358     \textcolor{keywordflow}{return} dt\_actual;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11359}11359   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11360}11360 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11361}11361 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11362}11362   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11363}11363 \textcolor{comment}{  /// Private helper function to perform}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11364}11364 \textcolor{comment}{  /// unsteady "{}doubly"{} adaptive Newton solve: Does temporal}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11365}11365 \textcolor{comment}{  /// adaptation first, i.e. we try to do a timestep with an increment}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11366}11366 \textcolor{comment}{  /// of dt, and adjusting dt until the solution on the given mesh satisfies}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11367}11367 \textcolor{comment}{  /// the temporal error measure with tolerance epsilon. Following}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11368}11368 \textcolor{comment}{  /// this, we do up to max\_adapt spatial adaptions (without}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11369}11369 \textcolor{comment}{  /// re-\/examining the temporal error). If first==true, the initial conditions}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11370}11370 \textcolor{comment}{  /// are re-\/assigned after the mesh adaptations.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11371}11371 \textcolor{comment}{  /// Shifting of time can be suppressed by overwriting the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11372}11372 \textcolor{comment}{  /// default value of shift (true). [Shifting must be done}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11373}11373 \textcolor{comment}{  /// if first\_timestep==true because we're constantly re-\/assigning}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11374}11374 \textcolor{comment}{  /// the initial conditions; if first\_timestep==true and shift==false}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11375}11375 \textcolor{comment}{  /// shifting is performed anyway and a warning is issued.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11376}11376 \textcolor{comment}{  /// Pseudo-\/Boolean flag suppress\_resolve\_after\_spatial\_adapt [0: false;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11377}11377 \textcolor{comment}{  /// 1: true] does what it says.]}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11378}11378 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11379}\mbox{\hyperlink{classoomph_1_1Problem_a71ba0a8ba4cbcb66077324217482ee11}{11379}}   \textcolor{keywordtype}{double} \mbox{\hyperlink{classoomph_1_1Problem_a71ba0a8ba4cbcb66077324217482ee11}{Problem::doubly\_adaptive\_unsteady\_newton\_solve\_helper}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11380}11380     \textcolor{keyword}{const} \textcolor{keywordtype}{double}\& dt\_desired,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11381}11381     \textcolor{keyword}{const} \textcolor{keywordtype}{double}\& epsilon,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11382}11382     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& max\_adapt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11383}11383     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& suppress\_resolve\_after\_spatial\_adapt\_flag,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11384}11384     \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& first,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11385}11385     \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& shift\_values)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11386}11386   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11387}11387     \textcolor{comment}{// Store the initial time}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11388}11388     \textcolor{keywordtype}{double} initial\_time = \mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_a43461269b799134f4b7a9aca3e79a7c8}{time}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11389}11389 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11390}11390     \textcolor{comment}{// Take adaptive timestep, adjusting dt until tolerance is satisfied}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11391}11391     \textcolor{keywordtype}{double} new\_dt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11392}11392       \mbox{\hyperlink{classoomph_1_1Problem_abf6681f21f614ed7f15cc675ed6f692a}{adaptive\_unsteady\_newton\_solve}}(dt\_desired, epsilon, shift\_values);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11393}11393     \textcolor{keywordtype}{double} dt\_taken = \mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_abd4c96948929a36a14a3ceaafa52bd42}{dt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11394}11394     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Accepted solution taken with timestep: "{}} << dt\_taken}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11395}11395                << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11396}11396 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11397}11397 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11398}11398     \textcolor{comment}{// Bail out straightaway if no spatial adaptation allowed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11399}11399     \textcolor{keywordflow}{if} (max\_adapt == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11400}11400     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11401}11401       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}No spatial refinement allowed; max\_adapt=0\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11402}11402       \textcolor{keywordflow}{return} new\_dt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11403}11403     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11404}11404 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11405}11405     \textcolor{comment}{// Adapt problem/mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11406}11406     \textcolor{keywordtype}{unsigned} n\_refined = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11407}11407     \textcolor{keywordtype}{unsigned} n\_unrefined = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11408}11408     \mbox{\hyperlink{classoomph_1_1Problem_a0b9e09ddfa2411f14fc723c3207decd1}{adapt}}(n\_refined, n\_unrefined);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11409}11409 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11410}11410     \textcolor{comment}{// Check if mesh has been adapted on other processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11411}11411     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} total\_ref\_count(2);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11412}11412     total\_ref\_count[0] = n\_refined;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11413}11413     total\_ref\_count[1] = n\_unrefined;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11414}11414 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11415}11415 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11416}11416 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11417}11417     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11418}11418     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11419}11419       \textcolor{comment}{// Sum n\_refine across all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11420}11420       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} ref\_count(2);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11421}11421       ref\_count[0] = n\_refined;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11422}11422       ref\_count[1] = n\_unrefined;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11423}11423       MPI\_Allreduce(\&ref\_count[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11424}11424                     \&total\_ref\_count[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11425}11425                     2,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11426}11426                     MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11427}11427                     MPI\_SUM,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11428}11428                     \mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11429}11429     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11430}11430 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11431}11431 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11432}11432 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11433}11433     \textcolor{comment}{// Re-\/solve the problem if the adaptation has changed anything}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11434}11434     \textcolor{keywordflow}{if} ((total\_ref\_count[0] != 0) || (total\_ref\_count[1] != 0))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11435}11435     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11436}11436       \textcolor{keywordflow}{if} (suppress\_resolve\_after\_spatial\_adapt\_flag == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11437}11437       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11438}11438         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Mesh was adapted but re-\/solve has been suppressed."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11439}11439                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11440}11440       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11441}11441       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11442}11442       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11443}11443         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11444}11444           << \textcolor{stringliteral}{"{}Mesh was adapted -\/-\/> we'll re-\/solve for current timestep."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11445}11445           << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11446}11446 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11447}11447         \textcolor{comment}{// Reset time to what it was when we entered here}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11448}11448         \textcolor{comment}{// because it will be incremented again by dt\_taken.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11449}11449         \mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_a43461269b799134f4b7a9aca3e79a7c8}{time}}() = initial\_time;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11450}11450 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11451}11451         \textcolor{comment}{// Shift the timesteps? No! They've been shifted already when we}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11452}11452         \textcolor{comment}{// called the solve with pure temporal adaptivity...}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11453}11453         \textcolor{keywordtype}{bool} shift = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11454}11454 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11455}11455         \textcolor{comment}{// Reset the inital condition on refined meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11456}11456         \textcolor{keywordflow}{if} (first)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11457}11457         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11458}11458           \textcolor{comment}{// Reset default set\_initial\_condition has been called flag to false}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11459}11459           \mbox{\hyperlink{classoomph_1_1Problem_a83df3b5fcc3ebbae951021c8e7f03ef7}{Default\_set\_initial\_condition\_called}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11460}11460 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11461}11461           \textcolor{comment}{// Reset the initial conditions}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11462}11462           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Re-\/assigning initial condition at time="{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11463}11463                      << \mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_a43461269b799134f4b7a9aca3e79a7c8}{time}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11464}11464           \mbox{\hyperlink{classoomph_1_1Problem_ad48be6d67071f7da5f6feb7c4fc918f0}{set\_initial\_condition}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11465}11465 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11466}11466           \textcolor{comment}{// This is the first timestep so shifting}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11467}11467           \textcolor{comment}{// has to be done following the assignment of initial conditions,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11468}11468           \textcolor{comment}{// providing the default set\_initial\_condition function has not}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11469}11469           \textcolor{comment}{// been called.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11470}11470           \textcolor{comment}{// In fact, unsteady\_newton\_solve(...) does that automatically.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11471}11471           \textcolor{comment}{// We're changing the flag here to avoid warning messages.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11472}11472           \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_a83df3b5fcc3ebbae951021c8e7f03ef7}{Default\_set\_initial\_condition\_called}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11473}11473           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11474}11474             shift = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11475}11475           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11476}11476         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11477}11477 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11478}11478         \textcolor{comment}{// Now take the step again on the refined mesh, using the same}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11479}11479         \textcolor{comment}{// timestep as used before.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11480}11480         \mbox{\hyperlink{classoomph_1_1Problem_aef22157aadc15a512cca93e4c423ff73}{unsteady\_newton\_solve}}(dt\_taken, max\_adapt, first, shift);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11481}11481       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11482}11482     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11483}11483     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11484}11484     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11485}11485       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Mesh wasn't adapted -\/-\/> we'll accept spatial refinement."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11486}11486                  << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11487}11487     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11488}11488 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11489}11489     \textcolor{keywordflow}{return} new\_dt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11490}11490   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11491}11491 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11492}11492 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11493}11493   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11494}11494 \textcolor{comment}{  /// Initialise the previous values of the variables for time stepping}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11495}11495 \textcolor{comment}{  /// corresponding to an impulsive start. Previous history for all data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11496}11496 \textcolor{comment}{  /// is generated by the appropriate timesteppers. Previous nodal}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11497}11497 \textcolor{comment}{  /// positions are simply copied backwards.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11498}11498 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11499}\mbox{\hyperlink{classoomph_1_1Problem_a10e5dc4d944dfb2b141918e18e5e3de8}{11499}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a10e5dc4d944dfb2b141918e18e5e3de8}{Problem::assign\_initial\_values\_impulsive}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11500}11500   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11501}11501     \textcolor{comment}{// Assign the impulsive values in the "{}master"{} mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11502}11502     \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ab1ceceaadc7114773f5a70cb52e67081}{assign\_initial\_values\_impulsive}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11503}11503 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11504}11504     \textcolor{comment}{// Loop over global data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11505}11505     \textcolor{keywordtype}{unsigned} Nglobal = \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11506}11506     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} iglobal = 0; iglobal < Nglobal; iglobal++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11507}11507     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11508}11508       \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[iglobal]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11509}11509         -\/>time\_stepper\_pt()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11510}11510         -\/>assign\_initial\_values\_impulsive(\mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[iglobal]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11511}11511     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11512}11512   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11513}11513 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11514}11514 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11515}11515   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11516}11516 \textcolor{comment}{  /// Assign the values for an impulsive start and also set the initial}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11517}11517 \textcolor{comment}{  /// values of the previous dts to both be dt}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11518}11518 \textcolor{comment}{}  \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11519}\mbox{\hyperlink{classoomph_1_1Problem_a296bd0ba13bd51a96bb7057845e5a800}{11519}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a10e5dc4d944dfb2b141918e18e5e3de8}{Problem::assign\_initial\_values\_impulsive}}(\textcolor{keyword}{const} \textcolor{keywordtype}{double}\& dt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11520}11520   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11521}11521     \textcolor{comment}{// First initialise the dts and set the weights}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11522}11522     \mbox{\hyperlink{classoomph_1_1Problem_a342b9bd9c4bc142f514907ee1d23d613}{initialise\_dt}}(dt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11523}11523     \textcolor{comment}{// Now call assign\_initial\_values\_impulsive}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11524}11524     \mbox{\hyperlink{classoomph_1_1Problem_a10e5dc4d944dfb2b141918e18e5e3de8}{assign\_initial\_values\_impulsive}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11525}11525   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11526}11526 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11527}11527   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11528}11528 \textcolor{comment}{  /// Return the current value of continuous time. If not Time object}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11529}11529 \textcolor{comment}{  /// has been assigned, then throw an error}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11530}11530 \textcolor{comment}{}  \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11531}\mbox{\hyperlink{classoomph_1_1Problem_acd8c357349d20a28af70b2b7ea7f488d}{11531}}   \textcolor{keywordtype}{double}\& \mbox{\hyperlink{classoomph_1_1Problem_acd8c357349d20a28af70b2b7ea7f488d}{Problem::time}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11532}11532   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11533}11533     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_ae33fbf5f34a7d06d88ad2c98538bbbe8}{Time\_pt}} == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11534}11534     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11535}11535       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Time object has not been set"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11536}11536                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11537}11537                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11538}11538     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11539}11539     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11540}11540     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11541}11541       \textcolor{keywordflow}{return} \mbox{\hyperlink{classoomph_1_1Problem_ae33fbf5f34a7d06d88ad2c98538bbbe8}{Time\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Time_a43461269b799134f4b7a9aca3e79a7c8}{time}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11542}11542     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11543}11543   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11544}11544 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11545}11545   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11546}11546 \textcolor{comment}{  /// Return the current value of continuous time. If not Time object}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11547}11547 \textcolor{comment}{  /// has been assigned, then throw an error. Const version.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11548}11548 \textcolor{comment}{}  \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11549}\mbox{\hyperlink{classoomph_1_1Problem_a925acb2e840deb4edc6305da8fced0e3}{11549}}   \textcolor{keywordtype}{double} \mbox{\hyperlink{classoomph_1_1Problem_acd8c357349d20a28af70b2b7ea7f488d}{Problem::time}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11550}11550 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11551}11551     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_ae33fbf5f34a7d06d88ad2c98538bbbe8}{Time\_pt}} == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11552}11552     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11553}11553       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Time object has not been set"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11554}11554                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11555}11555                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11556}11556     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11557}11557     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11558}11558     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11559}11559       \textcolor{keywordflow}{return} \mbox{\hyperlink{classoomph_1_1Problem_ae33fbf5f34a7d06d88ad2c98538bbbe8}{Time\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Time_a43461269b799134f4b7a9aca3e79a7c8}{time}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11560}11560     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11561}11561   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11562}11562 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11563}11563 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11564}11564   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11565}11565 \textcolor{comment}{  /// Set all problem data to have the same timestepper (timestepper\_pt).}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11566}11566 \textcolor{comment}{  /// This is mainly used in continuation and bifurcation detection problems}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11567}11567 \textcolor{comment}{  /// in which case the total number of unknowns may change and the changes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11568}11568 \textcolor{comment}{  /// to the underlying memory layout means that the Dof\_pt must be}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11569}11569 \textcolor{comment}{  /// reallocated. Thus, the function calls assign\_eqn\_numbers() and returns}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11570}11570 \textcolor{comment}{  /// the number of new equation numbers.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11571}11571 \textcolor{comment}{}  \textcolor{comment}{//=========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11572}\mbox{\hyperlink{classoomph_1_1Problem_a7be66e9917b39eaea90b91389f5a72fb}{11572}}   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{classoomph_1_1Problem_a7be66e9917b39eaea90b91389f5a72fb}{Problem::set\_timestepper\_for\_all\_data}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11573}11573     \mbox{\hyperlink{classoomph_1_1TimeStepper}{TimeStepper}}* \textcolor{keyword}{const}\& time\_stepper\_pt, \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& preserve\_existing\_data)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11574}11574   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11575}11575     \textcolor{comment}{// Set the timestepper for the master mesh's nodal and elemental data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11576}11576     \textcolor{comment}{// to be the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11577}11577     \textcolor{comment}{// continuation time stepper. This will wipe all storage other than}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11578}11578     \textcolor{comment}{// the 0th (present time) value at all the data objects}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11579}11579     \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a6c9a84e7e912c2fef3f513bfcd50fc70}{set\_nodal\_and\_elemental\_time\_stepper}}(\mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11580}11580                                                   preserve\_existing\_data);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11581}11581 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11582}11582     \textcolor{comment}{// Deal with the any additional mesh level timestepper data separately}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11583}11583     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_sub\_mesh = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11584}11584     \textcolor{comment}{// If there is only one mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11585}11585     \textcolor{keywordflow}{if} (n\_sub\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11586}11586     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11587}11587       \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a52c30b4ebc67038e137a5de1c5d422e5}{set\_mesh\_level\_time\_stepper}}(\mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11588}11588                                            preserve\_existing\_data);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11589}11589     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11590}11590     \textcolor{comment}{// Otherwise loop over the sub meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11591}11591     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11592}11592     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11593}11593       \textcolor{comment}{// Assign global equation numbers first}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11594}11594       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_sub\_mesh; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11595}11595       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11596}11596         this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ab65f6fc9c49860e6324457a7e6e76346}{Sub\_mesh\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]-\/>set\_mesh\_level\_time\_stepper(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11597}11597           time\_stepper\_pt, preserve\_existing\_data);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11598}11598       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11599}11599     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11600}11600 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11601}11601     \textcolor{comment}{// Also set time stepper for global data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11602}11602     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_global = \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11603}11603     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_global; ++\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11604}11604     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11605}11605       \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]-\/>set\_time\_stepper(\mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11606}11606                                           preserve\_existing\_data);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11607}11607     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11608}11608 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11609}11609     \textcolor{comment}{// We now need to reassign equations numbers because the Dof pointer}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11610}11610     \textcolor{comment}{// will be inappropriate  because memory has been reallocated}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11611}11611 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11612}11612 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11613}11613     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11614}11614     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11615}11615       std::ostringstream warning\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11616}11616       warning\_stream << \textcolor{stringliteral}{"{}This has not been comprehensively tested for "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11617}11617                         \textcolor{stringliteral}{"{}distributed problems.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11618}11618                      << \textcolor{stringliteral}{"{}I'm sure that I need to worry about external halo and "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11619}11619                         \textcolor{stringliteral}{"{}external elements."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11620}11620                      << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11621}11621       \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11622}11622         warning\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11623}11623     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11624}11624 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11625}11625 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11626}11626 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11627}11627     \textcolor{keywordflow}{return} (this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11628}11628   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11629}11629 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11630}11630 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11631}11631   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11632}11632 \textcolor{comment}{  /// Shift all time-\/dependent data along for next timestep.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11633}11633 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11634}\mbox{\hyperlink{classoomph_1_1Problem_aab27bdd1968e57cb3dffe78c1d63f762}{11634}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_aab27bdd1968e57cb3dffe78c1d63f762}{Problem::shift\_time\_values}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11635}11635   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11636}11636     \textcolor{comment}{// Move the values of dt in the Time object}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11637}11637     \mbox{\hyperlink{classoomph_1_1Problem_ae33fbf5f34a7d06d88ad2c98538bbbe8}{Time\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Time_a92ca0ca34a1491744a3315d61d7cee5f}{shift\_dt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11638}11638 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11639}11639     \textcolor{comment}{// Only shift time values in the "{}master"{} mesh, otherwise things will}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11640}11640     \textcolor{comment}{// get shifted twice in complex problems}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11641}11641     \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a7f097aaa854ac697f8016ba3b7e6c982}{shift\_time\_values}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11642}11642 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11643}11643     \textcolor{comment}{// Shift global data with their own timesteppers}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11644}11644     \textcolor{keywordtype}{unsigned} Nglobal = \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11645}11645     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} iglobal = 0; iglobal < Nglobal; iglobal++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11646}11646     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11647}11647       \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[iglobal]-\/>time\_stepper\_pt()-\/>shift\_time\_values(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11648}11648         \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[iglobal]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11649}11649     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11650}11650   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11651}11651 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11652}11652 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11653}11653   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11654}11654 \textcolor{comment}{  /// Calculate the predictions of all variables in problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11655}11655 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11656}\mbox{\hyperlink{classoomph_1_1Problem_a474deeb0947b767566fa1d4630ad8b4a}{11656}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a474deeb0947b767566fa1d4630ad8b4a}{Problem::calculate\_predictions}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11657}11657   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11658}11658 \textcolor{comment}{// Check that if we have multiple time steppers none of them want to}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11659}11659 \textcolor{comment}{// predict by calling an explicit timestepper (as opposed to doing}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11660}11660 \textcolor{comment}{// something like an explicit step by combining known history values, as}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11661}11661 \textcolor{comment}{// done in BDF).}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11662}11662 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11663}11663     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_af1e8f8a739453250eb3744fea2a3b983}{Time\_stepper\_pt}}.size() != 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11664}11664     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11665}11665       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < \mbox{\hyperlink{classoomph_1_1Problem_af1e8f8a739453250eb3744fea2a3b983}{Time\_stepper\_pt}}.size(); j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11666}11666       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11667}11667         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}()-\/>predict\_by\_explicit\_step())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11668}11668         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11669}11669           \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} err = \textcolor{stringliteral}{"{}Prediction by explicit step only works for "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11670}11670                             \textcolor{stringliteral}{"{}problems with a simple time"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11671}11671           err += \textcolor{stringliteral}{"{}stepper. I think implementing anything more general will"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11672}11672           err += \textcolor{stringliteral}{"{}require a rewrite of explicit time steppers. -\/ David"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11673}11673           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11674}11674             err, OOMPH\_EXCEPTION\_LOCATION, OOMPH\_CURRENT\_FUNCTION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11675}11675         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11676}11676       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11677}11677     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11678}11678 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11679}11679 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11680}11680 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11681}11681     \textcolor{comment}{// Predict using an explicit timestepper (don't do it if adaptive = false}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11682}11682     \textcolor{comment}{// because pointers probably aren't set up).}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11683}11683     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}()-\/>predict\_by\_explicit\_step() \&\&}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11684}11684         \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}()-\/>adaptive\_flag())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11685}11685     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11686}11686       \textcolor{comment}{// Copy the time stepper's predictor pt into problem's explicit time}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11687}11687       \textcolor{comment}{// stepper pt (unless problem already has its own explicit time}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11688}11688       \textcolor{comment}{// stepper).}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11689}11689       \mbox{\hyperlink{classoomph_1_1ExplicitTimeStepper}{ExplicitTimeStepper}}* ets\_pt = \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_a1214f9edca10512e1f3b857cff4e0797}{explicit\_predictor\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11690}11690 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11691}11691       \textcolor{keywordflow}{if} (ets\_pt == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11692}11692       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11693}11693         \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} err = \textcolor{stringliteral}{"{}Requested predictions by explicit step but explicit"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11694}11694         err += \textcolor{stringliteral}{"{} predictor pt is null."{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11695}11695         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11696}11696           err, OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11697}11697       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11698}11698 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11699}11699       \textcolor{keywordflow}{if} ((\mbox{\hyperlink{classoomph_1_1Problem_ab69ae6020f1886e7b288180b6130b7ed}{explicit\_time\_stepper\_pt}}() != ets\_pt) \&\&}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11700}11700           (\mbox{\hyperlink{classoomph_1_1Problem_ab69ae6020f1886e7b288180b6130b7ed}{explicit\_time\_stepper\_pt}}() != 0))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11701}11701       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11702}11702         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Problem has explicit time stepper other than "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11703}11703                             \textcolor{stringliteral}{"{}predictor, not sure how to handle this yet ??ds"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11704}11704                             OOMPH\_EXCEPTION\_LOCATION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11705}11705                             OOMPH\_CURRENT\_FUNCTION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11706}11706       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11707}11707 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11708}11708       \mbox{\hyperlink{classoomph_1_1Problem_ab69ae6020f1886e7b288180b6130b7ed}{explicit\_time\_stepper\_pt}}() = ets\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11709}11709 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11710}11710       \textcolor{comment}{// Backup dofs and time}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11711}11711       \mbox{\hyperlink{classoomph_1_1Problem_a5a2906b9a6a22445d1dbb8aebbce9fa7}{store\_current\_dof\_values}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11712}11712 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11713}11713 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11714}11714       \textcolor{keywordtype}{double} backup\_time = \mbox{\hyperlink{classoomph_1_1Problem_acd8c357349d20a28af70b2b7ea7f488d}{time}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11715}11715 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11716}11716 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11717}11717       \textcolor{comment}{// Move time back so that we are at the start of the timestep (as}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11718}11718       \textcolor{comment}{// explicit\_timestep functions expect). This is needed because the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11719}11719       \textcolor{comment}{// predictor calculations are done after unsteady newton solve has}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11720}11720       \textcolor{comment}{// started, and it has already moved time forwards.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11721}11721       \textcolor{keywordtype}{double} dt = \mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_abd4c96948929a36a14a3ceaafa52bd42}{dt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11722}11722       \mbox{\hyperlink{classoomph_1_1Problem_acd8c357349d20a28af70b2b7ea7f488d}{time}}() -\/= dt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11723}11723 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11724}11724       \textcolor{comment}{// Explicit step}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11725}11725       this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ab8b74c5b1499b2d712a8545cccbd97c2}{explicit\_timestep}}(dt, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11726}11726 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11727}11727       \textcolor{comment}{// Copy predicted dofs and time to their storage slots.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11728}11728       \mbox{\hyperlink{classoomph_1_1Problem_ab51480d18550c107c9f13629102f6b08}{set\_dofs}}(\mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}()-\/>predictor\_storage\_index(), \mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11729}11729       \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_ab9813c8ea8ad981f0db9a467302b9cd0}{update\_predicted\_time}}(\mbox{\hyperlink{classoomph_1_1Problem_acd8c357349d20a28af70b2b7ea7f488d}{time}}());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11730}11730 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11731}11731       \textcolor{comment}{// Check we got the times right}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11732}11732 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11733}11733       \textcolor{keywordflow}{if} (std::abs(\mbox{\hyperlink{classoomph_1_1Problem_acd8c357349d20a28af70b2b7ea7f488d}{time}}() -\/ backup\_time) > 1\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}-\/12)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11734}11734       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11735}11735         \textcolor{keyword}{using namespace }StringConversion;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11736}11736         \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} err = \textcolor{stringliteral}{"{}Predictor landed at the wrong time!"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11737}11737         err += \textcolor{stringliteral}{"{} Expected time "{}} + \mbox{\hyperlink{namespaceoomph_1_1StringConversion_a9d30fabdc1a0694bdb91dddd2833bbd6}{to\_string}}(backup\_time, 14) + \textcolor{stringliteral}{"{} but got "{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11738}11738         err += \mbox{\hyperlink{namespaceoomph_1_1StringConversion_a9d30fabdc1a0694bdb91dddd2833bbd6}{to\_string}}(\mbox{\hyperlink{classoomph_1_1Problem_acd8c357349d20a28af70b2b7ea7f488d}{time}}(), 14);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11739}11739         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11740}11740           err, OOMPH\_EXCEPTION\_LOCATION, OOMPH\_CURRENT\_FUNCTION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11741}11741       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11742}11742 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11743}11743 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11744}11744       \textcolor{comment}{// Restore dofs and time}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11745}11745       \mbox{\hyperlink{classoomph_1_1Problem_ad19fe0723fe6356776cfbe28e46ea64b}{restore\_dof\_values}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11746}11746     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11747}11747 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11748}11748     \textcolor{comment}{// Otherwise we can do predictions in a more object oriented way using}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11749}11749     \textcolor{comment}{// whatever timestepper the data provides (this is the normal case).}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11750}11750     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11751}11751     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11752}11752       \textcolor{comment}{// Calculate all predictions in the "{}master"{} mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11753}11753       \mbox{\hyperlink{classoomph_1_1Problem_aa4a3bf9419e495aaaaea0dcb00ea53e5}{Mesh\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a823b11b11e6a0c3c22ea86dc60a3da65}{calculate\_predictions}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11754}11754 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11755}11755       \textcolor{comment}{// Calculate predictions for global data with their own timesteppers}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11756}11756       \textcolor{keywordtype}{unsigned} Nglobal = \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11757}11757       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} iglobal = 0; iglobal < Nglobal; iglobal++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11758}11758       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11759}11759         \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[iglobal]-\/>time\_stepper\_pt()-\/>calculate\_predicted\_values(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11760}11760           \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[iglobal]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11761}11761       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11762}11762     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11763}11763 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11764}11764     \textcolor{comment}{// If requested then copy the predicted value into the current time data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11765}11765     \textcolor{comment}{// slots, ready for the newton solver to use as an initial guess.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11766}11766     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a45a100cc92214810b545b9bd7e56336c}{use\_predictor\_values\_as\_initial\_guess}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11767}11767     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11768}11768       \textcolor{comment}{// Not sure I know enough about distributed problems to implement}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11769}11769       \textcolor{comment}{// this. Probably you just need to loop over ndof\_local or something,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11770}11770       \textcolor{comment}{// but I can't really test it...}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11771}11771 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11772}11772       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_af5e9f1623cad361048856a4c0463ea23}{distributed}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11773}11773       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11774}11774         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Not yet implemented for distributed problems"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11775}11775                             OOMPH\_EXCEPTION\_LOCATION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11776}11776                             OOMPH\_CURRENT\_FUNCTION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11777}11777       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11778}11778 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11779}11779 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11780}11780       \textcolor{comment}{// With multiple time steppers this is much more complex becuase you}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11781}11781       \textcolor{comment}{// need to check the time stepper for each data to get the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11782}11782       \textcolor{comment}{// predictor\_storage\_index(). Do-\/able if you need it though.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11783}11783       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_af1e8f8a739453250eb3744fea2a3b983}{Time\_stepper\_pt}}.size() != 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11784}11784       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11785}11785         \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} err = \textcolor{stringliteral}{"{}Not implemented for multiple time steppers"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11786}11786         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11787}11787           err, OOMPH\_EXCEPTION\_LOCATION, OOMPH\_CURRENT\_FUNCTION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11788}11788       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11789}11789 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11790}11790       \textcolor{comment}{// Get predicted values}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11791}11791       \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} predicted\_dofs;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11792}11792       \mbox{\hyperlink{classoomph_1_1Problem_ae2ef66732d76053dba15001818c0605c}{get\_dofs}}(\mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}()-\/>predictor\_storage\_index(), predicted\_dofs);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11793}11793 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11794}11794       \textcolor{comment}{// Update dofs at current step}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11795}11795       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}(); \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11796}11796       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11797}11797         \mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) = predicted\_dofs[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11798}11798       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11799}11799     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11800}11800   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11801}11801 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11802}11802   \textcolor{comment}{//======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11803}11803 \textcolor{comment}{  /// Enable recycling of the mass matrix in explicit timestepping}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11804}11804 \textcolor{comment}{  /// schemes. Useful for timestepping on fixed meshes when you want}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11805}11805 \textcolor{comment}{  /// to avoid the linear solve phase.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11806}11806 \textcolor{comment}{}  \textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11807}\mbox{\hyperlink{classoomph_1_1Problem_a6a9e63d6e585eabe4e3e551f01f658ae}{11807}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a6a9e63d6e585eabe4e3e551f01f658ae}{Problem::enable\_mass\_matrix\_reuse}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11808}11808   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11809}11809     \mbox{\hyperlink{classoomph_1_1Problem_af4d25809ac090102a4d4a398e4ad0e26}{Mass\_matrix\_reuse\_is\_enabled}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11810}11810     \mbox{\hyperlink{classoomph_1_1Problem_a6067c6d344363a073fb8d02a99fb7ed0}{Mass\_matrix\_has\_been\_computed}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11811}11811 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11812}11812     \textcolor{comment}{// If we have a discontinuous formulation set the elements to reuse}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11813}11813     \textcolor{comment}{// their own mass matrices}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11814}11814     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a97ca0078fff6adca318835c11503dc2d}{Discontinuous\_element\_formulation}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11815}11815     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11816}11816       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_element = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{Problem::mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11817}11817       \textcolor{comment}{// Loop over the other elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11818}11818       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11819}11819       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11820}11820         \textcolor{comment}{// Cache the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11821}11821         \mbox{\hyperlink{classoomph_1_1DGElement}{DGElement}}* \textcolor{keyword}{const} elem\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11822}11822           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DGElement}{DGElement}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{Problem::mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11823}11823         elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1DGElement_a62c5daa21324a839419ec4feec8e0685}{enable\_mass\_matrix\_reuse}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11824}11824       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11825}11825     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11826}11826   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11827}11827 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11828}11828   \textcolor{comment}{//======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11829}11829 \textcolor{comment}{  /// Turn off the recyling of the mass matrix in explicit}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11830}11830 \textcolor{comment}{  /// time-\/stepping schemes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11831}11831 \textcolor{comment}{}  \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11832}\mbox{\hyperlink{classoomph_1_1Problem_a399ca4ccf551f9bf5621f9855e899af6}{11832}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a399ca4ccf551f9bf5621f9855e899af6}{Problem::disable\_mass\_matrix\_reuse}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11833}11833   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11834}11834     \mbox{\hyperlink{classoomph_1_1Problem_af4d25809ac090102a4d4a398e4ad0e26}{Mass\_matrix\_reuse\_is\_enabled}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11835}11835     \mbox{\hyperlink{classoomph_1_1Problem_a6067c6d344363a073fb8d02a99fb7ed0}{Mass\_matrix\_has\_been\_computed}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11836}11836 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11837}11837     \textcolor{comment}{// If we have a discontinuous formulation set the element-\/level}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11838}11838     \textcolor{comment}{// function}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11839}11839     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a97ca0078fff6adca318835c11503dc2d}{Discontinuous\_element\_formulation}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11840}11840     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11841}11841       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_element = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{Problem::mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11842}11842       \textcolor{comment}{// Loop over the other elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11843}11843       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11844}11844       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11845}11845         \textcolor{comment}{// Cache the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11846}11846         \mbox{\hyperlink{classoomph_1_1DGElement}{DGElement}}* \textcolor{keyword}{const} elem\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11847}11847           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DGElement}{DGElement}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{Problem::mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11848}11848         elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1DGElement_a1fb4172f65716e0b5277efc65b182d44}{disable\_mass\_matrix\_reuse}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11849}11849       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11850}11850     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11851}11851   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11852}11852 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11853}11853 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11854}11854   \textcolor{comment}{//=========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11855}11855 \textcolor{comment}{  /// Copy Data values, nodal positions etc from specified problem.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11856}11856 \textcolor{comment}{  /// Note: This is not a copy constructor. We assume that the current}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11857}11857 \textcolor{comment}{  /// and the "{}original"{} problem have both been created by calling}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11858}11858 \textcolor{comment}{  /// the same problem constructor so that all Data objects,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11859}11859 \textcolor{comment}{  /// time steppers etc. in the two problems are completely independent.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11860}11860 \textcolor{comment}{  /// This function copies the nodal, internal and global values}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11861}11861 \textcolor{comment}{  /// and the time parameters from the original problem into "{}this"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11862}11862 \textcolor{comment}{  /// one. This functionality is required, e.g. for}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11863}11863 \textcolor{comment}{  /// multigrid computations.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11864}11864 \textcolor{comment}{}  \textcolor{comment}{//=========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11865}\mbox{\hyperlink{classoomph_1_1Problem_a4ac828f337a2d4e77e566ff95d01bad0}{11865}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a4ac828f337a2d4e77e566ff95d01bad0}{Problem::copy}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* orig\_problem\_pt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11866}11866   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11867}11867     \textcolor{comment}{// Copy time}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11868}11868     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11869}11869 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11870}11870     \textcolor{comment}{// Flag to indicate that orig problem is unsteady problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11871}11871     \textcolor{keywordtype}{bool} unsteady\_flag = (orig\_problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}() != 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11872}11872 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11873}11873     \textcolor{comment}{// Copy current time and previous time increments for proper unsteady run}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11874}11874     \textcolor{keywordflow}{if} (unsteady\_flag)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11875}11875     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11876}11876       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Copying an unsteady problem."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11877}11877       \textcolor{comment}{// Current time}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11878}11878       this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_a43461269b799134f4b7a9aca3e79a7c8}{time}}() = orig\_problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_a43461269b799134f4b7a9aca3e79a7c8}{time}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11879}11879       \textcolor{comment}{// Timesteps}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11880}11880       \textcolor{keywordtype}{unsigned} n\_dt = orig\_problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_ad40953c471eb3ce59921e6870ed755f3}{ndt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11881}11881       \mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_aeab1acb1e182797c4194af84c0583c3f}{resize}}(n\_dt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11882}11882       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dt; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11883}11883       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11884}11884         \mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_abd4c96948929a36a14a3ceaafa52bd42}{dt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) = orig\_problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_abd4c96948929a36a14a3ceaafa52bd42}{dt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11885}11885       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11886}11886 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11887}11887       \textcolor{comment}{// Find out how many timesteppers there are}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11888}11888       \textcolor{keywordtype}{unsigned} n\_time\_steppers = \mbox{\hyperlink{classoomph_1_1Problem_ace3cdf55009c3bff21d2b7d3706d522a}{ntime\_stepper}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11889}11889 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11890}11890       \textcolor{comment}{// Loop over them all and set the weights}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11891}11891       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_time\_steppers; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11892}11892       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11893}11893         \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_a028fa3a8d3c6db6b0ddf580cb0468d55}{set\_weights}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11894}11894       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11895}11895     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11896}11896 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11897}11897     \textcolor{comment}{// Copy nodes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11898}11898     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11899}11899 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11900}11900     \textcolor{comment}{// Loop over submeshes:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11901}11901     \textcolor{keywordtype}{unsigned} nmesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11902}11902     \textcolor{keywordflow}{if} (nmesh == 0) nmesh = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11903}11903     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < nmesh; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11904}11904     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11905}11905       \textcolor{comment}{// Find number of nodes in present mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11906}11906       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_node = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(m)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a945e7823d1a2af243b5b7f7866aaff5e}{nnode}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11907}11907 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11908}11908       \textcolor{comment}{// Check \# of nodes:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11909}11909       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_node\_orig = orig\_problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(m)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a945e7823d1a2af243b5b7f7866aaff5e}{nnode}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11910}11910       \textcolor{keywordflow}{if} (n\_node != n\_node\_orig)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11911}11911       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11912}11912         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11913}11913         error\_message << \textcolor{stringliteral}{"{}Number of nodes in copy "{}} << n\_node}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11914}11914                       << \textcolor{stringliteral}{"{} not equal to the number in the original "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11915}11915                       << n\_node\_orig << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11916}11916 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11917}11917         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11918}11918                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11919}11919                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11920}11920       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11921}11921 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11922}11922       \textcolor{comment}{// Loop over the nodes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11923}11923       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_node; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11924}11924       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11925}11925         \textcolor{comment}{// Try to cast to elastic node}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11926}11926         \mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}* el\_node\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11927}11927           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(m)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11928}11928         \textcolor{keywordflow}{if} (el\_node\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11929}11929         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11930}11930           \mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}* el\_node\_orig\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11931}11931             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}*\textcolor{keyword}{>}(orig\_problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(m)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11932}11932           el\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidNode_ae4dfa5355b84b58745b0c6a3fef60112}{copy}}(el\_node\_orig\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11933}11933         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11934}11934         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11935}11935         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11936}11936           \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(m)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1Node_a103b12afe541e9bbe5c0790c1c0efe55}{copy}}(orig\_problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(m)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11937}11937         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11938}11938       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11939}11939     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11940}11940 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11941}11941 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11942}11942     \textcolor{comment}{// Copy global data:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11943}11943     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11944}11944 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11945}11945     \textcolor{comment}{// Number of global data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11946}11946     \textcolor{keywordtype}{unsigned} n\_global = \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11947}11947 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11948}11948     \textcolor{comment}{// Check \# of nodes in orig problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11949}11949     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_global\_orig = orig\_problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a60a9b6861928cf9115110b5bfc7d11a7}{nglobal\_data}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11950}11950     \textcolor{keywordflow}{if} (n\_global != n\_global\_orig)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11951}11951     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11952}11952       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11953}11953       error\_message << \textcolor{stringliteral}{"{}Number of global data in copy "{}} << n\_global}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11954}11954                     << \textcolor{stringliteral}{"{} not equal to the number in the original "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11955}11955                     << n\_global\_orig << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11956}11956 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11957}11957       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11958}11958         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11959}11959     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11960}11960 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11961}11961     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} iglobal = 0; iglobal < n\_global; iglobal++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11962}11962     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11963}11963       \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[iglobal]-\/>copy(orig\_problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a91a255f86e3af72ba1f27d9dee363927}{global\_data\_pt}}(iglobal));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11964}11964     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11965}11965 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11966}11966 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11967}11967     \textcolor{comment}{// Copy internal data of elements:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11968}11968     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11969}11969 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11970}11970     \textcolor{comment}{// Loop over submeshes:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11971}11971     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < nmesh; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11972}11972     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11973}11973       \textcolor{comment}{// Loop over elements and deal with internal data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11974}11974       \textcolor{keywordtype}{unsigned} n\_element = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(m)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11975}11975       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11976}11976       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11977}11977         \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* el\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(m)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11978}11978         \textcolor{keywordtype}{unsigned} n\_internal = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a6b736de0af4c92831968636479b3480e}{ninternal\_data}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11979}11979         \textcolor{keywordflow}{if} (n\_internal > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11980}11980         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11981}11981           \textcolor{comment}{// Check \# of internals :}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11982}11982           \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_internal\_orig =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11983}11983             orig\_problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(m)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}})-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a6b736de0af4c92831968636479b3480e}{ninternal\_data}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11984}11984           \textcolor{keywordflow}{if} (n\_internal != n\_internal\_orig)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11985}11985           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11986}11986             std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11987}11987             error\_message << \textcolor{stringliteral}{"{}Number of internal data in copy "{}} << n\_internal}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11988}11988                           << \textcolor{stringliteral}{"{} not equal to the number in the original "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11989}11989                           << n\_internal\_orig << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11990}11990 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11991}11991             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11992}11992                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11993}11993                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11994}11994           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11995}11995           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_internal; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11996}11996           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11997}11997             el\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a3b83389f2c80788013421c6d59604f0b}{internal\_data\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1Data_a57889a9db7ca009434f0268173fcf3f8}{copy}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11998}11998               orig\_problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(m)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}})-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a3b83389f2c80788013421c6d59604f0b}{internal\_data\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l11999}11999           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12000}12000         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12001}12001       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12002}12002     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12003}12003   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12004}12004 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12005}12005   \textcolor{comment}{//=========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12006}12006 \textcolor{comment}{  /// Make and return a pointer to the copy of the problem. A virtual}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12007}12007 \textcolor{comment}{  /// function that must be filled in by the user is they wish to perform}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12008}12008 \textcolor{comment}{  /// adaptive refinement in bifurcation tracking or in multigrid problems.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12009}12009 \textcolor{comment}{  /// ALH: WILL NOT BE NECESSARY IN BIFURCATION TRACKING IN LONG RUN...}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12010}12010 \textcolor{comment}{}  \textcolor{comment}{//=========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12011}\mbox{\hyperlink{classoomph_1_1Problem_a78ac2b1d2483f49198203e192d3b2871}{12011}}   \mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \mbox{\hyperlink{classoomph_1_1Problem_a78ac2b1d2483f49198203e192d3b2871}{Problem::make\_copy}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12012}12012   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12013}12013     std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12014}12014     error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12015}12015       << \textcolor{stringliteral}{"{}This function must be overloaded in your specific problem, and must\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12016}12016       << \textcolor{stringliteral}{"{}create an exact copy of your problem. Usually this will be achieved\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12017}12017       << \textcolor{stringliteral}{"{}by a call to the constructor with exactly the same arguments as "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12018}12018          \textcolor{stringliteral}{"{}used\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12019}12019 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12020}12020     \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12021}12021       error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12022}12022   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12023}12023 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12024}12024 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12025}12025   \textcolor{comment}{//=========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12026}12026 \textcolor{comment}{  /// Dump refinement pattern of all refineable meshes and all  generic}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12027}12027 \textcolor{comment}{  /// Problem data to file for restart.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12028}12028 \textcolor{comment}{}  \textcolor{comment}{//=========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12029}\mbox{\hyperlink{classoomph_1_1Problem_a804050357ac754151b86c2aec4dabc2d}{12029}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a804050357ac754151b86c2aec4dabc2d}{Problem::dump}}(std::ofstream\& dump\_file)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12030}12030 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12031}12031     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12032}12032     \textcolor{keywordtype}{unsigned} n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12033}12033 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12034}12034     dump\_file << std::max(\textcolor{keywordtype}{unsigned}(1), n\_mesh) << \textcolor{stringliteral}{"{} \# number of (sub)meshes "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12035}12035               << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12036}12036 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12037}12037     \textcolor{comment}{// Single mesh:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12038}12038     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12039}12039     \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12040}12040     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12041}12041       \textcolor{comment}{// Dump level of refinement before pruning}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12042}12042       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12043}12043             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12044}12044       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12045}12045         dump\_file << mmesh\_pt-\/>uniform\_refinement\_level\_when\_pruned()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12046}12046                   << \textcolor{stringliteral}{"{} \# uniform refinement when pruned "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12047}12047       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12048}12048       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12049}12049       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12050}12050         dump\_file << 0 << \textcolor{stringliteral}{"{} \# (fake) uniform refinement when pruned "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12051}12051                   << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12052}12052       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12053}12053       dump\_file << 9999 << \textcolor{stringliteral}{"{} \# test flag for end of sub-\/meshes "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12054}12054     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12055}12055 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12056}12056     \textcolor{comment}{// Multiple submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12057}12057     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12058}12058     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12059}12059     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12060}12060       \textcolor{comment}{// Loop over submeshes to dump level of refinement before pruning}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12061}12061       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imesh = 0; imesh < n\_mesh; imesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12062}12062       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12063}12063         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12064}12064               \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12065}12065         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12066}12066           dump\_file << mmesh\_pt-\/>uniform\_refinement\_level\_when\_pruned()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12067}12067                     << \textcolor{stringliteral}{"{} \# uniform refinement when pruned "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12068}12068         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12069}12069         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12070}12070         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12071}12071           dump\_file << 0 << \textcolor{stringliteral}{"{} \# (fake) uniform refinement when pruned "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12072}12072                     << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12073}12073         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12074}12074       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12075}12075       dump\_file << 9999 << \textcolor{stringliteral}{"{} \# test flag for end of sub-\/meshes "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12076}12076     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12077}12077 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12078}12078 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12079}12079 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12080}12080     \textcolor{keyword}{const} \textcolor{keywordtype}{int} my\_rank = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12081}12081 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12082}12082     \textcolor{comment}{// Record destination of all base elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12083}12083     \textcolor{keywordtype}{unsigned} n = \mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12084}12084     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} local\_base\_element\_processor(n, -\/1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12085}12085     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} base\_element\_processor(n, -\/1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12086}12086     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12087}12087     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12088}12088       \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* el\_pt = \mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12089}12089       \textcolor{keywordflow}{if} (el\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12090}12090       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12091}12091         \textcolor{keywordflow}{if} (!el\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a0d9869eaf7d6e104c1e465b0d3cd6a9b}{is\_halo}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12092}12092         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12093}12093           local\_base\_element\_processor[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = my\_rank;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12094}12094         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12095}12095       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12096}12096     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12097}12097 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12098}12098 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12099}12099     \textcolor{comment}{// Get target for all base elements by reduction}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12100}12100     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12101}12101     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12102}12102       \textcolor{comment}{// Check that the base elements have been associated to a processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12103}12103       \textcolor{comment}{// (the Base\_mesh\_elemen\_pt is only used for structured meshes,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12104}12104       \textcolor{comment}{// therefore, if there are no ustructured meshes as part of the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12105}12105       \textcolor{comment}{// problem this container will be empty)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12106}12106       \textcolor{keywordflow}{if} (n > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12107}12107       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12108}12108         MPI\_Allreduce(\&local\_base\_element\_processor[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12109}12109                       \&base\_element\_processor[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12110}12110                       n,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12111}12111                       MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12112}12112                       MPI\_MAX,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12113}12113                       this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12114}12114       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12115}12115     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12116}12116     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12117}12117     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12118}12118       \textcolor{comment}{// All the same...}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12119}12119       base\_element\_processor = local\_base\_element\_processor;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12120}12120     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12121}12121 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12122}12122 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12123}12123     dump\_file << n << \textcolor{stringliteral}{"{} \# Number of base elements; partitioning follows.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12124}12124     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12125}12125     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12126}12126       dump\_file << base\_element\_processor[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12127}12127     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12128}12128     dump\_file << \textcolor{stringliteral}{"{}8888 \#test flag for end of base element distribution\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12129}12129 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12130}12130 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12131}12131 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12132}12132     \textcolor{comment}{// Single mesh:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12133}12133     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12134}12134     \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12135}12135     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12136}12136       \textcolor{comment}{// Dump single mesh refinement pattern (if mesh is refineable)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12137}12137       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12138}12138             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12139}12139       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12140}12140         mmesh\_pt-\/>dump\_refinement(dump\_file);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12141}12141       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12142}12142 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_TRIANGLE\_LIB}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12143}12143       \textcolor{comment}{// Dump triangle mesh TriangulateIO which represents mesh topology}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12144}12144       \mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}* mmesh\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12145}12145       \textcolor{keywordflow}{if} (mmesh\_pt != 0 \&\& mmesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TriangleMeshBase_a69a2fe3d5e77ec39b9df4b3174b58c47}{use\_triangulateio\_restart}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12146}12146       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12147}12147 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12148}12148         \textcolor{comment}{// Check if the mesh is distributed, if that is the case then}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12149}12149         \textcolor{comment}{// additional info. needs to be saved}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12150}12150         \textcolor{keywordflow}{if} (mmesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1ab35b022b95f2d28c53aa58859bd6b5}{is\_mesh\_distributed}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12151}12151         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12152}12152           \textcolor{comment}{// Dump the info. related with the distribution of the mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12153}12153           mmesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TriangleMeshBase_ad8e275d5f2528d9958964438086be8f4}{dump\_distributed\_info\_for\_restart}}(dump\_file);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12154}12154         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12155}12155 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12156}12156         mmesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TriangleMeshBase_a3b27444232702a4bbbeb95aa9c963c07}{dump\_triangulateio}}(dump\_file);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12157}12157       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12158}12158 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12159}12159     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12160}12160 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12161}12161     \textcolor{comment}{// Multiple submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12162}12162     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12163}12163     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12164}12164     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12165}12165       \textcolor{comment}{// Loop over submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12166}12166       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imesh = 0; imesh < n\_mesh; imesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12167}12167       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12168}12168         \textcolor{comment}{// Dump single mesh refinement pattern (if mesh is refineable)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12169}12169         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12170}12170               \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12171}12171         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12172}12172           mmesh\_pt-\/>dump\_refinement(dump\_file);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12173}12173         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12174}12174 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_TRIANGLE\_LIB}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12175}12175         \textcolor{comment}{// Dump triangle mesh TriangulateIO which represents mesh topology}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12176}12176         \mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12177}12177           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12178}12178         \textcolor{keywordflow}{if} (mmesh\_pt != 0 \&\& mmesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TriangleMeshBase_a69a2fe3d5e77ec39b9df4b3174b58c47}{use\_triangulateio\_restart}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12179}12179         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12180}12180 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12181}12181           \textcolor{comment}{// Check if the mesh is distributed, if that is the case then}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12182}12182           \textcolor{comment}{// additional info. needs to be saved}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12183}12183           \textcolor{keywordflow}{if} (mmesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1ab35b022b95f2d28c53aa58859bd6b5}{is\_mesh\_distributed}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12184}12184           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12185}12185             \textcolor{comment}{// Dump the info. related with the distribution of the mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12186}12186             mmesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TriangleMeshBase_ad8e275d5f2528d9958964438086be8f4}{dump\_distributed\_info\_for\_restart}}(dump\_file);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12187}12187           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12188}12188 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12189}12189           mmesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TriangleMeshBase_a3b27444232702a4bbbeb95aa9c963c07}{dump\_triangulateio}}(dump\_file);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12190}12190         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12191}12191 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12192}12192       \} \textcolor{comment}{// End of loop over submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12193}12193     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12194}12194 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12195}12195 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12196}12196     \textcolor{comment}{// Dump time}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12197}12197     \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12198}12198 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12199}12199     \textcolor{comment}{// Flag to indicate unsteady run}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12200}12200     \textcolor{keywordtype}{bool} unsteady\_flag = (\mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}() != 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12201}12201     dump\_file << unsteady\_flag << \textcolor{stringliteral}{"{} \# bool flag for unsteady"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12202}12202 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12203}12203     \textcolor{comment}{// Current time and previous time increments for proper unsteady run}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12204}12204     \textcolor{keywordflow}{if} (unsteady\_flag)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12205}12205     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12206}12206       \textcolor{comment}{// Current time}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12207}12207       dump\_file << \mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_a43461269b799134f4b7a9aca3e79a7c8}{time}}() << \textcolor{stringliteral}{"{} \# Time "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12208}12208       \textcolor{comment}{// Timesteps}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12209}12209       \textcolor{keywordtype}{unsigned} n\_dt = \mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_ad40953c471eb3ce59921e6870ed755f3}{ndt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12210}12210       dump\_file << n\_dt << \textcolor{stringliteral}{"{} \# Number of timesteps "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12211}12211       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dt; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12212}12212       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12213}12213         dump\_file << \mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_abd4c96948929a36a14a3ceaafa52bd42}{dt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) << \textcolor{stringliteral}{"{} \# dt "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12214}12214       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12215}12215     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12216}12216     \textcolor{comment}{// Dummy time and previous time increments for steady run}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12217}12217     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12218}12218     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12219}12219       \textcolor{comment}{// Current time}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12220}12220       dump\_file << \textcolor{stringliteral}{"{}0.0 \# Dummy time from steady run "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12221}12221       \textcolor{comment}{// Timesteps}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12222}12222       dump\_file << \textcolor{stringliteral}{"{}0 \# Dummy number of timesteps from steady run"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12223}12223     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12224}12224 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12225}12225     \textcolor{comment}{// Loop over submeshes and dump their data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12226}12226     \textcolor{keywordtype}{unsigned} nmesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12227}12227     \textcolor{keywordflow}{if} (nmesh == 0) nmesh = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12228}12228     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < nmesh; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12229}12229     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12230}12230       \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(m)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af821b936768868ea5dd91495e9ae3bc0}{dump}}(dump\_file);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12231}12231     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12232}12232 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12233}12233     \textcolor{comment}{// Dump global data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12234}12234 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12235}12235     \textcolor{comment}{// Loop over global data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12236}12236     \textcolor{keywordtype}{unsigned} Nglobal = \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12237}12237     dump\_file << Nglobal << \textcolor{stringliteral}{"{} \# number of global Data items "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12238}12238     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} iglobal = 0; iglobal < Nglobal; iglobal++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12239}12239     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12240}12240       \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[iglobal]-\/>dump(dump\_file);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12241}12241       dump\_file << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12242}12242     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12243}12243   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12244}12244 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12245}12245   \textcolor{comment}{//=========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12246}12246 \textcolor{comment}{  /// Read refinement pattern of all refineable meshes and refine them}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12247}12247 \textcolor{comment}{  /// accordingly, then read all Data and nodal position info from}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12248}12248 \textcolor{comment}{  /// file for restart. Return flag to indicate if the restart was from}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12249}12249 \textcolor{comment}{  /// steady or unsteady solution.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12250}12250 \textcolor{comment}{}  \textcolor{comment}{//=========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12251}\mbox{\hyperlink{classoomph_1_1Problem_ae27a3057515ddaa60d2ecc684d517e8f}{12251}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ae27a3057515ddaa60d2ecc684d517e8f}{Problem::read}}(std::ifstream\& restart\_file, \textcolor{keywordtype}{bool}\& unsteady\_restart)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12252}12252   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12253}12253     \textcolor{comment}{// Check if the file is actually open as it won't be if it doesn't}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12254}12254     \textcolor{comment}{// exist! In that case we're almost certainly restarting the run on}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12255}12255     \textcolor{comment}{// a larger number of processors than the restart data was produced.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12256}12256     \textcolor{comment}{// Say so and return}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12257}12257     \textcolor{keywordtype}{bool} restart\_file\_is\_open = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12258}12258     \textcolor{keywordflow}{if} (!restart\_file.is\_open())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12259}12259     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12260}12260       std::ostringstream warn\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12261}12261       warn\_message << \textcolor{stringliteral}{"{}Restart file isn't open -\/-\/ I'm assuming that this is\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12262}12262       warn\_message << \textcolor{stringliteral}{"{}because we're restarting on a larger number of\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12263}12263       warn\_message << \textcolor{stringliteral}{"{}processor than were in use when the restart data was \(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12264}12264       warn\_message << \textcolor{stringliteral}{"{}dumped.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12265}12265       \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12266}12266         warn\_message.str(), \textcolor{stringliteral}{"{}Problem::read()"{}}, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12267}12267       restart\_file\_is\_open = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12268}12268     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12269}12269 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12270}12270     \textcolor{comment}{// Number of (sub)meshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12271}12271     \textcolor{keywordtype}{unsigned} n\_mesh = std::max(\textcolor{keywordtype}{unsigned}(1), \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12272}12272 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12273}12273     \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} input\_string;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12274}12274 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12275}12275     \textcolor{comment}{// Read line up to termination sign}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12276}12276     getline(restart\_file, input\_string, \textcolor{charliteral}{'\#'});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12277}12277 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12278}12278     \textcolor{comment}{// Ignore rest of line}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12279}12279     restart\_file.ignore(80, \textcolor{charliteral}{'\(\backslash\)n'});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12280}12280 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12281}12281     \textcolor{comment}{// Read in number of sub-\/meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12282}12282     \textcolor{keywordtype}{unsigned} n\_submesh\_read;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12283}12283     n\_submesh\_read = std::atoi(input\_string.c\_str());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12284}12284 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12285}12285 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12286}12286     \textcolor{keywordflow}{if} (restart\_file\_is\_open)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12287}12287     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12288}12288       \textcolor{keywordflow}{if} (n\_submesh\_read != n\_mesh)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12289}12289       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12290}12290         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12291}12291         error\_message}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12292}12292           << \textcolor{stringliteral}{"{}Number of sub-\/meshes specified in restart file, "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12293}12293           << n\_submesh\_read << \textcolor{stringliteral}{"{} doesn't \(\backslash\)n match the my number of sub-\/meshes,"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12294}12294           << n\_mesh << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12295}12295           << \textcolor{stringliteral}{"{}Make sure all sub-\/meshes have been added to the global mesh\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12296}12296           << \textcolor{stringliteral}{"{}when calling the Problem::dump() function.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12297}12297         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12298}12298                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12299}12299                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12300}12300       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12301}12301     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12302}12302 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12303}12303     \textcolor{comment}{// Suppress comiler warnings about non-\/used variable}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12304}12304     n\_submesh\_read++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12305}12305     n\_submesh\_read-\/-\/;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12306}12306 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12307}12307 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12308}12308 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12309}12309     \textcolor{comment}{// Read levels of refinement before pruning}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12310}12310 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12311}12311     \textcolor{keywordtype}{bool} refine\_and\_prune\_required = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12312}12312 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12313}12313     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} nrefinement\_for\_mesh(n\_mesh);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12314}12314     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_mesh; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12315}12315     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12316}12316       \textcolor{comment}{// Read line up to termination sign}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12317}12317       getline(restart\_file, input\_string, \textcolor{charliteral}{'\#'});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12318}12318 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12319}12319       \textcolor{comment}{// Ignore rest of line}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12320}12320       restart\_file.ignore(80, \textcolor{charliteral}{'\(\backslash\)n'});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12321}12321 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12322}12322       \textcolor{comment}{// Convert}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12323}12323       nrefinement\_for\_mesh[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = std::atoi(input\_string.c\_str());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12324}12324 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12325}12325       \textcolor{comment}{// Get pointer to sub-\/mesh in incarnation as tree-\/based refineable mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12326}12326       \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* ref\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12327}12327         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12328}12328 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12329}12329       \textcolor{comment}{// If it's not a tree-\/based refineable mesh, ignore the following}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12330}12330       \textcolor{keywordflow}{if} (ref\_mesh\_pt == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12331}12331       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12332}12332         \textcolor{keywordflow}{if} (nrefinement\_for\_mesh[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12333}12333         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12334}12334           std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12335}12335           error\_stream << \textcolor{stringliteral}{"{}Nonzero uniform-\/refinement-\/when-\/pruned specified\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12336}12336                        << \textcolor{stringliteral}{"{}even though mesh is not tree-\/based. Odd. May want\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12337}12337                        << \textcolor{stringliteral}{"{}to check this carefully before disabling this \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12338}12338                        << \textcolor{stringliteral}{"{}warning/error -\/-\/ most likely if/when we start to\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12339}12339                        << \textcolor{stringliteral}{"{}prune unstructured meshes [though I can't see why\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12340}12340                        << \textcolor{stringliteral}{"{}we would want to do this, given that they are \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12341}12341                        << \textcolor{stringliteral}{"{}currently totally re-\/generated...]\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12342}12342           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12343}12343                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12344}12344                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12345}12345         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12346}12346       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12347}12347       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12348}12348       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12349}12349         \textcolor{comment}{// Get min and max refinement level}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12350}12350         \textcolor{keywordtype}{unsigned} local\_min\_ref = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12351}12351         \textcolor{keywordtype}{unsigned} local\_max\_ref = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12352}12352         ref\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a937e4321288b6642d5057498f7659d76}{get\_refinement\_levels}}(local\_min\_ref, local\_max\_ref);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12353}12353 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12354}12354         \textcolor{comment}{// Overall min refinement level over all meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12355}12355         \textcolor{keywordtype}{unsigned} min\_ref = local\_min\_ref;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12356}12356 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12357}12357 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12358}12358         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12359}12359         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12360}12360           \textcolor{comment}{// Reconcile between processors: If (e.g. following}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12361}12361           \textcolor{comment}{// distribution/pruning) the mesh has no elements on this}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12362}12362           \textcolor{comment}{// processor) then ignore its contribution to the poll of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12363}12363           \textcolor{comment}{// max/min refinement levels}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12364}12364           \textcolor{keywordtype}{int} int\_local\_min\_ref = local\_min\_ref;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12365}12365           \textcolor{keywordflow}{if} (ref\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12366}12366           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12367}12367             int\_local\_min\_ref = INT\_MAX;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12368}12368           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12369}12369           \textcolor{keywordtype}{int} int\_min\_ref = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12370}12370           MPI\_Allreduce(\&int\_local\_min\_ref,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12371}12371                         \&int\_min\_ref,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12372}12372                         1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12373}12373                         MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12374}12374                         MPI\_MIN,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12375}12375                         \mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12376}12376 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12377}12377           \textcolor{comment}{// Overall min refinement level over all meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12378}12378           min\_ref = unsigned(int\_min\_ref);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12379}12379         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12380}12380 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12381}12381 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12382}12382         \textcolor{comment}{// Need to refine less}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12383}12383         \textcolor{keywordflow}{if} (nrefinement\_for\_mesh[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] >= min\_ref)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12384}12384         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12385}12385           nrefinement\_for\_mesh[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] -\/= min\_ref;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12386}12386         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12387}12387       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12388}12388 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12389}12389 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12390}12390       \textcolor{keywordflow}{if} (nrefinement\_for\_mesh[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12391}12391       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12392}12392         refine\_and\_prune\_required = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12393}12393       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12394}12394 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12395}12395     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12396}12396 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12397}12397 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12398}12398     \textcolor{comment}{// Reconcile overall need to refine and prune (even empty}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12399}12399     \textcolor{comment}{// processors have to participate in some communication!)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12400}12400 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12401}12401     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12402}12402     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12403}12403       \textcolor{keywordtype}{unsigned} local\_req\_flag = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12404}12404       \textcolor{keywordtype}{unsigned} req\_flag = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12405}12405       \textcolor{keywordflow}{if} (refine\_and\_prune\_required)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12406}12406       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12407}12407         local\_req\_flag = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12408}12408       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12409}12409       MPI\_Allreduce(\&local\_req\_flag,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12410}12410                     \&req\_flag,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12411}12411                     1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12412}12412                     MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12413}12413                     MPI\_MAX,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12414}12414                     \mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12415}12415       refine\_and\_prune\_required = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12416}12416       \textcolor{keywordflow}{if} (req\_flag == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12417}12417       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12418}12418         refine\_and\_prune\_required = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12419}12419       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12420}12420 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12421}12421       \textcolor{comment}{// If refine and prune is required make number of uniform}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12422}12422       \textcolor{comment}{// refinements for each mesh consistent otherwise code}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12423}12423       \textcolor{comment}{// hangs on "{}empty"{} processors for which no restart file exists}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12424}12424       \textcolor{keywordflow}{if} (refine\_and\_prune\_required)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12425}12425       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12426}12426         \textcolor{comment}{// This is what we have locally}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12427}12427         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} local\_nrefinement\_for\_mesh(nrefinement\_for\_mesh);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12428}12428         \textcolor{comment}{// Synchronise over all processors with max operation}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12429}12429         MPI\_Allreduce(\&local\_nrefinement\_for\_mesh[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12430}12430                       \&nrefinement\_for\_mesh[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12431}12431                       n\_mesh,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12432}12432                       MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12433}12433                       MPI\_MAX,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12434}12434                       \mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12435}12435 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12436}12436 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12437}12437         \textcolor{comment}{// Check it: Reconciliation should only be required for}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12438}12438         \textcolor{comment}{// for processors on which no restart file was opened and}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12439}12439         \textcolor{comment}{// for which the meshes are therefore empty}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12440}12440         \textcolor{keywordtype}{bool} fail = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12441}12441         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12442}12442         error\_message << \textcolor{stringliteral}{"{}Number of uniform refinements was not consistent \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12443}12443                       << \textcolor{stringliteral}{"{}for following meshes during restart on processor \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12444}12444                       << \textcolor{stringliteral}{"{}on which restart file could be opened:\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12445}12445         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_mesh; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12446}12446         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12447}12447           \textcolor{keywordflow}{if} ((local\_nrefinement\_for\_mesh[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] != nrefinement\_for\_mesh[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]) \&\&}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12448}12448               restart\_file\_is\_open)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12449}12449           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12450}12450             fail = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12451}12451             error\_message << \textcolor{stringliteral}{"{}Sub-\/mesh: "{}} << \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} << \textcolor{stringliteral}{"{}; local nrefinement: "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12452}12452                           << local\_nrefinement\_for\_mesh[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] << \textcolor{stringliteral}{"{} "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12453}12453                           << \textcolor{stringliteral}{"{}; global/synced nrefinement: "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12454}12454                           << nrefinement\_for\_mesh[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12455}12455           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12456}12456         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12457}12457         \textcolor{keywordflow}{if} (fail)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12458}12458         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12459}12459           \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12460}12460             error\_message.str(), \textcolor{stringliteral}{"{}Problem::read()"{}}, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12461}12461         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12462}12462 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12463}12463       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12464}12464     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12465}12465 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12466}12466 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12467}12467     \textcolor{comment}{// Read line up to termination sign}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12468}12468     getline(restart\_file, input\_string, \textcolor{charliteral}{'\#'});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12469}12469 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12470}12470     \textcolor{comment}{// Ignore rest of line}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12471}12471     restart\_file.ignore(80, \textcolor{charliteral}{'\(\backslash\)n'});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12472}12472 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12473}12473     \textcolor{comment}{// Check flag that indicates that we've read the final data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12474}12474     \textcolor{keywordtype}{unsigned} tmp;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12475}12475     tmp = std::atoi(input\_string.c\_str());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12476}12476 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12477}12477 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12478}12478     \textcolor{keywordflow}{if} (restart\_file\_is\_open)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12479}12479     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12480}12480       \textcolor{keywordflow}{if} (tmp != 9999)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12481}12481       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12482}12482         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12483}12483         error\_message}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12484}12484           << \textcolor{stringliteral}{"{}Error in reading restart data: Uniform refinement when pruned \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12485}12485           << \textcolor{stringliteral}{"{}flags should be followed by 9999.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12486}12486         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12487}12487                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12488}12488                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12489}12489       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12490}12490     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12491}12491 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12492}12492 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12493}12493     \textcolor{comment}{// Suppress comiler warnings about non-\/used variable}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12494}12494     tmp++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12495}12495     tmp-\/-\/;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12496}12496 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12497}12497 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12498}12498 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12499}12499 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12500}12500 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12501}12501     \textcolor{comment}{// Refine and prune if required}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12502}12502     \textcolor{keywordflow}{if} (refine\_and\_prune\_required)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12503}12503     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12504}12504       \mbox{\hyperlink{classoomph_1_1Problem_ade208b7d7d8e866d5ba896f03edb1f9a}{refine\_uniformly}}(nrefinement\_for\_mesh);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12505}12505       \mbox{\hyperlink{classoomph_1_1Problem_a8c5982a9323392e31a166e23a0c7f0a3}{prune\_halo\_elements\_and\_nodes}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12506}12506     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12507}12507 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12508}12508     \textcolor{comment}{// target\_domain\_for\_local\_non\_halo\_element[e] contains the number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12509}12509     \textcolor{comment}{// of the domain [0,1,...,nproc-\/1] to which non-\/halo element e on THE}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12510}12510     \textcolor{comment}{// CURRENT PROCESSOR ONLY has been assigned. The order of the non-\/halo}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12511}12511     \textcolor{comment}{// elements is the same as in the Problem's mesh, with the halo}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12512}12512     \textcolor{comment}{// elements being skipped.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12513}12513     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} target\_domain\_for\_local\_non\_halo\_element;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12514}12514 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12515}12515     \textcolor{comment}{// If a restart file has been generated using code compiled without MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12516}12516     \textcolor{comment}{// then it will not have any of the base element data.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12517}12517     \textcolor{comment}{// If we try to read in that file with code that has been compied using}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12518}12518     \textcolor{comment}{// MPI, even if running only one processor, then it will fail here.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12519}12519     \textcolor{comment}{// The ideal fix is to edit the restart file so that it contains the two}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12520}12520     \textcolor{comment}{// lines}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12521}12521     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12522}12522     \textcolor{comment}{// 0 \# Number of base elements; partitioning follows.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12523}12523     \textcolor{comment}{// 8888 \# Test flag for end of base element distribution}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12524}12524     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12525}12525     \textcolor{comment}{// after the end of the sub-\/meshes, but before the number of elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12526}12526     \textcolor{comment}{// However, we can determine that this is the problem if n\_base = 0,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12527}12527     \textcolor{comment}{// so there is a little bit of logic below to catch this case}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12528}12528 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12529}12529     \textcolor{comment}{// Store current location in the file (before we are about to read}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12530}12530     \textcolor{comment}{// in either the base mesh or number of elements of the first mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12531}12531     std::streampos position\_before\_base\_element = restart\_file.tellg();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12532}12532     \textcolor{comment}{// Boolean flag used to set whether to read in base element info}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12533}12533     \textcolor{keywordtype}{bool} read\_in\_base\_element\_info = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12534}12534 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12535}12535     \textcolor{comment}{// Read line up to termination sign}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12536}12536     getline(restart\_file, input\_string, \textcolor{charliteral}{'\#'});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12537}12537 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12538}12538     \textcolor{comment}{// Ignore rest of line}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12539}12539     restart\_file.ignore(80, \textcolor{charliteral}{'\(\backslash\)n'});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12540}12540 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12541}12541     \textcolor{comment}{// Get number of base elements as recorded}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12542}12542     \textcolor{keywordtype}{unsigned} n\_base\_element\_read\_in = atoi(input\_string.c\_str());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12543}12543     \textcolor{keywordtype}{unsigned} nbase = \mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12544}12544     \textcolor{keywordflow}{if} (restart\_file\_is\_open)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12545}12545     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12546}12546       \textcolor{keywordflow}{if} (n\_base\_element\_read\_in != nbase)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12547}12547       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12548}12548         \textcolor{comment}{// If we have zero base elements the problem could be that the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12549}12549         \textcolor{comment}{// restart file was generated without MPI. Issue a warning}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12550}12550         \textcolor{comment}{// and continue anyway}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12551}12551         \textcolor{keywordflow}{if} (nbase == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12552}12552         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12553}12553           std::ostringstream warn\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12554}12554           warn\_message}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12555}12555             << \textcolor{stringliteral}{"{}The number of base elements in the mesh is 0,\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12556}12556             << \textcolor{stringliteral}{"{} but the restart file indicates that there are "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12557}12557             << n\_base\_element\_read\_in << \textcolor{stringliteral}{"{}.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12558}12558             << \textcolor{stringliteral}{"{}This could be because the restart file was \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12559}12559             << \textcolor{stringliteral}{"{}generated by using code without MPI.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12560}12560             << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12561}12561             << \textcolor{stringliteral}{"{}The best fix is to include two additional lines\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12562}12562             << \textcolor{stringliteral}{"{}in the restart file: \(\backslash\)n\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12563}12563             << \textcolor{stringliteral}{"{}0 \# Number of base elements; partitioning follows.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12564}12564             << \textcolor{stringliteral}{"{}8888 \# Test flag for end of base element distribution\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12565}12565             << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12566}12566             << \textcolor{stringliteral}{"{}These lines go after the flag 9999 that indicates\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12567}12567             << \textcolor{stringliteral}{"{}the end of the submesh information.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12568}12568             << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12569}12569             << \textcolor{stringliteral}{"{}The file will now continue to be read assuming that\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12570}12570             << \textcolor{stringliteral}{"{}the base element information is not present.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12571}12571             << \textcolor{stringliteral}{"{}If you get strange results then please look carefully\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12572}12572             << \textcolor{stringliteral}{"{}at the restart file. The safest thing to do is to \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12573}12573             << \textcolor{stringliteral}{"{}ensure that the restart file was generated by code\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12574}12574             << \textcolor{stringliteral}{"{}compiled and run with the same parallel options.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12575}12575           \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(warn\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12576}12576                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12577}12577                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12578}12578           \textcolor{comment}{// Set the skip flag to true}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12579}12579           \textcolor{comment}{// and rewind the file pointer}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12580}12580           read\_in\_base\_element\_info = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12581}12581           restart\_file.seekg(position\_before\_base\_element);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12582}12582         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12583}12583         \textcolor{comment}{// Otherwise throw a hard error}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12584}12584         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12585}12585         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12586}12586           std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12587}12587           error\_message << \textcolor{stringliteral}{"{}About to read "{}} << n\_base\_element\_read\_in}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12588}12588                         << \textcolor{stringliteral}{"{} base elements \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12589}12589                         << \textcolor{stringliteral}{"{}though we only have "{}} << nbase}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12590}12590                         << \textcolor{stringliteral}{"{} base elements in mesh.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12591}12591           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12592}12592                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12593}12593                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12594}12594         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12595}12595       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12596}12596     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12597}12597 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12598}12598     \textcolor{comment}{// Read in the remaning base element information, if necessary}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12599}12599     \textcolor{keywordflow}{if} (read\_in\_base\_element\_info == \textcolor{keyword}{true})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12600}12600     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12601}12601       \textcolor{comment}{// Read in target\_domain\_for\_base\_element[e] for all base elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12602}12602       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} target\_domain\_for\_base\_element(nbase);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12603}12603       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nbase; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12604}12604       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12605}12605         \textcolor{comment}{// Read line}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12606}12606         getline(restart\_file, input\_string);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12607}12607 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12608}12608         \textcolor{comment}{// Get target domain}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12609}12609         target\_domain\_for\_base\_element[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = atoi(input\_string.c\_str());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12610}12610       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12611}12611 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12612}12612       \textcolor{comment}{// Read line up to termination sign}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12613}12613       getline(restart\_file, input\_string, \textcolor{charliteral}{'\#'});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12614}12614 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12615}12615       \textcolor{comment}{// Ignore rest of line}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12616}12616       restart\_file.ignore(80, \textcolor{charliteral}{'\(\backslash\)n'});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12617}12617 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12618}12618       \textcolor{comment}{// Check flag that indicates that we've read the final data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12619}12619       tmp = std::atoi(input\_string.c\_str());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12620}12620 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12621}12621 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12622}12622 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12623}12623       \textcolor{keywordflow}{if} (restart\_file\_is\_open)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12624}12624       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12625}12625         \textcolor{keywordflow}{if} (tmp != 8888)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12626}12626         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12627}12627           std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12628}12628           error\_message}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12629}12629             << \textcolor{stringliteral}{"{}Error in reading restart data: Target proc for base elements \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12630}12630             << \textcolor{stringliteral}{"{}should be followed by 8888.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12631}12631           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12632}12632                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12633}12633                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12634}12634         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12635}12635       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12636}12636 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12637}12637 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12638}12638       \textcolor{comment}{// Loop over all elements (incl. any FaceElements) and assign}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12639}12639       \textcolor{comment}{// target domain for all local non-\/halo elements and check if}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12640}12640       \textcolor{comment}{// load balancing is required -\/-\/ no need to do this if problem is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12641}12641       \textcolor{comment}{// not distributed.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12642}12642       \textcolor{keywordtype}{unsigned} load\_balance\_required\_flag = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12643}12643       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12644}12644       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12645}12645         \textcolor{comment}{// Working with TreeBasedRefineableMeshBase mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12646}12646         \textcolor{keywordtype}{unsigned} local\_load\_balance\_required\_flag = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12647}12647         \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12648}12648         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12649}12649           \textcolor{keyword}{const} \textcolor{keywordtype}{int} my\_rank = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12650}12650           \textcolor{keywordtype}{unsigned} nel = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12651}12651           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nel; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12652}12652           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12653}12653             \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* el\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12654}12654             \textcolor{keywordflow}{if} (!el\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a0d9869eaf7d6e104c1e465b0d3cd6a9b}{is\_halo}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12655}12655             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12656}12656               \textcolor{comment}{// Get element number (plus one) in base element enumeration}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12657}12657               \textcolor{keywordtype}{unsigned} el\_number\_in\_base\_mesh\_plus\_one =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12658}12658                 \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}[el\_pt];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12659}12659 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12660}12660               \textcolor{comment}{// If it's zero then we haven't found it, it may be a FaceElement}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12661}12661               \textcolor{comment}{// (in which case we move it to the same processor as its bulk}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12662}12662               \textcolor{comment}{// element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12663}12663               \textcolor{keywordflow}{if} (el\_number\_in\_base\_mesh\_plus\_one == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12664}12664               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12665}12665                 \mbox{\hyperlink{classoomph_1_1FaceElement}{FaceElement}}* face\_el\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1FaceElement}{FaceElement}}*\textcolor{keyword}{>}(el\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12666}12666                 \textcolor{keywordflow}{if} (face\_el\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12667}12667                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12668}12668                   \textcolor{comment}{// Get corresponding bulk element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12669}12669                   \mbox{\hyperlink{classoomph_1_1FiniteElement}{FiniteElement}}* bulk\_el\_pt = face\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FaceElement_a89e9f7ebc8019c47d54dded72f05479e}{bulk\_element\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12670}12670 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12671}12671                   \textcolor{comment}{// Use its element number (plus one) in base element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12672}12672                   \textcolor{comment}{// enumeration}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12673}12673                   el\_number\_in\_base\_mesh\_plus\_one =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12674}12674                     \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}[bulk\_el\_pt];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12675}12675 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12676}12676                   \textcolor{comment}{// If this is zero too we have a problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12677}12677                   \textcolor{keywordflow}{if} (el\_number\_in\_base\_mesh\_plus\_one == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12678}12678                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12679}12679                     \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12680}12680                       \textcolor{stringliteral}{"{}el\_number\_in\_base\_mesh\_plus\_one=0 for bulk"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12681}12681                       \textcolor{stringliteral}{"{}Problem::read()"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12682}12682                       OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12683}12683                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12684}12684                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12685}12685               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12686}12686 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12687}12687               \textcolor{comment}{// If we've made it here then we're not dealing with a}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12688}12688               \textcolor{comment}{// FaceElement but with an element that doesn't exist locally}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12689}12689               \textcolor{comment}{// -\/-\/> WTF?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12690}12690               \textcolor{keywordflow}{if} (el\_number\_in\_base\_mesh\_plus\_one == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12691}12691               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12692}12692                 \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}el\_number\_in\_base\_mesh\_plus\_one=0"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12693}12693                                     OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12694}12694                                     OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12695}12695               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12696}12696 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12697}12697               \textcolor{comment}{// Assign target domain for next local non-\/halo element in}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12698}12698               \textcolor{comment}{// the order in which it's encountered in the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12699}12699               target\_domain\_for\_local\_non\_halo\_element.push\_back(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12700}12700                 target\_domain\_for\_base\_element[el\_number\_in\_base\_mesh\_plus\_one -\/}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12701}12701                                                1]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12702}12702 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12703}12703               \textcolor{comment}{// Do elements on this processor to be moved elsewhere?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12704}12704               \textcolor{keywordflow}{if} (\textcolor{keywordtype}{int}(target\_domain\_for\_base\_element}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12705}12705                         [el\_number\_in\_base\_mesh\_plus\_one -\/ 1]) != my\_rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12706}12706               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12707}12707                 local\_load\_balance\_required\_flag = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12708}12708               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12709}12709             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12710}12710           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12711}12711 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12712}12712         \} \textcolor{comment}{// if (working with TreeBasedRefineableMeshBase mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12713}12713 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12714}12714         \textcolor{comment}{// Get overall need to load balance by max}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12715}12715         MPI\_Allreduce(\&local\_load\_balance\_required\_flag,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12716}12716                       \&load\_balance\_required\_flag,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12717}12717                       1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12718}12718                       MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12719}12719                       MPI\_MAX,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12720}12720                       this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12721}12721       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12722}12722 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12723}12723       \textcolor{comment}{// Do we need to load balance?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12724}12724       \textcolor{keywordflow}{if} (load\_balance\_required\_flag == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12725}12725       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12726}12726         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Doing load balancing after pruning\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12727}12727         \mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}} doc\_info;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12728}12728         doc\_info.\mbox{\hyperlink{classoomph_1_1DocInfo_a666a20817ab9c396b225d8652bc0a338}{disable\_doc}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12729}12729         \textcolor{keywordtype}{bool} report\_stats = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12730}12730         \mbox{\hyperlink{classoomph_1_1Problem_ad6309367fa379889012f25e3397ab425}{load\_balance}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12731}12731           doc\_info, report\_stats, target\_domain\_for\_local\_non\_halo\_element);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12732}12732         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Done load balancing after pruning\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12733}12733       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12734}12734       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12735}12735       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12736}12736         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}No need for load balancing after pruning\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12737}12737       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12738}12738     \} \textcolor{comment}{// End of read in base element information}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12739}12739 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12740}12740 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12741}12741 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12742}12742     \textcolor{comment}{// Boolean to record if any unstructured bulk meshes have}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12743}12743     \textcolor{comment}{// been read in (and therefore completely re-\/generated, with new}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12744}12744     \textcolor{comment}{// elements and nodes) from disk}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12745}12745     \textcolor{keywordtype}{bool} have\_read\_unstructured\_mesh = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12746}12746 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12747}12747     \textcolor{comment}{// Call the actions before adaptation}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12748}12748     \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12749}12749 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12750}12750     \textcolor{comment}{// If there are unstructured meshes in the problem we need}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12751}12751     \textcolor{comment}{// to strip out any face elements that are attached to them}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12752}12752     \textcolor{comment}{// because restart of unstructured meshes re-\/creates their elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12753}12753     \textcolor{comment}{// and nodes from scratch, leading to dangling pointers from the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12754}12754     \textcolor{comment}{// face elements to the old elements and nodes. This function is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12755}12755     \textcolor{comment}{// virtual and (practically) empty in the Problem base class}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12756}12756     \textcolor{comment}{// but toggles a flag to indicate that it has been called. We can then}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12757}12757     \textcolor{comment}{// issue a warning below, prompting the user to consider overloading it}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12758}12758     \textcolor{comment}{// if the problem is found to contain unstructured bulk meshes.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12759}12759     \textcolor{comment}{// Warning can be ignored if the bulk mesh is not associated with any}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12760}12760     \textcolor{comment}{// face elements.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12761}12761     \mbox{\hyperlink{classoomph_1_1Problem_a5f13ea67c29022392857b5c19bb3af71}{Empty\_actions\_before\_read\_unstructured\_meshes\_has\_been\_called}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12762}12762     \mbox{\hyperlink{classoomph_1_1Problem_af10662119a7a0c3a47879fa0d0644452}{actions\_before\_read\_unstructured\_meshes}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12763}12763 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12764}12764     \textcolor{comment}{// Update number of submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12765}12765     n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12766}12766 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12767}12767     \textcolor{comment}{// Single mesh:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12768}12768     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12769}12769     \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12770}12770     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12771}12771       \textcolor{comment}{// Refine single mesh (if it's refineable)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12772}12772       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12773}12773             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12774}12774       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12775}12775         \textcolor{comment}{// When we get in here the problem has been constructed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12776}12776         \textcolor{comment}{// by the constructor and the mesh is its original unrefined}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12777}12777         \textcolor{comment}{// form.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12778}12778         \textcolor{comment}{// RefineableMeshBase::refine(...) reads the refinement pattern from the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12779}12779         \textcolor{comment}{// specified file and performs refinements until the mesh has}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12780}12780         \textcolor{comment}{// reached the same level of refinement as the mesh that existed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12781}12781         \textcolor{comment}{// when the problem was dumped to disk.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12782}12782         mmesh\_pt-\/>refine(restart\_file);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12783}12783       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12784}12784 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_TRIANGLE\_LIB}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12785}12785       \textcolor{comment}{// Regenerate mesh from triangulate IO if it's a triangular mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12786}12786       \mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}* mmesh\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12787}12787       \textcolor{keywordflow}{if} (mmesh\_pt != 0 \&\& mmesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TriangleMeshBase_a69a2fe3d5e77ec39b9df4b3174b58c47}{use\_triangulateio\_restart}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12788}12788       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12789}12789 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12790}12790         \textcolor{comment}{// Check if the mesh is distributed, if that is the case then}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12791}12791         \textcolor{comment}{// additional info. needs to be read}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12792}12792         \textcolor{keywordflow}{if} (mmesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1ab35b022b95f2d28c53aa58859bd6b5}{is\_mesh\_distributed}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12793}12793         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12794}12794           \textcolor{comment}{// Dump the info. related with the distribution of the mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12795}12795           mmesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TriangleMeshBase_a56273b6d7b690d37f07632c7028adcf8}{read\_distributed\_info\_for\_restart}}(restart\_file);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12796}12796         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12797}12797 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12798}12798         \textcolor{comment}{// The function reads the TriangulateIO data structure from the dump}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12799}12799         \textcolor{comment}{// file and then completely regenerates the mesh using the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12800}12800         \textcolor{comment}{// data structure}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12801}12801         mmesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TriangleMeshBase_a8e8d7354b213cba989b661f0b748d8b5}{remesh\_from\_triangulateio}}(restart\_file);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12802}12802         have\_read\_unstructured\_mesh = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12803}12803 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12804}12804         \textcolor{comment}{// Check if the mesh is distributed, if that is the case then we}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12805}12805         \textcolor{comment}{// need to re-\/establish the halo/haloed scheme (similar as in the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12806}12806         \textcolor{comment}{// RefineableTriangleMesh::adapt() method)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12807}12807         \textcolor{keywordflow}{if} (mmesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1ab35b022b95f2d28c53aa58859bd6b5}{is\_mesh\_distributed}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12808}12808         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12809}12809           mmesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TriangleMeshBase_ae37b5239c84808e3e66aa0eac4396a2c}{reestablish\_distribution\_info\_for\_restart}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12810}12810             this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), restart\_file);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12811}12811         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12812}12812 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12813}12813         \textcolor{comment}{// Still left to update the polylines representation, that is performed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12814}12814         \textcolor{comment}{// later since the nodes positions may still change when reading info.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12815}12815         \textcolor{comment}{// for the mesh, see below}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12816}12816       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12817}12817 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12818}12818     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12819}12819 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12820}12820     \textcolor{comment}{// Multiple submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12821}12821     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12822}12822     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12823}12823     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12824}12824       \textcolor{comment}{// Loop over submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12825}12825       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imesh = 0; imesh < n\_mesh; imesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12826}12826       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12827}12827         \textcolor{comment}{// Refine single mesh (if its refineable)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12828}12828         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12829}12829               \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12830}12830         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12831}12831           \textcolor{comment}{// When we get in here the problem has been constructed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12832}12832           \textcolor{comment}{// by the constructor and the mesh is its original unrefined}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12833}12833           \textcolor{comment}{// form.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12834}12834           \textcolor{comment}{// RefineableMeshBase::refine(...) reads the refinement pattern from}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12835}12835           \textcolor{comment}{// the specified file and performs refinements until the mesh has}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12836}12836           \textcolor{comment}{// reached the same level of refinement as the mesh that existed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12837}12837           \textcolor{comment}{// when the problem was dumped to disk.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12838}12838           mmesh\_pt-\/>refine(restart\_file);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12839}12839         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12840}12840 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_TRIANGLE\_LIB}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12841}12841         \textcolor{comment}{// Regenerate mesh from triangulate IO if it's a triangular mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12842}12842         \mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12843}12843           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12844}12844         \textcolor{keywordflow}{if} (mmesh\_pt != 0 \&\& mmesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TriangleMeshBase_a69a2fe3d5e77ec39b9df4b3174b58c47}{use\_triangulateio\_restart}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12845}12845         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12846}12846 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12847}12847           \textcolor{comment}{// Check if the mesh is distributed, if that is the case then}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12848}12848           \textcolor{comment}{// additional info. needs to be read}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12849}12849           \textcolor{keywordflow}{if} (mmesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1ab35b022b95f2d28c53aa58859bd6b5}{is\_mesh\_distributed}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12850}12850           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12851}12851             \textcolor{comment}{// Dump the info. related with the distribution of the mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12852}12852             mmesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TriangleMeshBase_a56273b6d7b690d37f07632c7028adcf8}{read\_distributed\_info\_for\_restart}}(restart\_file);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12853}12853           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12854}12854 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12855}12855           \textcolor{comment}{// The function reads the TriangulateIO data structure from the dump}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12856}12856           \textcolor{comment}{// file and then completely regenerates the mesh using the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12857}12857           \textcolor{comment}{// data structure}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12858}12858           mmesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TriangleMeshBase_a8e8d7354b213cba989b661f0b748d8b5}{remesh\_from\_triangulateio}}(restart\_file);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12859}12859           have\_read\_unstructured\_mesh = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12860}12860 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12861}12861 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12862}12862           \textcolor{comment}{// Check if the mesh is distributed, if that is the case then we}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12863}12863           \textcolor{comment}{// need to re-\/establish the halo/haloed scheme (similar as in the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12864}12864           \textcolor{comment}{// RefineableTriangleMesh::adapt() method)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12865}12865           \textcolor{keywordflow}{if} (mmesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1ab35b022b95f2d28c53aa58859bd6b5}{is\_mesh\_distributed}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12866}12866           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12867}12867             mmesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TriangleMeshBase_ae37b5239c84808e3e66aa0eac4396a2c}{reestablish\_distribution\_info\_for\_restart}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12868}12868               this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), restart\_file);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12869}12869           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12870}12870 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12871}12871           \textcolor{comment}{// Still left to update the polylines representation, that is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12872}12872           \textcolor{comment}{// performed later since the nodes positions may still change when}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12873}12873           \textcolor{comment}{// reading info. for the mesh, see below}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12874}12874         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12875}12875 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12876}12876       \} \textcolor{comment}{// End of loop over submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12877}12877 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12878}12878 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12879}12879       \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12880}12880       \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12881}12881     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12882}12882 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12883}12883     \textcolor{comment}{// Any actions after adapt}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12884}12884     \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12885}12885 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12886}12886     \textcolor{comment}{// Re-\/attach face elements (or whatever else needs to be done}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12887}12887     \textcolor{comment}{// following the total re-\/generation of the unstructured meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12888}12888     \mbox{\hyperlink{classoomph_1_1Problem_a71f87e46a571a54abd27a26f6c701c36}{Empty\_actions\_after\_read\_unstructured\_meshes\_has\_been\_called}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12889}12889     \mbox{\hyperlink{classoomph_1_1Problem_a498317b3e390eddf2169ab989ee8d6b4}{actions\_after\_read\_unstructured\_meshes}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12890}12890 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12891}12891 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12892}12892     \textcolor{comment}{// Issue warning:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12893}12893     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_a223a45fe6b1c80ee0109037b63e162f9}{Suppress\_warning\_about\_actions\_before\_read\_unstructured\_meshes}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12894}12894     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12895}12895       \textcolor{keywordflow}{if} (have\_read\_unstructured\_mesh)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12896}12896       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12897}12897         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a5f13ea67c29022392857b5c19bb3af71}{Empty\_actions\_before\_read\_unstructured\_meshes\_has\_been\_called}} ||}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12898}12898             \mbox{\hyperlink{classoomph_1_1Problem_a71f87e46a571a54abd27a26f6c701c36}{Empty\_actions\_after\_read\_unstructured\_meshes\_has\_been\_called}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12899}12899         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12900}12900           std::ostringstream warn\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12901}12901           warn\_message}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12902}12902             << \textcolor{stringliteral}{"{}I've just read in some unstructured meshes and have, in\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12903}12903             << \textcolor{stringliteral}{"{}the process, totally re-\/generated their nodes and elements.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12904}12904             << \textcolor{stringliteral}{"{}This may create dangling pointers that still point to the\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12905}12905             << \textcolor{stringliteral}{"{}old nodes and elements, e.g. because FaceElements were\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12906}12906             << \textcolor{stringliteral}{"{}attached to these meshes or pointers to nodes and elements\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12907}12907             << \textcolor{stringliteral}{"{}were stored somewhere. FaceElements should therefore be\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12908}12908             << \textcolor{stringliteral}{"{}removed before reading in these meshes, using an overloaded\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12909}12909             << \textcolor{stringliteral}{"{}version of the function\(\backslash\)n\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12910}12910             << \textcolor{stringliteral}{"{}   Problem::actions\_before\_read\_unstructured\_meshes()\(\backslash\)n\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12911}12911             << \textcolor{stringliteral}{"{}and then re-\/attached using an overloaded version of\(\backslash\)n\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12912}12912             << \textcolor{stringliteral}{"{}   Problem::actions\_after\_read\_unstructured\_meshes().\(\backslash\)n\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12913}12913             << \textcolor{stringliteral}{"{}The required content of these functions is likely to be "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12914}12914                \textcolor{stringliteral}{"{}similar\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12915}12915             << \textcolor{stringliteral}{"{}to the Problem::actions\_before\_adapt() and \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12916}12916             << \textcolor{stringliteral}{"{}Problem::actions\_after\_adapt() that would be required in\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12917}12917             << \textcolor{stringliteral}{"{}a spatially adaptive computation. If these functions already\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12918}12918             << \textcolor{stringliteral}{"{}exist and perform the required actions, the \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12919}12919             << \textcolor{stringliteral}{"{}actions\_before/after\_read\_unstructured\_meshes() functions\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12920}12920             << \textcolor{stringliteral}{"{}can remain empty because the former are called automatically.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12921}12921             << \textcolor{stringliteral}{"{}In this case, this warning my be suppressed by setting the\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12922}12922             << \textcolor{stringliteral}{"{}public boolean\(\backslash\)n\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12923}12923             << \textcolor{stringliteral}{"{}   "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12924}12924                \textcolor{stringliteral}{"{}Problem::Suppress\_warning\_about\_actions\_before\_read\_"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12925}12925                \textcolor{stringliteral}{"{}unstructured\_meshes\(\backslash\)n\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12926}12926             << \textcolor{stringliteral}{"{}to true."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12927}12927           \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(warn\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12928}12928                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12929}12929                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12930}12930         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12931}12931       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12932}12932     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12933}12933 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12934}12934     \textcolor{comment}{// Setup equation numbering scheme}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12935}12935     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)nNumber of equations in Problem::read(): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12936}12936                << \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}() << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12937}12937                << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12938}12938     \textcolor{comment}{// Read time info}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12939}12939     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12940}12940     \textcolor{keywordtype}{unsigned} local\_unsteady\_restart\_flag = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12941}12941     \textcolor{keywordtype}{double} local\_time = -\/DBL\_MAX;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12942}12942     \textcolor{keywordtype}{unsigned} local\_n\_dt = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12943}12943 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12944}12944     \textcolor{keywordtype}{unsigned} local\_sync\_needed\_flag = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12945}12945 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12946}12946     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} local\_dt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12947}12947 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12948}12948     \textcolor{keywordflow}{if} (restart\_file.is\_open())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12949}12949     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12950}12950       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Restart file exists"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12951}12951 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12952}12952       local\_sync\_needed\_flag = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12953}12953 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12954}12954       \textcolor{comment}{// Read line up to termination sign}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12955}12955       getline(restart\_file, input\_string, \textcolor{charliteral}{'\#'});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12956}12956 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12957}12957       \textcolor{comment}{// Ignore rest of line}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12958}12958       restart\_file.ignore(80, \textcolor{charliteral}{'\(\backslash\)n'});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12959}12959 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12960}12960       \textcolor{comment}{// Is the restart data from an unsteady run?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12961}12961       local\_unsteady\_restart\_flag = atoi(input\_string.c\_str());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12962}12962 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12963}12963       \textcolor{comment}{// Read line up to termination sign}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12964}12964       getline(restart\_file, input\_string, \textcolor{charliteral}{'\#'});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12965}12965 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12966}12966       \textcolor{comment}{// Ignore rest of line}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12967}12967       restart\_file.ignore(80, \textcolor{charliteral}{'\(\backslash\)n'});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12968}12968 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12969}12969       \textcolor{comment}{// Read in initial time and set}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12970}12970       local\_time = atof(input\_string.c\_str());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12971}12971 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12972}12972       \textcolor{comment}{// Read line up to termination sign}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12973}12973       getline(restart\_file, input\_string, \textcolor{charliteral}{'\#'});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12974}12974 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12975}12975       \textcolor{comment}{// Ignore rest of line}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12976}12976       restart\_file.ignore(80, \textcolor{charliteral}{'\(\backslash\)n'});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12977}12977 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12978}12978       \textcolor{comment}{// Read \& set number of timesteps}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12979}12979       local\_n\_dt = atoi(input\_string.c\_str());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12980}12980       local\_dt.resize(local\_n\_dt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12981}12981 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12982}12982       \textcolor{comment}{// Read in timesteps:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12983}12983       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < local\_n\_dt; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12984}12984       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12985}12985         \textcolor{comment}{// Read line up to termination sign}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12986}12986         getline(restart\_file, input\_string, \textcolor{charliteral}{'\#'});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12987}12987 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12988}12988         \textcolor{comment}{// Ignore rest of line}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12989}12989         restart\_file.ignore(80, \textcolor{charliteral}{'\(\backslash\)n'});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12990}12990 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12991}12991         \textcolor{comment}{// Read in initial time and set}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12992}12992         \textcolor{keywordtype}{double} prev\_dt = atof(input\_string.c\_str());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12993}12993         local\_dt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = prev\_dt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12994}12994       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12995}12995     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12996}12996     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12997}12997     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12998}12998       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Restart file does not exist"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l12999}12999 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13000}13000       local\_sync\_needed\_flag = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13001}13001 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13002}13002     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13003}13003 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13004}13004 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13005}13005     \textcolor{comment}{// No prepare global values, possibly via sync}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13006}13006     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} dt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13007}13007 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13008}13008     \textcolor{comment}{// Do we need to sync?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13009}13009     \textcolor{keywordtype}{unsigned} sync\_needed\_flag = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13010}13010 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13011}13011 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13012}13012     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13013}13013     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13014}13014       \textcolor{comment}{// Get need to sync by max}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13015}13015       MPI\_Allreduce(\&local\_sync\_needed\_flag,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13016}13016                     \&sync\_needed\_flag,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13017}13017                     1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13018}13018                     MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13019}13019                     MPI\_MAX,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13020}13020                     this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13021}13021     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13022}13022 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13023}13023 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13024}13024     \textcolor{comment}{// Synchronise}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13025}13025     \textcolor{keywordflow}{if} (sync\_needed\_flag == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13026}13026     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13027}13027 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13028}13028 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13029}13029 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13030}13030 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13031}13031       \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13032}13032       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13033}13033         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13034}13034         error\_message << \textcolor{stringliteral}{"{}Synchronisation of temporal restart data \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13035}13035                       << \textcolor{stringliteral}{"{}required even though Problem hasn't been distributed "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13036}13036                          \textcolor{stringliteral}{"{}-\/-\/ very odd!\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13037}13037         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13038}13038                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13039}13039                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13040}13040       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13041}13041 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13042}13042 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13043}13043       \textcolor{comment}{// Get unsteady restart flag by max-\/based reduction}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13044}13044       \textcolor{keywordtype}{unsigned} unsteady\_restart\_flag = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13045}13045       MPI\_Allreduce(\&local\_unsteady\_restart\_flag,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13046}13046                     \&unsteady\_restart\_flag,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13047}13047                     1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13048}13048                     MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13049}13049                     MPI\_MAX,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13050}13050                     this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13051}13051 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13052}13052       \textcolor{comment}{// So, is it an unsteady restart?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13053}13053       unsteady\_restart = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13054}13054       \textcolor{keywordflow}{if} (unsteady\_restart\_flag == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13055}13055       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13056}13056         unsteady\_restart = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13057}13057 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13058}13058         \textcolor{comment}{// Get time by max}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13059}13059         \textcolor{keywordtype}{double} \mbox{\hyperlink{classoomph_1_1Problem_acd8c357349d20a28af70b2b7ea7f488d}{time}} = -\/DBL\_MAX;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13060}13060         MPI\_Allreduce(\&local\_time,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13061}13061                       \&\mbox{\hyperlink{classoomph_1_1Problem_acd8c357349d20a28af70b2b7ea7f488d}{time}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13062}13062                       1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13063}13063                       MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13064}13064                       MPI\_MAX,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13065}13065                       this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13066}13066         \mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_a43461269b799134f4b7a9aca3e79a7c8}{time}}() = \mbox{\hyperlink{classoomph_1_1Problem_acd8c357349d20a28af70b2b7ea7f488d}{time}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13067}13067 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13068}13068         \textcolor{comment}{// Get number of timesteps by max-\/based reduction}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13069}13069         \textcolor{keywordtype}{unsigned} n\_dt = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13070}13070         MPI\_Allreduce(\&local\_n\_dt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13071}13071                       \&n\_dt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13072}13072                       1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13073}13073                       MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13074}13074                       MPI\_MAX,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13075}13075                       this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13076}13076 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13077}13077         \textcolor{comment}{// Resize whatever needs resizing}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13078}13078         \mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_aeab1acb1e182797c4194af84c0583c3f}{resize}}(n\_dt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13079}13079         dt.resize(n\_dt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13080}13080         \textcolor{keywordflow}{if} (local\_dt.size() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13081}13081         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13082}13082           local\_dt.resize(n\_dt, -\/DBL\_MAX);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13083}13083         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13084}13084 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13085}13085         \textcolor{comment}{// Get timesteps increments by max-\/based reduction}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13086}13086         MPI\_Allreduce(\&local\_dt[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13087}13087                       \&dt[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13088}13088                       n\_dt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13089}13089                       MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13090}13090                       MPI\_MAX,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13091}13091                       this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13092}13092       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13093}13093 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13094}13094 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13095}13095 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13096}13096       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13097}13097       error\_message}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13098}13098         << \textcolor{stringliteral}{"{}Synchronisation of temporal restart data \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13099}13099         << \textcolor{stringliteral}{"{}required even though we don't have mpi support -\/-\/ very odd!\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13100}13100       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13101}13101         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13102}13102 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13103}13103 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13104}13104     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13105}13105     \textcolor{comment}{// No sync needed -\/-\/ just copy across}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13106}13106     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13107}13107     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13108}13108       unsteady\_restart = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13109}13109       \textcolor{keywordflow}{if} (local\_unsteady\_restart\_flag == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13110}13110       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13111}13111         unsteady\_restart = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13112}13112         \mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_a43461269b799134f4b7a9aca3e79a7c8}{time}}() = local\_time;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13113}13113         \mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_aeab1acb1e182797c4194af84c0583c3f}{resize}}(local\_n\_dt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13114}13114         dt.resize(local\_n\_dt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13115}13115         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < local\_n\_dt; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13116}13116         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13117}13117           dt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = local\_dt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13118}13118         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13119}13119       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13120}13120     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13121}13121 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13122}13122     \textcolor{comment}{// Initialise timestep -\/-\/ also sets the weights for all timesteppers}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13123}13123     \textcolor{comment}{// in the problem.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13124}13124     \textcolor{keywordflow}{if} (unsteady\_restart) \mbox{\hyperlink{classoomph_1_1Problem_a342b9bd9c4bc142f514907ee1d23d613}{initialise\_dt}}(dt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13125}13125 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13126}13126     \textcolor{comment}{// Loop over submeshes:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13127}13127     \textcolor{keywordtype}{unsigned} nmesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13128}13128     \textcolor{keywordflow}{if} (nmesh == 0) nmesh = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13129}13129     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < nmesh; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13130}13130     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13131}13131       \textcolor{comment}{//    //-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13132}13132       \textcolor{comment}{//    // Keep this commented out code around to debug restarts}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13133}13133       \textcolor{comment}{//    //-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13134}13134       \textcolor{comment}{//    std::ofstream some\_file;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13135}13135       \textcolor{comment}{//    char filename[100];}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13136}13136       \textcolor{comment}{//    sprintf(filename,"{}read\_mesh\%i\_on\_proc\%i.dat"{},m,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13137}13137       \textcolor{comment}{//            this-\/>communicator\_pt()-\/>my\_rank());}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13138}13138       \textcolor{comment}{//    some\_file.open(filename);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13139}13139       \textcolor{comment}{//    mesh\_pt(m)-\/>output(some\_file);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13140}13140       \textcolor{comment}{//    some\_file.close();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13141}13141 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13142}13142       \textcolor{comment}{//    sprintf(filename,"{}read\_mesh\%i\_with\_haloes\_on\_proc\%i.dat"{},m,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13143}13143       \textcolor{comment}{//            this-\/>communicator\_pt()-\/>my\_rank());}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13144}13144       \textcolor{comment}{//    mesh\_pt(m)-\/>enable\_output\_of\_halo\_elements();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13145}13145       \textcolor{comment}{//    some\_file.open(filename);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13146}13146       \textcolor{comment}{//    mesh\_pt(m)-\/>output(some\_file);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13147}13147       \textcolor{comment}{//    mesh\_pt(m)-\/>disable\_output\_of\_halo\_elements();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13148}13148       \textcolor{comment}{//    some\_file.close();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13149}13149       \textcolor{comment}{//    oomph\_info << "{}Doced mesh "{} << m << "{} before reading\(\backslash\)n"{};}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13150}13150 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13151}13151       \textcolor{comment}{//    sprintf(filename,"{}read\_nodes\_mesh\%i\_on\_proc\%i.dat"{},m,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13152}13152       \textcolor{comment}{//            this-\/>communicator\_pt()-\/>my\_rank());}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13153}13153       \textcolor{comment}{//    some\_file.open(filename);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13154}13154       \textcolor{comment}{//    unsigned nnod=mesh\_pt(m)-\/>nnode();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13155}13155       \textcolor{comment}{//    for (unsigned j=0;j<nnod;j++)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13156}13156       \textcolor{comment}{//     \{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13157}13157       \textcolor{comment}{//      Node* nod\_pt=mesh\_pt(m)-\/>node\_pt(j);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13158}13158       \textcolor{comment}{//      unsigned n=nod\_pt-\/>ndim();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13159}13159       \textcolor{comment}{//      for (unsigned i=0;i<n;i++)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13160}13160       \textcolor{comment}{//       \{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13161}13161       \textcolor{comment}{//        some\_file << nod\_pt-\/>x(i) << "{} "{};}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13162}13162       \textcolor{comment}{//       \}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13163}13163       \textcolor{comment}{//      some\_file << nod\_pt-\/>is\_halo() << "{} "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13164}13164       \textcolor{comment}{//                << nod\_pt-\/>nvalue() << "{} "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13165}13165       \textcolor{comment}{//                << nod\_pt-\/>hang\_code() << "{}\(\backslash\)n"{};}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13166}13166       \textcolor{comment}{//     \}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13167}13167       \textcolor{comment}{//    some\_file.close();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13168}13168       \textcolor{comment}{//    oomph\_info << "{}Doced mesh "{} << m << "{} before reading\(\backslash\)n"{};}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13169}13169       \textcolor{comment}{//    //-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13170}13170       \textcolor{comment}{//    // End keep this commented out code around to debug restarts}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13171}13171       \textcolor{comment}{//    //-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13172}13172 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13173}13173       \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(m)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ac192b41d1a24297ff38854548defd92b}{read}}(restart\_file);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13174}13174 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13175}13175 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_TRIANGLE\_LIB}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13176}13176       \textcolor{comment}{// Here update the polyline representation if working with}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13177}13177       \textcolor{comment}{// triangle base meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13178}13178       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13179}13179             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(m)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13180}13180       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13181}13181         \textcolor{comment}{// In charge of updating the polylines representation to the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13182}13182         \textcolor{comment}{// current refinement/unrefinement level after restart, it}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13183}13183         \textcolor{comment}{// also update the shared boundaries in case of working with a}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13184}13184         \textcolor{comment}{// distributed mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13185}13185         mmesh\_pt-\/>update\_polyline\_representation\_from\_restart();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13186}13186       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13187}13187 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// \#ifdef OOMPH\_HAS\_TRIANGLE\_LIB}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13188}13188     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13189}13189 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13190}13190     \textcolor{comment}{// Read global data:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13191}13191     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13192}13192 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13193}13193     \textcolor{comment}{// Number of global data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13194}13194     \textcolor{keywordtype}{unsigned} Nglobal = \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13195}13195 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13196}13196     \textcolor{comment}{// Read line up to termination sign}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13197}13197     getline(restart\_file, input\_string, \textcolor{charliteral}{'\#'});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13198}13198 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13199}13199     \textcolor{comment}{// Ignore rest of line}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13200}13200     restart\_file.ignore(80, \textcolor{charliteral}{'\(\backslash\)n'});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13201}13201 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13202}13202     \textcolor{comment}{// Check \# of nodes:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13203}13203     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} check\_nglobal = atoi(input\_string.c\_str());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13204}13204 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13205}13205 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13206}13206     \textcolor{keywordflow}{if} (restart\_file\_is\_open)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13207}13207     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13208}13208       \textcolor{keywordflow}{if} (check\_nglobal != Nglobal)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13209}13209       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13210}13210         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13211}13211         error\_message << \textcolor{stringliteral}{"{}The number of global data "{}} << Nglobal}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13212}13212                       << \textcolor{stringliteral}{"{} is not equal to that specified in the input file "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13213}13213                       << check\_nglobal << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13214}13214 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13215}13215         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13216}13216                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13217}13217                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13218}13218       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13219}13219     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13220}13220 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13221}13221     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} iglobal = 0; iglobal < Nglobal; iglobal++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13222}13222     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13223}13223       \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[iglobal]-\/>read(restart\_file);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13224}13224     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13225}13225   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13226}13226 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13227}13227   \textcolor{comment}{//===================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13228}13228 \textcolor{comment}{  /// Set all timesteps to the same value, dt, and assign}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13229}13229 \textcolor{comment}{  /// weights for all timesteppers in the problem.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13230}13230 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13231}\mbox{\hyperlink{classoomph_1_1Problem_a342b9bd9c4bc142f514907ee1d23d613}{13231}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a342b9bd9c4bc142f514907ee1d23d613}{Problem::initialise\_dt}}(\textcolor{keyword}{const} \textcolor{keywordtype}{double}\& dt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13232}13232   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13233}13233     \textcolor{comment}{// Initialise the timesteps in the Problem's time object}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13234}13234     \mbox{\hyperlink{classoomph_1_1Problem_ae33fbf5f34a7d06d88ad2c98538bbbe8}{Time\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Time_abc1e02cc2988b603bd5e1f6747381546}{initialise\_dt}}(dt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13235}13235 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13236}13236     \textcolor{comment}{// Find out how many timesteppers there are}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13237}13237     \textcolor{keywordtype}{unsigned} n\_time\_steppers = \mbox{\hyperlink{classoomph_1_1Problem_ace3cdf55009c3bff21d2b7d3706d522a}{ntime\_stepper}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13238}13238 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13239}13239     \textcolor{comment}{// Loop over them all and set the weights}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13240}13240     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_time\_steppers; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13241}13241     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13242}13242       \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_a028fa3a8d3c6db6b0ddf580cb0468d55}{set\_weights}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13243}13243       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>adaptive\_flag())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13244}13244       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13245}13245         \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_aee0c1da870a603e64efebb51dfc96a3d}{set\_error\_weights}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13246}13246       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13247}13247     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13248}13248   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13249}13249 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13250}13250   \textcolor{comment}{//=========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13251}13251 \textcolor{comment}{  /// Set the value of the timesteps to be equal to the values passed in}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13252}13252 \textcolor{comment}{  /// a vector and assign weights for all timesteppers in the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13253}13253 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13254}\mbox{\hyperlink{classoomph_1_1Problem_a48137f1c7b297de56078f6bc0c83b675}{13254}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a342b9bd9c4bc142f514907ee1d23d613}{Problem::initialise\_dt}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& dt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13255}13255   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13256}13256     \textcolor{comment}{// Initialise the timesteps in the Problem's time object}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13257}13257     \mbox{\hyperlink{classoomph_1_1Problem_ae33fbf5f34a7d06d88ad2c98538bbbe8}{Time\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Time_abc1e02cc2988b603bd5e1f6747381546}{initialise\_dt}}(dt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13258}13258 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13259}13259     \textcolor{comment}{// Find out how many timesteppers there are}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13260}13260     \textcolor{keywordtype}{unsigned} n\_time\_steppers = \mbox{\hyperlink{classoomph_1_1Problem_ace3cdf55009c3bff21d2b7d3706d522a}{ntime\_stepper}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13261}13261 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13262}13262     \textcolor{comment}{// Loop over them all and set the weights}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13263}13263     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_time\_steppers; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13264}13264     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13265}13265       \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_a028fa3a8d3c6db6b0ddf580cb0468d55}{set\_weights}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13266}13266       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>adaptive\_flag())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13267}13267       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13268}13268         \mbox{\hyperlink{classoomph_1_1Problem_aa6bb90130ac5bb220493c40cddf520ba}{time\_stepper\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_aee0c1da870a603e64efebb51dfc96a3d}{set\_error\_weights}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13269}13269       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13270}13270     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13271}13271   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13272}13272 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13273}13273   \textcolor{comment}{//========================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13274}13274 \textcolor{comment}{  /// Self-\/test: Check meshes and global data. Return 0 for OK}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13275}13275 \textcolor{comment}{}  \textcolor{comment}{//========================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13276}\mbox{\hyperlink{classoomph_1_1Problem_acdb76c0b94aa3cc5470ce862d70a8017}{13276}}   \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1Problem_acdb76c0b94aa3cc5470ce862d70a8017}{Problem::self\_test}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13277}13277   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13278}13278     \textcolor{comment}{// Initialise}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13279}13279     \textcolor{keywordtype}{bool} passed = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13280}13280 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13281}13281     \textcolor{comment}{// Are there any submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13282}13282     \textcolor{keywordtype}{unsigned} Nmesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13283}13283 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13284}13284     \textcolor{comment}{// Just one mesh: Check it}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13285}13285     \textcolor{keywordflow}{if} (Nmesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13286}13286     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13287}13287       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Problem_acdb76c0b94aa3cc5470ce862d70a8017}{self\_test}}() != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13288}13288       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13289}13289         passed = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13290}13290         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13291}13291           << \textcolor{stringliteral}{"{}\(\backslash\)n ERROR: Failed Mesh::self\_test() for single mesh in problem"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13292}13292           << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13293}13293       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13294}13294     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13295}13295     \textcolor{comment}{// Loop over all submeshes and check them}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13296}13296     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13297}13297     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13298}13298       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imesh = 0; imesh < Nmesh; imesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13299}13299       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13300}13300         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh)-\/>\mbox{\hyperlink{classoomph_1_1Problem_acdb76c0b94aa3cc5470ce862d70a8017}{self\_test}}() != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13301}13301         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13302}13302           passed = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13303}13303           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)n ERROR: Failed Mesh::self\_test() for mesh imesh"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13304}13304                      << imesh << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13305}13305         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13306}13306       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13307}13307     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13308}13308 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13309}13309 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13310}13310     \textcolor{comment}{// Check global data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13311}13311     \textcolor{keywordtype}{unsigned} Nglobal = \mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13312}13312     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} iglobal = 0; iglobal < Nglobal; iglobal++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13313}13313     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13314}13314       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aa963c98e91d135d31cdcfbe1afa64603}{Global\_data\_pt}}[iglobal]-\/>\mbox{\hyperlink{classoomph_1_1Problem_acdb76c0b94aa3cc5470ce862d70a8017}{self\_test}}() != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13315}13315       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13316}13316         passed = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13317}13317         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13318}13318           << \textcolor{stringliteral}{"{}\(\backslash\)n ERROR: Failed Data::self\_test() for global data iglobal"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13319}13319           << iglobal << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13320}13320       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13321}13321     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13322}13322 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13323}13323 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13324}13324 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13325}13325 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13326}13326     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13327}13327     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13328}13328       \textcolor{comment}{// Note: This throws an error if it fails so no return is required.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13329}13329       \mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}} tmp\_doc\_info;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13330}13330       tmp\_doc\_info.\mbox{\hyperlink{classoomph_1_1DocInfo_a666a20817ab9c396b225d8652bc0a338}{disable\_doc}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13331}13331       \mbox{\hyperlink{classoomph_1_1Problem_a8dd5cb241ce6218fb476931e0879d7c8}{check\_halo\_schemes}}(tmp\_doc\_info);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13332}13332     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13333}13333 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13334}13334 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13335}13335 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13336}13336     \textcolor{comment}{// Return verdict}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13337}13337     \textcolor{keywordflow}{if} (passed)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13338}13338     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13339}13339       \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13340}13340     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13341}13341     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13342}13342     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13343}13343       \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13344}13344     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13345}13345   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13346}13346 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13347}13347   \textcolor{comment}{//====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13348}13348 \textcolor{comment}{  /// A function that is used to adapt a bifurcation-\/tracking}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13349}13349 \textcolor{comment}{  /// problem, which requires separate interpolation of the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13350}13350 \textcolor{comment}{  /// associated eigenfunction. The error measure is chosen to be}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13351}13351 \textcolor{comment}{  /// a suitable combination of the errors in the base flow and the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13352}13352 \textcolor{comment}{  /// eigenfunction. The bifurcation type is passed as an argument}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13353}13353 \textcolor{comment}{}  \textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13354}\mbox{\hyperlink{classoomph_1_1Problem_a27d31a7a78f5d01b9d0a5e07c0e06e5d}{13354}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a27d31a7a78f5d01b9d0a5e07c0e06e5d}{Problem::bifurcation\_adapt\_helper}}(\textcolor{keywordtype}{unsigned}\& n\_refined,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13355}13355                                          \textcolor{keywordtype}{unsigned}\& n\_unrefined,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13356}13356                                          \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& bifurcation\_type,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13357}13357                                          \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& actually\_adapt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13358}13358   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13359}13359     \textcolor{comment}{// Storage for eigenfunction from the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13360}13360     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}} eigenfunction;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13361}13361     \textcolor{comment}{// Get the eigenfunction from the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13362}13362     this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a85b240c17750bdc32afafee35b50225a}{get\_bifurcation\_eigenfunction}}(eigenfunction);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13363}13363 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13364}13364     \textcolor{comment}{// Get the bifurcation parameter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13365}13365     \textcolor{keywordtype}{double}* parameter\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a3cf79b3067d1d794062ebb27e414dea9}{bifurcation\_parameter\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13366}13366 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13367}13367     \textcolor{comment}{// Get the frequency parameter if tracking a Hopf bifurcation}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13368}13368     \textcolor{keywordtype}{double} omega = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13369}13369     \textcolor{comment}{// If we're tracking a Hopf then also get the frequency}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13370}13370     \textcolor{keywordflow}{if} (bifurcation\_type == 3)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13371}13371     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13372}13372       omega = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1HopfHandler}{HopfHandler}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}())-\/>omega();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13373}13373     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13374}13374 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13375}13375     \textcolor{comment}{// If we're tracking a Pitchfork get the slack parameter (Hack)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13376}13376     \textcolor{keywordtype}{double} sigma = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13377}13377     \textcolor{keywordflow}{if} (bifurcation\_type == 2)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13378}13378     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13379}13379       sigma = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}() -\/ 1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13380}13380     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13381}13381 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13382}13382     \textcolor{comment}{// We can now deactivate the bifurcation tracking in the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13383}13383     \textcolor{comment}{// to restore the degrees of freedom to the unaugmented value}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13384}13384     this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ac5b47ae12ed6445e52c65596dfa97c6d}{deactivate\_bifurcation\_tracking}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13385}13385 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13386}13386     \textcolor{comment}{// Next, we create copies of the present problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13387}13387     \textcolor{comment}{// The number of copies depends on the number of eigenfunctions}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13388}13388     \textcolor{comment}{// One copy for each eigenfunction}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13389}13389     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_copies = eigenfunction.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13390}13390     \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}.resize(n\_copies);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13391}13391 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13392}13392     \textcolor{comment}{// Loop over the number of copies}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13393}13393     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} c = 0; c < n\_copies; c++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13394}13394     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13395}13395       \textcolor{comment}{// If we don't already have a copy}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13396}13396       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c] == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13397}13397       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13398}13398         \textcolor{comment}{// Create the copy}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13399}13399         \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c] = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a78ac2b1d2483f49198203e192d3b2871}{make\_copy}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13400}13400 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13401}13401         \textcolor{comment}{// Refine the copy to the same level as the current problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13402}13402 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13403}13403         \textcolor{comment}{// Find number of submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13404}13404         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} N\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>nsub\_mesh();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13405}13405         \textcolor{comment}{// If there is only one mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13406}13406         \textcolor{keywordflow}{if} (N\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13407}13407         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13408}13408           \textcolor{comment}{// Can we refine the mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13409}13409           \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13410}13410                 \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13411}13411                   \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13412}13412           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13413}13413             \textcolor{comment}{// Is the adapt flag set}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13414}13414             \textcolor{keywordflow}{if} (mmesh\_pt-\/>is\_adaptation\_enabled())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13415}13415             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13416}13416               \textcolor{comment}{// Now get the original problem's mesh if it's refineable}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13417}13417               \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* original\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13418}13418                     \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13419}13419                       this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13420}13420               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13421}13421                 mmesh\_pt-\/>refine\_base\_mesh\_as\_in\_reference\_mesh(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13422}13422                   original\_mesh\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13423}13423               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13424}13424               \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13425}13425               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13426}13426                 \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13427}13427                   << \textcolor{stringliteral}{"{}Info/Warning: Mesh in orginal problem is not refineable."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13428}13428                   << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13429}13429               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13430}13430             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13431}13431             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13432}13432             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13433}13433               \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh adaptation is disabled in copy."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13434}13434                          << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13435}13435             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13436}13436           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13437}13437           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13438}13438           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13439}13439             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be adapted in copy."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13440}13440                        << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13441}13441           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13442}13442         \} \textcolor{comment}{// End of single mesh case}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13443}13443         \textcolor{comment}{// Otherwise loop over the submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13444}13444         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13445}13445         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13446}13446           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < N\_mesh; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13447}13447           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13448}13448             \textcolor{comment}{// Can we refine the submesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13449}13449             \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13450}13450                   \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13451}13451                     \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(m)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13452}13452             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13453}13453               \textcolor{comment}{// Is the adapt flag set}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13454}13454               \textcolor{keywordflow}{if} (mmesh\_pt-\/>is\_adaptation\_enabled())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13455}13455               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13456}13456                 \textcolor{comment}{// Now get the original problem's mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13457}13457                 \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* original\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13458}13458                       \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13459}13459                         this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(m)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13460}13460                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13461}13461                   mmesh\_pt-\/>refine\_base\_mesh\_as\_in\_reference\_mesh(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13462}13462                     original\_mesh\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13463}13463                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13464}13464                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13465}13465                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13466}13466                   \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh in orginal problem is not "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13467}13467                                 \textcolor{stringliteral}{"{}refineable."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13468}13468                              << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13469}13469                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13470}13470               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13471}13471               \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13472}13472               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13473}13473                 \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13474}13474                   << \textcolor{stringliteral}{"{}Info/Warning: Mesh adaptation is disabled in copy."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13475}13475                   << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13476}13476               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13477}13477             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13478}13478             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13479}13479             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13480}13480               \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be adapted in copy."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13481}13481                          << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13482}13482             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13483}13483           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13484}13484           \textcolor{comment}{// rebuild the global mesh in the copy}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13485}13485           \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>rebuild\_global\_mesh();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13486}13486 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13487}13487         \} \textcolor{comment}{// End of multiple mesh case}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13488}13488 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13489}13489         \textcolor{comment}{// Must call actions after adapt}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13490}13490         \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>actions\_after\_adapt();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13491}13491 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13492}13492         \textcolor{comment}{// Assign the equation numbers to the copy (quietly)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13493}13493         (void)\mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>\mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13494}13494       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13495}13495     \} \textcolor{comment}{// End of creation of copies}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13496}13496 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13497}13497 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13498}13498     \textcolor{comment}{// Now check some numbers}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13499}13499     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} c = 0; c < n\_copies; c++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13500}13500     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13501}13501       \textcolor{comment}{// Check that the dofs match for each copy}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13502}13502 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13503}13503       \textcolor{comment}{// If the problems don't match then complain}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13504}13504       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}() != this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13505}13505       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13506}13506         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13507}13507         error\_stream << \textcolor{stringliteral}{"{}Number of unknowns in the problem copy "{}} << c << \textcolor{stringliteral}{"{} "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13508}13508                      << \textcolor{stringliteral}{"{}not equal to number in the original:\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13509}13509                      << this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}() << \textcolor{stringliteral}{"{} (original) "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13510}13510                      << \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>ndof() << \textcolor{stringliteral}{"{} (copy)\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13511}13511 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13512}13512         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13513}13513           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13514}13514       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13515}13515 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13516}13516 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13517}13517       \textcolor{comment}{// Assign the eigenfunction(s) to the copied problems}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13518}13518       \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>assign\_eigenvector\_to\_dofs(eigenfunction[c]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13519}13519       \textcolor{comment}{// Set all pinned values to zero}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13520}13520       \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>set\_pinned\_values\_to\_zero();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13521}13521     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13522}13522 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13523}13523     \textcolor{comment}{// Symmetrise the problem if we are solving a pitchfork}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13524}13524     \textcolor{keywordflow}{if} (bifurcation\_type == 2)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13525}13525     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13526}13526       \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[0]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13527}13527         -\/>symmetrise\_eigenfunction\_for\_adaptive\_pitchfork\_tracking();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13528}13528     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13529}13529 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13530}13530     \textcolor{comment}{// Find error estimates based on current problem and eigenproblem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13531}13531     \textcolor{comment}{// Now we need to get the error estimates for both problems.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13532}13532     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<double>}}> base\_error, eigenfunction\_error;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13533}13533     this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5e58bd6dcb1ff9ef54cf504984fb5f9e}{get\_all\_error\_estimates}}(base\_error);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13534}13534     \textcolor{comment}{// Loop over the copies}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13535}13535     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} c = 0; c < n\_copies; c++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13536}13536     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13537}13537       \textcolor{comment}{// Get the error estimates for the copy}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13538}13538       \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>get\_all\_error\_estimates(eigenfunction\_error);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13539}13539 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13540}13540       \textcolor{comment}{// Find the number of meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13541}13541       \textcolor{keywordtype}{unsigned} n\_mesh = base\_error.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13542}13542 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13543}13543 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13544}13544       \textcolor{keywordflow}{if} (n\_mesh != eigenfunction\_error.size())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13545}13545       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13546}13546         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13547}13547         error\_stream << \textcolor{stringliteral}{"{}Problems do not have the same number of meshes\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13548}13548                      << \textcolor{stringliteral}{"{}Base : "{}} << n\_mesh}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13549}13549                      << \textcolor{stringliteral}{"{} : Eigenproblem : "{}} << eigenfunction\_error.size()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13550}13550                      << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13551}13551         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13552}13552           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13553}13553       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13554}13554 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13555}13555 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13556}13556       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_mesh; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13557}13557       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13558}13558         \textcolor{comment}{// Check the number of elements is the same}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13559}13559         \textcolor{keywordtype}{unsigned} n\_element = base\_error[m].size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13560}13560 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13561}13561         \textcolor{keywordflow}{if} (n\_element != eigenfunction\_error[m].size())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13562}13562         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13563}13563           std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13564}13564           error\_stream << \textcolor{stringliteral}{"{}Mesh "{}} << m}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13565}13565                        << \textcolor{stringliteral}{"{} does not have the same number of elements in the "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13566}13566                           \textcolor{stringliteral}{"{}two problems:\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13567}13567                        << \textcolor{stringliteral}{"{}Base: "{}} << n\_element}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13568}13568                        << \textcolor{stringliteral}{"{} :  Eigenproblem: "{}} << eigenfunction\_error[m].size()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13569}13569                        << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13570}13570           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13571}13571                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13572}13572                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13573}13573         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13574}13574 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13575}13575         \textcolor{comment}{// Now add all the error esimates together}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13576}13576         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13577}13577         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13578}13578           \textcolor{comment}{// Add the error estimates (lazy)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13579}13579           base\_error[m][\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] += eigenfunction\_error[m][\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13580}13580         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13581}13581       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13582}13582     \} \textcolor{comment}{// End of loop over copies}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13583}13583 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13584}13584     \textcolor{comment}{// Then refine all problems based on the combined measure}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13585}13585     \textcolor{comment}{// if we are actually adapting (not just estimating the errors)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13586}13586     \textcolor{keywordflow}{if} (actually\_adapt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13587}13587     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13588}13588       this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a291f1a2b3cb65743355ec1e0cdcb7f48}{adapt\_based\_on\_error\_estimates}}(n\_refined, n\_unrefined, base\_error);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13589}13589       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} c = 0; c < n\_copies; c++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13590}13590       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13591}13591         \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>adapt\_based\_on\_error\_estimates(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13592}13592           n\_refined, n\_unrefined, base\_error);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13593}13593       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13594}13594       \textcolor{comment}{// Symmetrise the problem (again) if we are solving for a pitchfork}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13595}13595       \textcolor{keywordflow}{if} (bifurcation\_type == 2)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13596}13596       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13597}13597         \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[0]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13598}13598           -\/>symmetrise\_eigenfunction\_for\_adaptive\_pitchfork\_tracking();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13599}13599       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13600}13600 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13601}13601       \textcolor{comment}{// Now get the refined guess for the eigenvector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13602}13602       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} c = 0; c < n\_copies; c++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13603}13603       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13604}13604         \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>get\_dofs(eigenfunction[c]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13605}13605       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13606}13606     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13607}13607 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13608}13608     \textcolor{comment}{// Reactivate the tracking}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13609}13609     \textcolor{keywordflow}{switch} (bifurcation\_type)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13610}13610     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13611}13611         \textcolor{comment}{// Fold tracking}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13612}13612       \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13613}13613         this-\/>\mbox{\hyperlink{classoomph_1_1Problem_acf20e92281911dfbb423ea82542c0485}{activate\_fold\_tracking}}(parameter\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13614}13614         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13615}13615 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13616}13616         \textcolor{comment}{// Pitchfork}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13617}13617       \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13618}13618         this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a7f5eb1f88a957cb3d8a11b558002d484}{activate\_pitchfork\_tracking}}(parameter\_pt, eigenfunction[0]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13619}13619         \textcolor{comment}{// reset the slack parameter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13620}13620         this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}() -\/ 1) = sigma;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13621}13621         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13622}13622 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13623}13623         \textcolor{comment}{// Hopf}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13624}13624       \textcolor{keywordflow}{case} 3:}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13625}13625         this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ac5966d1a184e722195f96d797b52e64c}{activate\_hopf\_tracking}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13626}13626           parameter\_pt, omega, eigenfunction[0], eigenfunction[1]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13627}13627         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13628}13628 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13629}13629       \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13630}13630         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13631}13631         error\_stream << \textcolor{stringliteral}{"{}Bifurcation type "{}} << bifurcation\_type}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13632}13632                      << \textcolor{stringliteral}{"{} not known\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13633}13633                      << \textcolor{stringliteral}{"{}1: Fold, 2: Pitchfork, 3: Hopf\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13634}13634         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13635}13635           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13636}13636     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13637}13637   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13638}13638 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13639}13639 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13640}13640   \textcolor{comment}{//====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13641}13641 \textcolor{comment}{  /// A function that is used to document the errors when}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13642}13642 \textcolor{comment}{  /// adapting a bifurcation-\/tracking}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13643}13643 \textcolor{comment}{  /// problem, which requires separate interpolation of the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13644}13644 \textcolor{comment}{  /// associated eigenfunction. The error measure is chosen to be}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13645}13645 \textcolor{comment}{  /// a suitable combination of the errors in the base flow and the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13646}13646 \textcolor{comment}{  /// eigenfunction. The bifurcation type is passed as an argument}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13647}13647 \textcolor{comment}{}  \textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13648}\mbox{\hyperlink{classoomph_1_1Problem_ad36cedd508f3cfb352ddd44c18914d41}{13648}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ad36cedd508f3cfb352ddd44c18914d41}{Problem::bifurcation\_adapt\_doc\_errors}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& bifurcation\_type)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13649}13649   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13650}13650     \textcolor{comment}{// Dummy arguments}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13651}13651     \textcolor{keywordtype}{unsigned} n\_refined, n\_unrefined;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13652}13652     \textcolor{comment}{// Just call the bifurcation helper without actually adapting}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13653}13653     \mbox{\hyperlink{classoomph_1_1Problem_a27d31a7a78f5d01b9d0a5e07c0e06e5d}{bifurcation\_adapt\_helper}}(n\_refined, n\_unrefined, bifurcation\_type, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13654}13654   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13655}13655 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13656}13656 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13657}13657   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13658}13658 \textcolor{comment}{  /// Adapt problem:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13659}13659 \textcolor{comment}{  /// Perform mesh adaptation for (all) refineable (sub)mesh(es),}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13660}13660 \textcolor{comment}{  /// based on their own error estimates and the target errors specified}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13661}13661 \textcolor{comment}{  /// in the mesh(es). Following mesh adaptation,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13662}13662 \textcolor{comment}{  /// update global mesh, and re-\/assign equation numbers.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13663}13663 \textcolor{comment}{  /// Return \# of refined/unrefined elements. On return from this}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13664}13664 \textcolor{comment}{  /// function, Problem can immediately be solved again.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13665}13665 \textcolor{comment}{}  \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13666}\mbox{\hyperlink{classoomph_1_1Problem_afc4492ec2686c70467cb0cdb4638a45f}{13666}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a0b9e09ddfa2411f14fc723c3207decd1}{Problem::adapt}}(\textcolor{keywordtype}{unsigned}\& n\_refined, \textcolor{keywordtype}{unsigned}\& n\_unrefined)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13667}13667   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13668}13668     \textcolor{keywordtype}{double} t\_start\_total = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13669}13669     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13670}13670     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13671}13671       t\_start\_total = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13672}13672     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13673}13673 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13674}13674     \textcolor{comment}{// Get the bifurcation type}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13675}13675     \textcolor{keywordtype}{int} bifurcation\_type = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a22c5f240674e4f6cee12006790c11dae}{bifurcation\_type}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13676}13676 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13677}13677     \textcolor{keywordtype}{bool} continuation\_problem = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13678}13678 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13679}13679     \textcolor{comment}{// If we have continuation data then we need to project that across to the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13680}13680     \textcolor{comment}{// new mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13681}13681     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_adbecce0cb1bd7b6b21285568e41ee3eb}{Use\_continuation\_timestepper}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13682}13682     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13683}13683       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a1861321b2d129707935bf1191238daca}{Dof\_derivative}}.size() != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13684}13684       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13685}13685         continuation\_problem = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13686}13686       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13687}13687     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13688}13688 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13689}13689     \textcolor{comment}{// If we are tracking a bifurcation then call the bifurcation adapt function}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13690}13690     \textcolor{keywordflow}{if} (bifurcation\_type != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13691}13691     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13692}13692       this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a27d31a7a78f5d01b9d0a5e07c0e06e5d}{bifurcation\_adapt\_helper}}(n\_refined, n\_unrefined, bifurcation\_type);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13693}13693       \textcolor{comment}{// Return immediately}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13694}13694       \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13695}13695     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13696}13696 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13697}13697     \textcolor{keywordflow}{if} (continuation\_problem)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13698}13698     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13699}13699       \textcolor{comment}{// Create a copy of the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13700}13700       \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}.resize(2);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13701}13701       \textcolor{comment}{// If we don't already have a copy}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13702}13702       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} c = 0; c < 2; c++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13703}13703       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13704}13704         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c] == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13705}13705         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13706}13706           \textcolor{comment}{// Create the copy}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13707}13707           \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c] = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a78ac2b1d2483f49198203e192d3b2871}{make\_copy}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13708}13708 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13709}13709           \textcolor{comment}{// Refine the copy to the same level as the current problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13710}13710           \textcolor{comment}{// Must call actions before adapt}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13711}13711           \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>actions\_before\_adapt();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13712}13712 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13713}13713           \textcolor{comment}{// Find number of submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13714}13714           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} N\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>nsub\_mesh();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13715}13715 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13716}13716           \textcolor{comment}{// If there is only one mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13717}13717           \textcolor{keywordflow}{if} (N\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13718}13718           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13719}13719             \textcolor{comment}{// Can we refine the mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13720}13720             \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13721}13721                   \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13722}13722                     \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13723}13723             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13724}13724               \textcolor{comment}{// Is the adapt flag set}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13725}13725               \textcolor{keywordflow}{if} (mmesh\_pt-\/>is\_adaptation\_enabled())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13726}13726               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13727}13727                 \textcolor{comment}{// Now get the original problem's mesh if it's refineable}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13728}13728                 \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* original\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13729}13729                       \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13730}13730                         this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13731}13731                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13732}13732                   \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SolidMesh}{SolidMesh}}*\textcolor{keyword}{>}(original\_mesh\_pt) != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13733}13733                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13734}13734                     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13735}13735                       << \textcolor{stringliteral}{"{}Info/Warning: Adaptive Continuation is broken in "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13736}13736                       << \textcolor{stringliteral}{"{}SolidElement"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13737}13737                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13738}13738                   mmesh\_pt-\/>refine\_base\_mesh\_as\_in\_reference\_mesh(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13739}13739                     original\_mesh\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13740}13740                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13741}13741                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13742}13742                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13743}13743                   \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh in orginal problem is not "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13744}13744                                 \textcolor{stringliteral}{"{}refineable."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13745}13745                              << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13746}13746                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13747}13747               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13748}13748               \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13749}13749               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13750}13750                 \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13751}13751                   << \textcolor{stringliteral}{"{}Info/Warning: Mesh adaptation is disabled in copy."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13752}13752                   << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13753}13753               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13754}13754             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13755}13755             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}* tmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13756}13756                        \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13757}13757                          \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13758}13758             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13759}13759               \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}* original\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13760}13760                     \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}*\textcolor{keyword}{>}(this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13761}13761               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13762}13762                 \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SolidMesh}{SolidMesh}}*\textcolor{keyword}{>}(original\_mesh\_pt) != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13763}13763                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13764}13764                   \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13765}13765                     << \textcolor{stringliteral}{"{}Info/Warning: Adaptive Continuation is broken in "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13766}13766                     << \textcolor{stringliteral}{"{}SolidElement"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13767}13767                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13768}13768 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13769}13769                 \textcolor{comment}{// Remesh using the triangulateIO of the base mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13770}13770                 \textcolor{comment}{// Done via a file, so a bit hacky but this will be}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13771}13771                 \textcolor{comment}{// superseded very soon}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13772}13772                 std::ofstream tri\_dump(\textcolor{stringliteral}{"{}triangle\_mesh.dmp"{}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13773}13773                 original\_mesh\_pt-\/>dump\_triangulateio(tri\_dump);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13774}13774                 tri\_dump.close();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13775}13775                 std::ifstream tri\_read(\textcolor{stringliteral}{"{}triangle\_mesh.dmp"{}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13776}13776                 tmesh\_pt-\/>remesh\_from\_triangulateio(tri\_read);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13777}13777                 tri\_read.close();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13778}13778 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13779}13779 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13780}13780                 \textcolor{comment}{// Set the nodes to be at the same positions}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13781}13781                 \textcolor{comment}{// as the original just in case the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13782}13782                 \textcolor{comment}{// triangulatio is out of sync with the real data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13783}13783                 \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_node = original\_mesh\_pt-\/>nnode();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13784}13784                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_node; ++n)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13785}13785                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13786}13786                   \mbox{\hyperlink{classoomph_1_1Node}{Node}}* \textcolor{keyword}{const} nod\_pt = original\_mesh\_pt-\/>node\_pt(n);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13787}13787                   \mbox{\hyperlink{classoomph_1_1Node}{Node}}* \textcolor{keyword}{const} new\_node\_pt = tmesh\_pt-\/>node\_pt(n);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13788}13788                   \textcolor{keywordtype}{unsigned} n\_dim = nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_a786c96a8e46eb27a03b2b31f629d41b3}{ndim}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13789}13789                   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dim; ++\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13790}13790                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13791}13791                     new\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_ab76b4773a65b349f143539e07b6e15e2}{x}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) = nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_ab76b4773a65b349f143539e07b6e15e2}{x}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13792}13792                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13793}13793                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13794}13794               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13795}13795               \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13796}13796               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13797}13797                 \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13798}13798                   << \textcolor{stringliteral}{"{}Info/warning: Original Mesh is not TriangleBased\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13799}13799                   << \textcolor{stringliteral}{"{}... but the copy is!"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13800}13800               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13801}13801             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13802}13802             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13803}13803             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13804}13804               \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be adapted in copy."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13805}13805                          << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13806}13806             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13807}13807           \} \textcolor{comment}{// End of single mesh case}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13808}13808           \textcolor{comment}{// Otherwise loop over the submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13809}13809           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13810}13810           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13811}13811             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < N\_mesh; m++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13812}13812             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13813}13813               \textcolor{comment}{// Can we refine the submesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13814}13814               \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13815}13815                     \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13816}13816                       \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(m)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13817}13817               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13818}13818                 \textcolor{comment}{// Is the adapt flag set}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13819}13819                 \textcolor{keywordflow}{if} (mmesh\_pt-\/>is\_adaptation\_enabled())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13820}13820                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13821}13821                   \textcolor{comment}{// Now get the original problem's mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13822}13822                   \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* original\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13823}13823                         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13824}13824                           this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(m)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13825}13825                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13826}13826                     \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SolidMesh}{SolidMesh}}*\textcolor{keyword}{>}(original\_mesh\_pt) != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13827}13827                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13828}13828                       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13829}13829                         << \textcolor{stringliteral}{"{}Info/Warning: Adaptive Continuation is broken in "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13830}13830                         << \textcolor{stringliteral}{"{}SolidElement"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13831}13831                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13832}13832 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13833}13833                     mmesh\_pt-\/>refine\_base\_mesh\_as\_in\_reference\_mesh(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13834}13834                       original\_mesh\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13835}13835                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13836}13836                   \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13837}13837                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13838}13838                     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh in orginal problem is "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13839}13839                                   \textcolor{stringliteral}{"{}not refineable."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13840}13840                                << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13841}13841                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13842}13842                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13843}13843                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13844}13844                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13845}13845                   \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13846}13846                     << \textcolor{stringliteral}{"{}Info/Warning: Mesh adaptation is disabled in copy."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13847}13847                     << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13848}13848                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13849}13849               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13850}13850               \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}* tmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13851}13851                          \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13852}13852                            \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(m)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13853}13853               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13854}13854                 \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}* original\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13855}13855                       \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}*\textcolor{keyword}{>}(this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(m)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13856}13856                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13857}13857                   \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SolidMesh}{SolidMesh}}*\textcolor{keyword}{>}(original\_mesh\_pt) != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13858}13858                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13859}13859                     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13860}13860                       << \textcolor{stringliteral}{"{}Info/Warning: Adaptive Continuation is broken in "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13861}13861                       << \textcolor{stringliteral}{"{}SolidElement"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13862}13862                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13863}13863 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13864}13864                   \textcolor{comment}{// Remesh using the triangulateIO of the base mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13865}13865                   \textcolor{comment}{// Done via a file, so a bit hacky but this will be}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13866}13866                   \textcolor{comment}{// superseded very soon}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13867}13867                   std::ofstream tri\_dump(\textcolor{stringliteral}{"{}triangle\_mesh.dmp"{}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13868}13868                   original\_mesh\_pt-\/>dump\_triangulateio(tri\_dump);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13869}13869                   tri\_dump.close();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13870}13870                   std::ifstream tri\_read(\textcolor{stringliteral}{"{}triangle\_mesh.dmp"{}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13871}13871                   tmesh\_pt-\/>remesh\_from\_triangulateio(tri\_read);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13872}13872                   tri\_read.close();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13873}13873 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13874}13874                   \textcolor{comment}{// Set the nodes to be at the same positions}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13875}13875                   \textcolor{comment}{// as the original just in case the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13876}13876                   \textcolor{comment}{// triangulatio is out of sync with the real data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13877}13877                   \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_node = original\_mesh\_pt-\/>nnode();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13878}13878                   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_node; ++n)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13879}13879                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13880}13880                     \mbox{\hyperlink{classoomph_1_1Node}{Node}}* \textcolor{keyword}{const} nod\_pt = original\_mesh\_pt-\/>node\_pt(n);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13881}13881                     \mbox{\hyperlink{classoomph_1_1Node}{Node}}* \textcolor{keyword}{const} new\_node\_pt = tmesh\_pt-\/>node\_pt(n);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13882}13882                     \textcolor{keywordtype}{unsigned} n\_dim = nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_a786c96a8e46eb27a03b2b31f629d41b3}{ndim}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13883}13883                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dim; ++\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13884}13884                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13885}13885                       new\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_ab76b4773a65b349f143539e07b6e15e2}{x}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) = nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_ab76b4773a65b349f143539e07b6e15e2}{x}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13886}13886                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13887}13887                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13888}13888                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13889}13889                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13890}13890                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13891}13891                   \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13892}13892                     << \textcolor{stringliteral}{"{}Info/warning: Original Mesh is not TriangleBased\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13893}13893                     << \textcolor{stringliteral}{"{}... but the copy is!"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13894}13894                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13895}13895               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13896}13896               \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13897}13897               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13898}13898                 \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be adapted in copy."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13899}13899                            << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13900}13900               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13901}13901             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13902}13902 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13903}13903 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13904}13904             \textcolor{comment}{// Must call actions after adapt}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13905}13905             \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>actions\_after\_adapt();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13906}13906 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13907}13907             \textcolor{comment}{// rebuild the global mesh in the copy}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13908}13908             \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>rebuild\_global\_mesh();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13909}13909 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13910}13910           \} \textcolor{comment}{// End of multiple mesh case}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13911}13911 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13912}13912           \textcolor{comment}{// Must call actions after adapt}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13913}13913           \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>actions\_after\_adapt();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13914}13914 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13915}13915           \textcolor{comment}{// Assign the equation numbers to the copy (quietly)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13916}13916           (void)\mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>\mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13917}13917         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13918}13918 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13919}13919         \textcolor{comment}{// Check that the dofs match for each copy}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13920}13920 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13921}13921         \textcolor{comment}{// If the problems don't match then complain}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13922}13922         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}() != this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13923}13923         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13924}13924           std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13925}13925           error\_stream << \textcolor{stringliteral}{"{}Number of unknowns in the problem copy "{}} << c << \textcolor{stringliteral}{"{} "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13926}13926                        << \textcolor{stringliteral}{"{}not equal to number in the original:\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13927}13927                        << this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}() << \textcolor{stringliteral}{"{} (original) "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13928}13928                        << \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[c]-\/>ndof() << \textcolor{stringliteral}{"{} (copy)\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13929}13929 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13930}13930           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13931}13931                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13932}13932                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13933}13933         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13934}13934 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13935}13935       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13936}13936 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13937}13937       \textcolor{comment}{// Need to set the Dof derivatives to the copied problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13938}13938       \textcolor{comment}{// Assign the eigenfunction(s) to the copied problems}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13939}13939       \textcolor{keywordtype}{unsigned} ndof\_local = \mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13940}13940       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < ndof\_local; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13941}13941       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13942}13942         \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[0]-\/>dof(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5aa9936836b7e342c61ac0daba155ec5}{dof\_derivative}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13943}13943         \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[1]-\/>dof(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a187fca413da164551f4d3344c7baf861}{dof\_current}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13944}13944       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13945}13945       \textcolor{comment}{// Set all pinned values to zero}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13946}13946       \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[0]-\/>set\_pinned\_values\_to\_zero();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13947}13947       \textcolor{comment}{// Don't need to for the current dofs that are actuall the dofs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13948}13948 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13949}13949       \textcolor{comment}{// Now adapt}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13950}13950       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<double>}}> base\_error;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13951}13951       this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5e58bd6dcb1ff9ef54cf504984fb5f9e}{get\_all\_error\_estimates}}(base\_error);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13952}13952       this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a291f1a2b3cb65743355ec1e0cdcb7f48}{adapt\_based\_on\_error\_estimates}}(n\_refined, n\_unrefined, base\_error);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13953}13953       \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[0]-\/>adapt\_based\_on\_error\_estimates(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13954}13954         n\_refined, n\_unrefined, base\_error);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13955}13955       \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[1]-\/>adapt\_based\_on\_error\_estimates(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13956}13956         n\_refined, n\_unrefined, base\_error);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13957}13957 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13958}13958       \textcolor{comment}{// Now sort out the Dof pointer}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13959}13959       ndof\_local = \mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13960}13960       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a1861321b2d129707935bf1191238daca}{Dof\_derivative}}.size() != ndof\_local)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13961}13961       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13962}13962         \mbox{\hyperlink{classoomph_1_1Problem_a1861321b2d129707935bf1191238daca}{Dof\_derivative}}.resize(ndof\_local, 0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13963}13963       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13964}13964       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a366b50c490e9fd3ddafa05b2fbd0b883}{Dof\_current}}.size() != ndof\_local)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13965}13965       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13966}13966         \mbox{\hyperlink{classoomph_1_1Problem_a366b50c490e9fd3ddafa05b2fbd0b883}{Dof\_current}}.resize(ndof\_local, 0.0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13967}13967       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13968}13968       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < ndof\_local; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13969}13969       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13970}13970         \mbox{\hyperlink{classoomph_1_1Problem_a1861321b2d129707935bf1191238daca}{Dof\_derivative}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[0]-\/>dof(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13971}13971         \mbox{\hyperlink{classoomph_1_1Problem_a366b50c490e9fd3ddafa05b2fbd0b883}{Dof\_current}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = \mbox{\hyperlink{classoomph_1_1Problem_aa2e04de221f29c13067e2fe4cf4c70f9}{Copy\_of\_problem\_pt}}[1]-\/>dof(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13972}13972       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13973}13973       \textcolor{comment}{// Return immediately}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13974}13974       \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13975}13975     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13976}13976 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13977}13977     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13978}13978     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Adapting problem:"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13979}13979     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}================="{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13980}13980 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13981}13981     \textcolor{keywordtype}{double} t\_start = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13982}13982     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13983}13983     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13984}13984       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13985}13985     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13986}13986 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13987}13987     \textcolor{comment}{// Call the actions before adaptation}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13988}13988     \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13989}13989 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13990}13990     \textcolor{keywordtype}{double} t\_end = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13991}13991     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13992}13992     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13993}13993       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13994}13994       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for actions before adapt: "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13995}13995                  << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13996}13996       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13997}13997     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13998}13998 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l13999}13999     \textcolor{comment}{// Initialise counters}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14000}14000     n\_refined = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14001}14001     n\_unrefined = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14002}14002 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14003}14003     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14004}14004     \textcolor{keywordtype}{unsigned} Nmesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14005}14005 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14006}14006     \textcolor{comment}{// Single mesh:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14007}14007     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14008}14008     \textcolor{keywordflow}{if} (Nmesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14009}14009     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14010}14010       \textcolor{comment}{// Refine single mesh if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14011}14011       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14012}14012             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14013}14013       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14014}14014         \textcolor{keywordflow}{if} (mmesh\_pt-\/>is\_adaptation\_enabled())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14015}14015         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14016}14016           \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14017}14017 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14018}14018           \textcolor{comment}{// Get pointer to error estimator}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14019}14019           \mbox{\hyperlink{classoomph_1_1ErrorEstimator}{ErrorEstimator}}* error\_estimator\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14020}14020             mmesh\_pt-\/>spatial\_error\_estimator\_pt();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14021}14021 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14022}14022 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14023}14023           \textcolor{keywordflow}{if} (error\_estimator\_pt == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14024}14024           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14025}14025             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Error estimator hasn't been set yet"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14026}14026                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14027}14027                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14028}14028           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14029}14029 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14030}14030 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14031}14031           \textcolor{comment}{// Get error for all elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14032}14032           \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} elemental\_error(mmesh\_pt-\/>nelement());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14033}14033 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14034}14034           \textcolor{keywordflow}{if} (mmesh\_pt-\/>doc\_info\_pt() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14035}14035           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14036}14036             error\_estimator\_pt-\/>\mbox{\hyperlink{classoomph_1_1ErrorEstimator_a3b12c5d2579360a08b6b6298cea8b142}{get\_element\_errors}}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0), elemental\_error);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14037}14037           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14038}14038           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14039}14039           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14040}14040             error\_estimator\_pt-\/>\mbox{\hyperlink{classoomph_1_1ErrorEstimator_a3b12c5d2579360a08b6b6298cea8b142}{get\_element\_errors}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14041}14041               \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0), elemental\_error, *mmesh\_pt-\/>doc\_info\_pt());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14042}14042           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14043}14043 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14044}14044           \textcolor{comment}{// Store max./min actual error}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14045}14045           mmesh\_pt-\/>max\_error() = std::fabs(*std::max\_element(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14046}14046             elemental\_error.begin(), elemental\_error.end(), \mbox{\hyperlink{classoomph_1_1AbsCmp}{AbsCmp<double>}}()));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14047}14047 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14048}14048           mmesh\_pt-\/>min\_error() = std::fabs(*std::min\_element(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14049}14049             elemental\_error.begin(), elemental\_error.end(), \mbox{\hyperlink{classoomph_1_1AbsCmp}{AbsCmp<double>}}()));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14050}14050 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14051}14051           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)n Max/min error: "{}} << mmesh\_pt-\/>max\_error() << \textcolor{stringliteral}{"{} "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14052}14052                      << mmesh\_pt-\/>min\_error() << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14053}14053                      << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14054}14054 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14055}14055 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14056}14056           \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14057}14057           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14058}14058             t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14059}14059             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for error estimation: "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14060}14060                        << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14061}14061             t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14062}14062           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14063}14063 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14064}14064           \textcolor{comment}{// Adapt mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14065}14065           mmesh\_pt-\/>adapt(elemental\_error);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14066}14066 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14067}14067           \textcolor{comment}{// Add to counters}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14068}14068           n\_refined += mmesh\_pt-\/>nrefined();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14069}14069           n\_unrefined += mmesh\_pt-\/>nunrefined();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14070}14070 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14071}14071           \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14072}14072           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14073}14073             t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14074}14074             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for complete mesh adaptation "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14075}14075                        << \textcolor{stringliteral}{"{}(but excluding comp of error estimate): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14076}14076                        << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14077}14077             t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14078}14078           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14079}14079         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14080}14080         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14081}14081         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14082}14082           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh adaptation is disabled."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14083}14083                      << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14084}14084         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14085}14085       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14086}14086       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14087}14087       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14088}14088         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be adapted"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14089}14089       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14090}14090     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14091}14091     \textcolor{comment}{// Multiple submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14092}14092     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14093}14093     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14094}14094     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14095}14095       \textcolor{comment}{// Loop over submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14096}14096       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imesh = 0; imesh < Nmesh; imesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14097}14097       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14098}14098         \textcolor{comment}{// Refine single mesh uniformly if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14099}14099         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14100}14100               \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14101}14101         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14102}14102           \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14103}14103 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14104}14104           \textcolor{comment}{// Get pointer to error estimator}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14105}14105           \mbox{\hyperlink{classoomph_1_1ErrorEstimator}{ErrorEstimator}}* error\_estimator\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14106}14106             mmesh\_pt-\/>spatial\_error\_estimator\_pt();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14107}14107 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14108}14108 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14109}14109           \textcolor{keywordflow}{if} (error\_estimator\_pt == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14110}14110           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14111}14111             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Error estimator hasn't been set yet"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14112}14112                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14113}14113                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14114}14114           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14115}14115 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14116}14116 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14117}14117           \textcolor{keywordflow}{if} (mmesh\_pt-\/>is\_adaptation\_enabled())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14118}14118           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14119}14119             \textcolor{comment}{// Get error for all elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14120}14120             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} elemental\_error(mmesh\_pt-\/>nelement());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14121}14121             \textcolor{keywordflow}{if} (mmesh\_pt-\/>doc\_info\_pt() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14122}14122             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14123}14123               error\_estimator\_pt-\/>\mbox{\hyperlink{classoomph_1_1ErrorEstimator_a3b12c5d2579360a08b6b6298cea8b142}{get\_element\_errors}}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14124}14124                                                      elemental\_error);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14125}14125             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14126}14126             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14127}14127             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14128}14128               error\_estimator\_pt-\/>\mbox{\hyperlink{classoomph_1_1ErrorEstimator_a3b12c5d2579360a08b6b6298cea8b142}{get\_element\_errors}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14129}14129                 \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh), elemental\_error, *mmesh\_pt-\/>doc\_info\_pt());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14130}14130             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14131}14131 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14132}14132             \textcolor{comment}{// Store max./min error if the mesh has any elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14133}14133             \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh)-\/>nelement() > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14134}14134             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14135}14135               mmesh\_pt-\/>max\_error() =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14136}14136                 std::fabs(*std::max\_element(elemental\_error.begin(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14137}14137                                             elemental\_error.end(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14138}14138                                             \mbox{\hyperlink{classoomph_1_1AbsCmp}{AbsCmp<double>}}()));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14139}14139 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14140}14140               mmesh\_pt-\/>min\_error() =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14141}14141                 std::fabs(*std::min\_element(elemental\_error.begin(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14142}14142                                             elemental\_error.end(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14143}14143                                             \mbox{\hyperlink{classoomph_1_1AbsCmp}{AbsCmp<double>}}()));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14144}14144             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14145}14145 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14146}14146             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)n Max/min error: "{}} << mmesh\_pt-\/>max\_error() << \textcolor{stringliteral}{"{} "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14147}14147                        << mmesh\_pt-\/>min\_error() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14148}14148 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14149}14149 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14150}14150             \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14151}14151             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14152}14152               t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14153}14153               \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for error estimation: "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14154}14154                          << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14155}14155               t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14156}14156             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14157}14157 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14158}14158             \textcolor{comment}{// Adapt mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14159}14159             mmesh\_pt-\/>adapt(elemental\_error);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14160}14160 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14161}14161             \textcolor{comment}{// Add to counters}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14162}14162             n\_refined += mmesh\_pt-\/>nrefined();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14163}14163             n\_unrefined += mmesh\_pt-\/>nunrefined();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14164}14164 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14165}14165 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14166}14166             \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14167}14167             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14168}14168               t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14169}14169               \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for complete mesh adaptation "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14170}14170                          << \textcolor{stringliteral}{"{}(but excluding comp of error estimate): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14171}14171                          << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14172}14172               t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14173}14173             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14174}14174           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14175}14175           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14176}14176           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14177}14177             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh adaptation is disabled."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14178}14178                        << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14179}14179           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14180}14180         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14181}14181         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14182}14182         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14183}14183           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be adapted."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14184}14184         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14185}14185 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14186}14186       \} \textcolor{comment}{// End of loop over submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14187}14187 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14188}14188       \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14189}14189       \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14190}14190     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14191}14191 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14192}14192 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14193}14193     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14194}14194     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14195}14195       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14196}14196       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Total time for actual adaptation "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14197}14197                  << \textcolor{stringliteral}{"{}(all meshes; incl error estimates): "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14198}14198                  << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14199}14199       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14200}14200     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14201}14201 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14202}14202     \textcolor{comment}{// Any actions after adapt}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14203}14203     \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14204}14204 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14205}14205 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14206}14206     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14207}14207     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14208}14208       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14209}14209       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for actions after adapt: "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14210}14210                  << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14211}14211       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14212}14212 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14213}14213       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}About to start re-\/assigning eqn numbers "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14214}14214                  << \textcolor{stringliteral}{"{}with Problem::assign\_eqn\_numbers() at end of "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14215}14215                  << \textcolor{stringliteral}{"{}Problem::adapt().\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14216}14216     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14217}14217 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14218}14218     \textcolor{comment}{// Attach the boundary conditions to the mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14219}14219     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)nNumber of equations: "{}} << \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}() << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14220}14220                << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14221}14221 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14222}14222 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14223}14223     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14224}14224     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14225}14225       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14226}14226       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for re-\/assigning eqn numbers with "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14227}14227                  << \textcolor{stringliteral}{"{}Problem::assign\_eqn\_numbers() at end of Problem::adapt(): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14228}14228                  << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14229}14229       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Total time for adapt: "{}} << t\_end -\/ t\_start\_total}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14230}14230                  << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14231}14231     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14232}14232   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14233}14233 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14234}14234   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14235}14235 \textcolor{comment}{  /// p-\/adapt problem:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14236}14236 \textcolor{comment}{  /// Perform mesh adaptation for (all) refineable (sub)mesh(es),}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14237}14237 \textcolor{comment}{  /// based on their own error estimates and the target errors specified}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14238}14238 \textcolor{comment}{  /// in the mesh(es). Following mesh adaptation,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14239}14239 \textcolor{comment}{  /// update global mesh, and re-\/assign equation numbers.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14240}14240 \textcolor{comment}{  /// Return \# of refined/unrefined elements. On return from this}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14241}14241 \textcolor{comment}{  /// function, Problem can immediately be solved again.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14242}14242 \textcolor{comment}{}  \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14243}\mbox{\hyperlink{classoomph_1_1Problem_a1303b2fde2fe84b71519cadabc18f868}{14243}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_aaad4443f87f3f3affe53fa9160802e7c}{Problem::p\_adapt}}(\textcolor{keywordtype}{unsigned}\& n\_refined, \textcolor{keywordtype}{unsigned}\& n\_unrefined)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14244}14244   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14245}14245     \textcolor{keywordtype}{double} t\_start\_total = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14246}14246     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14247}14247     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14248}14248       t\_start\_total = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14249}14249     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14250}14250 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14251}14251     \textcolor{comment}{// Get the bifurcation type}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14252}14252     \textcolor{keywordtype}{int} bifurcation\_type = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a22c5f240674e4f6cee12006790c11dae}{bifurcation\_type}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14253}14253 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14254}14254     \textcolor{comment}{// If we are tracking a bifurcation then call the bifurcation adapt function}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14255}14255     \textcolor{keywordflow}{if} (bifurcation\_type != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14256}14256     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14257}14257       this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a27d31a7a78f5d01b9d0a5e07c0e06e5d}{bifurcation\_adapt\_helper}}(n\_refined, n\_unrefined, bifurcation\_type);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14258}14258       \textcolor{comment}{// Return immediately}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14259}14259       \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14260}14260     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14261}14261 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14262}14262     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14263}14263     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}p-\/adapting problem:"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14264}14264     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}==================="{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14265}14265 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14266}14266     \textcolor{keywordtype}{double} t\_start = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14267}14267     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14268}14268     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14269}14269       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14270}14270     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14271}14271 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14272}14272     \textcolor{comment}{// Call the actions before adaptation}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14273}14273     \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14274}14274 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14275}14275     \textcolor{keywordtype}{double} t\_end = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14276}14276     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14277}14277     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14278}14278       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14279}14279       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for actions before adapt: "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14280}14280                  << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14281}14281       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14282}14282     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14283}14283 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14284}14284     \textcolor{comment}{// Initialise counters}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14285}14285     n\_refined = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14286}14286     n\_unrefined = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14287}14287 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14288}14288     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14289}14289     \textcolor{keywordtype}{unsigned} Nmesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14290}14290 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14291}14291     \textcolor{comment}{// Single mesh:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14292}14292     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14293}14293     \textcolor{keywordflow}{if} (Nmesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14294}14294     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14295}14295       \textcolor{comment}{// Refine single mesh if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14296}14296       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14297}14297             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14298}14298       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14299}14299         \textcolor{keywordflow}{if} (mmesh\_pt-\/>is\_p\_adaptation\_enabled())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14300}14300         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14301}14301           \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14302}14302 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14303}14303           \textcolor{comment}{// Get pointer to error estimator}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14304}14304           \mbox{\hyperlink{classoomph_1_1ErrorEstimator}{ErrorEstimator}}* error\_estimator\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14305}14305             mmesh\_pt-\/>spatial\_error\_estimator\_pt();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14306}14306 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14307}14307 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14308}14308           \textcolor{keywordflow}{if} (error\_estimator\_pt == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14309}14309           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14310}14310             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Error estimator hasn't been set yet"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14311}14311                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14312}14312                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14313}14313           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14314}14314 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14315}14315 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14316}14316           \textcolor{comment}{// Get error for all elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14317}14317           \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} elemental\_error(mmesh\_pt-\/>nelement());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14318}14318 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14319}14319           \textcolor{keywordflow}{if} (mmesh\_pt-\/>doc\_info\_pt() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14320}14320           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14321}14321             error\_estimator\_pt-\/>\mbox{\hyperlink{classoomph_1_1ErrorEstimator_a3b12c5d2579360a08b6b6298cea8b142}{get\_element\_errors}}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0), elemental\_error);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14322}14322           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14323}14323           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14324}14324           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14325}14325             error\_estimator\_pt-\/>\mbox{\hyperlink{classoomph_1_1ErrorEstimator_a3b12c5d2579360a08b6b6298cea8b142}{get\_element\_errors}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14326}14326               \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0), elemental\_error, *mmesh\_pt-\/>doc\_info\_pt());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14327}14327           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14328}14328 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14329}14329           \textcolor{comment}{// Store max./min actual error}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14330}14330           mmesh\_pt-\/>max\_error() = std::fabs(*std::max\_element(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14331}14331             elemental\_error.begin(), elemental\_error.end(), \mbox{\hyperlink{classoomph_1_1AbsCmp}{AbsCmp<double>}}()));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14332}14332 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14333}14333           mmesh\_pt-\/>min\_error() = std::fabs(*std::min\_element(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14334}14334             elemental\_error.begin(), elemental\_error.end(), \mbox{\hyperlink{classoomph_1_1AbsCmp}{AbsCmp<double>}}()));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14335}14335 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14336}14336           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)n Max/min error: "{}} << mmesh\_pt-\/>max\_error() << \textcolor{stringliteral}{"{} "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14337}14337                      << mmesh\_pt-\/>min\_error() << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14338}14338                      << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14339}14339 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14340}14340 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14341}14341           \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14342}14342           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14343}14343             t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14344}14344             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for error estimation: "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14345}14345                        << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14346}14346             t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14347}14347           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14348}14348 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14349}14349           \textcolor{comment}{// Adapt mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14350}14350           mmesh\_pt-\/>p\_adapt(elemental\_error);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14351}14351 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14352}14352           \textcolor{comment}{// Add to counters}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14353}14353           n\_refined += mmesh\_pt-\/>nrefined();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14354}14354           n\_unrefined += mmesh\_pt-\/>nunrefined();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14355}14355 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14356}14356           \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14357}14357           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14358}14358             t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14359}14359             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for complete mesh adaptation "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14360}14360                        << \textcolor{stringliteral}{"{}(but excluding comp of error estimate): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14361}14361                        << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14362}14362             t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14363}14363           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14364}14364         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14365}14365         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14366}14366         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14367}14367           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh adaptation is disabled."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14368}14368                      << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14369}14369         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14370}14370       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14371}14371       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14372}14372       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14373}14373         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be adapted"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14374}14374       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14375}14375     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14376}14376     \textcolor{comment}{// Multiple submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14377}14377     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14378}14378     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14379}14379     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14380}14380       \textcolor{comment}{// Loop over submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14381}14381       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imesh = 0; imesh < Nmesh; imesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14382}14382       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14383}14383         \textcolor{comment}{// Refine single mesh uniformly if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14384}14384         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14385}14385               \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14386}14386         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14387}14387           \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14388}14388 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14389}14389           \textcolor{comment}{// Get pointer to error estimator}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14390}14390           \mbox{\hyperlink{classoomph_1_1ErrorEstimator}{ErrorEstimator}}* error\_estimator\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14391}14391             mmesh\_pt-\/>spatial\_error\_estimator\_pt();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14392}14392 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14393}14393 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14394}14394           \textcolor{keywordflow}{if} (error\_estimator\_pt == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14395}14395           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14396}14396             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Error estimator hasn't been set yet"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14397}14397                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14398}14398                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14399}14399           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14400}14400 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14401}14401 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14402}14402           \textcolor{keywordflow}{if} (mmesh\_pt-\/>is\_p\_adaptation\_enabled())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14403}14403           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14404}14404             \textcolor{comment}{// Get error for all elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14405}14405             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} elemental\_error(mmesh\_pt-\/>nelement());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14406}14406             \textcolor{keywordflow}{if} (mmesh\_pt-\/>doc\_info\_pt() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14407}14407             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14408}14408               error\_estimator\_pt-\/>\mbox{\hyperlink{classoomph_1_1ErrorEstimator_a3b12c5d2579360a08b6b6298cea8b142}{get\_element\_errors}}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14409}14409                                                      elemental\_error);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14410}14410             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14411}14411             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14412}14412             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14413}14413               error\_estimator\_pt-\/>\mbox{\hyperlink{classoomph_1_1ErrorEstimator_a3b12c5d2579360a08b6b6298cea8b142}{get\_element\_errors}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14414}14414                 \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh), elemental\_error, *mmesh\_pt-\/>doc\_info\_pt());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14415}14415             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14416}14416 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14417}14417             \textcolor{comment}{// Store max./min error if the mesh has any elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14418}14418             \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh)-\/>nelement() > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14419}14419             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14420}14420               mmesh\_pt-\/>max\_error() =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14421}14421                 std::fabs(*std::max\_element(elemental\_error.begin(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14422}14422                                             elemental\_error.end(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14423}14423                                             \mbox{\hyperlink{classoomph_1_1AbsCmp}{AbsCmp<double>}}()));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14424}14424 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14425}14425               mmesh\_pt-\/>min\_error() =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14426}14426                 std::fabs(*std::min\_element(elemental\_error.begin(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14427}14427                                             elemental\_error.end(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14428}14428                                             \mbox{\hyperlink{classoomph_1_1AbsCmp}{AbsCmp<double>}}()));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14429}14429             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14430}14430 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14431}14431             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)n Max/min error: "{}} << mmesh\_pt-\/>max\_error() << \textcolor{stringliteral}{"{} "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14432}14432                        << mmesh\_pt-\/>min\_error() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14433}14433 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14434}14434 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14435}14435             \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14436}14436             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14437}14437               t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14438}14438               \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for error estimation: "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14439}14439                          << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14440}14440               t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14441}14441             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14442}14442 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14443}14443             \textcolor{comment}{// Adapt mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14444}14444             mmesh\_pt-\/>p\_adapt(elemental\_error);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14445}14445 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14446}14446             \textcolor{comment}{// Add to counters}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14447}14447             n\_refined += mmesh\_pt-\/>nrefined();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14448}14448             n\_unrefined += mmesh\_pt-\/>nunrefined();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14449}14449 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14450}14450 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14451}14451             \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14452}14452             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14453}14453               t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14454}14454               \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for complete mesh adaptation "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14455}14455                          << \textcolor{stringliteral}{"{}(but excluding comp of error estimate): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14456}14456                          << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14457}14457               t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14458}14458             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14459}14459           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14460}14460           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14461}14461           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14462}14462             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh adaptation is disabled."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14463}14463                        << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14464}14464           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14465}14465         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14466}14466         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14467}14467         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14468}14468           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be adapted."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14469}14469         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14470}14470 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14471}14471       \} \textcolor{comment}{// End of loop over submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14472}14472 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14473}14473       \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14474}14474       \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14475}14475     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14476}14476 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14477}14477 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14478}14478     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14479}14479     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14480}14480       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14481}14481       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Total time for actual adaptation "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14482}14482                  << \textcolor{stringliteral}{"{}(all meshes; incl error estimates): "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14483}14483                  << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14484}14484       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14485}14485     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14486}14486 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14487}14487     \textcolor{comment}{// Any actions after adapt}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14488}14488     \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14489}14489 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14490}14490 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14491}14491     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14492}14492     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14493}14493       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14494}14494       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for actions after adapt: "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14495}14495                  << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14496}14496       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14497}14497 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14498}14498       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}About to start re-\/assigning eqn numbers "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14499}14499                  << \textcolor{stringliteral}{"{}with Problem::assign\_eqn\_numbers() at end of "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14500}14500                  << \textcolor{stringliteral}{"{}Problem::adapt().\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14501}14501     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14502}14502 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14503}14503     \textcolor{comment}{// Attach the boundary conditions to the mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14504}14504     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)nNumber of equations: "{}} << \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}() << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14505}14505                << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14506}14506 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14507}14507 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14508}14508     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14509}14509     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14510}14510       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14511}14511       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for re-\/assigning eqn numbers with "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14512}14512                  << \textcolor{stringliteral}{"{}Problem::assign\_eqn\_numbers() at end of Problem::adapt(): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14513}14513                  << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14514}14514       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Total time for adapt: "{}} << t\_end -\/ t\_start\_total}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14515}14515                  << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14516}14516     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14517}14517   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14518}14518 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14519}14519   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14520}14520 \textcolor{comment}{  /// Perform mesh adaptation for (all) refineable (sub)mesh(es),}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14521}14521 \textcolor{comment}{  /// based on the error estimates in elemental\_error}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14522}14522 \textcolor{comment}{  /// and the target errors specified}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14523}14523 \textcolor{comment}{  /// in the mesh(es). Following mesh adaptation,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14524}14524 \textcolor{comment}{  /// update global mesh, and re-\/assign equation numbers.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14525}14525 \textcolor{comment}{  /// Return \# of refined/unrefined elements. On return from this}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14526}14526 \textcolor{comment}{  /// function, Problem can immediately be solved again.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14527}14527 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14528}\mbox{\hyperlink{classoomph_1_1Problem_a291f1a2b3cb65743355ec1e0cdcb7f48}{14528}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a291f1a2b3cb65743355ec1e0cdcb7f48}{Problem::adapt\_based\_on\_error\_estimates}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14529}14529     \textcolor{keywordtype}{unsigned}\& n\_refined,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14530}14530     \textcolor{keywordtype}{unsigned}\& n\_unrefined,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14531}14531     \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}>\& elemental\_error)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14532}14532   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14533}14533     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14534}14534     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Adapting problem:"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14535}14535     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}================="{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14536}14536 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14537}14537     \textcolor{comment}{// Call the actions before adaptation}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14538}14538     \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14539}14539 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14540}14540     \textcolor{comment}{// Initialise counters}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14541}14541     n\_refined = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14542}14542     n\_unrefined = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14543}14543 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14544}14544     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14545}14545     \textcolor{keywordtype}{unsigned} Nmesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14546}14546 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14547}14547     \textcolor{comment}{// Single mesh:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14548}14548     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14549}14549     \textcolor{keywordflow}{if} (Nmesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14550}14550     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14551}14551       \textcolor{comment}{// Refine single mesh uniformly if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14552}14552       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14553}14553             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{Problem::mesh\_pt}}(0)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14554}14554       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14555}14555         \textcolor{keywordflow}{if} (mmesh\_pt-\/>is\_adaptation\_enabled())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14556}14556         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14557}14557           \textcolor{comment}{// Adapt mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14558}14558           mmesh\_pt-\/>adapt(elemental\_error[0]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14559}14559 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14560}14560           \textcolor{comment}{// Add to counters}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14561}14561           n\_refined += mmesh\_pt-\/>nrefined();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14562}14562           n\_unrefined += mmesh\_pt-\/>nunrefined();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14563}14563         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14564}14564         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14565}14565         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14566}14566           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh adaptation is disabled."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14567}14567                      << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14568}14568         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14569}14569       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14570}14570       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14571}14571       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14572}14572         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be adapted"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14573}14573       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14574}14574     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14575}14575 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14576}14576     \textcolor{comment}{// Multiple submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14577}14577     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14578}14578     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14579}14579     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14580}14580       \textcolor{comment}{// Loop over submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14581}14581       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imesh = 0; imesh < Nmesh; imesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14582}14582       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14583}14583         \textcolor{comment}{// Refine single mesh uniformly if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14584}14584         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14585}14585               \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{Problem::mesh\_pt}}(imesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14586}14586         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14587}14587           \textcolor{keywordflow}{if} (mmesh\_pt-\/>is\_adaptation\_enabled())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14588}14588           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14589}14589             \textcolor{comment}{// Adapt mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14590}14590             mmesh\_pt-\/>adapt(elemental\_error[imesh]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14591}14591 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14592}14592             \textcolor{comment}{// Add to counters}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14593}14593             n\_refined += mmesh\_pt-\/>nrefined();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14594}14594             n\_unrefined += mmesh\_pt-\/>nunrefined();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14595}14595           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14596}14596           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14597}14597           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14598}14598             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh adaptation is disabled."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14599}14599                        << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14600}14600           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14601}14601         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14602}14602         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14603}14603         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14604}14604           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be adapted."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14605}14605         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14606}14606 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14607}14607       \} \textcolor{comment}{// End of loop over submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14608}14608 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14609}14609       \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14610}14610       \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14611}14611     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14612}14612 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14613}14613     \textcolor{comment}{// Any actions after adapt}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14614}14614     \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14615}14615 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14616}14616     \textcolor{comment}{// Attach the boundary conditions to the mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14617}14617     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)nNumber of equations: "{}} << \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}() << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14618}14618                << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14619}14619   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14620}14620 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14621}14621 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14622}14622   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14623}14623 \textcolor{comment}{  /// Return the error estimates computed by (all) refineable}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14624}14624 \textcolor{comment}{  /// (sub)mesh(es) in the elemental\_error structure, which consists of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14625}14625 \textcolor{comment}{  /// a vector of elemental errors for each (sub)mesh.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14626}14626 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14627}\mbox{\hyperlink{classoomph_1_1Problem_a5e58bd6dcb1ff9ef54cf504984fb5f9e}{14627}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a5e58bd6dcb1ff9ef54cf504984fb5f9e}{Problem::get\_all\_error\_estimates}}(\mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}>\& elemental\_error)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14628}14628   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14629}14629     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14630}14630     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} Nmesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14631}14631 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14632}14632     \textcolor{comment}{// Single mesh:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14633}14633     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14634}14634     \textcolor{keywordflow}{if} (Nmesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14635}14635     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14636}14636       \textcolor{comment}{// There is only one mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14637}14637       elemental\_error.resize(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14638}14638       \textcolor{comment}{// Refine single mesh uniformly if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14639}14639       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14640}14640             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{Problem::mesh\_pt}}(0)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14641}14641       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14642}14642         \textcolor{comment}{// If we can adapt the mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14643}14643         \textcolor{keywordflow}{if} (mmesh\_pt-\/>is\_adaptation\_enabled())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14644}14644         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14645}14645           \textcolor{comment}{// Get pointer to error estimator}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14646}14646           \mbox{\hyperlink{classoomph_1_1ErrorEstimator}{ErrorEstimator}}* error\_estimator\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14647}14647             mmesh\_pt-\/>spatial\_error\_estimator\_pt();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14648}14648 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14649}14649 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14650}14650           \textcolor{keywordflow}{if} (error\_estimator\_pt == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14651}14651           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14652}14652             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Error estimator hasn't been set yet"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14653}14653                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14654}14654                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14655}14655           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14656}14656 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14657}14657 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14658}14658           \textcolor{comment}{// Get error for all elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14659}14659           elemental\_error[0].resize(mmesh\_pt-\/>nelement());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14660}14660           \textcolor{comment}{// Are we documenting the errors or not}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14661}14661           \textcolor{keywordflow}{if} (mmesh\_pt-\/>doc\_info\_pt() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14662}14662           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14663}14663             error\_estimator\_pt-\/>\mbox{\hyperlink{classoomph_1_1ErrorEstimator_a3b12c5d2579360a08b6b6298cea8b142}{get\_element\_errors}}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{Problem::mesh\_pt}}(0),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14664}14664                                                    elemental\_error[0]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14665}14665           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14666}14666           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14667}14667           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14668}14668             error\_estimator\_pt-\/>\mbox{\hyperlink{classoomph_1_1ErrorEstimator_a3b12c5d2579360a08b6b6298cea8b142}{get\_element\_errors}}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{Problem::mesh\_pt}}(0),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14669}14669                                                    elemental\_error[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14670}14670                                                    *mmesh\_pt-\/>doc\_info\_pt());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14671}14671           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14672}14672 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14673}14673           \textcolor{comment}{// Store max./min actual error}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14674}14674           mmesh\_pt-\/>max\_error() =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14675}14675             std::fabs(*std::max\_element(elemental\_error[0].begin(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14676}14676                                         elemental\_error[0].end(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14677}14677                                         \mbox{\hyperlink{classoomph_1_1AbsCmp}{AbsCmp<double>}}()));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14678}14678 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14679}14679           mmesh\_pt-\/>min\_error() =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14680}14680             std::fabs(*std::min\_element(elemental\_error[0].begin(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14681}14681                                         elemental\_error[0].end(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14682}14682                                         \mbox{\hyperlink{classoomph_1_1AbsCmp}{AbsCmp<double>}}()));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14683}14683 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14684}14684           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)n Max/min error: "{}} << mmesh\_pt-\/>max\_error() << \textcolor{stringliteral}{"{} "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14685}14685                      << mmesh\_pt-\/>min\_error() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14686}14686         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14687}14687         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14688}14688         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14689}14689           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh adaptation is disabled."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14690}14690                      << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14691}14691         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14692}14692       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14693}14693       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14694}14694       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14695}14695         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be adapted"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14696}14696       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14697}14697     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14698}14698 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14699}14699     \textcolor{comment}{// Multiple submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14700}14700     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14701}14701     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14702}14702     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14703}14703       \textcolor{comment}{// Resize to the number of submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14704}14704       elemental\_error.resize(Nmesh);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14705}14705 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14706}14706       \textcolor{comment}{// Loop over submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14707}14707       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imesh = 0; imesh < Nmesh; imesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14708}14708       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14709}14709         \textcolor{comment}{// Refine single mesh uniformly if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14710}14710         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14711}14711               \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{Problem::mesh\_pt}}(imesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14712}14712         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14713}14713           \textcolor{comment}{// Get pointer to error estimator}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14714}14714           \mbox{\hyperlink{classoomph_1_1ErrorEstimator}{ErrorEstimator}}* error\_estimator\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14715}14715             mmesh\_pt-\/>spatial\_error\_estimator\_pt();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14716}14716 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14717}14717 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14718}14718           \textcolor{keywordflow}{if} (error\_estimator\_pt == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14719}14719           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14720}14720             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Error estimator hasn't been set yet"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14721}14721                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14722}14722                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14723}14723           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14724}14724 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14725}14725           \textcolor{comment}{// If we can adapt the mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14726}14726           \textcolor{keywordflow}{if} (mmesh\_pt-\/>is\_adaptation\_enabled())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14727}14727           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14728}14728             \textcolor{comment}{// Get error for all elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14729}14729             elemental\_error[imesh].resize(mmesh\_pt-\/>nelement());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14730}14730             \textcolor{keywordflow}{if} (mmesh\_pt-\/>doc\_info\_pt() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14731}14731             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14732}14732               error\_estimator\_pt-\/>\mbox{\hyperlink{classoomph_1_1ErrorEstimator_a3b12c5d2579360a08b6b6298cea8b142}{get\_element\_errors}}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{Problem::mesh\_pt}}(imesh),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14733}14733                                                      elemental\_error[imesh]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14734}14734             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14735}14735             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14736}14736             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14737}14737               error\_estimator\_pt-\/>\mbox{\hyperlink{classoomph_1_1ErrorEstimator_a3b12c5d2579360a08b6b6298cea8b142}{get\_element\_errors}}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{Problem::mesh\_pt}}(imesh),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14738}14738                                                      elemental\_error[imesh],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14739}14739                                                      *mmesh\_pt-\/>doc\_info\_pt());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14740}14740             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14741}14741 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14742}14742             \textcolor{comment}{// Store max./min error}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14743}14743             mmesh\_pt-\/>max\_error() =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14744}14744               std::fabs(*std::max\_element(elemental\_error[imesh].begin(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14745}14745                                           elemental\_error[imesh].end(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14746}14746                                           \mbox{\hyperlink{classoomph_1_1AbsCmp}{AbsCmp<double>}}()));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14747}14747 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14748}14748             mmesh\_pt-\/>min\_error() =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14749}14749               std::fabs(*std::min\_element(elemental\_error[imesh].begin(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14750}14750                                           elemental\_error[imesh].end(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14751}14751                                           \mbox{\hyperlink{classoomph_1_1AbsCmp}{AbsCmp<double>}}()));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14752}14752 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14753}14753             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)n Max/min error: "{}} << mmesh\_pt-\/>max\_error() << \textcolor{stringliteral}{"{} "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14754}14754                        << mmesh\_pt-\/>min\_error() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14755}14755           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14756}14756           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14757}14757           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14758}14758             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh adaptation is disabled."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14759}14759                        << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14760}14760           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14761}14761         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14762}14762         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14763}14763         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14764}14764           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be adapted."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14765}14765         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14766}14766 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14767}14767       \} \textcolor{comment}{// End of loop over submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14768}14768     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14769}14769   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14770}14770 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14771}14771   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14772}14772 \textcolor{comment}{  /// Get max and min error for all elements in submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14773}14773 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14774}\mbox{\hyperlink{classoomph_1_1Problem_af2a77519885ccb13e4644c89b19c37a7}{14774}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_af2a9dfdb7b4f95bb941d48411f955f55}{Problem::doc\_errors}}(\mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}}\& doc\_info)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14775}14775   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14776}14776     \textcolor{comment}{// Get the bifurcation type}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14777}14777     \textcolor{keywordtype}{int} bifurcation\_type = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_aefc325e2e116c389a24c9871e41bdb55}{Assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a22c5f240674e4f6cee12006790c11dae}{bifurcation\_type}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14778}14778     \textcolor{comment}{// If we are tracking a bifurcation then call the bifurcation adapt function}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14779}14779     \textcolor{keywordflow}{if} (bifurcation\_type != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14780}14780     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14781}14781       this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ad36cedd508f3cfb352ddd44c18914d41}{bifurcation\_adapt\_doc\_errors}}(bifurcation\_type);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14782}14782       \textcolor{comment}{// Return immediately}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14783}14783       \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14784}14784     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14785}14785 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14786}14786     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14787}14787     \textcolor{keywordtype}{unsigned} Nmesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14788}14788 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14789}14789     \textcolor{comment}{// Single mesh:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14790}14790     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14791}14791     \textcolor{keywordflow}{if} (Nmesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14792}14792     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14793}14793       \textcolor{comment}{// Is the single mesh refineable?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14794}14794       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14795}14795             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14796}14796       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14797}14797         \textcolor{comment}{// Get pointer to error estimator}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14798}14798         \mbox{\hyperlink{classoomph_1_1ErrorEstimator}{ErrorEstimator}}* error\_estimator\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14799}14799           mmesh\_pt-\/>spatial\_error\_estimator\_pt();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14800}14800 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14801}14801 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14802}14802         \textcolor{keywordflow}{if} (error\_estimator\_pt == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14803}14803         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14804}14804           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Error estimator hasn't been set yet"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14805}14805                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14806}14806                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14807}14807         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14808}14808 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14809}14809 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14810}14810         \textcolor{comment}{// Get error for all elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14811}14811         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} elemental\_error(mmesh\_pt-\/>nelement());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14812}14812         \textcolor{keywordflow}{if} (!doc\_info.\mbox{\hyperlink{classoomph_1_1DocInfo_a2ce90cf54f24b4ab523c624031fbb76b}{is\_doc\_enabled}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14813}14813         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14814}14814           error\_estimator\_pt-\/>\mbox{\hyperlink{classoomph_1_1ErrorEstimator_a3b12c5d2579360a08b6b6298cea8b142}{get\_element\_errors}}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0), elemental\_error);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14815}14815         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14816}14816         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14817}14817         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14818}14818           error\_estimator\_pt-\/>\mbox{\hyperlink{classoomph_1_1ErrorEstimator_a3b12c5d2579360a08b6b6298cea8b142}{get\_element\_errors}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14819}14819             \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0), elemental\_error, doc\_info);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14820}14820         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14821}14821 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14822}14822         \textcolor{comment}{// Store max./min actual error}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14823}14823         mmesh\_pt-\/>max\_error() = std::fabs(*std::max\_element(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14824}14824           elemental\_error.begin(), elemental\_error.end(), \mbox{\hyperlink{classoomph_1_1AbsCmp}{AbsCmp<double>}}()));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14825}14825 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14826}14826         mmesh\_pt-\/>min\_error() = std::fabs(*std::min\_element(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14827}14827           elemental\_error.begin(), elemental\_error.end(), \mbox{\hyperlink{classoomph_1_1AbsCmp}{AbsCmp<double>}}()));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14828}14828 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14829}14829         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)n Max/min error: "{}} << mmesh\_pt-\/>max\_error() << \textcolor{stringliteral}{"{} "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14830}14830                    << mmesh\_pt-\/>min\_error() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14831}14831       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14832}14832     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14833}14833 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14834}14834     \textcolor{comment}{// Multiple submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14835}14835     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14836}14836     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14837}14837     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14838}14838       \textcolor{comment}{// Loop over submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14839}14839       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imesh = 0; imesh < Nmesh; imesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14840}14840       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14841}14841         \textcolor{comment}{// Is the single mesh refineable?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14842}14842         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14843}14843               \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14844}14844         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14845}14845           \textcolor{comment}{// Get pointer to error estimator}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14846}14846           \mbox{\hyperlink{classoomph_1_1ErrorEstimator}{ErrorEstimator}}* error\_estimator\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14847}14847             mmesh\_pt-\/>spatial\_error\_estimator\_pt();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14848}14848 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14849}14849 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14850}14850           \textcolor{keywordflow}{if} (error\_estimator\_pt == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14851}14851           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14852}14852             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Error estimator hasn't been set yet"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14853}14853                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14854}14854                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14855}14855           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14856}14856 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14857}14857 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14858}14858           \textcolor{comment}{// Get error for all elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14859}14859           \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} elemental\_error(mmesh\_pt-\/>nelement());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14860}14860           \textcolor{keywordflow}{if} (mmesh\_pt-\/>doc\_info\_pt() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14861}14861           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14862}14862             error\_estimator\_pt-\/>\mbox{\hyperlink{classoomph_1_1ErrorEstimator_a3b12c5d2579360a08b6b6298cea8b142}{get\_element\_errors}}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14863}14863                                                    elemental\_error);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14864}14864           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14865}14865           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14866}14866           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14867}14867             error\_estimator\_pt-\/>\mbox{\hyperlink{classoomph_1_1ErrorEstimator_a3b12c5d2579360a08b6b6298cea8b142}{get\_element\_errors}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14868}14868               \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh), elemental\_error, *mmesh\_pt-\/>doc\_info\_pt());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14869}14869           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14870}14870 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14871}14871           \textcolor{comment}{// Store max./min error if the mesh has any elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14872}14872           \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh)-\/>nelement() > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14873}14873           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14874}14874             mmesh\_pt-\/>max\_error() =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14875}14875               std::fabs(*std::max\_element(elemental\_error.begin(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14876}14876                                           elemental\_error.end(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14877}14877                                           \mbox{\hyperlink{classoomph_1_1AbsCmp}{AbsCmp<double>}}()));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14878}14878 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14879}14879             mmesh\_pt-\/>min\_error() =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14880}14880               std::fabs(*std::min\_element(elemental\_error.begin(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14881}14881                                           elemental\_error.end(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14882}14882                                           \mbox{\hyperlink{classoomph_1_1AbsCmp}{AbsCmp<double>}}()));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14883}14883           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14884}14884 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14885}14885           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)n Max/min error: "{}} << mmesh\_pt-\/>max\_error() << \textcolor{stringliteral}{"{} "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14886}14886                      << mmesh\_pt-\/>min\_error() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14887}14887         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14888}14888 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14889}14889       \} \textcolor{comment}{// End of loop over submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14890}14890     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14891}14891   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14892}14892 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14893}14893   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14894}14894 \textcolor{comment}{  /// Refine (one and only!) mesh by splitting the elements identified}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14895}14895 \textcolor{comment}{  /// by their numbers relative to the problems' only mesh, then rebuild}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14896}14896 \textcolor{comment}{  /// the problem.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14897}14897 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14898}\mbox{\hyperlink{classoomph_1_1Problem_a88bfce034f5b054e78a1c1a15d196aeb}{14898}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a88bfce034f5b054e78a1c1a15d196aeb}{Problem::refine\_selected\_elements}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14899}14899     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& elements\_to\_be\_refined)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14900}14900   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14901}14901     \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14902}14902 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14903}14903     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14904}14904     \textcolor{keywordtype}{unsigned} Nmesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14905}14905 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14906}14906     \textcolor{comment}{// Single mesh:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14907}14907     \textcolor{keywordflow}{if} (Nmesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14908}14908     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14909}14909       \textcolor{comment}{// Refine single mesh if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14910}14910       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14911}14911             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14912}14912       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14913}14913         mmesh\_pt-\/>refine\_selected\_elements(elements\_to\_be\_refined);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14914}14914       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14915}14915       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14916}14916       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14917}14917         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be refined "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14918}14918       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14919}14919     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14920}14920     \textcolor{comment}{// Multiple submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14921}14921     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14922}14922     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14923}14923       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14924}14924       error\_message << \textcolor{stringliteral}{"{}Problem::refine\_selected\_elements(...) only works for\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14925}14925                     << \textcolor{stringliteral}{"{}multiple-\/mesh problems if you specify the mesh\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14926}14926                     << \textcolor{stringliteral}{"{}number in the function argument before the Vector,\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14927}14927                     << \textcolor{stringliteral}{"{}or a Vector of Vectors for each submesh.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14928}14928                     << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14929}14929       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14930}14930         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14931}14931     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14932}14932 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14933}14933     \textcolor{comment}{// Any actions after the adapatation phase}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14934}14934     \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14935}14935 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14936}14936     \textcolor{comment}{// Attach the boundary conditions to the mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14937}14937     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of equations: "{}} << \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14938}14938   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14939}14939 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14940}14940   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14941}14941 \textcolor{comment}{  /// Refine (one and only!) mesh by splitting the elements identified}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14942}14942 \textcolor{comment}{  /// by their pointers, then rebuild the problem.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14943}14943 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14944}\mbox{\hyperlink{classoomph_1_1Problem_abd2274dbc96e0ae3caf20573152d19e7}{14944}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a88bfce034f5b054e78a1c1a15d196aeb}{Problem::refine\_selected\_elements}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14945}14945     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<RefineableElement*>}}\& elements\_to\_be\_refined\_pt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14946}14946   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14947}14947     \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14948}14948 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14949}14949     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14950}14950     \textcolor{keywordtype}{unsigned} Nmesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14951}14951 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14952}14952     \textcolor{comment}{// Single mesh:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14953}14953     \textcolor{keywordflow}{if} (Nmesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14954}14954     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14955}14955       \textcolor{comment}{// Refine single mesh if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14956}14956       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14957}14957             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14958}14958       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14959}14959         mmesh\_pt-\/>refine\_selected\_elements(elements\_to\_be\_refined\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14960}14960       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14961}14961       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14962}14962       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14963}14963         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be refined "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14964}14964       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14965}14965     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14966}14966     \textcolor{comment}{// Multiple submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14967}14967     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14968}14968     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14969}14969       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14970}14970       error\_message << \textcolor{stringliteral}{"{}Problem::refine\_selected\_elements(...) only works for\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14971}14971                     << \textcolor{stringliteral}{"{}multiple-\/mesh problems if you specify the mesh\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14972}14972                     << \textcolor{stringliteral}{"{}number in the function argument before the Vector,\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14973}14973                     << \textcolor{stringliteral}{"{}or a Vector of Vectors for each submesh.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14974}14974                     << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14975}14975       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14976}14976         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14977}14977     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14978}14978 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14979}14979     \textcolor{comment}{// Any actions after the adapatation phase}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14980}14980     \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14981}14981 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14982}14982     \textcolor{comment}{// Do equation numbering}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14983}14983     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of equations: "{}} << \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14984}14984   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14985}14985 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14986}14986   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14987}14987 \textcolor{comment}{  /// Refine specified submesh by splitting the elements identified}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14988}14988 \textcolor{comment}{  /// by their numbers relative to the specified mesh, then rebuild the problem.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14989}14989 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14990}\mbox{\hyperlink{classoomph_1_1Problem_af2bd42a9612a31041b9d607340c6d68c}{14990}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a88bfce034f5b054e78a1c1a15d196aeb}{Problem::refine\_selected\_elements}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14991}14991     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& i\_mesh, \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& elements\_to\_be\_refined)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14992}14992   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14993}14993     \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14994}14994 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14995}14995     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14996}14996     \textcolor{keywordtype}{unsigned} n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14997}14997 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14998}14998     \textcolor{keywordflow}{if} (i\_mesh >= n\_mesh)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l14999}14999     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15000}15000       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15001}15001       error\_message << \textcolor{stringliteral}{"{}Problem only has "{}} << n\_mesh}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15002}15002                     << \textcolor{stringliteral}{"{} submeshes. Cannot refine submesh "{}} << i\_mesh}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15003}15003                     << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15004}15004       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15005}15005         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15006}15006     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15007}15007 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15008}15008     \textcolor{comment}{// Refine single mesh if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15009}15009     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15010}15010           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15011}15011     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15012}15012       mmesh\_pt-\/>refine\_selected\_elements(elements\_to\_be\_refined);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15013}15013     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15014}15014     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15015}15015     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15016}15016       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be refined "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15017}15017     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15018}15018 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15019}15019     \textcolor{keywordflow}{if} (n\_mesh > 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15020}15020     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15021}15021       \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15022}15022       \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15023}15023     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15024}15024 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15025}15025     \textcolor{comment}{// Any actions after the adapatation phase}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15026}15026     \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15027}15027 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15028}15028     \textcolor{comment}{// Do equation numbering}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15029}15029     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of equations: "{}} << \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15030}15030   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15031}15031 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15032}15032 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15033}15033   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15034}15034 \textcolor{comment}{  /// Refine specified submesh by splitting the elements identified}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15035}15035 \textcolor{comment}{  /// by their pointers, then rebuild the problem.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15036}15036 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15037}\mbox{\hyperlink{classoomph_1_1Problem_a77b480e2299c8526b27b09fa45ac20a9}{15037}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a88bfce034f5b054e78a1c1a15d196aeb}{Problem::refine\_selected\_elements}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15038}15038     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& i\_mesh,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15039}15039     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<RefineableElement*>}}\& elements\_to\_be\_refined\_pt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15040}15040   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15041}15041     \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15042}15042 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15043}15043     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15044}15044     \textcolor{keywordtype}{unsigned} n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15045}15045 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15046}15046     \textcolor{keywordflow}{if} (i\_mesh >= n\_mesh)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15047}15047     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15048}15048       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15049}15049       error\_message << \textcolor{stringliteral}{"{}Problem only has "{}} << n\_mesh}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15050}15050                     << \textcolor{stringliteral}{"{} submeshes. Cannot refine submesh "{}} << i\_mesh}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15051}15051                     << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15052}15052       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15053}15053         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15054}15054     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15055}15055 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15056}15056     \textcolor{comment}{// Refine single mesh if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15057}15057     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15058}15058           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15059}15059     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15060}15060       mmesh\_pt-\/>refine\_selected\_elements(elements\_to\_be\_refined\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15061}15061     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15062}15062     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15063}15063     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15064}15064       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be refined "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15065}15065     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15066}15066 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15067}15067     \textcolor{keywordflow}{if} (n\_mesh > 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15068}15068     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15069}15069       \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15070}15070       \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15071}15071     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15072}15072 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15073}15073     \textcolor{comment}{// Any actions after the adapatation phase}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15074}15074     \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15075}15075 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15076}15076     \textcolor{comment}{// Do equation numbering}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15077}15077     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of equations: "{}} << \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15078}15078   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15079}15079 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15080}15080   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15081}15081 \textcolor{comment}{  /// Refine all submeshes by splitting the elements identified by their}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15082}15082 \textcolor{comment}{  /// numbers relative to each submesh in a Vector of Vectors, then}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15083}15083 \textcolor{comment}{  /// rebuild the problem.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15084}15084 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15085}\mbox{\hyperlink{classoomph_1_1Problem_a2f4ca0c03520c5c827f49ede74321684}{15085}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a88bfce034f5b054e78a1c1a15d196aeb}{Problem::refine\_selected\_elements}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15086}15086     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}>\& elements\_to\_be\_refined)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15087}15087   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15088}15088     \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15089}15089 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15090}15090     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15091}15091     \textcolor{keywordtype}{unsigned} n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15092}15092 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15093}15093     \textcolor{comment}{// Refine all submeshes if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15094}15094     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15095}15095     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15096}15096       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15097}15097             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15098}15098       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15099}15099         mmesh\_pt-\/>refine\_selected\_elements(elements\_to\_be\_refined[i\_mesh]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15100}15100       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15101}15101       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15102}15102       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15103}15103         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be refined "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15104}15104       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15105}15105     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15106}15106 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15107}15107     \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15108}15108     \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15109}15109 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15110}15110     \textcolor{comment}{// Any actions after the adapatation phase}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15111}15111     \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15112}15112 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15113}15113     \textcolor{comment}{// Do equation numbering}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15114}15114     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of equations: "{}} << \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15115}15115   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15116}15116 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15117}15117   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15118}15118 \textcolor{comment}{  /// Refine all submeshes by splitting the elements identified by their}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15119}15119 \textcolor{comment}{  /// pointers within each submesh in a Vector of Vectors, then}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15120}15120 \textcolor{comment}{  /// rebuild the problem.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15121}15121 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15122}\mbox{\hyperlink{classoomph_1_1Problem_ac82771428414dab6ddcbd115481173a0}{15122}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a88bfce034f5b054e78a1c1a15d196aeb}{Problem::refine\_selected\_elements}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15123}15123     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector<RefineableElement*>}}>\& elements\_to\_be\_refined\_pt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15124}15124   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15125}15125     \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15126}15126 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15127}15127     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15128}15128     \textcolor{keywordtype}{unsigned} n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15129}15129 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15130}15130     \textcolor{comment}{// Refine all submeshes if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15131}15131     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15132}15132     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15133}15133       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15134}15134             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15135}15135       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15136}15136         mmesh\_pt-\/>refine\_selected\_elements(elements\_to\_be\_refined\_pt[i\_mesh]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15137}15137       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15138}15138       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15139}15139       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15140}15140         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be refined "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15141}15141       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15142}15142     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15143}15143 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15144}15144     \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15145}15145     \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15146}15146 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15147}15147     \textcolor{comment}{// Any actions after the adapatation phase}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15148}15148     \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15149}15149 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15150}15150     \textcolor{comment}{// Do equation numbering}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15151}15151     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of equations: "{}} << \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15152}15152   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15153}15153 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15154}15154   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15155}15155 \textcolor{comment}{  /// p-\/refine (one and only!) mesh by refining the elements identified}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15156}15156 \textcolor{comment}{  /// by their numbers relative to the problems' only mesh, then rebuild}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15157}15157 \textcolor{comment}{  /// the problem.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15158}15158 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15159}\mbox{\hyperlink{classoomph_1_1Problem_a2042cdd88af58eedc66bfaf29b370ff1}{15159}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a2042cdd88af58eedc66bfaf29b370ff1}{Problem::p\_refine\_selected\_elements}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15160}15160     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& elements\_to\_be\_refined)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15161}15161   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15162}15162     \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15163}15163 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15164}15164     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15165}15165     \textcolor{keywordtype}{unsigned} Nmesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15166}15166 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15167}15167     \textcolor{comment}{// Single mesh:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15168}15168     \textcolor{keywordflow}{if} (Nmesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15169}15169     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15170}15170       \textcolor{comment}{// Refine single mesh if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15171}15171       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15172}15172             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15173}15173       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15174}15174         mmesh\_pt-\/>p\_refine\_selected\_elements(elements\_to\_be\_refined);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15175}15175       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15176}15176       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15177}15177       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15178}15178         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be refined "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15179}15179       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15180}15180     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15181}15181     \textcolor{comment}{// Multiple submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15182}15182     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15183}15183     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15184}15184       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15185}15185       error\_message}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15186}15186         << \textcolor{stringliteral}{"{}Problem::p\_refine\_selected\_elements(...) only works for\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15187}15187         << \textcolor{stringliteral}{"{}multiple-\/mesh problems if you specify the mesh\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15188}15188         << \textcolor{stringliteral}{"{}number in the function argument before the Vector,\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15189}15189         << \textcolor{stringliteral}{"{}or a Vector of Vectors for each submesh.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15190}15190         << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15191}15191       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15192}15192         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15193}15193     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15194}15194 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15195}15195     \textcolor{comment}{// Any actions after the adapatation phase}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15196}15196     \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15197}15197 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15198}15198     \textcolor{comment}{// Attach the boundary conditions to the mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15199}15199     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of equations: "{}} << \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15200}15200   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15201}15201 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15202}15202   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15203}15203 \textcolor{comment}{  /// p-\/refine (one and only!) mesh by refining the elements identified}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15204}15204 \textcolor{comment}{  /// by their pointers, then rebuild the problem.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15205}15205 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15206}\mbox{\hyperlink{classoomph_1_1Problem_afd17da2aa90d68c4fb5120c90b2435d9}{15206}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a2042cdd88af58eedc66bfaf29b370ff1}{Problem::p\_refine\_selected\_elements}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15207}15207     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<PRefineableElement*>}}\& elements\_to\_be\_refined\_pt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15208}15208   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15209}15209     \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15210}15210 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15211}15211     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15212}15212     \textcolor{keywordtype}{unsigned} Nmesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15213}15213 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15214}15214     \textcolor{comment}{// Single mesh:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15215}15215     \textcolor{keywordflow}{if} (Nmesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15216}15216     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15217}15217       \textcolor{comment}{// Refine single mesh if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15218}15218       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15219}15219             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15220}15220       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15221}15221         mmesh\_pt-\/>p\_refine\_selected\_elements(elements\_to\_be\_refined\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15222}15222       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15223}15223       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15224}15224       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15225}15225         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be refined "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15226}15226       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15227}15227     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15228}15228     \textcolor{comment}{// Multiple submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15229}15229     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15230}15230     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15231}15231       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15232}15232       error\_message}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15233}15233         << \textcolor{stringliteral}{"{}Problem::p\_refine\_selected\_elements(...) only works for\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15234}15234         << \textcolor{stringliteral}{"{}multiple-\/mesh problems if you specify the mesh\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15235}15235         << \textcolor{stringliteral}{"{}number in the function argument before the Vector,\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15236}15236         << \textcolor{stringliteral}{"{}or a Vector of Vectors for each submesh.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15237}15237         << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15238}15238       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15239}15239         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15240}15240     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15241}15241 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15242}15242     \textcolor{comment}{// Any actions after the adapatation phase}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15243}15243     \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15244}15244 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15245}15245     \textcolor{comment}{// Do equation numbering}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15246}15246     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of equations: "{}} << \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15247}15247   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15248}15248 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15249}15249   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15250}15250 \textcolor{comment}{  /// p-\/refine specified submesh by refining the elements identified}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15251}15251 \textcolor{comment}{  /// by their numbers relative to the specified mesh, then rebuild the problem.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15252}15252 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15253}\mbox{\hyperlink{classoomph_1_1Problem_a86f7b013945049548f86377e489e23f1}{15253}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a2042cdd88af58eedc66bfaf29b370ff1}{Problem::p\_refine\_selected\_elements}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15254}15254     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& i\_mesh, \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& elements\_to\_be\_refined)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15255}15255   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15256}15256     \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15257}15257       \textcolor{stringliteral}{"{}p-\/refinement for multiple submeshes has not yet been tested."{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15258}15258       \textcolor{stringliteral}{"{}Problem::p\_refine\_selected\_elements()"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15259}15259       OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15260}15260 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15261}15261     \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15262}15262 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15263}15263     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15264}15264     \textcolor{keywordtype}{unsigned} n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15265}15265 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15266}15266     \textcolor{keywordflow}{if} (i\_mesh >= n\_mesh)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15267}15267     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15268}15268       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15269}15269       error\_message << \textcolor{stringliteral}{"{}Problem only has "{}} << n\_mesh}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15270}15270                     << \textcolor{stringliteral}{"{} submeshes. Cannot p-\/refine submesh "{}} << i\_mesh}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15271}15271                     << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15272}15272       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15273}15273         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15274}15274     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15275}15275 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15276}15276     \textcolor{comment}{// Refine single mesh if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15277}15277     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15278}15278           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15279}15279     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15280}15280       mmesh\_pt-\/>p\_refine\_selected\_elements(elements\_to\_be\_refined);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15281}15281     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15282}15282     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15283}15283     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15284}15284       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be refined "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15285}15285     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15286}15286 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15287}15287     \textcolor{keywordflow}{if} (n\_mesh > 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15288}15288     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15289}15289       \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15290}15290       \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15291}15291     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15292}15292 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15293}15293     \textcolor{comment}{// Any actions after the adapatation phase}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15294}15294     \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15295}15295 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15296}15296     \textcolor{comment}{// Do equation numbering}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15297}15297     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of equations: "{}} << \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15298}15298   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15299}15299 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15300}15300 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15301}15301   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15302}15302 \textcolor{comment}{  /// p-\/refine specified submesh by refining the elements identified}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15303}15303 \textcolor{comment}{  /// by their pointers, then rebuild the problem.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15304}15304 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15305}\mbox{\hyperlink{classoomph_1_1Problem_a044b3cb5ffc2953c1990bd602567b99a}{15305}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a2042cdd88af58eedc66bfaf29b370ff1}{Problem::p\_refine\_selected\_elements}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15306}15306     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& i\_mesh,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15307}15307     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<PRefineableElement*>}}\& elements\_to\_be\_refined\_pt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15308}15308   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15309}15309     \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15310}15310       \textcolor{stringliteral}{"{}p-\/refinement for multiple submeshes has not yet been tested."{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15311}15311       \textcolor{stringliteral}{"{}Problem::p\_refine\_selected\_elements()"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15312}15312       OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15313}15313 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15314}15314     \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15315}15315 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15316}15316     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15317}15317     \textcolor{keywordtype}{unsigned} n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15318}15318 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15319}15319     \textcolor{keywordflow}{if} (i\_mesh >= n\_mesh)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15320}15320     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15321}15321       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15322}15322       error\_message << \textcolor{stringliteral}{"{}Problem only has "{}} << n\_mesh}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15323}15323                     << \textcolor{stringliteral}{"{} submeshes. Cannot p-\/refine submesh "{}} << i\_mesh}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15324}15324                     << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15325}15325       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15326}15326         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15327}15327     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15328}15328 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15329}15329     \textcolor{comment}{// Refine single mesh if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15330}15330     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15331}15331           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15332}15332     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15333}15333       mmesh\_pt-\/>p\_refine\_selected\_elements(elements\_to\_be\_refined\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15334}15334     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15335}15335     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15336}15336     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15337}15337       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be refined "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15338}15338     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15339}15339 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15340}15340     \textcolor{keywordflow}{if} (n\_mesh > 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15341}15341     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15342}15342       \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15343}15343       \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15344}15344     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15345}15345 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15346}15346     \textcolor{comment}{// Any actions after the adapatation phase}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15347}15347     \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15348}15348 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15349}15349     \textcolor{comment}{// Do equation numbering}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15350}15350     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of equations: "{}} << \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15351}15351   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15352}15352 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15353}15353   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15354}15354 \textcolor{comment}{  /// p-\/refine all submeshes by refining the elements identified by their}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15355}15355 \textcolor{comment}{  /// numbers relative to each submesh in a Vector of Vectors, then}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15356}15356 \textcolor{comment}{  /// rebuild the problem.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15357}15357 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15358}\mbox{\hyperlink{classoomph_1_1Problem_a4be6e85e73cd5c7f61763efe78f9fa9e}{15358}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a2042cdd88af58eedc66bfaf29b370ff1}{Problem::p\_refine\_selected\_elements}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15359}15359     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}>\& elements\_to\_be\_refined)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15360}15360   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15361}15361     \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15362}15362       \textcolor{stringliteral}{"{}p-\/refinement for multiple submeshes has not yet been tested."{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15363}15363       \textcolor{stringliteral}{"{}Problem::p\_refine\_selected\_elements()"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15364}15364       OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15365}15365 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15366}15366     \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15367}15367 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15368}15368     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15369}15369     \textcolor{keywordtype}{unsigned} n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15370}15370 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15371}15371     \textcolor{comment}{// Refine all submeshes if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15372}15372     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15373}15373     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15374}15374       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15375}15375             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15376}15376       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15377}15377         mmesh\_pt-\/>p\_refine\_selected\_elements(elements\_to\_be\_refined[i\_mesh]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15378}15378       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15379}15379       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15380}15380       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15381}15381         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be refined "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15382}15382       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15383}15383     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15384}15384 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15385}15385     \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15386}15386     \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15387}15387 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15388}15388     \textcolor{comment}{// Any actions after the adapatation phase}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15389}15389     \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15390}15390 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15391}15391     \textcolor{comment}{// Do equation numbering}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15392}15392     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of equations: "{}} << \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15393}15393   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15394}15394 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15395}15395   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15396}15396 \textcolor{comment}{  /// p-\/refine all submeshes by refining the elements identified by their}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15397}15397 \textcolor{comment}{  /// pointers within each submesh in a Vector of Vectors, then}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15398}15398 \textcolor{comment}{  /// rebuild the problem.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15399}15399 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15400}\mbox{\hyperlink{classoomph_1_1Problem_a1351a6db8cc6457ca8790e9b2acf4c8d}{15400}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a2042cdd88af58eedc66bfaf29b370ff1}{Problem::p\_refine\_selected\_elements}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15401}15401     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector<PRefineableElement*>}}>\& elements\_to\_be\_refined\_pt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15402}15402   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15403}15403     \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15404}15404       \textcolor{stringliteral}{"{}p-\/refinement for multiple submeshes has not yet been tested."{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15405}15405       \textcolor{stringliteral}{"{}Problem::p\_refine\_selected\_elements()"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15406}15406       OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15407}15407 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15408}15408     \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15409}15409 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15410}15410     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15411}15411     \textcolor{keywordtype}{unsigned} n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15412}15412 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15413}15413     \textcolor{comment}{// Refine all submeshes if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15414}15414     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15415}15415     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15416}15416       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15417}15417             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15418}15418       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15419}15419         mmesh\_pt-\/>p\_refine\_selected\_elements(elements\_to\_be\_refined\_pt[i\_mesh]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15420}15420       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15421}15421       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15422}15422       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15423}15423         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be refined "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15424}15424       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15425}15425     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15426}15426 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15427}15427     \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15428}15428     \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15429}15429 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15430}15430     \textcolor{comment}{// Any actions after the adapatation phase}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15431}15431     \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15432}15432 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15433}15433     \textcolor{comment}{// Do equation numbering}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15434}15434     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of equations: "{}} << \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15435}15435   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15436}15436 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15437}15437 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15438}15438   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15439}15439 \textcolor{comment}{  /// Helper function to do compund refinement of (all) refineable}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15440}15440 \textcolor{comment}{  /// (sub)mesh(es) uniformly as many times as specified in vector and}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15441}15441 \textcolor{comment}{  /// rebuild problem; doc refinement process. Set boolean argument}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15442}15442 \textcolor{comment}{  /// to true if you want to prune immediately after refining the meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15443}15443 \textcolor{comment}{  /// individually.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15444}15444 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15445}\mbox{\hyperlink{classoomph_1_1Problem_a0f86f3d5d65115dca81e10910e11ea19}{15445}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a0f86f3d5d65115dca81e10910e11ea19}{Problem::refine\_uniformly\_aux}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& nrefine\_for\_mesh,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15446}15446                                      \mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}}\& doc\_info,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15447}15447                                      \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& prune)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15448}15448   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15449}15449     \textcolor{keywordtype}{double} t\_start = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15450}15450     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15451}15451     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15452}15452       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15453}15453     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15454}15454 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15455}15455     \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15456}15456 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15457}15457     \textcolor{keywordtype}{double} t\_end = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15458}15458     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15459}15459     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15460}15460       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15461}15461       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15462}15462         << \textcolor{stringliteral}{"{}Time for actions before adapt in Problem::refine\_uniformly\_aux(): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15463}15463         << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15464}15464       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15465}15465     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15466}15466 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15467}15467     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15468}15468     \textcolor{keywordtype}{unsigned} n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15469}15469 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15470}15470     \textcolor{comment}{// Single mesh:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15471}15471     \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15472}15472     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15473}15473       \textcolor{comment}{// Refine single mesh uniformly if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15474}15474       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15475}15475             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15476}15476       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15477}15477         \textcolor{keywordtype}{unsigned} nref = nrefine\_for\_mesh[0];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15478}15478         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nref; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15479}15479         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15480}15480           mmesh\_pt-\/>refine\_uniformly(doc\_info);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15481}15481         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15482}15482       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15483}15483       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15484}15484       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15485}15485         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be refined uniformly "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15486}15486                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15487}15487       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15488}15488     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15489}15489     \textcolor{comment}{// Multiple submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15490}15490     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15491}15491     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15492}15492       \textcolor{comment}{// Loop over submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15493}15493       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imesh = 0; imesh < n\_mesh; imesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15494}15494       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15495}15495         \textcolor{comment}{// Refine i-\/th submesh uniformly if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15496}15496         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15497}15497               \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15498}15498         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15499}15499           \textcolor{keywordtype}{unsigned} nref = nrefine\_for\_mesh[imesh];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15500}15500           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nref; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15501}15501           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15502}15502             mmesh\_pt-\/>refine\_uniformly(doc\_info);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15503}15503           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15504}15504         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15505}15505         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15506}15506         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15507}15507           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Cannot refine mesh "{}} << imesh}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15508}15508                      << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15509}15509         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15510}15510       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15511}15511       \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15512}15512       \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15513}15513     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15514}15514 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15515}15515     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15516}15516     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15517}15517       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15518}15518       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for mesh-\/level mesh refinement in "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15519}15519                  << \textcolor{stringliteral}{"{}Problem::refine\_uniformly\_aux(): "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15520}15520                  << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15521}15521       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15522}15522     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15523}15523 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15524}15524     \textcolor{comment}{// Any actions after the adaptation phase}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15525}15525     \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15526}15526 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15527}15527 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15528}15528     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15529}15529     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15530}15530       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15531}15531       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15532}15532         << \textcolor{stringliteral}{"{}Time for actions after adapt  Problem::refine\_uniformly\_aux(): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15533}15533         << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15534}15534       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15535}15535     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15536}15536 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15537}15537 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15538}15538 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15539}15539 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15540}15540     \textcolor{comment}{// Prune it?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15541}15541     \textcolor{keywordflow}{if} (prune)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15542}15542     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15543}15543       \textcolor{comment}{// Note: This calls assign eqn numbers already...}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15544}15544       \mbox{\hyperlink{classoomph_1_1Problem_a2cee2eaaf1ac49020fc76b3b6adb9bba}{Bypass\_increase\_in\_dof\_check\_during\_pruning}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15545}15545       \mbox{\hyperlink{classoomph_1_1Problem_a8c5982a9323392e31a166e23a0c7f0a3}{prune\_halo\_elements\_and\_nodes}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15546}15546       \mbox{\hyperlink{classoomph_1_1Problem_a2cee2eaaf1ac49020fc76b3b6adb9bba}{Bypass\_increase\_in\_dof\_check\_during\_pruning}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15547}15547 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15548}15548       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15549}15549       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15550}15550         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15551}15551         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for Problem::prune\_halo\_elements\_and\_nodes() in "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15552}15552                    << \textcolor{stringliteral}{"{}Problem::refine\_uniformly\_aux(): "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15553}15553                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15554}15554       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15555}15555     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15556}15556     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15557}15557 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15558}15558     \textcolor{keywordflow}{if} (prune)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15559}15559     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15560}15560       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15561}15561       error\_message}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15562}15562         << \textcolor{stringliteral}{"{}Requested pruning in serial build. Ignoring the request.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15563}15563       \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15564}15564                       \textcolor{stringliteral}{"{}Problem::refine\_uniformly\_aux()"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15565}15565                       OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15566}15566     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15567}15567 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15568}15568     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15569}15569       \textcolor{comment}{// Do equation numbering}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15570}15570       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15571}15571         << \textcolor{stringliteral}{"{}Number of equations after Problem::refine\_uniformly\_aux(): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15572}15572         << \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15573}15573 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15574}15574       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15575}15575       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15576}15576         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15577}15577         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for Problem::assign\_eqn\_numbers() in "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15578}15578                    << \textcolor{stringliteral}{"{}Problem::refine\_uniformly\_aux(): "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15579}15579                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15580}15580       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15581}15581     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15582}15582   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15583}15583 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15584}15584 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15585}15585   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15586}15586 \textcolor{comment}{  /// Helper function to do compund p-\/refinement of (all) p-\/refineable}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15587}15587 \textcolor{comment}{  /// (sub)mesh(es) uniformly as many times as specified in vector and}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15588}15588 \textcolor{comment}{  /// rebuild problem; doc refinement process. Set boolean argument}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15589}15589 \textcolor{comment}{  /// to true if you want to prune immediately after refining the meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15590}15590 \textcolor{comment}{  /// individually.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15591}15591 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15592}\mbox{\hyperlink{classoomph_1_1Problem_a9e598cc12a894db00bfe62d87a0ff41b}{15592}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a9e598cc12a894db00bfe62d87a0ff41b}{Problem::p\_refine\_uniformly\_aux}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& nrefine\_for\_mesh,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15593}15593                                        \mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}}\& doc\_info,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15594}15594                                        \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& prune)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15595}15595   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15596}15596     \textcolor{keywordtype}{double} t\_start = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15597}15597     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15598}15598     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15599}15599       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15600}15600     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15601}15601 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15602}15602     \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15603}15603 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15604}15604     \textcolor{keywordtype}{double} t\_end = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15605}15605     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15606}15606     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15607}15607       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15608}15608       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for actions before adapt in "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15609}15609                     \textcolor{stringliteral}{"{}Problem::p\_refine\_uniformly\_aux(): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15610}15610                  << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15611}15611       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15612}15612     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15613}15613 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15614}15614     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15615}15615     \textcolor{keywordtype}{unsigned} n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15616}15616 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15617}15617     \textcolor{comment}{// Single mesh:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15618}15618     \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15619}15619     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15620}15620       \textcolor{comment}{// Refine single mesh uniformly if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15621}15621       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15622}15622             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15623}15623       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15624}15624         \textcolor{keywordtype}{unsigned} nref = nrefine\_for\_mesh[0];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15625}15625         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nref; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15626}15626         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15627}15627           mmesh\_pt-\/>p\_refine\_uniformly(doc\_info);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15628}15628         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15629}15629       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15630}15630       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15631}15631       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15632}15632         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be p-\/refined uniformly "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15633}15633                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15634}15634       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15635}15635     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15636}15636     \textcolor{comment}{// Multiple submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15637}15637     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15638}15638     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15639}15639       \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15640}15640         \textcolor{stringliteral}{"{}p-\/refinement for multiple submeshes has not yet been tested."{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15641}15641         \textcolor{stringliteral}{"{}Problem::p\_refine\_uniformly\_aux()"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15642}15642         OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15643}15643 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15644}15644       \textcolor{comment}{// Loop over submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15645}15645       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imesh = 0; imesh < n\_mesh; imesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15646}15646       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15647}15647         \textcolor{comment}{// Refine i-\/th submesh uniformly if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15648}15648         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15649}15649               \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15650}15650         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15651}15651           \textcolor{keywordtype}{unsigned} nref = nrefine\_for\_mesh[imesh];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15652}15652           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nref; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15653}15653           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15654}15654             mmesh\_pt-\/>p\_refine\_uniformly(doc\_info);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15655}15655           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15656}15656         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15657}15657         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15658}15658         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15659}15659           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Cannot p-\/refine mesh "{}} << imesh}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15660}15660                      << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15661}15661         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15662}15662       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15663}15663       \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15664}15664       \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15665}15665     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15666}15666 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15667}15667     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15668}15668     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15669}15669       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15670}15670       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for mesh-\/level mesh refinement in "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15671}15671                  << \textcolor{stringliteral}{"{}Problem::p\_refine\_uniformly\_aux(): "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15672}15672                  << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15673}15673       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15674}15674     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15675}15675 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15676}15676     \textcolor{comment}{// Any actions after the adaptation phase}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15677}15677     \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15678}15678 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15679}15679 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15680}15680     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15681}15681     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15682}15682       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15683}15683       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15684}15684         << \textcolor{stringliteral}{"{}Time for actions after adapt  Problem::p\_refine\_uniformly\_aux(): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15685}15685         << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15686}15686       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15687}15687     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15688}15688 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15689}15689 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15690}15690 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15691}15691 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15692}15692     \textcolor{comment}{// Prune it?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15693}15693     \textcolor{keywordflow}{if} (prune)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15694}15694     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15695}15695       \textcolor{comment}{// Note: This calls assign eqn numbers already...}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15696}15696       \mbox{\hyperlink{classoomph_1_1Problem_a2cee2eaaf1ac49020fc76b3b6adb9bba}{Bypass\_increase\_in\_dof\_check\_during\_pruning}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15697}15697       \mbox{\hyperlink{classoomph_1_1Problem_a8c5982a9323392e31a166e23a0c7f0a3}{prune\_halo\_elements\_and\_nodes}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15698}15698       \mbox{\hyperlink{classoomph_1_1Problem_a2cee2eaaf1ac49020fc76b3b6adb9bba}{Bypass\_increase\_in\_dof\_check\_during\_pruning}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15699}15699 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15700}15700       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15701}15701       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15702}15702         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15703}15703         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for Problem::prune\_halo\_elements\_and\_nodes() in "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15704}15704                    << \textcolor{stringliteral}{"{}Problem::p\_refine\_uniformly\_aux(): "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15705}15705                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15706}15706       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15707}15707     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15708}15708     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15709}15709 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15710}15710     \textcolor{keywordflow}{if} (prune)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15711}15711     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15712}15712       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15713}15713       error\_message}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15714}15714         << \textcolor{stringliteral}{"{}Requested pruning in serial build. Ignoring the request.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15715}15715       \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15716}15716                       \textcolor{stringliteral}{"{}Problem::p\_refine\_uniformly\_aux()"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15717}15717                       OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15718}15718     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15719}15719 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15720}15720     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15721}15721       \textcolor{comment}{// Do equation numbering}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15722}15722       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15723}15723         << \textcolor{stringliteral}{"{}Number of equations after Problem::p\_refine\_uniformly\_aux(): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15724}15724         << \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15725}15725 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15726}15726       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15727}15727       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15728}15728         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15729}15729         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for Problem::assign\_eqn\_numbers() in "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15730}15730                    << \textcolor{stringliteral}{"{}Problem::p\_refine\_uniformly\_aux(): "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15731}15731                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15732}15732       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15733}15733     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15734}15734   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15735}15735 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15736}15736   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15737}15737 \textcolor{comment}{  /// Refine submesh i\_mesh uniformly and rebuild problem;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15738}15738 \textcolor{comment}{  /// doc refinement process.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15739}15739 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15740}\mbox{\hyperlink{classoomph_1_1Problem_a74d1904dd72eaf71c015470a23caef5f}{15740}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ade208b7d7d8e866d5ba896f03edb1f9a}{Problem::refine\_uniformly}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& i\_mesh, \mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}}\& doc\_info)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15741}15741   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15742}15742     \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15743}15743 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15744}15744 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15745}15745     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15746}15746     \textcolor{keywordflow}{if} (i\_mesh >= \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15747}15747     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15748}15748       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15749}15749       error\_message << \textcolor{stringliteral}{"{}imesh "{}} << i\_mesh}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15750}15750                     << \textcolor{stringliteral}{"{} is greater than the number of sub meshes "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15751}15751                     << \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15752}15752 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15753}15753       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15754}15754         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15755}15755     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15756}15756 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15757}15757 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15758}15758     \textcolor{comment}{// Refine single mesh uniformly if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15759}15759     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15760}15760           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15761}15761     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15762}15762       mmesh\_pt-\/>refine\_uniformly(doc\_info);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15763}15763     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15764}15764     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15765}15765     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15766}15766       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be refined uniformly "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15767}15767                  << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15768}15768     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15769}15769 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15770}15770     \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15771}15771     \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15772}15772 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15773}15773     \textcolor{comment}{// Any actions after the adaptation phase}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15774}15774     \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15775}15775 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15776}15776     \textcolor{comment}{// Do equation numbering}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15777}15777     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of equations: "{}} << \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15778}15778   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15779}15779 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15780}15780   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15781}15781 \textcolor{comment}{  /// p-\/refine submesh i\_mesh uniformly and rebuild problem;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15782}15782 \textcolor{comment}{  /// doc refinement process.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15783}15783 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15784}\mbox{\hyperlink{classoomph_1_1Problem_a04fed27f341b9eb68b5fb3e4673f26f9}{15784}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ada439afd4d195644e53d6bdbc4b00587}{Problem::p\_refine\_uniformly}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& i\_mesh, \mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}}\& doc\_info)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15785}15785   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15786}15786     \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15787}15787 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15788}15788 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15789}15789     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15790}15790     \textcolor{keywordflow}{if} (i\_mesh >= \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15791}15791     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15792}15792       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15793}15793       error\_message << \textcolor{stringliteral}{"{}imesh "{}} << i\_mesh}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15794}15794                     << \textcolor{stringliteral}{"{} is greater than the number of sub meshes "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15795}15795                     << \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15796}15796 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15797}15797       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15798}15798         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15799}15799     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15800}15800 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15801}15801 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15802}15802     \textcolor{comment}{// Refine single mesh uniformly if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15803}15803     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15804}15804           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15805}15805     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15806}15806       mmesh\_pt-\/>p\_refine\_uniformly(doc\_info);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15807}15807     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15808}15808     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15809}15809     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15810}15810       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be refined uniformly "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15811}15811                  << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15812}15812     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15813}15813 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15814}15814     \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15815}15815     \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15816}15816 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15817}15817     \textcolor{comment}{// Any actions after the adaptation phase}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15818}15818     \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15819}15819 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15820}15820     \textcolor{comment}{// Do equation numbering}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15821}15821     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of equations: "{}} << \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15822}15822   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15823}15823 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15824}15824 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15825}15825   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15826}15826 \textcolor{comment}{  /// Unrefine (all) refineable (sub)mesh(es) uniformly and rebuild problem.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15827}15827 \textcolor{comment}{  /// Return 0 for success,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15828}15828 \textcolor{comment}{  /// 1 for failure (if unrefinement has reached the coarsest permitted}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15829}15829 \textcolor{comment}{  /// level)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15830}15830 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15831}\mbox{\hyperlink{classoomph_1_1Problem_a10dae99dec2f8202887f4e49e175f39c}{15831}}   \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1Problem_a10dae99dec2f8202887f4e49e175f39c}{Problem::unrefine\_uniformly}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15832}15832   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15833}15833     \textcolor{comment}{// Call actions\_before\_adapt()}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15834}15834     \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15835}15835 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15836}15836     \textcolor{comment}{// Has unrefinement been successful?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15837}15837     \textcolor{keywordtype}{unsigned} success\_flag = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15838}15838 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15839}15839     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15840}15840     \textcolor{keywordtype}{unsigned} n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15841}15841 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15842}15842     \textcolor{comment}{// Single mesh:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15843}15843     \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15844}15844     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15845}15845       \textcolor{comment}{// Unrefine single mesh uniformly if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15846}15846       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15847}15847             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15848}15848       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15849}15849         success\_flag += mmesh\_pt-\/>unrefine\_uniformly();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15850}15850       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15851}15851       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15852}15852       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15853}15853         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be unrefined uniformly "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15854}15854                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15855}15855       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15856}15856     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15857}15857     \textcolor{comment}{// Multiple submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15858}15858     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15859}15859     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15860}15860       \textcolor{comment}{// Loop over submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15861}15861       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imesh = 0; imesh < n\_mesh; imesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15862}15862       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15863}15863         \textcolor{comment}{// Unrefine i-\/th submesh uniformly if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15864}15864         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15865}15865               \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15866}15866         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15867}15867           success\_flag += mmesh\_pt-\/>unrefine\_uniformly();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15868}15868         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15869}15869         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15870}15870         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15871}15871           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Cannot unrefine mesh "{}} << imesh}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15872}15872                      << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15873}15873         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15874}15874       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15875}15875       \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15876}15876       \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15877}15877     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15878}15878 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15879}15879     \textcolor{comment}{// Any actions after the adaptation phase}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15880}15880     \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15881}15881 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15882}15882     \textcolor{comment}{// Do equation numbering}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15883}15883     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{} Number of equations: "{}} << \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15884}15884 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15885}15885     \textcolor{comment}{// Judge success}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15886}15886     \textcolor{keywordflow}{if} (success\_flag > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15887}15887     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15888}15888       \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15889}15889     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15890}15890     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15891}15891     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15892}15892       \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15893}15893     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15894}15894   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15895}15895 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15896}15896   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15897}15897 \textcolor{comment}{  /// Unrefine submesh i\_mesh uniformly and rebuild problem.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15898}15898 \textcolor{comment}{  /// Return 0 for success,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15899}15899 \textcolor{comment}{  /// 1 for failure (if unrefinement has reached the coarsest permitted}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15900}15900 \textcolor{comment}{  /// level)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15901}15901 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15902}\mbox{\hyperlink{classoomph_1_1Problem_aadd2996d4046e5a6176c92f4abc899d5}{15902}}   \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1Problem_a10dae99dec2f8202887f4e49e175f39c}{Problem::unrefine\_uniformly}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& i\_mesh)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15903}15903   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15904}15904     \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15905}15905 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15906}15906     \textcolor{comment}{// Has unrefinement been successful?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15907}15907     \textcolor{keywordtype}{unsigned} success\_flag = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15908}15908 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15909}15909 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15910}15910     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15911}15911     \textcolor{keywordflow}{if} (i\_mesh >= \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15912}15912     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15913}15913       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15914}15914       error\_message << \textcolor{stringliteral}{"{}imesh "{}} << i\_mesh}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15915}15915                     << \textcolor{stringliteral}{"{} is greater than the number of sub meshes "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15916}15916                     << \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15917}15917 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15918}15918       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15919}15919         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15920}15920     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15921}15921 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15922}15922 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15923}15923     \textcolor{comment}{// Unrefine single mesh uniformly if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15924}15924     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15925}15925           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15926}15926     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15927}15927       success\_flag += mmesh\_pt-\/>unrefine\_uniformly();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15928}15928     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15929}15929     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15930}15930     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15931}15931       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be unrefined uniformly "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15932}15932                  << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15933}15933     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15934}15934 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15935}15935     \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15936}15936     \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15937}15937 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15938}15938     \textcolor{comment}{// Any actions after the adaptation phase}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15939}15939     \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15940}15940 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15941}15941     \textcolor{comment}{// Do equation numbering}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15942}15942     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of equations: "{}} << \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15943}15943 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15944}15944     \textcolor{comment}{// Judge success}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15945}15945     \textcolor{keywordflow}{if} (success\_flag > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15946}15946     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15947}15947       \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15948}15948     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15949}15949     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15950}15950     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15951}15951       \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15952}15952     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15953}15953   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15954}15954 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15955}15955 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15956}15956   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15957}15957 \textcolor{comment}{  /// p-\/unrefine (all) p-\/refineable (sub)mesh(es) uniformly and rebuild problem;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15958}15958 \textcolor{comment}{  /// doc refinement process.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15959}15959 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15960}\mbox{\hyperlink{classoomph_1_1Problem_a21d8f0ff6813b09f35acbc7a76232397}{15960}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a21d8f0ff6813b09f35acbc7a76232397}{Problem::p\_unrefine\_uniformly}}(\mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}}\& doc\_info)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15961}15961   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15962}15962     \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15963}15963 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15964}15964     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15965}15965     \textcolor{keywordtype}{unsigned} n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15966}15966 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15967}15967     \textcolor{comment}{// Single mesh:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15968}15968     \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15969}15969     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15970}15970       \textcolor{comment}{// Unrefine single mesh uniformly if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15971}15971       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15972}15972             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(0)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15973}15973       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15974}15974         mmesh\_pt-\/>p\_unrefine\_uniformly(doc\_info);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15975}15975       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15976}15976       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15977}15977       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15978}15978         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be p-\/unrefined uniformly "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15979}15979                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15980}15980       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15981}15981     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15982}15982     \textcolor{comment}{// Multiple submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15983}15983     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15984}15984     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15985}15985       \textcolor{comment}{// Not tested:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15986}15986       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}This functionality has not yet been tested."{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15987}15987                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15988}15988                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15989}15989       \textcolor{comment}{// Loop over submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15990}15990       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imesh = 0; imesh < n\_mesh; imesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15991}15991       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15992}15992         \textcolor{comment}{// Unrefine i-\/th submesh uniformly if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15993}15993         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15994}15994               \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15995}15995         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15996}15996           mmesh\_pt-\/>p\_unrefine\_uniformly(doc\_info);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15997}15997         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15998}15998         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l15999}15999         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16000}16000           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Cannot p-\/unrefine mesh "{}} << imesh}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16001}16001                      << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16002}16002         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16003}16003       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16004}16004       \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16005}16005       \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16006}16006     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16007}16007 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16008}16008     \textcolor{comment}{// Any actions after the adaptation phase}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16009}16009     \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16010}16010 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16011}16011     \textcolor{comment}{// Do equation numbering}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16012}16012     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of equations: "{}} << \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16013}16013   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16014}16014 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16015}16015   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16016}16016 \textcolor{comment}{  /// p-\/unrefine submesh i\_mesh uniformly and rebuild problem;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16017}16017 \textcolor{comment}{  /// doc refinement process.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16018}16018 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16019}\mbox{\hyperlink{classoomph_1_1Problem_a706a2845212ece5535260cca6301653d}{16019}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a21d8f0ff6813b09f35acbc7a76232397}{Problem::p\_unrefine\_uniformly}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& i\_mesh, \mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}}\& doc\_info)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16020}16020   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16021}16021     \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16022}16022 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16023}16023 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16024}16024     \textcolor{comment}{// Number of submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16025}16025     \textcolor{keywordflow}{if} (i\_mesh >= \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16026}16026     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16027}16027       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16028}16028       error\_message << \textcolor{stringliteral}{"{}imesh "{}} << i\_mesh}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16029}16029                     << \textcolor{stringliteral}{"{} is greater than the number of sub meshes "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16030}16030                     << \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16031}16031 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16032}16032       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16033}16033         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16034}16034     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16035}16035 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16036}16036 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16037}16037     \textcolor{comment}{// Refine single mesh uniformly if possible}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16038}16038     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16039}16039           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16040}16040     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16041}16041       mmesh\_pt-\/>p\_unrefine\_uniformly(doc\_info);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16042}16042     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16043}16043     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16044}16044     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16045}16045       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Info/Warning: Mesh cannot be p-\/unrefined uniformly "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16046}16046                  << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16047}16047     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16048}16048 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16049}16049     \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16050}16050     \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16051}16051 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16052}16052     \textcolor{comment}{// Any actions after the adaptation phase}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16053}16053     \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16054}16054 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16055}16055     \textcolor{comment}{// Do equation numbering}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16056}16056     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of equations: "{}} << \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16057}16057   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16058}16058 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16059}16059 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16060}16060   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16061}16061 \textcolor{comment}{  /// Do one timestep, dt, forward  using Newton's method with specified}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16062}16062 \textcolor{comment}{  /// tolerance and linear solver specified via member data.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16063}16063 \textcolor{comment}{  /// Keep adapting on all meshes to criteria specified in}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16064}16064 \textcolor{comment}{  /// these meshes (up to max\_adapt adaptations are performed).}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16065}16065 \textcolor{comment}{  /// If first\_timestep==true, re-\/set initial conditions after mesh adaptation.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16066}16066 \textcolor{comment}{  /// Shifting of time can be suppressed by overwriting the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16067}16067 \textcolor{comment}{  /// default value of shift (true). [Shifting must be done}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16068}16068 \textcolor{comment}{  /// if first\_timestep==true because we're constantly re-\/assigning}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16069}16069 \textcolor{comment}{  /// the initial conditions; if first\_timestep==true and shift==false}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16070}16070 \textcolor{comment}{  /// shifting is performed anyway and a warning is issued.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16071}16071 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16072}\mbox{\hyperlink{classoomph_1_1Problem_af26bd71c24ba99c9391d6e932b68e5e8}{16072}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_aef22157aadc15a512cca93e4c423ff73}{Problem::unsteady\_newton\_solve}}(\textcolor{keyword}{const} \textcolor{keywordtype}{double}\& dt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16073}16073                                       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& max\_adapt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16074}16074                                       \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& first\_timestep,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16075}16075                                       \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& shift)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16076}16076   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16077}16077     \textcolor{comment}{// Do shifting or not?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16078}16078     \textcolor{keywordtype}{bool} shift\_it = shift;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16079}16079 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16080}16080     \textcolor{comment}{// Warning:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16081}16081     \textcolor{keywordflow}{if} (first\_timestep \&\& (!shift) \&\& (!\mbox{\hyperlink{classoomph_1_1Problem_a83df3b5fcc3ebbae951021c8e7f03ef7}{Default\_set\_initial\_condition\_called}}))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16082}16082     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16083}16083       shift\_it = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16084}16084       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16085}16085         << \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n===========================================================\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16086}16086       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}                  ********  WARNING *********** \(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16087}16087       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16088}16088         << \textcolor{stringliteral}{"{}===========================================================\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16089}16089       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Problem::unsteady\_newton\_solve() called with "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16090}16090                  << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16091}16091       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}first\_timestep: "{}} << first\_timestep << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16092}16092       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}shift: "{}} << shift << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16093}16093       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}This doesn't make sense (shifting does have to be done"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16094}16094                  << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16095}16095       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}since we're constantly re-\/assigning the initial conditions"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16096}16096                  << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16097}16097       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16098}16098         << \textcolor{stringliteral}{"{}\(\backslash\)n===========================================================\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16099}16099     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16100}16100 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16101}16101 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16102}16102     \textcolor{comment}{// Find the initial time}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16103}16103     \textcolor{keywordtype}{double} initial\_time = \mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_a43461269b799134f4b7a9aca3e79a7c8}{time}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16104}16104 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16105}16105     \textcolor{comment}{// Max number of solves}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16106}16106     \textcolor{keywordtype}{unsigned} max\_solve = max\_adapt + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16107}16107 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16108}16108     \textcolor{comment}{// Adaptation loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16109}16109     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16110}16110     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} isolve = 0; isolve < max\_solve; isolve++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16111}16111     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16112}16112       \textcolor{comment}{// Only adapt after the first solve has been done!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16113}16113       \textcolor{keywordflow}{if} (isolve > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16114}16114       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16115}16115         \textcolor{keywordtype}{unsigned} n\_refined;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16116}16116         \textcolor{keywordtype}{unsigned} n\_unrefined;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16117}16117 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16118}16118         \textcolor{comment}{// Adapt problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16119}16119         \mbox{\hyperlink{classoomph_1_1Problem_a0b9e09ddfa2411f14fc723c3207decd1}{adapt}}(n\_refined, n\_unrefined);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16120}16120 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16121}16121 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16122}16122         \textcolor{comment}{// Adaptation only converges if ALL the processes have no}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16123}16123         \textcolor{comment}{// refinement or unrefinement to perform}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16124}16124         \textcolor{keywordtype}{unsigned} total\_refined = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16125}16125         \textcolor{keywordtype}{unsigned} total\_unrefined = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16126}16126         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16127}16127         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16128}16128           MPI\_Allreduce(\&n\_refined,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16129}16129                         \&total\_refined,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16130}16130                         1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16131}16131                         MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16132}16132                         MPI\_SUM,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16133}16133                         this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16134}16134           n\_refined = total\_refined;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16135}16135           MPI\_Allreduce(\&n\_unrefined,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16136}16136                         \&total\_unrefined,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16137}16137                         1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16138}16138                         MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16139}16139                         MPI\_SUM,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16140}16140                         this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16141}16141           n\_unrefined = total\_unrefined;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16142}16142         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16143}16143 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16144}16144 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16145}16145         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}-\/-\/-\/> "{}} << n\_refined << \textcolor{stringliteral}{"{} elements were refined, and "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16146}16146                    << n\_unrefined << \textcolor{stringliteral}{"{} were unrefined, in total."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16147}16147 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16148}16148         \textcolor{comment}{// Check convergence of adaptation cycle}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16149}16149         \textcolor{keywordflow}{if} ((n\_refined == 0) \&\& (n\_unrefined == 0))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16150}16150         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16151}16151           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)n \(\backslash\)n Solution is fully converged in "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16152}16152                      << \textcolor{stringliteral}{"{}Problem::unsteady\_newton\_solver() \(\backslash\)n \(\backslash\)n "{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16153}16153           \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16154}16154         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16155}16155 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16156}16156         \textcolor{comment}{// Reset the time}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16157}16157         \mbox{\hyperlink{classoomph_1_1Problem_ae87f0d17b929d9b6097e19c2507c87f9}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_a43461269b799134f4b7a9aca3e79a7c8}{time}}() = initial\_time;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16158}16158 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16159}16159         \textcolor{comment}{// Reset the inital condition on refined meshes. Note that because we}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16160}16160         \textcolor{comment}{// have reset the global time to the initial time, the initial}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16161}16161         \textcolor{comment}{// conditions are reset at time t=0 rather than at time t=dt}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16162}16162         \textcolor{keywordflow}{if} (first\_timestep)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16163}16163         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16164}16164           \textcolor{comment}{// Reset default set\_initial\_condition has been called flag to false}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16165}16165           \mbox{\hyperlink{classoomph_1_1Problem_a83df3b5fcc3ebbae951021c8e7f03ef7}{Default\_set\_initial\_condition\_called}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16166}16166 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16167}16167           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Re-\/setting initial condition "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16168}16168           \mbox{\hyperlink{classoomph_1_1Problem_ad48be6d67071f7da5f6feb7c4fc918f0}{set\_initial\_condition}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16169}16169 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16170}16170           \textcolor{comment}{// If the default set\_initial\_condition function has been called,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16171}16171           \textcolor{comment}{// we must not shift the timevalues on the first timestep, as we}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16172}16172           \textcolor{comment}{// will NOT be constantly re-\/assigning the initial condition}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16173}16173           \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a83df3b5fcc3ebbae951021c8e7f03ef7}{Default\_set\_initial\_condition\_called}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16174}16174           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16175}16175             shift\_it = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16176}16176           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16177}16177         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16178}16178       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16179}16179 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16180}16180       \textcolor{comment}{// Now do the actual unsteady timestep}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16181}16181       \textcolor{comment}{// If it's the first time around the loop, or the first timestep}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16182}16182       \textcolor{comment}{// shift the timevalues, otherwise don't}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16183}16183       \textcolor{comment}{// Note: we need to shift if it's the first timestep because}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16184}16184       \textcolor{comment}{// we're constantly re-\/assigning the initial condition above!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16185}16185       \textcolor{comment}{// The only exception to this is if the default set\_initial\_condition}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16186}16186       \textcolor{comment}{// function has been called, in which case we must NOT shift!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16187}16187       \textcolor{keywordflow}{if} ((isolve == 0) || (first\_timestep))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16188}16188       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16189}16189         \mbox{\hyperlink{classoomph_1_1Problem_aef22157aadc15a512cca93e4c423ff73}{Problem::unsteady\_newton\_solve}}(dt, shift\_it);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16190}16190       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16191}16191       \textcolor{comment}{// Subsequent solve: Have shifted already -\/-\/ don't do it again.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16192}16192       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16193}16193       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16194}16194         shift\_it = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16195}16195         \mbox{\hyperlink{classoomph_1_1Problem_aef22157aadc15a512cca93e4c423ff73}{Problem::unsteady\_newton\_solve}}(dt, shift\_it);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16196}16196       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16197}16197 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16198}16198       \textcolor{keywordflow}{if} (isolve == max\_solve -\/ 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16199}16199       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16200}16200         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16201}16201           << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16202}16202           << \textcolor{stringliteral}{"{}-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16203}16203           << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16204}16204           << \textcolor{stringliteral}{"{}Reached max. number of adaptations in \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16205}16205           << \textcolor{stringliteral}{"{}Problem::unsteady\_newton\_solver().\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16206}16206           << \textcolor{stringliteral}{"{}-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16207}16207           << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16208}16208           << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16209}16209       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16210}16210 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16211}16211     \} \textcolor{comment}{// End of adaptation loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16212}16212   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16213}16213 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16214}16214 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16215}16215   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16216}16216 \textcolor{comment}{  /// Adaptive Newton solver.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16217}16217 \textcolor{comment}{  /// The linear solver takes a pointer to the problem (which defines}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16218}16218 \textcolor{comment}{  /// the Jacobian \(\backslash\)b J and the residual Vector \(\backslash\)b r) and returns}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16219}16219 \textcolor{comment}{  /// the solution \(\backslash\)b x of the system}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16220}16220 \textcolor{comment}{  /// \(\backslash\)f[ \{\(\backslash\)bf J\} \{\(\backslash\)bf x\} = -\/ \(\backslash\)bf\{r\} \(\backslash\)f].}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16221}16221 \textcolor{comment}{  /// Performs at most max\_adapt adaptations on all meshes.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16222}16222 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16223}\mbox{\hyperlink{classoomph_1_1Problem_a4a5a30c124a14f32368f9607b7c8bf34}{16223}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a62a989ae9a9169b9d905f844db59787f}{Problem::newton\_solve}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& max\_adapt)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16224}16224   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16225}16225     \textcolor{comment}{// Max number of solves}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16226}16226     \textcolor{keywordtype}{unsigned} max\_solve = max\_adapt + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16227}16227 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16228}16228     \textcolor{comment}{// Adaptation loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16229}16229     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16230}16230     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} isolve = 0; isolve < max\_solve; isolve++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16231}16231     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16232}16232       \textcolor{comment}{// Only adapt after the first solve has been done!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16233}16233       \textcolor{keywordflow}{if} (isolve > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16234}16234       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16235}16235         \textcolor{keywordtype}{unsigned} n\_refined;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16236}16236         \textcolor{keywordtype}{unsigned} n\_unrefined;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16237}16237 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16238}16238         \textcolor{comment}{// Adapt problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16239}16239         \mbox{\hyperlink{classoomph_1_1Problem_a0b9e09ddfa2411f14fc723c3207decd1}{adapt}}(n\_refined, n\_unrefined);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16240}16240 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16241}16241 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16242}16242         \textcolor{comment}{// Adaptation only converges if ALL the processes have no}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16243}16243         \textcolor{comment}{// refinement or unrefinement to perform}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16244}16244         \textcolor{keywordtype}{unsigned} total\_refined = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16245}16245         \textcolor{keywordtype}{unsigned} total\_unrefined = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16246}16246         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16247}16247         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16248}16248           MPI\_Allreduce(\&n\_refined,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16249}16249                         \&total\_refined,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16250}16250                         1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16251}16251                         MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16252}16252                         MPI\_SUM,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16253}16253                         this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16254}16254           n\_refined = total\_refined;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16255}16255           MPI\_Allreduce(\&n\_unrefined,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16256}16256                         \&total\_unrefined,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16257}16257                         1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16258}16258                         MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16259}16259                         MPI\_SUM,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16260}16260                         this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16261}16261           n\_unrefined = total\_unrefined;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16262}16262         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16263}16263 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16264}16264 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16265}16265         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}-\/-\/-\/> "{}} << n\_refined << \textcolor{stringliteral}{"{} elements were refined, and "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16266}16266                    << n\_unrefined << \textcolor{stringliteral}{"{} were unrefined"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16267}16267 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16268}16268                    << \textcolor{stringliteral}{"{}, in total (over all processors).\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16269}16269 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16270}16270                    << \textcolor{stringliteral}{"{}.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16271}16271 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16272}16272 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16273}16273 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16274}16274         \textcolor{comment}{// Check convergence of adaptation cycle}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16275}16275         \textcolor{keywordflow}{if} ((n\_refined == 0) \&\& (n\_unrefined == 0))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16276}16276         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16277}16277           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)n \(\backslash\)n Solution is fully converged in "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16278}16278                      << \textcolor{stringliteral}{"{}Problem::newton\_solver(). \(\backslash\)n \(\backslash\)n "{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16279}16279           \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16280}16280         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16281}16281       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16282}16282 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16283}16283 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16284}16284       \textcolor{comment}{// Do actual solve}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16285}16285       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16286}16286       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16287}16287         \textcolor{comment}{// Now update anything that needs updating}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16288}16288         \textcolor{comment}{// NOT NEEDED -\/-\/ IS CALLED IN newton\_solve BELOW! \#}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16289}16289         \textcolor{comment}{// actions\_before\_newton\_solve();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16290}16290 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16291}16291         \textcolor{keywordflow}{try}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16292}16292         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16293}16293           \textcolor{comment}{// Solve the non-\/linear problem for this timestep with Newton's method}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16294}16294           \mbox{\hyperlink{classoomph_1_1Problem_a62a989ae9a9169b9d905f844db59787f}{newton\_solve}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16295}16295         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16296}16296         \textcolor{comment}{// Catch any exceptions thrown in the Newton solver}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16297}16297         \textcolor{keywordflow}{catch} (\mbox{\hyperlink{classoomph_1_1NewtonSolverError}{NewtonSolverError}}\& error)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16298}16298         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16299}16299           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16300}16300                      << \textcolor{stringliteral}{"{}USER-\/DEFINED ERROR IN NEWTON SOLVER "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16301}16301           \textcolor{comment}{// Check to see whether we have reached Max\_iterations}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16302}16302           \textcolor{keywordflow}{if} (error.\mbox{\hyperlink{classoomph_1_1NewtonSolverError_aaae34aeb5b4128c87e03c89de1de60a8}{iterations}} == \mbox{\hyperlink{classoomph_1_1Problem_a52a58a98c3e2e7dbaefcfb1ee7830c35}{Max\_newton\_iterations}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16303}16303           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16304}16304             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}MAXIMUM NUMBER OF ITERATIONS ("{}} << error.\mbox{\hyperlink{classoomph_1_1NewtonSolverError_aaae34aeb5b4128c87e03c89de1de60a8}{iterations}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16305}16305                        << \textcolor{stringliteral}{"{}) REACHED WITHOUT CONVERGENCE "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16306}16306           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16307}16307           \textcolor{comment}{// If not, it must be that we have exceeded the maximum residuals}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16308}16308           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16309}16309           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16310}16310             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}MAXIMUM RESIDUALS: "{}} << error.\mbox{\hyperlink{classoomph_1_1NewtonSolverError_ae9ee0ef969c2fbf869afb7c4a75dcbe0}{maxres}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16311}16311                        << \textcolor{stringliteral}{"{}EXCEEDS PREDEFINED MAXIMUM "{}} << \mbox{\hyperlink{classoomph_1_1Problem_accb8811cdf32f14be497917e922c623e}{Max\_residuals}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16312}16312                        << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16313}16313           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16314}16314 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16315}16315           \textcolor{comment}{// Die horribly!!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16316}16316           std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16317}16317           error\_stream << \textcolor{stringliteral}{"{}Error occured in adaptive Newton solver. "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16318}16318                        << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16319}16319           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16320}16320                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16321}16321                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16322}16322         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16323}16323 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16324}16324         \textcolor{comment}{// Now update anything that needs updating}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16325}16325         \textcolor{comment}{// NOT NEEDED -\/-\/ WAS CALLED IN newton\_solve ABOVE}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16326}16326         \textcolor{comment}{// !actions\_after\_newton\_solve();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16327}16327 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16328}16328       \} \textcolor{comment}{// End of solve block}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16329}16329 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16330}16330 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16331}16331       \textcolor{keywordflow}{if} (isolve == max\_solve -\/ 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16332}16332       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16333}16333         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16334}16334           << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16335}16335           << \textcolor{stringliteral}{"{}-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16336}16336           << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16337}16337           << \textcolor{stringliteral}{"{}Reached max. number of adaptations in \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16338}16338           << \textcolor{stringliteral}{"{}Problem::newton\_solver().\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16339}16339           << \textcolor{stringliteral}{"{}-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16340}16340           << std::endl}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16341}16341           << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16342}16342       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16343}16343 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16344}16344     \} \textcolor{comment}{// End of adaptation loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16345}16345   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16346}16346 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16347}16347   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16348}16348 \textcolor{comment}{  /// Delete any external storage for any submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16349}16349 \textcolor{comment}{  /// NB this would ordinarily take place within the adaptation procedure}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16350}16350 \textcolor{comment}{  /// for each submesh (See RefineableMesh::adapt\_mesh(...)), but there}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16351}16351 \textcolor{comment}{  /// are instances where the actions\_before/after\_adapt routines are used}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16352}16352 \textcolor{comment}{  /// and no adaptive routines are called in between (e.g. when doc-\/ing}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16353}16353 \textcolor{comment}{  /// errors at the end of an adaptive newton solver)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16354}16354 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16355}\mbox{\hyperlink{classoomph_1_1Problem_ab8eb3782046c64ea0e46205917440452}{16355}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ab8eb3782046c64ea0e46205917440452}{Problem::delete\_all\_external\_storage}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16356}16356   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16357}16357     \textcolor{comment}{// Number of submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16358}16358     \textcolor{keywordtype}{unsigned} n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16359}16359 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16360}16360     \textcolor{comment}{// External storage will only exist if there is more than one (sub)mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16361}16361     \textcolor{keywordflow}{if} (n\_mesh > 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16362}16362     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16363}16363       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16364}16364       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16365}16365         \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9e3ecb07dc622cf37ce0085446ff9aa6}{delete\_all\_external\_storage}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16366}16366       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16367}16367     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16368}16368   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16369}16369 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16370}16370 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16371}16371 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16372}16372 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16373}16373   \textcolor{comment}{//====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16374}16374 \textcolor{comment}{  /// Get all the halo data stored on this processor and store pointers}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16375}16375 \textcolor{comment}{  /// to the data in a map, indexed by the gobal eqn number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16376}16376 \textcolor{comment}{}  \textcolor{comment}{//====================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16377}\mbox{\hyperlink{classoomph_1_1Problem_ad5c302721bf6699ecf8c8760e49d47d8}{16377}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ad5c302721bf6699ecf8c8760e49d47d8}{Problem::get\_all\_halo\_data}}(std::map<unsigned, double*>\& map\_of\_halo\_data)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16378}16378   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16379}16379     \textcolor{comment}{// Halo data is stored in the meshes, so kick the problem down to that}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16380}16380     \textcolor{comment}{// level}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16381}16381 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16382}16382     \textcolor{comment}{// Find the number of meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16383}16383     \textcolor{keywordtype}{unsigned} n\_mesh = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16384}16384     \textcolor{comment}{// If there are no submeshes it's only the main mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16385}16385     \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16386}16386     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16387}16387       \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9ea031181ace6be72e84892656bdb2cf}{get\_all\_halo\_data}}(map\_of\_halo\_data);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16388}16388     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16389}16389     \textcolor{comment}{// Otherwise loop over all the submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16390}16390     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16391}16391     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16392}16392       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imesh = 0; imesh < n\_mesh; ++imesh)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16393}16393       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16394}16394         \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9ea031181ace6be72e84892656bdb2cf}{get\_all\_halo\_data}}(map\_of\_halo\_data);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16395}16395       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16396}16396     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16397}16397   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16398}16398 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16399}16399 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16400}16400   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16401}16401 \textcolor{comment}{  /// Check the halo/haloed/shared node/element schemes.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16402}16402 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16403}\mbox{\hyperlink{classoomph_1_1Problem_a93dde63729e7cd332edc1f8904a80649}{16403}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a8dd5cb241ce6218fb476931e0879d7c8}{Problem::check\_halo\_schemes}}(\mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}}\& doc\_info)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16404}16404   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16405}16405     \textcolor{comment}{// The bulk of the stuff that was in this routine is mesh-\/based, and}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16406}16406     \textcolor{comment}{// should therefore drop into the Mesh base class.  All that needs to remain}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16407}16407     \textcolor{comment}{// here is a "{}wrapper"{} which calls the function dependent upon the number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16408}16408     \textcolor{comment}{// of (sub)meshes that may have been distributed.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16409}16409 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16410}16410     \textcolor{keywordtype}{unsigned} n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16411}16411 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16412}16412     \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16413}16413     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16414}16414       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Checking halo schemes on single mesh"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16415}16415       doc\_info.\mbox{\hyperlink{classoomph_1_1DocInfo_a0ed2b6a12c476044ceb77a0d450ba43f}{label}}() = \textcolor{stringliteral}{"{}\_one\_and\_only\_mesh\_"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16416}16416       \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a500ba96f32d090b15dbdbadcaef0e32a}{check\_halo\_schemes}}(doc\_info,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16417}16417                                     \mbox{\hyperlink{classoomph_1_1Problem_aeadae1fc5f49e66223ee09c69a9e506d}{Max\_permitted\_error\_for\_halo\_check}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16418}16418     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16419}16419     \textcolor{keywordflow}{else} \textcolor{comment}{// there are submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16420}16420     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16421}16421       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16422}16422       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16423}16423         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Checking halo schemes on submesh "{}} << i\_mesh}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16424}16424                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16425}16425         std::stringstream tmp;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16426}16426         tmp << \textcolor{stringliteral}{"{}\_mesh"{}} << i\_mesh << \textcolor{stringliteral}{"{}\_"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16427}16427         doc\_info.\mbox{\hyperlink{classoomph_1_1DocInfo_a0ed2b6a12c476044ceb77a0d450ba43f}{label}}() = tmp.str();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16428}16428         \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a500ba96f32d090b15dbdbadcaef0e32a}{check\_halo\_schemes}}(doc\_info,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16429}16429                                             \mbox{\hyperlink{classoomph_1_1Problem_aeadae1fc5f49e66223ee09c69a9e506d}{Max\_permitted\_error\_for\_halo\_check}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16430}16430       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16431}16431     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16432}16432   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16433}16433 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16434}16434 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16435}16435   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16436}16436 \textcolor{comment}{  /// Synchronise all dofs by calling the appropriate synchronisation}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16437}16437 \textcolor{comment}{  /// routines for all meshes and the assembly handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16438}16438 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16439}\mbox{\hyperlink{classoomph_1_1Problem_a5d9a3ba5696a7bcd275223ff16b7392e}{16439}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a5d9a3ba5696a7bcd275223ff16b7392e}{Problem::synchronise\_all\_dofs}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16440}16440   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16441}16441     \textcolor{comment}{// Synchronise dofs themselves}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16442}16442     \textcolor{keywordtype}{bool} do\_halos = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16443}16443     \textcolor{keywordtype}{bool} do\_external\_halos = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16444}16444     this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a1ccef4e26a7788424780da7555cdc772}{synchronise\_dofs}}(do\_halos, do\_external\_halos);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16445}16445 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16446}16446 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16447}16447     do\_halos = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16448}16448     do\_external\_halos = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16449}16449     this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a1ccef4e26a7788424780da7555cdc772}{synchronise\_dofs}}(do\_halos, do\_external\_halos);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16450}16450 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16451}16451     \textcolor{comment}{// Now perform any synchronisation required by the assembly handler}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16452}16452     this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a0ccef21253d997dd1a78ed26c2b99fce}{synchronise}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16453}16453   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16454}16454 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16455}16455 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16456}16456   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16457}16457 \textcolor{comment}{  /// Synchronise the degrees of freedom by overwriting}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16458}16458 \textcolor{comment}{  /// the haloed values with their non-\/halo counterparts held}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16459}16459 \textcolor{comment}{  /// on other processors. Bools control if we deal with data associated with}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16460}16460 \textcolor{comment}{  /// external halo/ed elements/nodes or the "{}normal"{} halo/ed ones.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16461}16461 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16462}\mbox{\hyperlink{classoomph_1_1Problem_a1ccef4e26a7788424780da7555cdc772}{16462}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a1ccef4e26a7788424780da7555cdc772}{Problem::synchronise\_dofs}}(\textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& do\_halos,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16463}16463                                  \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& do\_external\_halos)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16464}16464   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16465}16465     \textcolor{comment}{// Do we have submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16466}16466     \textcolor{keywordtype}{unsigned} n\_mesh\_loop = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16467}16467     \textcolor{keywordtype}{unsigned} nmesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16468}16468     \textcolor{keywordflow}{if} (nmesh > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16469}16469     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16470}16470       n\_mesh\_loop = nmesh;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16471}16471     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16472}16472 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16473}16473     \textcolor{comment}{// Local storage for number of processors and current processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16474}16474     \textcolor{keyword}{const} \textcolor{keywordtype}{int} n\_proc = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16475}16475 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16476}16476     \textcolor{comment}{// If only one processor then return}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16477}16477     \textcolor{keywordflow}{if} (n\_proc == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16478}16478     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16479}16479       \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16480}16480     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16481}16481 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16482}16482     \textcolor{keyword}{const} \textcolor{keywordtype}{int} my\_rank = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16483}16483 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16484}16484     \textcolor{comment}{// Storage for number of data to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16485}16485     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} send\_n(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16486}16486 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16487}16487     \textcolor{comment}{// Storage for all values to be sent to all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16488}16488     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} send\_data;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16489}16489 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16490}16490     \textcolor{comment}{// Start location within send\_data for data to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16491}16491     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} send\_displacement(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16492}16492 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16493}16493     \textcolor{comment}{// Loop over all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16494}16494     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} rank = 0; rank < n\_proc; rank++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16495}16495     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16496}16496       \textcolor{comment}{// Set the offset for the current processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16497}16497       send\_displacement[rank] = send\_data.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16498}16498 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16499}16499       \textcolor{comment}{// Don't bother to do anything if the processor in the loop is the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16500}16500       \textcolor{comment}{// current processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16501}16501       \textcolor{keywordflow}{if} (rank != my\_rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16502}16502       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16503}16503         \textcolor{comment}{// Deal with sub-\/meshes one-\/by-\/one if required}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16504}16504         \mbox{\hyperlink{classoomph_1_1Mesh}{Mesh}}* my\_mesh\_pt = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16505}16505 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16506}16506         \textcolor{comment}{// Loop over submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16507}16507         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imesh = 0; imesh < n\_mesh\_loop; imesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16508}16508         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16509}16509           \textcolor{keywordflow}{if} (nmesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16510}16510           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16511}16511             my\_mesh\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16512}16512           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16513}16513           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16514}16514           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16515}16515             my\_mesh\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16516}16516           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16517}16517 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16518}16518           \textcolor{keywordflow}{if} (do\_halos)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16519}16519           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16520}16520             \textcolor{comment}{// How many of my nodes are haloed by the processor whose values}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16521}16521             \textcolor{comment}{// are updated?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16522}16522             \textcolor{keywordtype}{unsigned} n\_nod = my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ad3202cdf7b1b35f8b3db51430dbbb8c6}{nhaloed\_node}}(rank);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16523}16523             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_nod; n++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16524}16524             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16525}16525               \textcolor{comment}{// Add the data for each haloed node to the vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16526}16526               my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ab29fbaa5e88f722de752b3fd642a75e4}{haloed\_node\_pt}}(rank, n)-\/>\mbox{\hyperlink{classoomph_1_1Node_a11400682e1fd2851777234a779e8bf8d}{add\_values\_to\_vector}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16527}16527                 send\_data);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16528}16528             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16529}16529 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16530}16530             \textcolor{comment}{// Now loop over haloed elements and prepare to add their}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16531}16531             \textcolor{comment}{// internal data to the big vector to be sent}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16532}16532             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<GeneralisedElement*>}} haloed\_elem\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16533}16533               my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ae1376f1c2e3e2dbd66b9334992f02ae0}{haloed\_element\_pt}}(rank);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16534}16534             \textcolor{keywordtype}{unsigned} nelem\_haloed = haloed\_elem\_pt.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16535}16535             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nelem\_haloed; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16536}16536             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16537}16537               haloed\_elem\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>add\_internal\_data\_values\_to\_vector(send\_data);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16538}16538             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16539}16539           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16540}16540 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16541}16541           \textcolor{keywordflow}{if} (do\_external\_halos)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16542}16542           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16543}16543             \textcolor{comment}{// How many of my nodes are externally haloed by the processor whose}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16544}16544             \textcolor{comment}{// values are updated?  NB these nodes are on the external mesh.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16545}16545             \textcolor{keywordtype}{unsigned} n\_ext\_nod = my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ad37eca6c72c9687954aa2d321938d692}{nexternal\_haloed\_node}}(rank);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16546}16546             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_ext\_nod; n++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16547}16547             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16548}16548               \textcolor{comment}{// Add data from each external haloed node to the vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16549}16549               my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9f6a99d3f3b01dc1b48247285f50e14d}{external\_haloed\_node\_pt}}(rank, n)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16550}16550                 -\/>\mbox{\hyperlink{classoomph_1_1Node_a11400682e1fd2851777234a779e8bf8d}{add\_values\_to\_vector}}(send\_data);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16551}16551             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16552}16552 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16553}16553             \textcolor{comment}{// Now loop over haloed elements and prepare to send internal data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16554}16554             \textcolor{keywordtype}{unsigned} next\_elem\_haloed =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16555}16555               my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a2ab617e7c2c754234dcad02d3d0ed5ba}{nexternal\_haloed\_element}}(rank);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16556}16556             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < next\_elem\_haloed; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16557}16557             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16558}16558               my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a4718b68acd1961c943b47859487bd870}{external\_haloed\_element\_pt}}(rank, \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16559}16559                 -\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a3f15bfeb2a705f8acfa529967077bc20}{add\_internal\_data\_values\_to\_vector}}(send\_data);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16560}16560             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16561}16561           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16562}16562         \} \textcolor{comment}{// end of loop over meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16563}16563       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16564}16564 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16565}16565       \textcolor{comment}{// Find the number of data added to the vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16566}16566       send\_n[rank] = send\_data.size() -\/ send\_displacement[rank];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16567}16567     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16568}16568 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16569}16569 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16570}16570     \textcolor{comment}{// Storage for the number of data to be received from each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16571}16571     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} receive\_n(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16572}16572 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16573}16573     \textcolor{comment}{// Now send numbers of data to be sent between all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16574}16574     MPI\_Alltoall(\&send\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16575}16575                  1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16576}16576                  MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16577}16577                  \&receive\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16578}16578                  1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16579}16579                  MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16580}16580                  this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16581}16581 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16582}16582     \textcolor{comment}{// We now prepare the data to be received}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16583}16583     \textcolor{comment}{// by working out the displacements from the received data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16584}16584     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} receive\_displacement(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16585}16585     \textcolor{keywordtype}{int} receive\_data\_count = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16586}16586     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} rank = 0; rank < n\_proc; ++rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16587}16587     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16588}16588       \textcolor{comment}{// Displacement is number of data received so far}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16589}16589       receive\_displacement[rank] = receive\_data\_count;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16590}16590       receive\_data\_count += receive\_n[rank];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16591}16591     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16592}16592 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16593}16593     \textcolor{comment}{// Now resize the receive buffer for all data from all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16594}16594     \textcolor{comment}{// Make sure that it has a size of at least one}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16595}16595     \textcolor{keywordflow}{if} (receive\_data\_count == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16596}16596     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16597}16597       ++receive\_data\_count;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16598}16598     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16599}16599     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} receive\_data(receive\_data\_count);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16600}16600 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16601}16601     \textcolor{comment}{// Make sure that the send buffer has size at least one}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16602}16602     \textcolor{comment}{// so that we don't get a segmentation fault}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16603}16603     \textcolor{keywordflow}{if} (send\_data.size() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16604}16604     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16605}16605       send\_data.resize(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16606}16606     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16607}16607 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16608}16608     \textcolor{comment}{// Now send the data between all the processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16609}16609     MPI\_Alltoallv(\&send\_data[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16610}16610                   \&send\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16611}16611                   \&send\_displacement[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16612}16612                   MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16613}16613                   \&receive\_data[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16614}16614                   \&receive\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16615}16615                   \&receive\_displacement[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16616}16616                   MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16617}16617                   this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16618}16618 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16619}16619     \textcolor{comment}{// Now use the received data to update the halo nodes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16620}16620     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} send\_rank = 0; send\_rank < n\_proc; send\_rank++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16621}16621     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16622}16622       \textcolor{comment}{// Don't bother to do anything for the processor corresponding to the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16623}16623       \textcolor{comment}{// current processor or if no data were received from this processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16624}16624       \textcolor{keywordflow}{if} ((send\_rank != my\_rank) \&\& (receive\_n[send\_rank] != 0))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16625}16625       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16626}16626         \textcolor{comment}{// Counter for the data within the large array}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16627}16627         \textcolor{keywordtype}{unsigned} count = receive\_displacement[send\_rank];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16628}16628 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16629}16629         \textcolor{comment}{// Deal with sub-\/meshes one-\/by-\/one if required}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16630}16630         \mbox{\hyperlink{classoomph_1_1Mesh}{Mesh}}* my\_mesh\_pt = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16631}16631 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16632}16632         \textcolor{comment}{// Loop over submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16633}16633         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imesh = 0; imesh < n\_mesh\_loop; imesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16634}16634         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16635}16635           \textcolor{keywordflow}{if} (nmesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16636}16636           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16637}16637             my\_mesh\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16638}16638           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16639}16639           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16640}16640           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16641}16641             my\_mesh\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16642}16642           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16643}16643 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16644}16644           \textcolor{keywordflow}{if} (do\_halos)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16645}16645           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16646}16646             \textcolor{comment}{// How many of my nodes are halos whose non-\/halo counter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16647}16647             \textcolor{comment}{// parts live on processor send\_rank?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16648}16648             \textcolor{keywordtype}{unsigned} n\_nod = my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_aa19080c0e68facf0e8c8ec55b327279f}{nhalo\_node}}(send\_rank);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16649}16649             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_nod; n++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16650}16650             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16651}16651               \textcolor{comment}{// Read in values for each halo node}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16652}16652               my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ad7ba73da180acb43523166ee71fb2e99}{halo\_node\_pt}}(send\_rank, n)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16653}16653                 -\/>\mbox{\hyperlink{classoomph_1_1Node_accb033ab8ed4f96331014f7c4cd131f9}{read\_values\_from\_vector}}(receive\_data, count);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16654}16654             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16655}16655 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16656}16656             \textcolor{comment}{// Get number of halo elements whose non-\/halo is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16657}16657             \textcolor{comment}{// on process send\_rank}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16658}16658             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<GeneralisedElement*>}} halo\_elem\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16659}16659               my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a882f5825ab0369b49d1d694f8e87d951}{halo\_element\_pt}}(send\_rank);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16660}16660 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16661}16661             \textcolor{keywordtype}{unsigned} nelem\_halo = halo\_elem\_pt.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16662}16662             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nelem\_halo; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16663}16663             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16664}16664               halo\_elem\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>read\_internal\_data\_values\_from\_vector(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16665}16665                 receive\_data, count);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16666}16666             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16667}16667           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16668}16668 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16669}16669           \textcolor{keywordflow}{if} (do\_external\_halos)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16670}16670           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16671}16671             \textcolor{comment}{// How many of my nodes are external halos whose external non-\/halo}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16672}16672             \textcolor{comment}{// counterparts live on processor send\_rank?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16673}16673             \textcolor{keywordtype}{unsigned} n\_ext\_nod = my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a2dc1f87191771f18f55e9b44664bc7ea}{nexternal\_halo\_node}}(send\_rank);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16674}16674 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16675}16675             \textcolor{comment}{// Copy into the values of the external halo nodes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16676}16676             \textcolor{comment}{// on the present processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16677}16677             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_ext\_nod; n++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16678}16678             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16679}16679               \textcolor{comment}{// Read the data from the array into each halo node}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16680}16680               my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1f88352a0bf5be7d15858915097c1e70}{external\_halo\_node\_pt}}(send\_rank, n)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16681}16681                 -\/>\mbox{\hyperlink{classoomph_1_1Node_accb033ab8ed4f96331014f7c4cd131f9}{read\_values\_from\_vector}}(receive\_data, count);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16682}16682             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16683}16683 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16684}16684             \textcolor{comment}{// Get number of halo elements whose non-\/halo is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16685}16685             \textcolor{comment}{// on process send\_rank}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16686}16686             \textcolor{keywordtype}{unsigned} next\_elem\_halo =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16687}16687               my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af7554deb7f9854272d849a6482a57d60}{nexternal\_halo\_element}}(send\_rank);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16688}16688             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < next\_elem\_halo; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16689}16689             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16690}16690               my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1f889ef9305db5f812f93931877839d2}{external\_halo\_element\_pt}}(send\_rank, \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16691}16691                 -\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_af4db27d80c24979a9cb822203ff77557}{read\_internal\_data\_values\_from\_vector}}(receive\_data, count);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16692}16692             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16693}16693           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16694}16694 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16695}16695         \} \textcolor{comment}{// end of loop over meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16696}16696       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16697}16697     \} \textcolor{comment}{// End of data is received}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16698}16698   \} \textcolor{comment}{// End of synchronise}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16699}16699 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16700}16700 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16701}16701   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16702}16702 \textcolor{comment}{  ///  Synchronise equation numbers and return the total}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16703}16703 \textcolor{comment}{  /// number of degrees of freedom in the overall problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16704}16704 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16705}\mbox{\hyperlink{classoomph_1_1Problem_a9a9ce9ee869ff79ee5596e434309f379}{16705}}   \textcolor{keywordtype}{long} \mbox{\hyperlink{classoomph_1_1Problem_a9a9ce9ee869ff79ee5596e434309f379}{Problem::synchronise\_eqn\_numbers}}(\textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& assign\_local\_eqn\_numbers)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16706}16706   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16707}16707     \textcolor{comment}{// number of equations on this processor, which at this stage is only known}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16708}16708     \textcolor{comment}{// by counting the number of dofs that have been added to the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16709}16709     \textcolor{keywordtype}{unsigned} my\_n\_eqn = \mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16710}16710 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16711}16711     \textcolor{comment}{// my rank}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16712}16712     \textcolor{keywordtype}{unsigned} my\_rank = \mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16713}16713 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16714}16714     \textcolor{comment}{// number of processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16715}16715     \textcolor{keywordtype}{unsigned} nproc = \mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>nproc();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16716}16716 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16717}16717     \textcolor{comment}{//  // Time alternative communication}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16718}16718     \textcolor{comment}{//  Vector<unsigned> n\_eqn(nproc);}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16719}16719     \textcolor{comment}{//  \{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16720}16720     \textcolor{comment}{//   double t\_start = TimingHelpers::timer();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16721}16721 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16722}16722     \textcolor{comment}{//   // Gather numbers of equations (enumerated independently on all procs)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16723}16723     \textcolor{comment}{//   MPI\_Allgather(\&my\_n\_eqn,1,MPI\_UNSIGNED,\&n\_eqn[0],}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16724}16724     \textcolor{comment}{//                 1,MPI\_INT,Communicator\_pt-\/>mpi\_comm());}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16725}16725 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16726}16726     \textcolor{comment}{//   double t\_end = TimingHelpers::timer();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16727}16727     \textcolor{comment}{//   oomph\_info << "{}Time for allgather-\/based exchange of eqn numbers: "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16728}16728     \textcolor{comment}{//              << t\_end-\/t\_start << std::endl;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16729}16729     \textcolor{comment}{//  \}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16730}16730 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16731}16731     \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16732}16732 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16733}16733     \textcolor{comment}{// send my\_n\_eqn to with rank greater than my\_rank}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16734}16734     \textcolor{keywordtype}{unsigned} n\_send = nproc -\/ my\_rank -\/ 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16735}16735     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Request>}} send\_req(n\_send);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16736}16736     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = my\_rank + 1; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16737}16737     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16738}16738       MPI\_Isend(\&my\_n\_eqn,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16739}16739                 1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16740}16740                 MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16741}16741                 p,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16742}16742                 0,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16743}16743                 \mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16744}16744                 \&send\_req[p -\/ my\_rank -\/ 1]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16745}16745     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16746}16746 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16747}16747     \textcolor{comment}{// recv n\_eqn from processors with rank less than my\_rank}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16748}16748     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} n\_eqn\_on\_proc(my\_rank);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16749}16749     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < my\_rank; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16750}16750     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16751}16751       MPI\_Recv(\&n\_eqn\_on\_proc[p],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16752}16752                1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16753}16753                MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16754}16754                p,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16755}16755                0,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16756}16756                \mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16757}16757                MPI\_STATUS\_IGNORE);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16758}16758     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16759}16759 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16760}16760     \textcolor{keywordtype}{double} t\_end = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16761}16761     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16762}16762     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16763}16763       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16764}16764       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for send and receive stuff: "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16765}16765                  << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16766}16766       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16767}16767     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16768}16768 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16769}16769     \textcolor{comment}{// determine the number of equation on processors with rank}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16770}16770     \textcolor{comment}{// less than my\_rank}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16771}16771     \textcolor{keywordtype}{unsigned} my\_eqn\_num\_base = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16772}16772     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} p = 0; p < my\_rank; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16773}16773     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16774}16774       my\_eqn\_num\_base += n\_eqn\_on\_proc[p];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16775}16775       \textcolor{comment}{//   if (n\_eqn\_on\_proc[p]!=n\_eqn[p])}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16776}16776       \textcolor{comment}{//     \{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16777}16777       \textcolor{comment}{//      std::cout << "{}proc "{} << my\_rank << "{}clash in eqn numbers: "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16778}16778       \textcolor{comment}{//                << p << "{} "{} << n\_eqn\_on\_proc[p] << "{} "{} << n\_eqn[p]}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16779}16779       \textcolor{comment}{//                << std::endl;}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16780}16780       \textcolor{comment}{//     \}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16781}16781     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16782}16782 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16783}16783     \textcolor{comment}{// Loop over all internal data (on elements) and bump up their}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16784}16784     \textcolor{comment}{// equation numbers if they exist}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16785}16785     \textcolor{keywordtype}{unsigned} nelem = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16786}16786     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nelem; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16787}16787     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16788}16788       \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* el\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16789}16789 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16790}16790       \textcolor{keywordtype}{unsigned} nintern\_data = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a6b736de0af4c92831968636479b3480e}{ninternal\_data}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16791}16791       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} iintern = 0; iintern < nintern\_data; iintern++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16792}16792       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16793}16793         \mbox{\hyperlink{classoomph_1_1Data}{Data}}* int\_data\_pt = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a3b83389f2c80788013421c6d59604f0b}{internal\_data\_pt}}(iintern);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16794}16794         \textcolor{keywordtype}{unsigned} nval = int\_data\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7e67fc78a2e8a2fd6eb75bd292d42ff8}{nvalue}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16795}16795         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} ival = 0; ival < nval; ival++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16796}16796         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16797}16797           \textcolor{keywordtype}{int} old\_eqn\_number = int\_data\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_ab6845db69833c541766d9a073b023fc4}{eqn\_number}}(ival);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16798}16798           \textcolor{keywordflow}{if} (old\_eqn\_number >= 0) \textcolor{comment}{// i.e. it's being used}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16799}16799           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16800}16800             \textcolor{comment}{// Bump up eqn number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16801}16801             \textcolor{keywordtype}{int} new\_eqn\_number = old\_eqn\_number + my\_eqn\_num\_base;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16802}16802             int\_data\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_ab6845db69833c541766d9a073b023fc4}{eqn\_number}}(ival) = new\_eqn\_number;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16803}16803           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16804}16804         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16805}16805       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16806}16806     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16807}16807 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16808}16808     \textcolor{comment}{// Loop over all nodes on current processor and bump up their}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16809}16809     \textcolor{comment}{// equation numbers if they're not pinned!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16810}16810     \textcolor{keywordtype}{unsigned} nnod = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a945e7823d1a2af243b5b7f7866aaff5e}{nnode}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16811}16811     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < nnod; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16812}16812     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16813}16813       \mbox{\hyperlink{classoomph_1_1Node}{Node}}* nod\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16814}16814 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16815}16815       \textcolor{comment}{// loop over ALL eqn numbers -\/ variable number of values}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16816}16816       \textcolor{keywordtype}{unsigned} nval = nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7e67fc78a2e8a2fd6eb75bd292d42ff8}{nvalue}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16817}16817 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16818}16818       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} ival = 0; ival < nval; ival++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16819}16819       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16820}16820         \textcolor{keywordtype}{int} old\_eqn\_number = nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_ab6845db69833c541766d9a073b023fc4}{eqn\_number}}(ival);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16821}16821         \textcolor{comment}{// Include all eqn numbers}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16822}16822         \textcolor{keywordflow}{if} (old\_eqn\_number >= 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16823}16823         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16824}16824           \textcolor{comment}{// Bump up eqn number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16825}16825           \textcolor{keywordtype}{int} new\_eqn\_number = old\_eqn\_number + my\_eqn\_num\_base;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16826}16826           nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_ab6845db69833c541766d9a073b023fc4}{eqn\_number}}(ival) = new\_eqn\_number;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16827}16827         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16828}16828       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16829}16829 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16830}16830       \textcolor{comment}{// Is this a solid node? If so, need to bump up its equation number(s)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16831}16831       \mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}* solid\_nod\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}*\textcolor{keyword}{>}(nod\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16832}16832 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16833}16833       \textcolor{keywordflow}{if} (solid\_nod\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16834}16834       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16835}16835         \textcolor{comment}{// Find equation numbers}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16836}16836         \textcolor{keywordtype}{unsigned} nval = solid\_nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidNode_a22078726936f5bf3cf9e4328b3852a4a}{variable\_position\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Data_a7e67fc78a2e8a2fd6eb75bd292d42ff8}{nvalue}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16837}16837         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} ival = 0; ival < nval; ival++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16838}16838         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16839}16839           \textcolor{keywordtype}{int} old\_eqn\_number =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16840}16840             solid\_nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidNode_a22078726936f5bf3cf9e4328b3852a4a}{variable\_position\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Data_ab6845db69833c541766d9a073b023fc4}{eqn\_number}}(ival);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16841}16841           \textcolor{comment}{// include all eqn numbers}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16842}16842 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16843}16843           \textcolor{keywordflow}{if} (old\_eqn\_number >= 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16844}16844           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16845}16845             \textcolor{comment}{// Bump up eqn number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16846}16846             \textcolor{keywordtype}{int} new\_eqn\_number = old\_eqn\_number + my\_eqn\_num\_base;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16847}16847             solid\_nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidNode_a22078726936f5bf3cf9e4328b3852a4a}{variable\_position\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Data_ab6845db69833c541766d9a073b023fc4}{eqn\_number}}(ival) =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16848}16848               new\_eqn\_number;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16849}16849           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16850}16850         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16851}16851       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16852}16852     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16853}16853 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16854}16854     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16855}16855     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16856}16856       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16857}16857       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for bumping: "{}} << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16858}16858       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16859}16859     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16860}16860 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16861}16861 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16862}16862     \textcolor{comment}{// Now copy the haloed eqn numbers across}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16863}16863     \textcolor{comment}{// This has to include the internal data equation numbers as well}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16864}16864     \textcolor{comment}{// as the solid node equation numbers}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16865}16865     \textcolor{keywordtype}{bool} do\_halos = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16866}16866     \textcolor{keywordtype}{bool} do\_external\_halos = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16867}16867     \mbox{\hyperlink{classoomph_1_1Problem_a3d06660ec06b402f14d4b33a84621214}{copy\_haloed\_eqn\_numbers\_helper}}(do\_halos, do\_external\_halos);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16868}16868 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16869}16869     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16870}16870     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16871}16871       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16872}16872       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for copy\_haloed\_eqn\_numbers\_helper for halos: "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16873}16873                  << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16874}16874       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16875}16875     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16876}16876 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16877}16877     \textcolor{comment}{// Now do external halo stuff}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16878}16878     do\_halos = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16879}16879     do\_external\_halos = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16880}16880     \mbox{\hyperlink{classoomph_1_1Problem_a3d06660ec06b402f14d4b33a84621214}{copy\_haloed\_eqn\_numbers\_helper}}(do\_halos, do\_external\_halos);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16881}16881 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16882}16882     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16883}16883     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16884}16884       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16885}16885       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16886}16886         << \textcolor{stringliteral}{"{}Time for copy\_haloed\_eqn\_numbers\_helper for external halos: "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16887}16887         << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16888}16888       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16889}16889     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16890}16890 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16891}16891     \textcolor{comment}{// Now the global equation numbers have been updated.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16892}16892     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16893}16893     \textcolor{comment}{// Setup the local equation numbers again.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16894}16894     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16895}16895     \textcolor{keywordflow}{if} (assign\_local\_eqn\_numbers)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16896}16896     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16897}16897       \textcolor{comment}{// Loop over the submeshes: Note we need to call the submeshes' own}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16898}16898       \textcolor{comment}{// assign\_*\_eqn\_number() otherwise we miss additional functionality}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16899}16899       \textcolor{comment}{// that is implemented (e.g.) in SolidMeshes!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16900}16900       \textcolor{keywordtype}{unsigned} n\_sub\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16901}16901       \textcolor{keywordflow}{if} (n\_sub\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16902}16902       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16903}16903         \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ab73d03d38e9b94b15f21b2c12f5dc3bc}{assign\_local\_eqn\_numbers}}(\mbox{\hyperlink{classoomph_1_1Problem_a075696d6f4c4260ce860997c8c931de4}{Store\_local\_dof\_pt\_in\_elements}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16904}16904       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16905}16905       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16906}16906       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16907}16907         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_sub\_mesh; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16908}16908         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16909}16909           \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ab73d03d38e9b94b15f21b2c12f5dc3bc}{assign\_local\_eqn\_numbers}}(\mbox{\hyperlink{classoomph_1_1Problem_a075696d6f4c4260ce860997c8c931de4}{Store\_local\_dof\_pt\_in\_elements}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16910}16910         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16911}16911       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16912}16912     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16913}16913 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16914}16914     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16915}16915     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16916}16916       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16917}16917       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for assign\_local\_eqn\_numbers in sync: "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16918}16918                  << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16919}16919       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16920}16920     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16921}16921 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16922}16922     \textcolor{comment}{// wait for the sends to complete}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16923}16923     \textcolor{keywordflow}{if} (n\_send > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16924}16924     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16925}16925       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Status>}} send\_status(n\_send);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16926}16926       MPI\_Waitall(n\_send, \&send\_req[0], \&send\_status[0]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16927}16927     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16928}16928 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16929}16929     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16930}16930     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16931}16931       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16932}16932       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for waitall: "{}} << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16933}16933       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16934}16934     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16935}16935 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16936}16936     \textcolor{comment}{// build the Dof distribution pt}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16937}16937     \mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a3cab441019e738e4c6db6ee22dd71515}{build}}(\mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}, my\_eqn\_num\_base, my\_n\_eqn);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16938}16938 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16939}16939     \textcolor{comment}{// and return the total number of equations in the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16940}16940     \textcolor{keywordflow}{return} (\textcolor{keywordtype}{long})\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_aafad0b69de2284808366b65bd63e493b}{nrow}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16941}16941   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16942}16942 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16943}16943 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16944}16944   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16945}16945 \textcolor{comment}{  /// A private helper function to}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16946}16946 \textcolor{comment}{  /// copy the haloed equation numbers into the halo equation numbers,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16947}16947 \textcolor{comment}{  /// either for the problem's one and only mesh or for all of its}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16948}16948 \textcolor{comment}{  /// submeshes. Bools control if we deal with data associated with}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16949}16949 \textcolor{comment}{  /// external halo/ed elements/nodes or the "{}normal"{} halo/ed ones.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16950}16950 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16951}\mbox{\hyperlink{classoomph_1_1Problem_a3d06660ec06b402f14d4b33a84621214}{16951}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a3d06660ec06b402f14d4b33a84621214}{Problem::copy\_haloed\_eqn\_numbers\_helper}}(\textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& do\_halos,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16952}16952                                                \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& do\_external\_halos)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16953}16953   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16954}16954     \textcolor{comment}{// Do we have submeshes?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16955}16955     \textcolor{keywordtype}{unsigned} n\_mesh\_loop = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16956}16956     \textcolor{keywordtype}{unsigned} nmesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16957}16957     \textcolor{keywordflow}{if} (nmesh > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16958}16958     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16959}16959       n\_mesh\_loop = nmesh;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16960}16960     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16961}16961 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16962}16962     \textcolor{comment}{// Storage for number of processors and current processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16963}16963     \textcolor{keywordtype}{int} n\_proc = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16964}16964 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16965}16965     \textcolor{comment}{// If only one processor then return}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16966}16966     \textcolor{keywordflow}{if} (n\_proc == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16967}16967     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16968}16968       \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16969}16969     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16970}16970     \textcolor{keywordtype}{int} my\_rank = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16971}16971 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16972}16972     \textcolor{comment}{// Storage for number of data to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16973}16973     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} send\_n(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16974}16974     \textcolor{comment}{// Storage for all equation numbers to be sent to all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16975}16975     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<long>}} send\_data;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16976}16976     \textcolor{comment}{// Start location within send\_data for data to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16977}16977     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} send\_displacement(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16978}16978 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16979}16979 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16980}16980     \textcolor{comment}{// Loop over all processors whose eqn numbers are to be updated}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16981}16981     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} rank = 0; rank < n\_proc; rank++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16982}16982     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16983}16983       \textcolor{comment}{// Set the displacement of the current processor in the loop}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16984}16984       send\_displacement[rank] = send\_data.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16985}16985 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16986}16986       \textcolor{comment}{// If I'm not the processor whose halo eqn numbers are updated,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16987}16987       \textcolor{comment}{// some of my nodes may be haloed: Stick their}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16988}16988       \textcolor{comment}{// eqn numbers into the vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16989}16989       \textcolor{keywordflow}{if} (rank != my\_rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16990}16990       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16991}16991         \textcolor{comment}{// Deal with sub-\/meshes one-\/by-\/one if required}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16992}16992         \mbox{\hyperlink{classoomph_1_1Mesh}{Mesh}}* my\_mesh\_pt = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16993}16993 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16994}16994         \textcolor{comment}{// Loop over submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16995}16995         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imesh = 0; imesh < n\_mesh\_loop; imesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16996}16996         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16997}16997           \textcolor{keywordflow}{if} (nmesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16998}16998           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l16999}16999             my\_mesh\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17000}17000           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17001}17001           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17002}17002           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17003}17003             my\_mesh\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17004}17004           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17005}17005 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17006}17006           \textcolor{keywordflow}{if} (do\_halos)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17007}17007           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17008}17008             \textcolor{comment}{// Add equation numbers for each haloed node}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17009}17009             \textcolor{keywordtype}{unsigned} n\_nod = my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ad3202cdf7b1b35f8b3db51430dbbb8c6}{nhaloed\_node}}(rank);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17010}17010             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_nod; n++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17011}17011             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17012}17012               my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ab29fbaa5e88f722de752b3fd642a75e4}{haloed\_node\_pt}}(rank, n)-\/>\mbox{\hyperlink{classoomph_1_1Data_a1d3f7c4200506d11fea3c647fe498f5d}{add\_eqn\_numbers\_to\_vector}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17013}17013                 send\_data);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17014}17014             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17015}17015 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17016}17016             \textcolor{comment}{// Add the equation numbers associated with internal data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17017}17017             \textcolor{comment}{// in the haloed elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17018}17018             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<GeneralisedElement*>}} haloed\_elem\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17019}17019               my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ae1376f1c2e3e2dbd66b9334992f02ae0}{haloed\_element\_pt}}(rank);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17020}17020             \textcolor{keywordtype}{unsigned} nelem\_haloed = haloed\_elem\_pt.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17021}17021             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nelem\_haloed; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17022}17022             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17023}17023               haloed\_elem\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>add\_internal\_eqn\_numbers\_to\_vector(send\_data);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17024}17024             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17025}17025           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17026}17026 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17027}17027           \textcolor{keywordflow}{if} (do\_external\_halos)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17028}17028           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17029}17029             \textcolor{comment}{// Add equation numbers associated with external haloed nodes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17030}17030             \textcolor{keywordtype}{unsigned} n\_ext\_nod = my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ad37eca6c72c9687954aa2d321938d692}{nexternal\_haloed\_node}}(rank);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17031}17031             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_ext\_nod; n++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17032}17032             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17033}17033               my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9f6a99d3f3b01dc1b48247285f50e14d}{external\_haloed\_node\_pt}}(rank, n)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17034}17034                 -\/>\mbox{\hyperlink{classoomph_1_1Data_a1d3f7c4200506d11fea3c647fe498f5d}{add\_eqn\_numbers\_to\_vector}}(send\_data);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17035}17035             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17036}17036 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17037}17037             \textcolor{comment}{// Add the equation numbers associated with internal data in}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17038}17038             \textcolor{comment}{// each external haloed element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17039}17039             \textcolor{keywordtype}{unsigned} next\_elem\_haloed =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17040}17040               my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a2ab617e7c2c754234dcad02d3d0ed5ba}{nexternal\_haloed\_element}}(rank);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17041}17041             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < next\_elem\_haloed; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17042}17042             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17043}17043               \textcolor{comment}{// how many internal data values for this element?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17044}17044               my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a4718b68acd1961c943b47859487bd870}{external\_haloed\_element\_pt}}(rank, \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17045}17045                 -\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_ab3af7347c1269583d2409d30415b5016}{add\_internal\_eqn\_numbers\_to\_vector}}(send\_data);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17046}17046             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17047}17047           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17048}17048 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17049}17049         \} \textcolor{comment}{// end of loop over meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17050}17050       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17051}17051 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17052}17052       \textcolor{comment}{// Find the number of data added to the vector by this processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17053}17053       send\_n[rank] = send\_data.size() -\/ send\_displacement[rank];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17054}17054     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17055}17055 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17056}17056     \textcolor{comment}{// Storage for the number of data to be received from each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17057}17057     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} receive\_n(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17058}17058 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17059}17059     \textcolor{comment}{// Communicate all numbers of data to be sent between all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17060}17060     MPI\_Alltoall(\&send\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17061}17061                  1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17062}17062                  MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17063}17063                  \&receive\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17064}17064                  1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17065}17065                  MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17066}17066                  this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17067}17067 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17068}17068     \textcolor{comment}{// We now prepare the data to be received}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17069}17069     \textcolor{comment}{// by working out the displacements from the received data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17070}17070     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} receive\_displacement(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17071}17071     \textcolor{keywordtype}{int} receive\_data\_count = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17072}17072     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} rank = 0; rank < n\_proc; ++rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17073}17073     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17074}17074       \textcolor{comment}{// Displacement is number of data received so far}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17075}17075       receive\_displacement[rank] = receive\_data\_count;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17076}17076       receive\_data\_count += receive\_n[rank];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17077}17077     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17078}17078 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17079}17079     \textcolor{comment}{// Now resize the receive buffer}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17080}17080     \textcolor{comment}{// Make sure that it has a size of at least one}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17081}17081     \textcolor{keywordflow}{if} (receive\_data\_count == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17082}17082     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17083}17083       ++receive\_data\_count;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17084}17084     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17085}17085     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<long>}} receive\_data(receive\_data\_count);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17086}17086 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17087}17087     \textcolor{comment}{// Make sure that the send buffer has size at least one}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17088}17088     \textcolor{comment}{// so that we don't get a segmentation fault}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17089}17089     \textcolor{keywordflow}{if} (send\_data.size() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17090}17090     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17091}17091       send\_data.resize(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17092}17092     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17093}17093 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17094}17094     \textcolor{comment}{// Now send the data between all the processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17095}17095     MPI\_Alltoallv(\&send\_data[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17096}17096                   \&send\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17097}17097                   \&send\_displacement[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17098}17098                   MPI\_LONG,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17099}17099                   \&receive\_data[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17100}17100                   \&receive\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17101}17101                   \&receive\_displacement[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17102}17102                   MPI\_LONG,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17103}17103                   this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17104}17104 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17105}17105 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17106}17106     \textcolor{comment}{// Loop over all other processors to receive their}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17107}17107     \textcolor{comment}{// eqn numbers}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17108}17108     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} send\_rank = 0; send\_rank < n\_proc; send\_rank++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17109}17109     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17110}17110       \textcolor{comment}{// Don't do anything for the processor corresponding to the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17111}17111       \textcolor{comment}{// current processor or if no data were received from this processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17112}17112       \textcolor{keywordflow}{if} ((send\_rank != my\_rank) \&\& (receive\_n[send\_rank] != 0))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17113}17113       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17114}17114         \textcolor{comment}{// Counter for the data within the large array}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17115}17115         \textcolor{keywordtype}{unsigned} count = receive\_displacement[send\_rank];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17116}17116 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17117}17117         \textcolor{comment}{// Deal with sub-\/meshes one-\/by-\/one if required}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17118}17118         \mbox{\hyperlink{classoomph_1_1Mesh}{Mesh}}* my\_mesh\_pt = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17119}17119 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17120}17120         \textcolor{comment}{// Loop over submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17121}17121         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imesh = 0; imesh < n\_mesh\_loop; imesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17122}17122         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17123}17123           \textcolor{keywordflow}{if} (nmesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17124}17124           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17125}17125             my\_mesh\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17126}17126           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17127}17127           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17128}17128           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17129}17129             my\_mesh\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(imesh);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17130}17130           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17131}17131 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17132}17132           \textcolor{keywordflow}{if} (do\_halos)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17133}17133           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17134}17134             \textcolor{comment}{// How many of my nodes are halos whose non-\/halo counter}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17135}17135             \textcolor{comment}{// parts live on processor send\_rank?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17136}17136             \textcolor{keywordtype}{unsigned} n\_nod = my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_aa19080c0e68facf0e8c8ec55b327279f}{nhalo\_node}}(send\_rank);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17137}17137             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_nod; n++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17138}17138             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17139}17139               \textcolor{comment}{// Generalise to variable number of values per node}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17140}17140               my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ad7ba73da180acb43523166ee71fb2e99}{halo\_node\_pt}}(send\_rank, n)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17141}17141                 -\/>\mbox{\hyperlink{classoomph_1_1Data_ae958e52df6ede2a08f957db4ee685ca7}{read\_eqn\_numbers\_from\_vector}}(receive\_data, count);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17142}17142             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17143}17143 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17144}17144             \textcolor{comment}{// Get number of halo elements whose non-\/halo is on}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17145}17145             \textcolor{comment}{// process send\_rank}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17146}17146             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<GeneralisedElement*>}} halo\_elem\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17147}17147               my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a882f5825ab0369b49d1d694f8e87d951}{halo\_element\_pt}}(send\_rank);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17148}17148             \textcolor{keywordtype}{unsigned} nelem\_halo = halo\_elem\_pt.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17149}17149             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nelem\_halo; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17150}17150             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17151}17151               halo\_elem\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>read\_internal\_eqn\_numbers\_from\_vector(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17152}17152                 receive\_data, count);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17153}17153             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17154}17154           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17155}17155 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17156}17156           \textcolor{keywordflow}{if} (do\_external\_halos)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17157}17157           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17158}17158             \textcolor{comment}{// How many of my nodes are external halos whose external non-\/halo}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17159}17159             \textcolor{comment}{// counterparts live on processor send\_rank?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17160}17160             \textcolor{keywordtype}{unsigned} n\_ext\_nod = my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a2dc1f87191771f18f55e9b44664bc7ea}{nexternal\_halo\_node}}(send\_rank);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17161}17161             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_ext\_nod; n++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17162}17162             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17163}17163               my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1f88352a0bf5be7d15858915097c1e70}{external\_halo\_node\_pt}}(send\_rank, n)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17164}17164                 -\/>\mbox{\hyperlink{classoomph_1_1Data_ae958e52df6ede2a08f957db4ee685ca7}{read\_eqn\_numbers\_from\_vector}}(receive\_data, count);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17165}17165             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17166}17166 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17167}17167             \textcolor{comment}{// Get number of external halo elements whose external haloed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17168}17168             \textcolor{comment}{// counterpart is on process send\_rank}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17169}17169             \textcolor{keywordtype}{unsigned} next\_elem\_halo =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17170}17170               my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af7554deb7f9854272d849a6482a57d60}{nexternal\_halo\_element}}(send\_rank);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17171}17171             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < next\_elem\_halo; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17172}17172             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17173}17173               my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1f889ef9305db5f812f93931877839d2}{external\_halo\_element\_pt}}(send\_rank, \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17174}17174                 -\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a27afd80364f84725fbcf20d69e6f98e6}{read\_internal\_eqn\_numbers\_from\_vector}}(receive\_data, count);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17175}17175             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17176}17176           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17177}17177 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17178}17178         \} \textcolor{comment}{// end of loop over meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17179}17179       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17180}17180     \} \textcolor{comment}{// End of loop over processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17181}17181   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17182}17182 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17183}17183   \textcolor{comment}{//==========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17184}17184 \textcolor{comment}{  /// Balance the load of a (possibly non-\/uniformly refined) problem that has}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17185}17185 \textcolor{comment}{  /// already been distributed, by re-\/distributing elements over the processors.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17186}17186 \textcolor{comment}{  /// Produce explicit stats of load balancing process if boolean, report\_stats,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17187}17187 \textcolor{comment}{  /// is set to true and doc various bits of data (mainly for debugging)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17188}17188 \textcolor{comment}{  /// in directory specified by DocInfo object.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17189}17189 \textcolor{comment}{}  \textcolor{comment}{//==========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17190}\mbox{\hyperlink{classoomph_1_1Problem_a7492ddb5663552ce8f61f1ef73c86a9d}{17190}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ad6309367fa379889012f25e3397ab425}{Problem::load\_balance}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17191}17191     \mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}}\& doc\_info,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17192}17192     \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& report\_stats,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17193}17193     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& input\_target\_domain\_for\_local\_non\_halo\_element)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17194}17194   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17195}17195     \textcolor{keywordtype}{double} start\_t = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17196}17196 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17197}17197     \textcolor{comment}{// Number of processes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17198}17198     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_proc = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17199}17199 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17200}17200     \textcolor{comment}{// Don't do anything if this is a single-\/process job}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17201}17201     \textcolor{keywordflow}{if} (n\_proc == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17202}17202     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17203}17203       \textcolor{keywordflow}{if} (report\_stats)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17204}17204       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17205}17205         std::ostringstream warn\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17206}17206         warn\_message << \textcolor{stringliteral}{"{}WARNING: You've tried to load balance a problem over\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17207}17207                      << \textcolor{stringliteral}{"{}only one processor: ignoring your request.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17208}17208         \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(warn\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17209}17209                         \textcolor{stringliteral}{"{}Problem::load\_balance()"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17210}17210                         OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17211}17211       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17212}17212     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17213}17213     \textcolor{comment}{// Multiple processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17214}17214     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17215}17215     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17216}17216       \textcolor{comment}{// This will only work if the problem has already been distributed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17217}17217       \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Problem_a5c6bd262be3544343a30767da278d846}{Problem\_has\_been\_distributed}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17218}17218       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17219}17219         \textcolor{comment}{// Throw an error}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17220}17220         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17221}17221         error\_stream << \textcolor{stringliteral}{"{}You have called Problem::load\_balance()\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17222}17222                      << \textcolor{stringliteral}{"{}on a non-\/distributed problem. This doesn't\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17223}17223                      << \textcolor{stringliteral}{"{}make sense -\/-\/ go distribute your problem first."{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17224}17224                      << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17225}17225         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17226}17226           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17227}17227       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17228}17228 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17229}17229       \textcolor{comment}{// Timings}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17230}17230       \textcolor{keywordtype}{double} t\_start = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17231}17231       \textcolor{keywordtype}{double} t\_metis = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17232}17232       \textcolor{keywordtype}{double} t\_partition = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17233}17233       \textcolor{keywordtype}{double} t\_distribute = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17234}17234       \textcolor{keywordtype}{double} t\_refine = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17235}17235       \textcolor{keywordtype}{double} t\_copy\_solution = 0.0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17236}17236 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17237}17237       \textcolor{keywordflow}{if} (report\_stats)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17238}17238       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17239}17239         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17240}17240       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17241}17241 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17242}17242 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17243}17243 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17244}17244       \textcolor{keywordtype}{unsigned} old\_ndof = \mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17245}17245 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17246}17246 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17247}17247       \textcolor{comment}{// Store pointers to the old mesh(es) so we retain a handle}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17248}17248       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17249}17249       \textcolor{comment}{// to them for deletion}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17250}17250       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17251}17251       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Mesh*>}} old\_mesh\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17252}17252       \textcolor{keywordtype}{unsigned} n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17253}17253       \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17254}17254       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17255}17255         \textcolor{comment}{// Resize the container}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17256}17256         old\_mesh\_pt.resize(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17257}17257         old\_mesh\_pt[0] = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17258}17258       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17259}17259       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17260}17260       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17261}17261         \textcolor{comment}{// Resize the container}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17262}17262         old\_mesh\_pt.resize(n\_mesh);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17263}17263         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17264}17264         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17265}17265           old\_mesh\_pt[i\_mesh] = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17266}17266         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17267}17267       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17268}17268 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17269}17269 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17270}17270       \textcolor{comment}{// Partition the global mesh in its current state}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17271}17271       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17272}17272 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17273}17273       \textcolor{comment}{// target\_domain\_for\_local\_non\_halo\_element[e] contains the number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17274}17274       \textcolor{comment}{// of the domain [0,1,...,nproc-\/1] to which non-\/halo element e on THE}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17275}17275       \textcolor{comment}{// CURRENT PROCESSOR ONLY has been assigned. The order of the non-\/halo}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17276}17276       \textcolor{comment}{// elements is the same as in the Problem's mesh, with the halo}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17277}17277       \textcolor{comment}{// elements being skipped.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17278}17278       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} target\_domain\_for\_local\_non\_halo\_element;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17279}17279 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17280}17280       \textcolor{comment}{// Do any of the processors want to go through externally imposed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17281}17281       \textcolor{comment}{// partitioning? If so, we'd better do it here too (even if the processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17282}17282       \textcolor{comment}{// is empty, e.g. following a restart on a larger number of procs) or}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17283}17283       \textcolor{comment}{// we hang.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17284}17284       \textcolor{keywordtype}{unsigned} local\_ntarget =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17285}17285         input\_target\_domain\_for\_local\_non\_halo\_element.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17286}17286       \textcolor{keywordtype}{unsigned} global\_ntarget = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17287}17287       MPI\_Allreduce(\&local\_ntarget,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17288}17288                     \&global\_ntarget,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17289}17289                     1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17290}17290                     MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17291}17291                     MPI\_MAX,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17292}17292                     \mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17293}17293 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17294}17294       \textcolor{comment}{// External prescribed partitioning}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17295}17295       \textcolor{keywordflow}{if} (global\_ntarget > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17296}17296       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17297}17297         target\_domain\_for\_local\_non\_halo\_element =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17298}17298           input\_target\_domain\_for\_local\_non\_halo\_element;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17299}17299       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17300}17300       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17301}17301       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17302}17302         \textcolor{comment}{// Metis does not always produce repeatable results which is}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17303}17303         \textcolor{comment}{// a disaster for validation runs -\/-\/ this bypasses metis and}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17304}17304         \textcolor{comment}{// comes up with a stupid but repeatable partioning.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17305}17305         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_a259414329d43257a71790ac2983e32d4}{Use\_default\_partition\_in\_load\_balance}})}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17306}17306         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17307}17307           \textcolor{comment}{// Bypass METIS to perform the partitioning}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17308}17308           \textcolor{keywordtype}{unsigned} objective = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17309}17309           \textcolor{keywordtype}{bool} bypass\_metis = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17310}17310           \mbox{\hyperlink{namespaceoomph_1_1METIS_a9d95103cfa79d38f80b3b0a6db949701}{METIS::partition\_distributed\_mesh}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17311}17311             \textcolor{keyword}{this},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17312}17312             objective,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17313}17313             target\_domain\_for\_local\_non\_halo\_element,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17314}17314             bypass\_metis);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17315}17315         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17316}17316         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17317}17317         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17318}17318           \textcolor{comment}{// Use METIS to perform the partitioning}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17319}17319           \textcolor{keywordtype}{unsigned} objective = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17320}17320           \mbox{\hyperlink{namespaceoomph_1_1METIS_a9d95103cfa79d38f80b3b0a6db949701}{METIS::partition\_distributed\_mesh}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17321}17321             \textcolor{keyword}{this}, objective, target\_domain\_for\_local\_non\_halo\_element);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17322}17322         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17323}17323       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17324}17324 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17325}17325       \textcolor{keywordflow}{if} (report\_stats)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17326}17326       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17327}17327         t\_metis = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17328}17328       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17329}17329 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17330}17330       \textcolor{comment}{// Setup map linking element with target domain}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17331}17331       std::map<GeneralisedElement*, unsigned>}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17332}17332         target\_domain\_for\_local\_non\_halo\_element\_map;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17333}17333       \textcolor{keywordtype}{unsigned} n\_elem = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17334}17334       \textcolor{keywordtype}{unsigned} count\_non\_halo\_el = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17335}17335       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_elem; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17336}17336       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17337}17337         \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* el\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17338}17338         \textcolor{keywordflow}{if} (!el\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a0d9869eaf7d6e104c1e465b0d3cd6a9b}{is\_halo}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17339}17339         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17340}17340           target\_domain\_for\_local\_non\_halo\_element\_map[el\_pt] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17341}17341             target\_domain\_for\_local\_non\_halo\_element[count\_non\_halo\_el];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17342}17342           count\_non\_halo\_el++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17343}17343         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17344}17344       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17345}17345 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17346}17346       \textcolor{comment}{// Load balancing is equivalent to distribution so call the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17347}17347       \textcolor{comment}{// appropriate "{}actions before"{}. NOTE: This acts on the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17348}17348       \textcolor{comment}{// current, refined, distributed, etc. problem object}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17349}17349       \textcolor{comment}{// before it's being wiped. This step is therefore not}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17350}17350       \textcolor{comment}{// a duplicate of the call below, which acts on the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17351}17351       \textcolor{comment}{// new, not-\/yet refined, distributed etc. problem!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17352}17352       \mbox{\hyperlink{classoomph_1_1Problem_a1d1280f442f9352a614bada21324456d}{actions\_before\_distribute}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17353}17353 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17354}17354       \textcolor{comment}{// Re-\/setup target domains for remaining elements (FaceElements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17355}17355       \textcolor{comment}{// are likely to have been stripped out in actions\_before\_distribute()}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17356}17356       n\_elem = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17357}17357       target\_domain\_for\_local\_non\_halo\_element.clear();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17358}17358       target\_domain\_for\_local\_non\_halo\_element.reserve(n\_elem);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17359}17359       count\_non\_halo\_el = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17360}17360       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_elem; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17361}17361       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17362}17362         \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* el\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17363}17363         \textcolor{keywordflow}{if} (!el\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a0d9869eaf7d6e104c1e465b0d3cd6a9b}{is\_halo}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17364}17364         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17365}17365           target\_domain\_for\_local\_non\_halo\_element.push\_back(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17366}17366             target\_domain\_for\_local\_non\_halo\_element\_map[el\_pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17367}17367         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17368}17368       \} \textcolor{comment}{// for (e < n\_elem)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17369}17369 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17370}17370       \textcolor{comment}{// Re-\/setup the number of sub-\/meshes since some of them may have}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17371}17371       \textcolor{comment}{// been stripped out in actions\_before\_distribute(), but save the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17372}17372       \textcolor{comment}{// number of old sub-\/meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17373}17373       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_old\_sub\_meshes = n\_mesh;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17374}17374       n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17375}17375 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17376}17376       \textcolor{comment}{// Now get the target domains for each of the submeshes, we only}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17377}17377       \textcolor{comment}{// get the target domains for the nonhalo elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17378}17378       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<unsigned>}}> target\_domain\_for\_local\_non\_halo\_element\_submesh(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17379}17379         n\_mesh);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17380}17380       \textcolor{comment}{// If we have no sub-\/meshes then we do not need to copy the target areas}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17381}17381       \textcolor{comment}{// of the submeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17382}17382       \textcolor{keywordflow}{if} (n\_mesh != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17383}17383       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17384}17384         \textcolor{comment}{// Counter to copy the target domains from the global vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17385}17385         \textcolor{keywordtype}{unsigned} count\_td = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17386}17386         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17387}17387         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17388}17388           \textcolor{comment}{// Get the number of elements (considering halo elements)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17389}17389           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nsub\_ele = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17390}17390           \textcolor{comment}{// Now copy that number of data from the global target domains}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17391}17391           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nsub\_ele; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17392}17392           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17393}17393             \textcolor{comment}{// Get the element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17394}17394             \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* ele\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17395}17395             \textcolor{comment}{// ... and check if it is a nonhalo element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17396}17396             \textcolor{keywordflow}{if} (!ele\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a0d9869eaf7d6e104c1e465b0d3cd6a9b}{is\_halo}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17397}17397             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17398}17398               \textcolor{comment}{// Get the target domain for the current element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17399}17399               \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} target\_domain =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17400}17400                 target\_domain\_for\_local\_non\_halo\_element[count\_td++];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17401}17401               \textcolor{comment}{// Add the target domain for the nonhalo element in the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17402}17402               \textcolor{comment}{// submesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17403}17403               target\_domain\_for\_local\_non\_halo\_element\_submesh[i\_mesh]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17404}17404                 .push\_back(target\_domain);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17405}17405             \} \textcolor{comment}{// if (!ele\_pt-\/>is\_halo())}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17406}17406           \} \textcolor{comment}{// for (i < nsub\_ele)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17407}17407         \} \textcolor{comment}{// for (imesh < n\_mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17408}17408 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17409}17409 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17410}17410         \textcolor{comment}{// Check that the total number of copied data be the same as the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17411}17411         \textcolor{comment}{// total number of nonhalo elements in the (sub)-\/mesh(es)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17412}17412         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} ntarget\_domain =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17413}17413           target\_domain\_for\_local\_non\_halo\_element.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17414}17414         \textcolor{keywordflow}{if} (count\_td != ntarget\_domain)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17415}17415         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17416}17416           std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17417}17417           error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17418}17418             << \textcolor{stringliteral}{"{}The number of nonhalo elements ("{}} << count\_td}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17419}17419             << \textcolor{stringliteral}{"{}) found in (all)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17420}17420             << \textcolor{stringliteral}{"{}the (sub)-\/mesh(es) is different from the number of target "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17421}17421                \textcolor{stringliteral}{"{}domains\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17422}17422             << \textcolor{stringliteral}{"{}("{}} << ntarget\_domain << \textcolor{stringliteral}{"{}) for the nonhalo elements.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17423}17423             << \textcolor{stringliteral}{"{}Please ensure that you called the rebuild\_global\_mesh() method "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17424}17424             << \textcolor{stringliteral}{"{}after the\(\backslash\)npossible deletion of FaceElements in "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17425}17425             << \textcolor{stringliteral}{"{}actions\_before\_distribute()!!!\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17426}17426           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17427}17427                               \textcolor{stringliteral}{"{}Problem::load\_balance()"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17428}17428                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17429}17429         \} \textcolor{comment}{// if (count\_td != ntarget\_domain)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17430}17430 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17431}17431 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17432}17432       \} \textcolor{comment}{// if (n\_mesh != 0)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17433}17433 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17434}17434       \textcolor{comment}{// Check if we have different type of submeshes (unstructured}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17435}17435       \textcolor{comment}{// and/or structured). Identify to which type each submesh belongs.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17436}17436       \textcolor{comment}{// If we have only one mesh then identify to which type that mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17437}17437       \textcolor{comment}{// belongs.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17438}17438 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17439}17439       \textcolor{comment}{// The load balancing strategy acts in the structured meshes and}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17440}17440       \textcolor{comment}{// then acts in the unstructured meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17441}17441 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17442}17442       \textcolor{comment}{// Vector to temporaly store pointers to unstructured meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17443}17443       \textcolor{comment}{// (TriangleMeshBase)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17444}17444       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<TriangleMeshBase*>}} unstructured\_mesh\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17445}17445       std::vector<bool> is\_unstructured\_mesh;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17446}17446 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17447}17447       \textcolor{comment}{// Flag to indicate that there are unstructured meshes as part of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17448}17448       \textcolor{comment}{// the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17449}17449       \textcolor{keywordtype}{bool} are\_there\_unstructured\_meshes = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17450}17450 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17451}17451       \textcolor{comment}{// We have only one mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17452}17452       \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17453}17453       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17454}17454         \textcolor{comment}{// Check if it is a TriangleMeshBase mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17455}17455         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}* tri\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17456}17456               \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}*\textcolor{keyword}{>}(old\_mesh\_pt[0]))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17457}17457         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17458}17458           \textcolor{comment}{// Add the pointer to the unstructured meshes container}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17459}17459           unstructured\_mesh\_pt.push\_back(tri\_mesh\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17460}17460           \textcolor{comment}{// Indicate that it is an unstructured mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17461}17461           is\_unstructured\_mesh.push\_back(\textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17462}17462           \textcolor{comment}{// Indicate that there are unstructured meshes as part of the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17463}17463           \textcolor{comment}{// problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17464}17464           are\_there\_unstructured\_meshes = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17465}17465         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17466}17466         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17467}17467         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17468}17468           \textcolor{comment}{// Add the pointer to the unstructured meshes container (null}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17469}17469           \textcolor{comment}{// pointer)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17470}17470           unstructured\_mesh\_pt.push\_back(tri\_mesh\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17471}17471           \textcolor{comment}{// Indicate that it is not an unstructured mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17472}17472           is\_unstructured\_mesh.push\_back(\textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17473}17473         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17474}17474       \} \textcolor{comment}{// if (n\_mesh == 0)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17475}17475       \textcolor{keywordflow}{else} \textcolor{comment}{// We have sub-\/meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17476}17476       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17477}17477         \textcolor{comment}{// Check which sub-\/meshes are unstructured meshes (work with the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17478}17478         \textcolor{comment}{// old sub-\/meshes number)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17479}17479         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17480}17480         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17481}17481           \textcolor{comment}{// Is it a TriangleMeshBase mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17482}17482           \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}* tri\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17483}17483                 \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}*\textcolor{keyword}{>}(old\_mesh\_pt[i\_mesh]))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17484}17484           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17485}17485             \textcolor{comment}{// Add the pointer to the unstructured meshes container}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17486}17486             unstructured\_mesh\_pt.push\_back(tri\_mesh\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17487}17487             \textcolor{comment}{// Indicate that it is an unstructured mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17488}17488             is\_unstructured\_mesh.push\_back(\textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17489}17489             \textcolor{comment}{// Indicate that there are unstructured meshes as part of the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17490}17490             \textcolor{comment}{// problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17491}17491             are\_there\_unstructured\_meshes = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17492}17492           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17493}17493           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17494}17494           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17495}17495             \textcolor{comment}{// Add the pointer to the unstructured meshes container (null}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17496}17496             \textcolor{comment}{// pointer)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17497}17497             unstructured\_mesh\_pt.push\_back(tri\_mesh\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17498}17498             \textcolor{comment}{// Indicate that it is not an unstructured mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17499}17499             is\_unstructured\_mesh.push\_back(\textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17500}17500           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17501}17501         \} \textcolor{comment}{// for (i\_mesh < n\_mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17502}17502       \} \textcolor{comment}{// else if (n\_mesh == 0) // We have sub-\/meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17503}17503 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17504}17504       \textcolor{comment}{// Extract data to be sent to various processors after the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17505}17505       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17506}17506       \textcolor{comment}{// problem has been rebuilt/re-\/distributed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17507}17507       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17508}17508 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17509}17509       \textcolor{comment}{// Storage for number of data to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17510}17510       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} send\_n(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17511}17511 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17512}17512       \textcolor{comment}{// Storage for all values to be sent to all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17513}17513       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} send\_data;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17514}17514 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17515}17515       \textcolor{comment}{// Start location within send\_data for data to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17516}17516       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} send\_displacement(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17517}17517 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17518}17518       \textcolor{comment}{// Old and new domains for each base element (available for all, for}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17519}17519       \textcolor{comment}{// convenience)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17520}17520       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} old\_domain\_for\_base\_element;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17521}17521       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} new\_domain\_for\_base\_element;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17522}17522 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17523}17523       \textcolor{comment}{// Flat-\/packed refinement info, labeled by id of locally}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17524}17524       \textcolor{comment}{// available root elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17525}17525       std::map<unsigned, Vector<unsigned>> flat\_packed\_refinement\_info\_for\_root;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17526}17526 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17527}17527       \textcolor{comment}{// Max. level of refinement}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17528}17528       \textcolor{keywordtype}{unsigned} max\_refinement\_level\_overall = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17529}17529 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17530}17530       \textcolor{comment}{// Prepare the input for the get\_data...() method, only copy the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17531}17531       \textcolor{comment}{// data from the structured meshes, TreeBaseMesh meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17532}17532       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17533}17533         target\_domain\_for\_local\_non\_halo\_element\_in\_structured\_mesh;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17534}17534       \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17535}17535       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17536}17536         \textcolor{comment}{// Check if the mesh is an structured mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17537}17537         \textcolor{keywordflow}{if} (!is\_unstructured\_mesh[0])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17538}17538         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17539}17539           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nele\_mesh =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17540}17540             target\_domain\_for\_local\_non\_halo\_element.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17541}17541           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nele\_mesh; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17542}17542           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17543}17543             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} target\_domain =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17544}17544               target\_domain\_for\_local\_non\_halo\_element[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17545}17545             target\_domain\_for\_local\_non\_halo\_element\_in\_structured\_mesh}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17546}17546               .push\_back(target\_domain);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17547}17547           \} \textcolor{comment}{// for (e < nele\_mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17548}17548         \} \textcolor{comment}{// if (!is\_unstructured\_mesh[0])}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17549}17549       \} \textcolor{comment}{// if (n\_mesh == 0)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17550}17550       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17551}17551       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17552}17552         \textcolor{comment}{// Copy the target domains from the structured meshes only}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17553}17553         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17554}17554         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17555}17555           \textcolor{comment}{// Check if the mesh is an structured mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17556}17556           \textcolor{keywordflow}{if} (!is\_unstructured\_mesh[i\_mesh])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17557}17557           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17558}17558             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nele\_sub\_mesh =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17559}17559               target\_domain\_for\_local\_non\_halo\_element\_submesh[i\_mesh].size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17560}17560             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nele\_sub\_mesh; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17561}17561             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17562}17562               \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} target\_domain =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17563}17563                 target\_domain\_for\_local\_non\_halo\_element\_submesh[i\_mesh][\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17564}17564               target\_domain\_for\_local\_non\_halo\_element\_in\_structured\_mesh}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17565}17565                 .push\_back(target\_domain);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17566}17566             \} \textcolor{comment}{// for (e < nele\_sub\_mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17567}17567           \} \textcolor{comment}{// if (!is\_triangle\_mesh\_base[i\_mesh])}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17568}17568         \} \textcolor{comment}{// for (i\_mesh < n\_mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17569}17569       \} \textcolor{comment}{// else if (n\_mesh == 0)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17570}17570 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17571}17571       \textcolor{comment}{// Extract data from current problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17572}17572       \textcolor{comment}{// sorted into data to be sent to various processors after}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17573}17573       \textcolor{comment}{// rebuilding the meshes in a load-\/balanced form}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17574}17574       \mbox{\hyperlink{classoomph_1_1Problem_ad150d0fa8f2e2ccff79f8ecd78cc1343}{get\_data\_to\_be\_sent\_during\_load\_balancing}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17575}17575         target\_domain\_for\_local\_non\_halo\_element\_in\_structured\_mesh,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17576}17576         send\_n,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17577}17577         send\_data,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17578}17578         send\_displacement,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17579}17579         old\_domain\_for\_base\_element,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17580}17580         new\_domain\_for\_base\_element,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17581}17581         max\_refinement\_level\_overall);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17582}17582 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17583}17583       \textcolor{comment}{// Extract flat-\/packed refinement pattern}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17584}17584       \mbox{\hyperlink{classoomph_1_1Problem_a09788e9f690067496b6621fae12ba354}{get\_flat\_packed\_refinement\_pattern\_for\_load\_balancing}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17585}17585         old\_domain\_for\_base\_element,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17586}17586         new\_domain\_for\_base\_element,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17587}17587         max\_refinement\_level\_overall,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17588}17588         flat\_packed\_refinement\_info\_for\_root);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17589}17589 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17590}17590       \textcolor{keywordflow}{if} (report\_stats)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17591}17591       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17592}17592         t\_partition = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17593}17593         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}CPU for partition calculation for roots: "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17594}17594                    << t\_partition -\/ t\_metis << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17595}17595       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17596}17596 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17597}17597 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17598}17598       \textcolor{comment}{// Flush and delete old submeshes and null the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17599}17599       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17600}17600       \textcolor{comment}{// and rebuild the new (not yet distributed, refined etc.) mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17601}17601       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17602}17602       \textcolor{comment}{// that will be distributed in the new, improved way determined}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17603}17603       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17604}17604       \textcolor{comment}{// by METIS}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17605}17605       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17606}17606       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} pruned\_refinement\_level(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17607}17607         std::max(\textcolor{keywordtype}{int}(n\_old\_sub\_meshes), 1));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17608}17608       \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17609}17609       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17610}17610         pruned\_refinement\_level[0] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17611}17611         \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* ref\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17612}17612           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(old\_mesh\_pt[0]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17613}17613         \textcolor{keywordflow}{if} (ref\_mesh\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17614}17614         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17615}17615           pruned\_refinement\_level[0] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17616}17616             ref\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a1ee27bd5bd3c2eded38103b9161af719}{uniform\_refinement\_level\_when\_pruned}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17617}17617         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17618}17618 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17619}17619         \textcolor{comment}{// If the mesh is an unstructured mesh (TriangleMeshBase mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17620}17620         \textcolor{comment}{// then we should not delete it since the load balance strategy}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17621}17621         \textcolor{comment}{// requires the mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17622}17622 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17623}17623         \textcolor{comment}{// Delete the mesh if it is not an unstructured mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17624}17624         \textcolor{keywordflow}{if} (!is\_unstructured\_mesh[0])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17625}17625         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17626}17626           \textcolor{keyword}{delete} old\_mesh\_pt[0];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17627}17627           old\_mesh\_pt[0] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17628}17628         \} \textcolor{comment}{// if (!is\_unstructured\_mesh[0])}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17629}17629       \} \textcolor{comment}{// if (n\_mesh==0)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17630}17630       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17631}17631       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17632}17632         \textcolor{comment}{// Loop over the number of old meshes (required to delete the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17633}17633         \textcolor{comment}{// pointers of structured meshes in the old\_mesh\_pt structure)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17634}17634         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_old\_sub\_meshes; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17635}17635         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17636}17636           pruned\_refinement\_level[i\_mesh] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17637}17637           \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* ref\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17638}17638             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(old\_mesh\_pt[i\_mesh]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17639}17639           \textcolor{keywordflow}{if} (ref\_mesh\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17640}17640           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17641}17641             pruned\_refinement\_level[i\_mesh] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17642}17642               ref\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a1ee27bd5bd3c2eded38103b9161af719}{uniform\_refinement\_level\_when\_pruned}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17643}17643           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17644}17644 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17645}17645           \textcolor{comment}{// If the mesh is an unstructured mesh (TriangleMeshBase mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17646}17646           \textcolor{comment}{// then we should NOT delete it since the load balance strategy}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17647}17647           \textcolor{comment}{// requires the mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17648}17648 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17649}17649           \textcolor{comment}{// Delete the mesh if it is not an unstructured mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17650}17650           \textcolor{keywordflow}{if} (!is\_unstructured\_mesh[i\_mesh])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17651}17651           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17652}17652             \textcolor{keyword}{delete} old\_mesh\_pt[i\_mesh];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17653}17653             old\_mesh\_pt[i\_mesh] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17654}17654           \} \textcolor{comment}{// if (!is\_unstructured\_mesh[i\_mesh])}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17655}17655 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17656}17656         \} \textcolor{comment}{// for (i\_mesh<n\_mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17657}17657 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17658}17658         \textcolor{comment}{// Empty storage for sub-\/meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17659}17659         \mbox{\hyperlink{classoomph_1_1Problem_a42b2b42a03f9de7d7a4d24edcfa20179}{flush\_sub\_meshes}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17660}17660 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17661}17661         \textcolor{comment}{// Flush the storage for nodes and elements in compound mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17662}17662         \textcolor{comment}{// (they've already been deleted in the sub-\/meshes)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17663}17663         \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a38446e721be2f75a64fdaa025b7c23ad}{flush\_element\_and\_node\_storage}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17664}17664 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17665}17665         \textcolor{comment}{// Kill}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17666}17666         \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17667}17667         \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}() = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17668}17668       \} \textcolor{comment}{// else if (n\_mesh==0)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17669}17669 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17670}17670       \textcolor{keywordtype}{bool} some\_mesh\_has\_been\_pruned = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17671}17671       \textcolor{keywordtype}{unsigned} n = pruned\_refinement\_level.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17672}17672       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17673}17673       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17674}17674         \textcolor{keywordflow}{if} (pruned\_refinement\_level[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] > 0) some\_mesh\_has\_been\_pruned = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17675}17675       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17676}17676 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17677}17677       \textcolor{comment}{// (Re-\/)build the new mesh(es) -\/-\/ this must get the problem into the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17678}17678       \textcolor{comment}{// state it was in when it was first distributed!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17679}17679       \mbox{\hyperlink{classoomph_1_1Problem_a220816aebf8c74c6c524088e3da4d793}{build\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17680}17680 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17681}17681       \textcolor{comment}{// Has one of the meshes been pruned; if so refine to the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17682}17682       \textcolor{comment}{// common refinement level}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17683}17683       \textcolor{keywordflow}{if} (some\_mesh\_has\_been\_pruned)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17684}17684       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17685}17685         \textcolor{comment}{// Do actions before adapt}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17686}17686         \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17687}17687 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17688}17688         \textcolor{comment}{// Re-\/assign number of submeshes -\/-\/ when this was first}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17689}17689         \textcolor{comment}{// set, the problem may have had face meshes that have now}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17690}17690         \textcolor{comment}{// disappeared.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17691}17691         n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17692}17692 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17693}17693         \textcolor{comment}{// Now adapt meshes manually}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17694}17694         \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17695}17695         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17696}17696           \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* ref\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17697}17697             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17698}17698           \textcolor{keywordflow}{if} (ref\_mesh\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17699}17699           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17700}17700             \textcolor{comment}{// Get min and max refinement level}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17701}17701             \textcolor{keywordtype}{unsigned} local\_min\_ref = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17702}17702             \textcolor{keywordtype}{unsigned} local\_max\_ref = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17703}17703             ref\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a937e4321288b6642d5057498f7659d76}{get\_refinement\_levels}}(local\_min\_ref, local\_max\_ref);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17704}17704 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17705}17705             \textcolor{comment}{// Reconcile between processors: If (e.g. following}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17706}17706             \textcolor{comment}{// distribution/pruning) the mesh has no elements on this}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17707}17707             \textcolor{comment}{// processor) then ignore its contribution to the poll of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17708}17708             \textcolor{comment}{// max/min refinement levels}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17709}17709             \textcolor{keywordtype}{int} int\_local\_min\_ref = local\_min\_ref;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17710}17710             \textcolor{keywordflow}{if} (ref\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17711}17711             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17712}17712               int\_local\_min\_ref = INT\_MAX;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17713}17713             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17714}17714             \textcolor{keywordtype}{int} int\_min\_ref = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17715}17715             MPI\_Allreduce(\&int\_local\_min\_ref,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17716}17716                           \&int\_min\_ref,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17717}17717                           1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17718}17718                           MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17719}17719                           MPI\_MIN,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17720}17720                           \mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17721}17721 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17722}17722             \textcolor{comment}{// Overall min refinement level over all meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17723}17723             \textcolor{keywordtype}{unsigned} min\_ref = unsigned(int\_min\_ref);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17724}17724 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17725}17725             \textcolor{comment}{// Refine as many times as required to get refinement up to}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17726}17726             \textcolor{comment}{// uniform refinement level after last prune}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17727}17727             \textcolor{keywordtype}{unsigned} nref = pruned\_refinement\_level[0] -\/ min\_ref;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17728}17728             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Refining one-\/and-\/only mesh uniformly "{}} << nref}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17729}17729                        << \textcolor{stringliteral}{"{} times\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17730}17730             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nref; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17731}17731             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17732}17732               ref\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_ae238476195a0ceeb2cdb680620fb97a3}{refine\_uniformly}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17733}17733             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17734}17734           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17735}17735         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17736}17736         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17737}17737         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17738}17738           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17739}17739           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17740}17740             \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* ref\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17741}17741               \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17742}17742             \textcolor{keywordflow}{if} (ref\_mesh\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17743}17743             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17744}17744               \textcolor{comment}{// Get min and max refinement level}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17745}17745               \textcolor{keywordtype}{unsigned} local\_min\_ref = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17746}17746               \textcolor{keywordtype}{unsigned} local\_max\_ref = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17747}17747               ref\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a937e4321288b6642d5057498f7659d76}{get\_refinement\_levels}}(local\_min\_ref, local\_max\_ref);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17748}17748 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17749}17749               \textcolor{comment}{// Reconcile between processors: If (e.g. following}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17750}17750               \textcolor{comment}{// distribution/pruning) the mesh has no elements on this}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17751}17751               \textcolor{comment}{// processor) then ignore its contribution to the poll of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17752}17752               \textcolor{comment}{// max/min refinement levels}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17753}17753               \textcolor{keywordtype}{int} int\_local\_min\_ref = local\_min\_ref;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17754}17754               \textcolor{keywordflow}{if} (ref\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17755}17755               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17756}17756                 int\_local\_min\_ref = INT\_MAX;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17757}17757               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17758}17758               \textcolor{keywordtype}{int} int\_min\_ref = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17759}17759               MPI\_Allreduce(\&int\_local\_min\_ref,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17760}17760                             \&int\_min\_ref,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17761}17761                             1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17762}17762                             MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17763}17763                             MPI\_MIN,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17764}17764                             \mbox{\hyperlink{classoomph_1_1Problem_a937afdd0d5a039943482f8be9b24c82e}{Communicator\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17765}17765 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17766}17766               \textcolor{comment}{// Overall min refinement level over all meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17767}17767               \textcolor{keywordtype}{unsigned} min\_ref = unsigned(int\_min\_ref);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17768}17768 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17769}17769               \textcolor{comment}{// Refine as many times as required to get refinement up to}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17770}17770               \textcolor{comment}{// uniform refinement level after last prune}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17771}17771               \textcolor{keywordtype}{unsigned} nref = pruned\_refinement\_level[i\_mesh] -\/ min\_ref;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17772}17772               \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Refining sub-\/mesh "{}} << i\_mesh << \textcolor{stringliteral}{"{} uniformly "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17773}17773                          << nref << \textcolor{stringliteral}{"{} times\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17774}17774               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nref; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17775}17775               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17776}17776                 ref\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_ae238476195a0ceeb2cdb680620fb97a3}{refine\_uniformly}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17777}17777               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17778}17778             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17779}17779           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17780}17780           \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17781}17781           \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17782}17782         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17783}17783 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17784}17784         \textcolor{comment}{// Do actions after adapt}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17785}17785         \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17786}17786 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17787}17787         \textcolor{comment}{// Re-\/assign number of submeshes -\/-\/ when this was first}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17788}17788         \textcolor{comment}{// set, the problem may have had face meshes that have now}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17789}17789         \textcolor{comment}{// disappeared.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17790}17790         n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17791}17791       \} \textcolor{comment}{// if (some\_mesh\_has\_been\_pruned)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17792}17792 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17793}17793 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17794}17794       \textcolor{comment}{// Perform any actions before distribution but now for the new mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17795}17795       \textcolor{comment}{// NOTE: This does NOT replicate the actions\_before\_distribute()}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17796}17796       \textcolor{comment}{// call made above for the previous mesh!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17797}17797       \mbox{\hyperlink{classoomph_1_1Problem_a1d1280f442f9352a614bada21324456d}{actions\_before\_distribute}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17798}17798 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17799}17799       \textcolor{comment}{// Do some book-\/keeping}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17800}17800       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17801}17801 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17802}17802       \textcolor{comment}{// Re-\/assign number of submeshes -\/-\/ when this was first}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17803}17803       \textcolor{comment}{// set, the problem may have had face meshes that have now}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17804}17804       \textcolor{comment}{// disappeared.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17805}17805       n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17806}17806 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17807}17807       \textcolor{comment}{// The submeshes, if they exist, need to know their own element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17808}17808       \textcolor{comment}{// domains.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17809}17809       \textcolor{comment}{// NOTE: This vector only stores the target domains or the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17810}17810       \textcolor{comment}{// element partition for structured meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17811}17811       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<unsigned>}}> submesh\_element\_partition(n\_mesh);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17812}17812       \textcolor{keywordflow}{if} (n\_mesh != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17813}17813       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17814}17814         \textcolor{keywordtype}{unsigned} count = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17815}17815         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17816}17816         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17817}17817           \textcolor{comment}{// Only work with structured meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17818}17818           \textcolor{keywordflow}{if} (!is\_unstructured\_mesh[i\_mesh])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17819}17819           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17820}17820             \textcolor{comment}{// Get the number of element in the mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17821}17821             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nsub\_ele = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17822}17822             submesh\_element\_partition[i\_mesh].resize(nsub\_ele);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17823}17823             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nsub\_ele; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17824}17824             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17825}17825               submesh\_element\_partition[i\_mesh][\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17826}17826                 new\_domain\_for\_base\_element[count++];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17827}17827             \} \textcolor{comment}{// for (e<nsub\_elem)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17828}17828           \} \textcolor{comment}{// if (sub\_mesh\_pt!=0)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17829}17829         \} \textcolor{comment}{// for (i\_mesh<n\_mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17830}17830 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17831}17831 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17832}17832         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nnew\_domain\_for\_base\_element =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17833}17833           new\_domain\_for\_base\_element.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17834}17834         \textcolor{keywordflow}{if} (count != nnew\_domain\_for\_base\_element)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17835}17835         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17836}17836           std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17837}17837           error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17838}17838             << \textcolor{stringliteral}{"{}The number of READ target domains for nonhalo elements\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17839}17839             << \textcolor{stringliteral}{"{} is ("{}} << count << \textcolor{stringliteral}{"{}), but the number of target domains for\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17840}17840             << \textcolor{stringliteral}{"{}nonhalo elements is ("{}} << nnew\_domain\_for\_base\_element}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17841}17841             << \textcolor{stringliteral}{"{})!\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17842}17842           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17843}17843                               \textcolor{stringliteral}{"{}Problem::load\_balance()"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17844}17844                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17845}17845         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17846}17846 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17847}17847 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17848}17848       \} \textcolor{comment}{// if (n\_mesh!=0)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17849}17849 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17850}17850       \textcolor{comment}{// Setup the map between "{}root"{} element and number in global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17851}17851       \textcolor{comment}{// again}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17852}17852 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17853}17853       \textcolor{comment}{// This map is only established for structured meshes, then we}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17854}17854       \textcolor{comment}{// need to check here the type of mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17855}17855       \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17856}17856       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17857}17857         \textcolor{comment}{// Check if the only one mesh is an stuctured mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17858}17858         \textcolor{keywordflow}{if} (!is\_unstructured\_mesh[0])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17859}17859         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17860}17860           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_ele = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17861}17861           \mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}.resize(n\_ele);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17862}17862           \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}.clear();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17863}17863           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_ele; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17864}17864           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17865}17865             \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* el\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17866}17866             \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}[el\_pt] = \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17867}17867             \mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = el\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17868}17868           \} \textcolor{comment}{// for (e<n\_ele)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17869}17869         \} \textcolor{comment}{// if (!is\_triangle\_mesh\_base[0])}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17870}17870       \} \textcolor{comment}{// if (n\_mesh==0)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17871}17871       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17872}17872       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17873}17873         \textcolor{comment}{// If we have submeshes then we only add those elements that}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17874}17874         \textcolor{comment}{// belong to structured meshes, but first compute the number of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17875}17875         \textcolor{comment}{// total elements in the structured sub-\/meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17876}17876         \textcolor{keywordtype}{unsigned} nglobal\_element = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17877}17877         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17878}17878         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17879}17879           \textcolor{comment}{// Check if mesh is an structured mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17880}17880           \textcolor{keywordflow}{if} (!is\_unstructured\_mesh[i\_mesh])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17881}17881           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17882}17882             nglobal\_element += \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17883}17883           \} \textcolor{comment}{// if (!is\_triangle\_mesh\_base[i\_mesh])}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17884}17884         \} \textcolor{comment}{// for (i\_mesh<n\_mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17885}17885 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17886}17886         \textcolor{comment}{// Once computed the number of elements, then resize the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17887}17887         \textcolor{comment}{// structure}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17888}17888         \mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}.resize(nglobal\_element);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17889}17889         \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}.clear();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17890}17890         \textcolor{keywordtype}{unsigned} counter\_base = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17891}17891         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17892}17892         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17893}17893           \textcolor{comment}{// Check if mesh is a structured mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17894}17894           \textcolor{keywordflow}{if} (!is\_unstructured\_mesh[i\_mesh])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17895}17895           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17896}17896             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_ele = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17897}17897             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_ele; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17898}17898             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17899}17899               \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* el\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17900}17900               \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}[el\_pt] = counter\_base + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17901}17901               \mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}[counter\_base] = el\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17902}17902               \textcolor{comment}{// Inrease the global element number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17903}17903               counter\_base++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17904}17904             \} \textcolor{comment}{// for (e<n\_ele)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17905}17905           \} \textcolor{comment}{// if (!is\_triangle\_mesh\_base[i\_mesh])}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17906}17906         \} \textcolor{comment}{// for (i\_mesh<n\_mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17907}17907 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17908}17908 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17909}17909         \textcolor{keywordflow}{if} (counter\_base != nglobal\_element)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17910}17910         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17911}17911           std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17912}17912           error\_stream << \textcolor{stringliteral}{"{}The number of global elements ("{}} << nglobal\_element}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17913}17913                        << \textcolor{stringliteral}{"{}) is not the same as the number of\(\backslash\)nadded elements ("{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17914}17914                        << counter\_base << \textcolor{stringliteral}{"{}) to the Base\_mesh\_element\_pt data "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17915}17915                        << \textcolor{stringliteral}{"{}structure!!!\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17916}17916           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17917}17917                               \textcolor{stringliteral}{"{}Problem::load\_balance()"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17918}17918                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17919}17919         \} \textcolor{comment}{// if (counter\_base != nglobal\_element)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17920}17920 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// \#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17921}17921 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17922}17922       \} \textcolor{comment}{// else if (n\_mesh==0)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17923}17923 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17924}17924       \textcolor{comment}{// Storage for the number of face elements in the base mesh -\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17925}17925       \textcolor{comment}{// element is identified by number of bulk element and face index}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17926}17926       \textcolor{comment}{// so we can reconstruct it if and when the FaceElements have been wiped}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17927}17927       \textcolor{comment}{// in actions\_before\_distribute().}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17928}17928       \textcolor{comment}{// NOTE: Not really clear (any more) why this is required. Typically}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17929}17929       \textcolor{comment}{//       FaceElements get wiped in actions\_before\_distribute() so}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17930}17930       \textcolor{comment}{//       at this point there shouldn't be any of them left.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17931}17931       \textcolor{comment}{//       This is certainly the case in all our currently existing}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17932}17932       \textcolor{comment}{//       test codes. However, I'm too scared to take this out}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17933}17933       \textcolor{comment}{//       in case it does matter (we're not insisting that FaceElements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17934}17934       \textcolor{comment}{//       are always removed in actions\_before\_distribute()...).}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17935}17935       std::map<unsigned, std::map<int, unsigned>> face\_element\_number;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17936}17936       \textcolor{keywordtype}{unsigned} n\_element = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17937}17937       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17938}17938       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17939}17939         \mbox{\hyperlink{classoomph_1_1FaceElement}{FaceElement}}* face\_el\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17940}17940           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1FaceElement}{FaceElement}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a479059b0964826a8cee6eb506b57268a}{finite\_element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17941}17941         \textcolor{keywordflow}{if} (face\_el\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17942}17942         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17943}17943 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17944}17944           std::stringstream info;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17945}17945           info << \textcolor{stringliteral}{"{}================================================\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17946}17946           info << \textcolor{stringliteral}{"{}INFO: I've come across a FaceElement while \(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17947}17947           info << \textcolor{stringliteral}{"{}       load-\/balancing a problem. \(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17948}17948           info << \textcolor{stringliteral}{"{}================================================\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17949}17949           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << info.str() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17950}17950 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17951}17951           \mbox{\hyperlink{classoomph_1_1FiniteElement}{FiniteElement}}* bulk\_elem\_pt = face\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FaceElement_a89e9f7ebc8019c47d54dded72f05479e}{bulk\_element\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17952}17952           \textcolor{keywordtype}{unsigned} e\_bulk = \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}[bulk\_elem\_pt];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17953}17953 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17954}17954           \textcolor{keywordflow}{if} (e\_bulk == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17955}17955           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17956}17956             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Base\_mesh\_element\_number\_plus\_one[...]=0"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17957}17957                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17958}17958                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17959}17959           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17960}17960 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17961}17961           e\_bulk -\/= 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17962}17962           \textcolor{keywordtype}{int} face\_index = face\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FaceElement_a14990bd081523c47cfe57e5ecf54dfe1}{face\_index}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17963}17963           face\_element\_number[e\_bulk][face\_index] = \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17964}17964         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17965}17965       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17966}17966 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17967}17967       \textcolor{comment}{// Distribute the (sub)meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17968}17968       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17969}17969       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<GeneralisedElement*>}} deleted\_element\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17970}17970       \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17971}17971       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17972}17972         \textcolor{comment}{// Only distribute (load balance strategy) if this is an}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17973}17973         \textcolor{comment}{// structured mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17974}17974         \textcolor{keywordflow}{if} (!is\_unstructured\_mesh[0])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17975}17975         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17976}17976 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17977}17977           \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>nelement() != new\_domain\_for\_base\_element.size())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17978}17978           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17979}17979             std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17980}17980             error\_stream << \textcolor{stringliteral}{"{}Distributing one-\/and-\/only mesh containing "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17981}17981                          << \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}() << \textcolor{stringliteral}{"{} elements with info for "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17982}17982                          << new\_domain\_for\_base\_element.size() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17983}17983             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17984}17984                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17985}17985                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17986}17986           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17987}17987 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17988}17988 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17989}17989           \textcolor{keywordflow}{if} (report\_stats)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17990}17990           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17991}17991             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Distributing one and only mesh\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17992}17992                        << \textcolor{stringliteral}{"{}-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17993}17993           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17994}17994 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17995}17995           \textcolor{comment}{// No pre-\/set distribution from restart that may leave some}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17996}17996           \textcolor{comment}{// processors empty so no need to overrule deletion of elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17997}17997           \textcolor{keywordtype}{bool} overrule\_keep\_as\_halo\_element\_status = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17998}17998 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l17999}17999           \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_adeef6d5b1de197aab956025b4b038778}{distribute}}(this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18000}18000                                 new\_domain\_for\_base\_element,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18001}18001                                 deleted\_element\_pt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18002}18002                                 doc\_info,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18003}18003                                 report\_stats,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18004}18004                                 overrule\_keep\_as\_halo\_element\_status);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18005}18005 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18006}18006         \} \textcolor{comment}{// if (!is\_unstructured\_mesh[0])}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18007}18007 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18008}18008       \} \textcolor{comment}{// if (n\_mesh==0)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18009}18009       \textcolor{keywordflow}{else} \textcolor{comment}{// There are submeshes, "{}distribute"{} each one separately}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18010}18010       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18011}18011         \textcolor{comment}{// Rebuild the mesh only if one of the meshes was modified}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18012}18012         \textcolor{keywordtype}{bool} need\_to\_rebuild\_mesh = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18013}18013         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18014}18014         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18015}18015           \textcolor{comment}{// Perform the load balancing based on distribution in the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18016}18016           \textcolor{comment}{// structured meshes only}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18017}18017           \textcolor{keywordflow}{if} (!is\_unstructured\_mesh[i\_mesh])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18018}18018           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18019}18019             \textcolor{keywordflow}{if} (report\_stats)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18020}18020             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18021}18021               \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Distributing submesh "{}} << i\_mesh << \textcolor{stringliteral}{"{} of "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18022}18022                          << n\_mesh << \textcolor{stringliteral}{"{} in total\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18023}18023                          << \textcolor{stringliteral}{"{}-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18024}18024                          << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18025}18025             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18026}18026 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18027}18027             \textcolor{comment}{// Set the doc\_info number to reflect the submesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18028}18028             doc\_info.\mbox{\hyperlink{classoomph_1_1DocInfo_a9d9ce638a7834bbd4961779af426bf13}{number}}() = i\_mesh;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18029}18029 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18030}18030             \textcolor{comment}{// No pre-\/set distribution from restart that may leave some}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18031}18031             \textcolor{comment}{// processors empty so no need to overrule deletion of elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18032}18032             \textcolor{keywordtype}{bool} overrule\_keep\_as\_halo\_element\_status = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18033}18033             \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_adeef6d5b1de197aab956025b4b038778}{distribute}}(this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18034}18034                                         submesh\_element\_partition[i\_mesh],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18035}18035                                         deleted\_element\_pt,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18036}18036                                         doc\_info,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18037}18037                                         report\_stats,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18038}18038                                         overrule\_keep\_as\_halo\_element\_status);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18039}18039 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18040}18040             \textcolor{comment}{// Set the flag to rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18041}18041             need\_to\_rebuild\_mesh = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18042}18042 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18043}18043           \} \textcolor{comment}{// if (!is\_unstructured\_mesh[i\_mesh])}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18044}18044 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18045}18045         \} \textcolor{comment}{// for (i\_mesh<n\_mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18046}18046 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18047}18047         \textcolor{keywordflow}{if} (need\_to\_rebuild\_mesh)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18048}18048         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18049}18049           \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18050}18050           \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18051}18051         \} \textcolor{comment}{// if (need\_to\_rebuild\_mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18052}18052 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18053}18053       \} \textcolor{comment}{// else if (n\_mesh==0)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18054}18054 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18055}18055       \textcolor{comment}{// Null out information associated with deleted elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18056}18056       \textcolor{keywordtype}{unsigned} n\_del = deleted\_element\_pt.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18057}18057       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_del; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18058}18058       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18059}18059         \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* el\_pt = deleted\_element\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18060}18060         \textcolor{keywordtype}{unsigned} old\_el\_number = \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}[el\_pt] -\/ 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18061}18061         \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}[el\_pt] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18062}18062         \mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}[old\_el\_number] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18063}18063       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18064}18064 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18065}18065       \textcolor{comment}{// Has one of the meshes been pruned before distribution? If so}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18066}18066       \textcolor{comment}{// then prune here now}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18067}18067       \textcolor{keywordflow}{if} (some\_mesh\_has\_been\_pruned)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18068}18068       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18069}18069         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<GeneralisedElement*>}} deleted\_element\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18070}18070         \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18071}18071         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18072}18072           \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* ref\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18073}18073             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18074}18074           \textcolor{keywordflow}{if} (ref\_mesh\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18075}18075           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18076}18076             ref\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a80f2372d3d0847d26030df88204acebe}{prune\_halo\_elements\_and\_nodes}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18077}18077               deleted\_element\_pt, doc\_info, report\_stats);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18078}18078           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18079}18079         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18080}18080         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18081}18081         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18082}18082           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18083}18083           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18084}18084             \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* ref\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18085}18085               \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18086}18086             \textcolor{keywordflow}{if} (ref\_mesh\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18087}18087             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18088}18088               ref\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a80f2372d3d0847d26030df88204acebe}{prune\_halo\_elements\_and\_nodes}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18089}18089                 deleted\_element\_pt, doc\_info, report\_stats);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18090}18090             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18091}18091           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18092}18092           \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18093}18093           \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18094}18094         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18095}18095 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18096}18096         \textcolor{comment}{// Null out information associated with deleted elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18097}18097         \textcolor{keywordtype}{unsigned} n\_del = deleted\_element\_pt.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18098}18098         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_del; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18099}18099         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18100}18100           \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* el\_pt = deleted\_element\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18101}18101           \textcolor{keywordtype}{unsigned} old\_el\_number = \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}[el\_pt] -\/ 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18102}18102           \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}[el\_pt] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18103}18103           \mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}[old\_el\_number] = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18104}18104         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18105}18105 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18106}18106         \textcolor{comment}{// Setup the map between "{}root"{} element and number in global mesh again}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18107}18107         \mbox{\hyperlink{classoomph_1_1Problem_ab5f60ebc552c00ee681776bc7fa61203}{setup\_base\_mesh\_info\_after\_pruning}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18108}18108       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18109}18109 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18110}18110       \textcolor{keywordflow}{if} (report\_stats)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18111}18111       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18112}18112         t\_distribute = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18113}18113         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}CPU for build and distribution of new mesh(es): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18114}18114                    << t\_distribute -\/ t\_partition << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18115}18115       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18116}18116 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18117}18117 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18118}18118       \textcolor{comment}{// Send refinement info to other processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18119}18119       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18120}18120 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18121}18121       \textcolor{comment}{// Storage for refinement pattern:  Given ID of root element,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18122}18122       \textcolor{comment}{// root\_element\_id, and current refinement level, level, the e-\/th entry in}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18123}18123       \textcolor{comment}{// refinement\_info\_for\_root\_elements[root\_element\_id][level][e] is equal}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18124}18124 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18125}18125       \textcolor{comment}{// to 2 if the e-\/th element (using the enumeration when the mesh has been}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18126}18126       \textcolor{comment}{// refined to the level-\/th level) is to be refined during the next}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18127}18127       \textcolor{comment}{// refinement; it's 1 if it's not to be refined.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18128}18128       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<Vector<unsigned>}}>> refinement\_info\_for\_root\_elements;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18129}18129 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18130}18130 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18131}18131       \textcolor{comment}{// Send refinement information between processors, using flat-\/packed}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18132}18132       \textcolor{comment}{// information accumulated earlier}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18133}18133       \mbox{\hyperlink{classoomph_1_1Problem_a90e714411f1575e0e39cf0d497287b37}{send\_refinement\_info\_helper}}(old\_domain\_for\_base\_element,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18134}18134                                   new\_domain\_for\_base\_element,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18135}18135                                   max\_refinement\_level\_overall,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18136}18136                                   flat\_packed\_refinement\_info\_for\_root,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18137}18137                                   refinement\_info\_for\_root\_elements);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18138}18138 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18139}18139       \textcolor{comment}{// Refine each mesh based upon refinement information stored for each root}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18140}18140       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18141}18141       \mbox{\hyperlink{classoomph_1_1Problem_ac969abcf440b4f631061e74316391b3a}{refine\_distributed\_base\_mesh}}(refinement\_info\_for\_root\_elements,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18142}18142                                    max\_refinement\_level\_overall);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18143}18143 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18144}18144       \textcolor{keywordflow}{if} (report\_stats)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18145}18145       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18146}18146         t\_refine = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18147}18147         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}CPU for refinement of base mesh: "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18148}18148                    << t\_refine -\/ t\_distribute << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18149}18149       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18150}18150 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18151}18151       \textcolor{comment}{// NOTE: The following two calls are important e.g. when}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18152}18152       \textcolor{comment}{//       FaceElements that resize nodes are attached/detached}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18153}18153       \textcolor{comment}{//       after/before adaptation. If we don't attach them}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18154}18154       \textcolor{comment}{//       on the newly built/refined mesh, there isn't enough}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18155}18155       \textcolor{comment}{//       storage for the nodal values that are sent around}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18156}18156       \textcolor{comment}{//       (in a flat-\/packed format) resulting in total disaster.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18157}18157       \textcolor{comment}{//       So we attach them first, but then immediatly strip}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18158}18158       \textcolor{comment}{//       them out again because the FaceElements themselves}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18159}18159       \textcolor{comment}{//       will have been stripped out before distribution/adaptation.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18160}18160 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18161}18161       \textcolor{comment}{// Do actions after adapt because we have just adapted the mesh.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18162}18162       \mbox{\hyperlink{classoomph_1_1Problem_ada40ec6730506c01109622c8383fe36e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18163}18163 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18164}18164       \textcolor{comment}{// Now strip it back out to get problem into the same state}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18165}18165       \textcolor{comment}{// it was in when data to be sent was recorded.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18166}18166       \mbox{\hyperlink{classoomph_1_1Problem_a6130d5c9a762cdd1569919a601620796}{actions\_before\_adapt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18167}18167 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18168}18168       \textcolor{comment}{// Send the stored values in each root from the old mesh into the new mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18169}18169       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18170}18170       \mbox{\hyperlink{classoomph_1_1Problem_a3e07d0acd3499ac7736fba1841ad1cf2}{send\_data\_to\_be\_sent\_during\_load\_balancing}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18171}18171         send\_n, send\_data, send\_displacement);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18172}18172 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18173}18173       \textcolor{comment}{// If there are unstructured meshes here we perform the load}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18174}18174       \textcolor{comment}{// balancing of those meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18175}18175       \textcolor{keywordflow}{if} (are\_there\_unstructured\_meshes)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18176}18176       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18177}18177         \textcolor{comment}{// Delete any storage of external elements and nodes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18178}18178         this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ab8eb3782046c64ea0e46205917440452}{delete\_all\_external\_storage}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18179}18179 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18180}18180         \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18181}18181         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18182}18182           \textcolor{comment}{// Before doing the load balancing delete the mesh created at}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18183}18183           \textcolor{comment}{// calling build\_mesh(), and restore the pointer to the old}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18184}18184           \textcolor{comment}{// mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18185}18185 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18186}18186           \textcolor{comment}{// It MUST be an unstructured mesh, otherwise we should not be}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18187}18187           \textcolor{comment}{// here}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18188}18188           \textcolor{keywordflow}{if} (is\_unstructured\_mesh[0])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18189}18189           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18190}18190             \textcolor{comment}{// Delete the new created mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18191}18191             \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18192}18192             \textcolor{comment}{// Re-\/assign the pointer to the old mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18193}18193             this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}() = old\_mesh\_pt[0];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18194}18194           \} \textcolor{comment}{// if (is\_unstructured\_mesh[0])}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18195}18195 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18196}18196           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18197}18197           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18198}18198             std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18199}18199             error\_stream << \textcolor{stringliteral}{"{}The only one mesh in the problem is not an "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18200}18200                             \textcolor{stringliteral}{"{}unstructured mesh,\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18201}18201                          << \textcolor{stringliteral}{"{}but the flag 'are\_there\_unstructures\_meshes' ("{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18202}18202                          << are\_there\_unstructured\_meshes}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18203}18203                          << \textcolor{stringliteral}{"{}) was turned on,\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18204}18204                          << \textcolor{stringliteral}{"{}this is weird. Please check for any  condition "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18205}18205                             \textcolor{stringliteral}{"{}that may have\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18206}18206                          << \textcolor{stringliteral}{"{}turned on this flag!!!!\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18207}18207             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18208}18208                                 \textcolor{stringliteral}{"{}Problem::load\_balance()"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18209}18209                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18210}18210           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18211}18211 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18212}18212 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18213}18213           unstructured\_mesh\_pt[0]-\/>load\_balance(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18214}18214             target\_domain\_for\_local\_non\_halo\_element);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18215}18215         \} \textcolor{comment}{// if (n\_mesh == 0)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18216}18216         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18217}18217         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18218}18218           \textcolor{comment}{// Before doing the load balancing delete the meshes created}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18219}18219           \textcolor{comment}{// at calling build\_mesh(), and restore the pointer to the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18220}18220           \textcolor{comment}{// old meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18221}18221           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18222}18222           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18223}18223             \textcolor{keywordflow}{if} (is\_unstructured\_mesh[i\_mesh])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18224}18224             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18225}18225               \textcolor{comment}{// Delete the new created mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18226}18226               \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18227}18227               \textcolor{comment}{// Now point it to nothing}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18228}18228               \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh) = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18229}18229               \textcolor{comment}{// ... and re-\/assign the pointer to the old mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18230}18230               this-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh) = old\_mesh\_pt[i\_mesh];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18231}18231             \} \textcolor{comment}{// if (is\_unstructured\_mesh[i\_mesh])}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18232}18232 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18233}18233           \} \textcolor{comment}{// for (i\_mesh<n\_mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18234}18234 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18235}18235           \textcolor{comment}{// Empty storage for sub-\/meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18236}18236           \textcolor{comment}{// flush\_sub\_meshes();}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18237}18237 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18238}18238           \textcolor{comment}{// Flush the storage for nodes and elements in compound mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18239}18239           \textcolor{comment}{// (they've already been deleted in the sub-\/meshes)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18240}18240           \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a38446e721be2f75a64fdaa025b7c23ad}{flush\_element\_and\_node\_storage}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18241}18241 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18242}18242           \textcolor{comment}{// Now we can procede with the load balancing thing}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18243}18243           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18244}18244           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18245}18245             \textcolor{keywordflow}{if} (is\_unstructured\_mesh[i\_mesh])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18246}18246             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18247}18247               \textcolor{comment}{// Get the number of elements in the "{}i\_mesh"{} (the old one)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18248}18248               \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_element = old\_mesh\_pt[i\_mesh]-\/>nelement();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18249}18249 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18250}18250               \textcolor{comment}{// Perform the load balancing if there are elements in the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18251}18251               \textcolor{comment}{// mesh. We check for this case because the meshes created}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18252}18252               \textcolor{comment}{// from face elements have been cleaned in}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18253}18253               \textcolor{comment}{// "{}actions\_before\_distribute()"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18254}18254               \textcolor{keywordflow}{if} (n\_element > 0 \&\& is\_unstructured\_mesh[i\_mesh])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18255}18255               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18256}18256                 unstructured\_mesh\_pt[i\_mesh]-\/>load\_balance(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18257}18257                   target\_domain\_for\_local\_non\_halo\_element\_submesh[i\_mesh]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18258}18258               \} \textcolor{comment}{// if (n\_element > 0)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18259}18259             \} \textcolor{comment}{// if (is\_unstructured\_mesh[i\_mesh)]}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18260}18260           \} \textcolor{comment}{// for (i\_mesh < n\_mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18261}18261 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18262}18262           \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18263}18263           \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18264}18264 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18265}18265         \} \textcolor{comment}{// else if (n\_mesh == 0)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18266}18266 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18267}18267       \} \textcolor{comment}{// if (are\_there\_unstructured\_meshes)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18268}18268 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18269}18269       \textcolor{keywordflow}{if} (report\_stats)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18270}18270       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18271}18271         t\_copy\_solution = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18272}18272         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}CPU for transferring solution to new mesh(es): "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18273}18273                    << t\_copy\_solution -\/ t\_refine << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18274}18274         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}CPU for load balancing: "{}} << t\_copy\_solution -\/ t\_start}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18275}18275                    << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18276}18276       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18277}18277 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18278}18278       \textcolor{comment}{// Do actions after distribution}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18279}18279       \mbox{\hyperlink{classoomph_1_1Problem_a4d3e3bd312518ca5afef94e169f81c39}{actions\_after\_distribute}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18280}18280 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18281}18281       \textcolor{comment}{// Re-\/assign equation numbers}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18282}18282 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18283}18283       \textcolor{keywordtype}{unsigned} n\_dof = \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18284}18284 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18285}18285       \mbox{\hyperlink{classoomph_1_1Problem_a0df501c6aed60c4938861df776b10119}{assign\_eqn\_numbers}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18286}18286 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18287}18287 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18288}18288       \textcolor{keywordflow}{if} (report\_stats)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18289}18289       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18290}18290         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18291}18291           << \textcolor{stringliteral}{"{}Total number of elements on this processor after load balance: "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18292}18292           << \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18293}18293 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18294}18294         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of non-\/halo elements on this processor after "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18295}18295                       \textcolor{stringliteral}{"{}load balance: "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18296}18296                    << \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9e74e01173bbdf890d0ea1908b22b6ef}{nnon\_halo\_element}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18297}18297       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18298}18298 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18299}18299 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18300}18300       \textcolor{keywordflow}{if} (n\_dof != old\_ndof)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18301}18301       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18302}18302         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18303}18303         error\_stream}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18304}18304           << \textcolor{stringliteral}{"{}Number of dofs in load\_balance() has changed from "{}} << old\_ndof}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18305}18305           << \textcolor{stringliteral}{"{} to "{}} << n\_dof << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18306}18306           << \textcolor{stringliteral}{"{}Check that you've implemented any necessary "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18307}18307              \textcolor{stringliteral}{"{}actions\_before/after\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18308}18308           << \textcolor{stringliteral}{"{}adapt/distribute functions, e.g. to pin redundant pressure dofs"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18309}18309           << \textcolor{stringliteral}{"{} etc.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18310}18310         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18311}18311           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18312}18312       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18313}18313 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18314}18314     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18315}18315 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18316}18316     \textcolor{comment}{// Finally synchronise all dofs to allow halo check to pass}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18317}18317     \mbox{\hyperlink{classoomph_1_1Problem_a5d9a3ba5696a7bcd275223ff16b7392e}{synchronise\_all\_dofs}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18318}18318 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18319}18319     \textcolor{keywordtype}{double} end\_t = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18320}18320     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for load\_balance() [sec]    : "{}} << end\_t -\/ start\_t}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18321}18321                << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18322}18322   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18323}18323 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18324}18324 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18325}18325   \textcolor{comment}{//==========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18326}18326 \textcolor{comment}{  /// Send refinement information between processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18327}18327 \textcolor{comment}{}  \textcolor{comment}{//==========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18328}\mbox{\hyperlink{classoomph_1_1Problem_a90e714411f1575e0e39cf0d497287b37}{18328}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a90e714411f1575e0e39cf0d497287b37}{Problem::send\_refinement\_info\_helper}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18329}18329     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& old\_domain\_for\_base\_element,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18330}18330     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& new\_domain\_for\_base\_element,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18331}18331     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& max\_refinement\_level\_overall,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18332}18332     std::map<\textcolor{keywordtype}{unsigned}, \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}>\& flat\_packed\_refinement\_info\_for\_root,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18333}18333     \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}>>\& refinement\_info\_for\_root\_elements)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18334}18334   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18335}18335     \textcolor{comment}{// Number of processes etc.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18336}18336     \textcolor{keyword}{const} \textcolor{keywordtype}{int} n\_proc = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18337}18337     \textcolor{keyword}{const} \textcolor{keywordtype}{int} my\_rank = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18338}18338 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18339}18339     \textcolor{comment}{// Make space}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18340}18340     \textcolor{keywordtype}{unsigned} n\_base\_element = old\_domain\_for\_base\_element.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18341}18341     refinement\_info\_for\_root\_elements.resize(n\_base\_element);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18342}18342 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18343}18343     \textcolor{comment}{// Make space for list of domains that the refinement info}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18344}18344     \textcolor{comment}{// is to be forwarded to}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18345}18345     std::map<unsigned, Vector<unsigned>> halo\_domain\_of\_haloed\_base\_element;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18346}18346 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18347}18347     \textcolor{comment}{// Find out haloed elements in new, redistributed problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18348}18348     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18349}18349 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18350}18350     \textcolor{comment}{// halo\_domains[e][j] = j-\/th halo domain associated with (haloed) element e}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18351}18351     std::map<unsigned, Vector<unsigned>> halo\_domains;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18352}18352 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18353}18353     \textcolor{comment}{// Loop over sub meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18354}18354     \textcolor{keywordtype}{unsigned} n\_sub\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18355}18355     \textcolor{keywordtype}{unsigned} max\_mesh = std::max(n\_sub\_mesh, \textcolor{keywordtype}{unsigned}(1));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18356}18356     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < max\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18357}18357     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18358}18358       \textcolor{comment}{// Choose the right mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18359}18359       \mbox{\hyperlink{classoomph_1_1Mesh}{Mesh}}* my\_mesh\_pt = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18360}18360       \textcolor{keywordflow}{if} (n\_sub\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18361}18361       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18362}18362         my\_mesh\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18363}18363       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18364}18364       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18365}18365       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18366}18366         my\_mesh\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18367}18367       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18368}18368 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18369}18369       \textcolor{comment}{// Only work with structured meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18370}18370       \mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}* sub\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18371}18371         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18372}18372       \textcolor{keywordflow}{if} (!(sub\_mesh\_pt != 0))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18373}18373       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18374}18374         \textcolor{comment}{// Loop over processors to find haloed elements -\/-\/ need to}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18375}18375         \textcolor{comment}{// send their refinement patterns processors that hold their}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18376}18376         \textcolor{comment}{// halo counterparts!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18377}18377         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < n\_proc; p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18378}18378         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18379}18379           \mbox{\hyperlink{classoomph_1_1Vector}{Vector<GeneralisedElement*>}} haloed\_elem\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18380}18380             my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ae1376f1c2e3e2dbd66b9334992f02ae0}{haloed\_element\_pt}}(p);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18381}18381           \textcolor{keywordtype}{unsigned} nhaloed = haloed\_elem\_pt.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18382}18382           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} h = 0; h < nhaloed; h++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18383}18383           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18384}18384             \textcolor{comment}{// This element must send its refinement information to processor p}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18385}18385             \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}[haloed\_elem\_pt[h]];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18386}18386 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18387}18387             \textcolor{keywordflow}{if} (\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18388}18388             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18389}18389               \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Base\_mesh\_element\_number\_plus\_one[...]=0"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18390}18390                                   OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18391}18391                                   OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18392}18392             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18393}18393 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18394}18394             \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} -\/= 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18395}18395             halo\_domains[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}].push\_back(p);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18396}18396           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18397}18397         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18398}18398       \} \textcolor{comment}{// if (!(sub\_mesh\_pt!=0))}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18399}18399     \} \textcolor{comment}{// for (i\_mesh<max\_mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18400}18400 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18401}18401     \textcolor{comment}{// Accumulate relevant flat-\/packed refinement data to be sent to}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18402}18402     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18403}18403     \textcolor{comment}{// various processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18404}18404     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18405}18405 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18406}18406     \textcolor{comment}{// Map to accumulate unsigned data to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18407}18407     \textcolor{comment}{// (map for sparsity)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18408}18408     std::map<unsigned, Vector<unsigned>> data\_for\_proc;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18409}18409 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18410}18410     \textcolor{comment}{// Number of base elements to be sent to specified domain}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18411}18411     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} nbase\_elements\_for\_proc(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18412}18412 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18413}18413     \textcolor{comment}{// Total number of entries in send vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18414}18414     \textcolor{keywordtype}{unsigned} count = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18415}18415 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18416}18416     \textcolor{comment}{// Loop over all base elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18417}18417     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18418}18418     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_base\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18419}18419     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18420}18420       \textcolor{comment}{// Is it one of mine (i.e. was it a non-\/halo element on this}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18421}18421       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18422}18422       \textcolor{comment}{// processor before re-\/distribution, and do I therefore hold}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18423}18423       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18424}18424       \textcolor{comment}{// refinement information for it)?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18425}18425       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18426}18426       \textcolor{keywordflow}{if} (\textcolor{keywordtype}{int}(old\_domain\_for\_base\_element[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]) == my\_rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18427}18427       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18428}18428         \textcolor{comment}{// Where does it go?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18429}18429         \textcolor{keywordtype}{unsigned} new\_domain = new\_domain\_for\_base\_element[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18430}18430 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18431}18431         \textcolor{comment}{// Keep counting}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18432}18432         nbase\_elements\_for\_proc[new\_domain]++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18433}18433 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18434}18434         \textcolor{comment}{// If it stays local, deal with it here}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18435}18435         \textcolor{keywordflow}{if} (\textcolor{keywordtype}{int}(new\_domain) == my\_rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18436}18436         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18437}18437           \textcolor{comment}{// Record on which other procs/domains the refinement info for}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18438}18438           \textcolor{comment}{// this element is required because it's haloed.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18439}18439           \textcolor{keywordtype}{unsigned} nhalo = halo\_domains[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}].size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18440}18440           halo\_domain\_of\_haloed\_base\_element[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}].resize(nhalo);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18441}18441           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < nhalo; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18442}18442           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18443}18443             halo\_domain\_of\_haloed\_base\_element[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}][j] = halo\_domains[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}][j];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18444}18444           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18445}18445 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18446}18446           \textcolor{comment}{// Provide storage for refinement pattern}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18447}18447           refinement\_info\_for\_root\_elements[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}].resize(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18448}18448             max\_refinement\_level\_overall);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18449}18449 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18450}18450 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18451}18451           \textcolor{comment}{// Get number of additional data sent for check}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18452}18452           \textcolor{keywordtype}{unsigned} n\_additional\_data =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18453}18453             flat\_packed\_refinement\_info\_for\_root[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}].size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18454}18454 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18455}18455 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18456}18456           \textcolor{comment}{// Get number of tree nodes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18457}18457           \textcolor{keywordtype}{unsigned} n\_tree\_nodes = flat\_packed\_refinement\_info\_for\_root[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}][0];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18458}18458 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18459}18459           \textcolor{comment}{// Counter for entries to be processed locally}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18460}18460           \textcolor{keywordtype}{unsigned} local\_count = 1; \textcolor{comment}{// (have already processed zero-\/th entry)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18461}18461 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18462}18462           \textcolor{comment}{// Loop over levels and number of nodes in tree}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18463}18463           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} level = 0; level < max\_refinement\_level\_overall;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18464}18464                level++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18465}18465           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18466}18466             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} ee = 0; ee < n\_tree\_nodes; ee++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18467}18467             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18468}18468               \textcolor{comment}{// Element exists at this level}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18469}18469               \textcolor{keywordflow}{if} (flat\_packed\_refinement\_info\_for\_root[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}][local\_count] == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18470}18470               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18471}18471                 local\_count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18472}18472 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18473}18473                 \textcolor{comment}{// Element should be refined}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18474}18474                 \textcolor{keywordflow}{if} (flat\_packed\_refinement\_info\_for\_root[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}][local\_count] == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18475}18475                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18476}18476                   refinement\_info\_for\_root\_elements[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}][level].push\_back(2);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18477}18477                   local\_count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18478}18478                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18479}18479                 \textcolor{comment}{// Element should not be refined}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18480}18480                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18481}18481                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18482}18482                   refinement\_info\_for\_root\_elements[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}][level].push\_back(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18483}18483                   local\_count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18484}18484                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18485}18485               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18486}18486               \textcolor{comment}{// Element does not exist at this level}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18487}18487               \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18488}18488               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18489}18489                 refinement\_info\_for\_root\_elements[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}][level].push\_back(0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18490}18490                 local\_count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18491}18491               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18492}18492             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18493}18493           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18494}18494 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18495}18495 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18496}18496           \textcolor{keywordflow}{if} (n\_additional\_data != local\_count)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18497}18497           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18498}18498             std::stringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18499}18499             error\_message << \textcolor{stringliteral}{"{}Number of additional data: "{}} << n\_additional\_data}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18500}18500                           << \textcolor{stringliteral}{"{} doesn't match that actually send: "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18501}18501                           << local\_count << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18502}18502             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18503}18503                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18504}18504                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18505}18505           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18506}18506 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18507}18507         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18508}18508         \textcolor{comment}{// Element in question is not one of mine so prepare for sending}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18509}18509         \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18510}18510         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18511}18511         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18512}18512           \textcolor{comment}{// Make space}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18513}18513           \textcolor{keywordtype}{unsigned} current\_size = data\_for\_proc[new\_domain].size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18514}18514           \textcolor{keywordtype}{unsigned} n\_additional\_data =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18515}18515             flat\_packed\_refinement\_info\_for\_root[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}].size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18516}18516           data\_for\_proc[new\_domain].reserve(current\_size + n\_additional\_data +}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18517}18517                                             2);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18518}18518 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18519}18519           \textcolor{comment}{// Keep counting}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18520}18520           count += n\_additional\_data + 2;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18521}18521 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18522}18522           \textcolor{comment}{// Add base element number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18523}18523           data\_for\_proc[new\_domain].push\_back(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18524}18524 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18525}18525 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18526}18526           \textcolor{comment}{// Add number of flat-\/packed instructions to follow}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18527}18527           data\_for\_proc[new\_domain].push\_back(n\_additional\_data);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18528}18528 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18529}18529 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18530}18530           \textcolor{comment}{// Add flat packed refinement data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18531}18531           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_additional\_data; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18532}18532           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18533}18533             data\_for\_proc[new\_domain].push\_back(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18534}18534               flat\_packed\_refinement\_info\_for\_root[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}][j]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18535}18535           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18536}18536         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18537}18537       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18538}18538     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18539}18539 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18540}18540 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18541}18541     \textcolor{comment}{// Now do the actual send/receive}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18542}18542     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18543}18543 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18544}18544     \textcolor{comment}{// Storage for number of data to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18545}18545     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} send\_n(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18546}18546 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18547}18547     \textcolor{comment}{// Storage for all values to be sent to all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18548}18548     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} send\_data;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18549}18549     send\_data.reserve(count);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18550}18550 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18551}18551     \textcolor{comment}{// Start location within send\_data for data to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18552}18552     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} send\_displacement(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18553}18553 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18554}18554     \textcolor{comment}{// Loop over all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18555}18555     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} rank = 0; rank < n\_proc; rank++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18556}18556     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18557}18557       \textcolor{comment}{// Set the offset for the current processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18558}18558       send\_displacement[rank] = send\_data.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18559}18559 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18560}18560       \textcolor{comment}{// Don't bother to do anything if the processor in the loop is the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18561}18561       \textcolor{comment}{// current processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18562}18562       \textcolor{keywordflow}{if} (rank != my\_rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18563}18563       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18564}18564         \textcolor{comment}{// Record how many base elements are to be sent}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18565}18565         send\_data.push\_back(nbase\_elements\_for\_proc[rank]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18566}18566 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18567}18567         \textcolor{comment}{// Add data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18568}18568         \textcolor{keywordtype}{unsigned} n\_data = data\_for\_proc[rank].size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18569}18569         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_data; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18570}18570         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18571}18571           send\_data.push\_back(data\_for\_proc[rank][j]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18572}18572         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18573}18573       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18574}18574 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18575}18575       \textcolor{comment}{// Find the number of data added to the vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18576}18576       send\_n[rank] = send\_data.size() -\/ send\_displacement[rank];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18577}18577     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18578}18578 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18579}18579     \textcolor{comment}{// Storage for the number of data to be received from each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18580}18580     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} receive\_n(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18581}18581 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18582}18582     \textcolor{comment}{// Now send numbers of data to be sent between all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18583}18583     MPI\_Alltoall(\&send\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18584}18584                  1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18585}18585                  MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18586}18586                  \&receive\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18587}18587                  1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18588}18588                  MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18589}18589                  this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18590}18590 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18591}18591     \textcolor{comment}{// We now prepare the data to be received}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18592}18592     \textcolor{comment}{// by working out the displacements from the received data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18593}18593     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} receive\_displacement(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18594}18594     \textcolor{keywordtype}{int} receive\_data\_count = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18595}18595     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} rank = 0; rank < n\_proc; ++rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18596}18596     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18597}18597       \textcolor{comment}{// Displacement is number of data received so far}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18598}18598       receive\_displacement[rank] = receive\_data\_count;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18599}18599       receive\_data\_count += receive\_n[rank];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18600}18600     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18601}18601 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18602}18602     \textcolor{comment}{// Now resize the receive buffer for all data from all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18603}18603     \textcolor{comment}{// Make sure that it has a size of at least one}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18604}18604     \textcolor{keywordflow}{if} (receive\_data\_count == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18605}18605     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18606}18606       ++receive\_data\_count;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18607}18607     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18608}18608     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} receive\_data(receive\_data\_count);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18609}18609 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18610}18610     \textcolor{comment}{// Make sure that the send buffer has size at least one}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18611}18611     \textcolor{comment}{// so that we don't get a segmentation fault}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18612}18612     \textcolor{keywordflow}{if} (send\_data.size() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18613}18613     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18614}18614       send\_data.resize(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18615}18615     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18616}18616 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18617}18617     \textcolor{comment}{// Now send the data between all the processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18618}18618     MPI\_Alltoallv(\&send\_data[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18619}18619                   \&send\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18620}18620                   \&send\_displacement[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18621}18621                   MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18622}18622                   \&receive\_data[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18623}18623                   \&receive\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18624}18624                   \&receive\_displacement[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18625}18625                   MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18626}18626                   this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18627}18627 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18628}18628 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18629}18629     \textcolor{comment}{// Now use the received data to update}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18630}18630     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18631}18631     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} send\_rank = 0; send\_rank < n\_proc; send\_rank++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18632}18632     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18633}18633       \textcolor{comment}{// Don't bother to do anything for the processor corresponding to the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18634}18634       \textcolor{comment}{// current processor or if no data were received from this processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18635}18635       \textcolor{keywordflow}{if} ((send\_rank != my\_rank) \&\& (receive\_n[send\_rank] != 0))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18636}18636       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18637}18637         \textcolor{comment}{// Counter for the data within the large array}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18638}18638         \textcolor{keywordtype}{unsigned} count = receive\_displacement[send\_rank];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18639}18639 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18640}18640         \textcolor{comment}{// Loop over base elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18641}18641         \textcolor{keywordtype}{unsigned} nbase\_element = receive\_data[count];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18642}18642         count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18643}18643         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < nbase\_element; b++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18644}18644         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18645}18645           \textcolor{comment}{//  Get base element number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18646}18646           \textcolor{keywordtype}{unsigned} base\_element\_number = receive\_data[count];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18647}18647           count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18648}18648 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18649}18649           \textcolor{comment}{// Record on which other procs/domains the refinement info for}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18650}18650           \textcolor{comment}{// this element is required because it's haloed.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18651}18651           \textcolor{keywordtype}{unsigned} nhalo = halo\_domains[base\_element\_number].size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18652}18652           halo\_domain\_of\_haloed\_base\_element[base\_element\_number].resize(nhalo);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18653}18653           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < nhalo; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18654}18654           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18655}18655             halo\_domain\_of\_haloed\_base\_element[base\_element\_number][j] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18656}18656               halo\_domains[base\_element\_number][j];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18657}18657           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18658}18658 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18659}18659           \textcolor{comment}{// Provide storage for refinement pattern}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18660}18660           refinement\_info\_for\_root\_elements[base\_element\_number].resize(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18661}18661             max\_refinement\_level\_overall);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18662}18662 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18663}18663           \textcolor{comment}{// Get number of flat-\/packed instructions to follow}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18664}18664           \textcolor{comment}{// (only used for check)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18665}18665 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18666}18666           \textcolor{keywordtype}{unsigned} n\_additional\_data = receive\_data[count];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18667}18667           count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18668}18668 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18669}18669           \textcolor{comment}{// Counter for number of additional data (validation only)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18670}18670           \textcolor{keywordtype}{unsigned} check\_count = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18671}18671 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18672}18672 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18673}18673           \textcolor{comment}{// Get number of tree nodes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18674}18674           \textcolor{keywordtype}{unsigned} n\_tree\_nodes = receive\_data[count];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18675}18675           count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18676}18676 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18677}18677 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18678}18678           check\_count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18679}18679 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18680}18680 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18681}18681           \textcolor{comment}{// Loop over levels and number of nodes in tree}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18682}18682           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} level = 0; level < max\_refinement\_level\_overall;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18683}18683                level++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18684}18684           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18685}18685             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_tree\_nodes; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18686}18686             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18687}18687               \textcolor{comment}{// Element exists at this level}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18688}18688               \textcolor{keywordflow}{if} (receive\_data[count] == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18689}18689               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18690}18690                 count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18691}18691 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18692}18692 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18693}18693                 check\_count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18694}18694 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18695}18695 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18696}18696                 \textcolor{comment}{// Element should be refined}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18697}18697                 \textcolor{keywordflow}{if} (receive\_data[count] == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18698}18698                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18699}18699                   refinement\_info\_for\_root\_elements[base\_element\_number][level]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18700}18700                     .push\_back(2);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18701}18701                   count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18702}18702 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18703}18703 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18704}18704                   check\_count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18705}18705 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18706}18706                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18707}18707                 \textcolor{comment}{// Element should not be refined}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18708}18708                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18709}18709                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18710}18710                   refinement\_info\_for\_root\_elements[base\_element\_number][level]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18711}18711                     .push\_back(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18712}18712                   count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18713}18713 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18714}18714 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18715}18715                   check\_count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18716}18716 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18717}18717                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18718}18718               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18719}18719               \textcolor{comment}{// Element does not exist at this level}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18720}18720               \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18721}18721               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18722}18722                 refinement\_info\_for\_root\_elements[base\_element\_number][level]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18723}18723                   .push\_back(0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18724}18724                 count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18725}18725 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18726}18726 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18727}18727                 check\_count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18728}18728 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18729}18729               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18730}18730             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18731}18731           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18732}18732 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18733}18733 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18734}18734           \textcolor{keywordflow}{if} (n\_additional\_data != check\_count)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18735}18735           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18736}18736             std::stringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18737}18737             error\_message << \textcolor{stringliteral}{"{}Number of additional data: "{}} << n\_additional\_data}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18738}18738                           << \textcolor{stringliteral}{"{} doesn't match that actually send: "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18739}18739                           << check\_count << std::endl;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18740}18740             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18741}18741                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18742}18742                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18743}18743           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18744}18744 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18745}18745         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18746}18746       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18747}18747     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18748}18748 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18749}18749 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18750}18750     \textcolor{comment}{// Now send the fully assembled refinement info to halo elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18751}18751     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18752}18752     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18753}18753       \textcolor{comment}{// Accumulate data to be sent}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18754}18754       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18755}18755 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18756}18756       \textcolor{comment}{// Map to accumulate data to be sent to other procs}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18757}18757       \textcolor{comment}{// (map for sparsity)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18758}18758       std::map<unsigned, Vector<unsigned>> data\_for\_proc;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18759}18759 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18760}18760       \textcolor{comment}{// Number of base elements to be sent to specified domain}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18761}18761       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} nbase\_elements\_for\_proc(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18762}18762 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18763}18763       \textcolor{comment}{// Loop over all haloed root elements and find out which}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18764}18764       \textcolor{comment}{// processors they have haloes on}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18765}18765       \textcolor{keywordflow}{for} (std::map<\textcolor{keywordtype}{unsigned}, \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}>::iterator it =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18766}18766              halo\_domain\_of\_haloed\_base\_element.begin();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18767}18767            it != halo\_domain\_of\_haloed\_base\_element.end();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18768}18768            it++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18769}18769       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18770}18770         \textcolor{comment}{// Get base element number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18771}18771         \textcolor{keywordtype}{unsigned} base\_element\_number = (*it).first;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18772}18772 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18773}18773         \textcolor{comment}{// Loop over target domains}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18774}18774         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} domains = (*it).second;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18775}18775         \textcolor{keywordtype}{unsigned} nd = domains.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18776}18776         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} jd = 0; jd < nd; jd++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18777}18777         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18778}18778           \textcolor{comment}{// Actual number of domain}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18779}18779           \textcolor{keywordtype}{unsigned} d = domains[jd];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18780}18780 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18781}18781           \textcolor{comment}{// Keep counting number of base elemements for domain}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18782}18782           nbase\_elements\_for\_proc[d]++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18783}18783 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18784}18784           \textcolor{comment}{// Write base element number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18785}18785           data\_for\_proc[d].push\_back(base\_element\_number);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18786}18786 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18787}18787           \textcolor{comment}{// Write refinement info in flat-\/packed form}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18788}18788           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} level = 0; level < max\_refinement\_level\_overall;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18789}18789                level++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18790}18790           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18791}18791             \textcolor{comment}{// Number of entries at each level}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18792}18792             \textcolor{keywordtype}{unsigned} n =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18793}18793               refinement\_info\_for\_root\_elements[base\_element\_number][level]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18794}18794                 .size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18795}18795             data\_for\_proc[d].push\_back(n);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18796}18796             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18797}18797             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18798}18798               data\_for\_proc[d].push\_back(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18799}18799                 refinement\_info\_for\_root\_elements[base\_element\_number][level]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18800}18800                                                  [j]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18801}18801             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18802}18802           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18803}18803         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18804}18804       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18805}18805 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18806}18806 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18807}18807       \textcolor{comment}{// Do the actual send}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18808}18808       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18809}18809 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18810}18810       \textcolor{comment}{// Storage for number of data to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18811}18811       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} send\_n(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18812}18812 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18813}18813       \textcolor{comment}{// Storage for all values to be sent to all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18814}18814       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} send\_data;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18815}18815       send\_data.reserve(count);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18816}18816 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18817}18817       \textcolor{comment}{// Start location within send\_data for data to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18818}18818       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} send\_displacement(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18819}18819 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18820}18820       \textcolor{comment}{// Loop over all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18821}18821       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} rank = 0; rank < n\_proc; rank++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18822}18822       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18823}18823         \textcolor{comment}{// Set the offset for the current processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18824}18824         send\_displacement[rank] = send\_data.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18825}18825 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18826}18826         \textcolor{comment}{// Don't bother to do anything if the processor in the loop is the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18827}18827         \textcolor{comment}{// current processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18828}18828         \textcolor{keywordflow}{if} (rank != my\_rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18829}18829         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18830}18830           \textcolor{comment}{// Record how many base elements are to be sent}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18831}18831           send\_data.push\_back(nbase\_elements\_for\_proc[rank]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18832}18832 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18833}18833           \textcolor{comment}{// Add data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18834}18834           \textcolor{keywordtype}{unsigned} n\_data = data\_for\_proc[rank].size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18835}18835           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_data; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18836}18836           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18837}18837             send\_data.push\_back(data\_for\_proc[rank][j]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18838}18838           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18839}18839         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18840}18840         \textcolor{comment}{// Find the number of data added to the vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18841}18841         send\_n[rank] = send\_data.size() -\/ send\_displacement[rank];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18842}18842       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18843}18843 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18844}18844       \textcolor{comment}{// Storage for the number of data to be received from each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18845}18845       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} receive\_n(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18846}18846 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18847}18847       \textcolor{comment}{// Now send numbers of data to be sent between all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18848}18848       MPI\_Alltoall(\&send\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18849}18849                    1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18850}18850                    MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18851}18851                    \&receive\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18852}18852                    1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18853}18853                    MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18854}18854                    this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18855}18855 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18856}18856       \textcolor{comment}{// We now prepare the data to be received}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18857}18857       \textcolor{comment}{// by working out the displacements from the received data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18858}18858       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} receive\_displacement(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18859}18859       \textcolor{keywordtype}{int} receive\_data\_count = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18860}18860       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} rank = 0; rank < n\_proc; ++rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18861}18861       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18862}18862         \textcolor{comment}{// Displacement is number of data received so far}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18863}18863         receive\_displacement[rank] = receive\_data\_count;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18864}18864         receive\_data\_count += receive\_n[rank];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18865}18865       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18866}18866 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18867}18867       \textcolor{comment}{// Now resize the receive buffer for all data from all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18868}18868       \textcolor{comment}{// Make sure that it has a size of at least one}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18869}18869       \textcolor{keywordflow}{if} (receive\_data\_count == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18870}18870       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18871}18871         ++receive\_data\_count;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18872}18872       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18873}18873       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} receive\_data(receive\_data\_count);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18874}18874 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18875}18875       \textcolor{comment}{// Make sure that the send buffer has size at least one}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18876}18876       \textcolor{comment}{// so that we don't get a segmentation fault}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18877}18877       \textcolor{keywordflow}{if} (send\_data.size() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18878}18878       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18879}18879         send\_data.resize(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18880}18880       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18881}18881 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18882}18882       \textcolor{comment}{// Now send the data between all the processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18883}18883       MPI\_Alltoallv(\&send\_data[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18884}18884                     \&send\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18885}18885                     \&send\_displacement[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18886}18886                     MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18887}18887                     \&receive\_data[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18888}18888                     \&receive\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18889}18889                     \&receive\_displacement[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18890}18890                     MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18891}18891                     this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18892}18892 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18893}18893 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18894}18894       \textcolor{comment}{// Now use the received data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18895}18895       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18896}18896       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} send\_rank = 0; send\_rank < n\_proc; send\_rank++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18897}18897       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18898}18898         \textcolor{comment}{// Don't bother to do anything for the processor corresponding to the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18899}18899         \textcolor{comment}{// current processor or if no data were received from this processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18900}18900         \textcolor{keywordflow}{if} ((send\_rank != my\_rank) \&\& (receive\_n[send\_rank] != 0))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18901}18901         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18902}18902           \textcolor{comment}{// Counter for the data within the large array}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18903}18903           \textcolor{keywordtype}{unsigned} count = receive\_displacement[send\_rank];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18904}18904 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18905}18905           \textcolor{comment}{// Read number of base elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18906}18906           \textcolor{keywordtype}{unsigned} nbase\_element = receive\_data[count];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18907}18907           count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18908}18908 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18909}18909           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nbase\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18910}18910           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18911}18911             \textcolor{comment}{// Read base element number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18912}18912             \textcolor{keywordtype}{unsigned} base\_element\_number = receive\_data[count];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18913}18913             count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18914}18914 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18915}18915             \textcolor{comment}{// Provide storage for refinement pattern}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18916}18916             refinement\_info\_for\_root\_elements[base\_element\_number].resize(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18917}18917               max\_refinement\_level\_overall);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18918}18918 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18919}18919             \textcolor{comment}{// Read refinement info in flat-\/packed form}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18920}18920             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} level = 0; level < max\_refinement\_level\_overall;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18921}18921                  level++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18922}18922             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18923}18923               \textcolor{comment}{// Read number of entries at each level}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18924}18924               \textcolor{keywordtype}{unsigned} n = receive\_data[count];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18925}18925               count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18926}18926 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18927}18927               \textcolor{comment}{// Read entries}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18928}18928               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18929}18929               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18930}18930                 refinement\_info\_for\_root\_elements[base\_element\_number][level]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18931}18931                   .push\_back(receive\_data[count]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18932}18932                 count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18933}18933               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18934}18934             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18935}18935           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18936}18936         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18937}18937       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18938}18938     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18939}18939   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18940}18940 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18941}18941   \textcolor{comment}{//==========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18942}18942 \textcolor{comment}{  /// Load balance helper routine: Send data to other}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18943}18943 \textcolor{comment}{  /// processors during load balancing.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18944}18944 \textcolor{comment}{  /// -\/ send\_n: Input, number of data to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18945}18945 \textcolor{comment}{  /// -\/ send\_data: Input, storage for all values to be sent to all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18946}18946 \textcolor{comment}{  /// -\/ send\_displacement: Input, start location within send\_data for data to}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18947}18947 \textcolor{comment}{  ///   be sent to each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18948}18948 \textcolor{comment}{}  \textcolor{comment}{//==========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18949}\mbox{\hyperlink{classoomph_1_1Problem_a3e07d0acd3499ac7736fba1841ad1cf2}{18949}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a3e07d0acd3499ac7736fba1841ad1cf2}{Problem::send\_data\_to\_be\_sent\_during\_load\_balancing}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18950}18950     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}}\& send\_n,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18951}18951     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& send\_data,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18952}18952     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}}\& send\_displacement)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18953}18953   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18954}18954     \textcolor{comment}{// Communicator info}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18955}18955     \mbox{\hyperlink{classoomph_1_1OomphCommunicator}{OomphCommunicator}}* comm\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18956}18956     \textcolor{keyword}{const} \textcolor{keywordtype}{int} n\_proc = comm\_pt-\/>nproc();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18957}18957 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18958}18958     \textcolor{comment}{// Storage for the number of data to be received from each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18959}18959     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} receive\_n(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18960}18960 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18961}18961     \textcolor{comment}{// Now send numbers of data to be sent between all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18962}18962     MPI\_Alltoall(\&send\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18963}18963                  1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18964}18964                  MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18965}18965                  \&receive\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18966}18966                  1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18967}18967                  MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18968}18968                  this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18969}18969 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18970}18970     \textcolor{comment}{// We now prepare the data to be received}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18971}18971     \textcolor{comment}{// by working out the displacements from the received data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18972}18972     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} receive\_displacement(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18973}18973     \textcolor{keywordtype}{int} receive\_data\_count = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18974}18974     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} rank = 0; rank < n\_proc; ++rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18975}18975     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18976}18976       \textcolor{comment}{// Displacement is number of data received so far}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18977}18977       receive\_displacement[rank] = receive\_data\_count;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18978}18978       receive\_data\_count += receive\_n[rank];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18979}18979     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18980}18980 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18981}18981     \textcolor{comment}{// Now resize the receive buffer for all data from all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18982}18982     \textcolor{comment}{// Make sure that it has a size of at least one}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18983}18983     \textcolor{keywordflow}{if} (receive\_data\_count == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18984}18984     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18985}18985       ++receive\_data\_count;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18986}18986     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18987}18987     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} receive\_data(receive\_data\_count);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18988}18988 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18989}18989     \textcolor{comment}{// Make sure that the send buffer has size at least one}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18990}18990     \textcolor{comment}{// so that we don't get a segmentation fault}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18991}18991     \textcolor{keywordflow}{if} (send\_data.size() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18992}18992     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18993}18993       send\_data.resize(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18994}18994     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18995}18995 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18996}18996     \textcolor{comment}{// Now send the data between all the processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18997}18997     MPI\_Alltoallv(\&send\_data[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18998}18998                   \&send\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l18999}18999                   \&send\_displacement[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19000}19000                   MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19001}19001                   \&receive\_data[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19002}19002                   \&receive\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19003}19003                   \&receive\_displacement[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19004}19004                   MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19005}19005                   this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19006}19006 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19007}19007     \textcolor{keywordtype}{unsigned} el\_count = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19008}19008 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19009}19009     \textcolor{comment}{// Only do each node once}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19010}19010     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<std::map<Node*, bool>}}> node\_done(n\_proc);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19011}19011 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19012}19012     \textcolor{comment}{// Now use the received data to update the halo nodes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19013}19013     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} send\_rank = 0; send\_rank < n\_proc; send\_rank++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19014}19014     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19015}19015       \textcolor{comment}{// Don't bother to do anything if no data were received from this}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19016}19016       \textcolor{comment}{// processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19017}19017       \textcolor{comment}{// NOTE: We do have to loop over our own processor number to process}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19018}19018       \textcolor{comment}{//       the data locally.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19019}19019       \textcolor{keywordflow}{if} (receive\_n[send\_rank] != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19020}19020       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19021}19021         \textcolor{comment}{// Counter for the data within the large array}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19022}19022         \textcolor{keywordtype}{unsigned} count = receive\_displacement[send\_rank];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19023}19023 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19024}19024         \textcolor{comment}{// How many batches are there for current rank}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19025}19025         \textcolor{keywordtype}{unsigned} nbatch = unsigned(receive\_data[count]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19026}19026         count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19027}19027 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19028}19028         \textcolor{comment}{// Loop over batches (containing leaves associated with root elements)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19029}19029         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < nbatch; b++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19030}19030         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19031}19031           \textcolor{comment}{// How many elements were received for this batch?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19032}19032           \textcolor{keywordtype}{unsigned} nel = unsigned(receive\_data[count]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19033}19033           count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19034}19034 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19035}19035           \textcolor{comment}{// Get the unique base/root element number of this batch}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19036}19036           \textcolor{comment}{// in unrefined mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19037}19037           \textcolor{keywordtype}{unsigned} base\_el\_no = unsigned(receive\_data[count]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19038}19038           count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19039}19039 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19040}19040           \textcolor{comment}{// Get pointer to base/root element from reverse lookup scheme}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19041}19041           \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* root\_el\_pt = \mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}[base\_el\_no];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19042}19042 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19043}19043           \textcolor{comment}{// Vector for pointers to associated elements in batch}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19044}19044           \mbox{\hyperlink{classoomph_1_1Vector}{Vector<GeneralisedElement*>}} batch\_el\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19045}19045 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19046}19046           \textcolor{comment}{// Is it a refineable element?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19047}19047           \mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}* ref\_root\_el\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19048}19048             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(root\_el\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19049}19049           \textcolor{keywordflow}{if} (ref\_root\_el\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19050}19050           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19051}19051             \textcolor{comment}{// Get all leaves associated with this base/root element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19052}19052             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Tree*>}} all\_leaf\_nodes\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19053}19053             ref\_root\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_a4b783f4e5b6aeed83d49e478510d614f}{tree\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Tree_accfbeb9178ce92a8a51e3a15293a86d1}{stick\_leaves\_into\_vector}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19054}19054               all\_leaf\_nodes\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19055}19055 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19056}19056             \textcolor{comment}{// How many leaves are there?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19057}19057             \textcolor{keywordtype}{unsigned} n\_leaf = all\_leaf\_nodes\_pt.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19058}19058 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19059}19059 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19060}19060             \textcolor{keywordflow}{if} (n\_leaf != nel)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19061}19061             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19062}19062               std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19063}19063               error\_message}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19064}19064                 << \textcolor{stringliteral}{"{}Number of leaves: "{}} << n\_leaf << \textcolor{stringliteral}{"{} "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19065}19065                 << \textcolor{stringliteral}{"{} doesn't match number of elements sent in batch: "{}} << nel}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19066}19066                 << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19067}19067               \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19068}19068                                   OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19069}19069                                   OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19070}19070             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19071}19071 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19072}19072 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19073}19073             \textcolor{comment}{// Loop over batch of elements associated with this base/root}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19074}19074             \textcolor{comment}{// element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19075}19075             batch\_el\_pt.resize(n\_leaf);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19076}19076             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_leaf; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19077}19077             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19078}19078               batch\_el\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = all\_leaf\_nodes\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>object\_pt();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19079}19079             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19080}19080           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19081}19081           \textcolor{comment}{// Not refineable -\/-\/ the batch contains just the root element itself}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19082}19082           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19083}19083           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19084}19084 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19085}19085             \textcolor{keywordflow}{if} (1 != nel)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19086}19086             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19087}19087               std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19088}19088               error\_message}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19089}19089                 << \textcolor{stringliteral}{"{}Non-\/refineable root element should only be associated with"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19090}19090                 << \textcolor{stringliteral}{"{} one element but nel="{}} << nel << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19091}19091               \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19092}19092                                   OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19093}19093                                   OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19094}19094             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19095}19095 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19096}19096             batch\_el\_pt.push\_back(root\_el\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19097}19097           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19098}19098 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19099}19099           \textcolor{comment}{// Now loop  over all elements in batch}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19100}19100           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nel; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19101}19101           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19102}19102             \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* el\_pt = batch\_el\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19103}19103             el\_count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19104}19104 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19105}19105             \textcolor{comment}{// FE?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19106}19106             \mbox{\hyperlink{classoomph_1_1FiniteElement}{FiniteElement}}* fe\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1FiniteElement}{FiniteElement}}*\textcolor{keyword}{>}(el\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19107}19107             \textcolor{keywordflow}{if} (fe\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19108}19108             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19109}19109               \textcolor{comment}{// Loop over nodes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19110}19110               \textcolor{keywordtype}{unsigned} nnod = fe\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a6219ed269a6d89b5aa14659cce48905a}{nnode}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19111}19111               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < nnod; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19112}19112               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19113}19113                 \mbox{\hyperlink{classoomph_1_1Node}{Node}}* nod\_pt = fe\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19114}19114                 \textcolor{keywordflow}{if} (!node\_done[send\_rank][nod\_pt])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19115}19115                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19116}19116                   node\_done[send\_rank][nod\_pt] = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19117}19117 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19118}19118 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19119}19119                   \textcolor{comment}{// Read number of values (as double) to allow for resizing}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19120}19120                   \textcolor{comment}{// before read (req'd in case we store data that}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19121}19121                   \textcolor{comment}{// got introduced by attaching FaceElements to bulk)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19122}19122                   \textcolor{keywordtype}{unsigned} nval = unsigned(receive\_data[count]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19123}19123                   count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19124}19124 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19125}19125 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19126}19126                   \textcolor{comment}{// Does the size match?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19127}19127                   \textcolor{keywordflow}{if} (nval < nod\_pt-\/>nvalue())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19128}19128                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19129}19129                     std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19130}19130                     error\_message}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19131}19131                       << \textcolor{stringliteral}{"{}Node has more values, namely "{}} << nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7e67fc78a2e8a2fd6eb75bd292d42ff8}{nvalue}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19132}19132                       << \textcolor{stringliteral}{"{}, than we're about to receive, namely "{}} << nval}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19133}19133                       << \textcolor{stringliteral}{"{}. Something's wrong!\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19134}19134                     \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19135}19135                                         OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19136}19136                                         OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19137}19137                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19138}19138 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19139}19139 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19140}19140 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19141}19141 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19142}19142                   \textcolor{comment}{// Check if it's been sent as a boundary node}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19143}19143                   \textcolor{keywordtype}{unsigned} is\_boundary\_node = unsigned(receive\_data[count]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19144}19144                   count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19145}19145 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19146}19146 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19147}19147                   \textcolor{comment}{// Check if it's actually a boundary node}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19148}19148                   \mbox{\hyperlink{classoomph_1_1BoundaryNodeBase}{BoundaryNodeBase}}* bnod\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19149}19149                     \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1BoundaryNodeBase}{BoundaryNodeBase}}*\textcolor{keyword}{>}(nod\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19150}19150                   \textcolor{keywordflow}{if} (bnod\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19151}19151                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19152}19152 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19153}19153                     \textcolor{comment}{// Check if local and received status are consistent}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19154}19154                     \textcolor{keywordflow}{if} (is\_boundary\_node != 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19155}19155                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19156}19156                       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19157}19157                       error\_message << \textcolor{stringliteral}{"{}Local node is boundary node but "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19158}19158                                        \textcolor{stringliteral}{"{}information sent is\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19159}19159                                     << \textcolor{stringliteral}{"{}for non-\/boundary node\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19160}19160                       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19161}19161                                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19162}19162                                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19163}19163                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19164}19164 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19165}19165 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19166}19166                     \textcolor{comment}{// Do we have entries in the map?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19167}19167                     \textcolor{keywordtype}{unsigned} n\_entry = unsigned(receive\_data[count]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19168}19168                     count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19169}19169                     \textcolor{keywordflow}{if} (n\_entry > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19170}19170                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19171}19171                       \textcolor{comment}{// Create storage, if it doesn't already exist, for the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19172}19172                       \textcolor{comment}{// map that will contain the position of the first entry}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19173}19173                       \textcolor{comment}{// of this face element's additional values,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19174}19174                       \textcolor{keywordflow}{if} (}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19175}19175                         bnod\_pt}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19176}19176                           -\/>index\_of\_first\_value\_assigned\_by\_face\_element\_pt() ==}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19177}19177                         0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19178}19178                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19179}19179                         bnod\_pt}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19180}19180                           -\/>\mbox{\hyperlink{classoomph_1_1BoundaryNodeBase_a5f73c54dbb9bdfe3538b61117a0cc674}{index\_of\_first\_value\_assigned\_by\_face\_element\_pt}}() =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19181}19181                           \textcolor{keyword}{new} std::map<unsigned, unsigned>;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19182}19182                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19183}19183 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19184}19184                       \textcolor{comment}{// Get pointer to the map of indices associated with}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19185}19185                       \textcolor{comment}{// additional values created by face elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19186}19186                       std::map<unsigned, unsigned>* map\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19187}19187                         bnod\_pt}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19188}19188                           -\/>\mbox{\hyperlink{classoomph_1_1BoundaryNodeBase_a5f73c54dbb9bdfe3538b61117a0cc674}{index\_of\_first\_value\_assigned\_by\_face\_element\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19189}19189 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19190}19190                       \textcolor{comment}{// Loop over number of entries in map}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19191}19191                       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_entry; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19192}19192                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19193}19193                         \textcolor{comment}{// Read out pairs...}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19194}19194                         \textcolor{keywordtype}{unsigned} first = unsigned(receive\_data[count]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19195}19195                         count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19196}19196                         \textcolor{keywordtype}{unsigned} second = unsigned(receive\_data[count]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19197}19197                         count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19198}19198 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19199}19199                         \textcolor{comment}{// ...and assign}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19200}19200                         (*map\_pt)[first] = second;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19201}19201                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19202}19202                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19203}19203                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19204}19204 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19205}19205                   \textcolor{comment}{// Not a boundary node}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19206}19206                   \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19207}19207                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19208}19208                     \textcolor{comment}{// Check if local and received status are consistent}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19209}19209                     \textcolor{keywordflow}{if} (is\_boundary\_node != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19210}19210                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19211}19211                       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19212}19212                       error\_message << \textcolor{stringliteral}{"{}Local node is not a boundary node but "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19213}19213                                        \textcolor{stringliteral}{"{}information \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19214}19214                                     << \textcolor{stringliteral}{"{}sent is for boundary node.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19215}19215                       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19216}19216                                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19217}19217                                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19218}19218                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19219}19219                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19220}19220 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19221}19221 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19222}19222                   \textcolor{comment}{// Do we have to resize? This can happen if node was}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19223}19223                   \textcolor{comment}{// resized (due to a FaceElement that hasn't been attached}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19224}19224                   \textcolor{comment}{// yet here) when the send data was written. If so make space}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19225}19225                   \textcolor{comment}{// for the data here}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19226}19226                   \textcolor{keywordflow}{if} (nval > nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7e67fc78a2e8a2fd6eb75bd292d42ff8}{nvalue}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19227}19227                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19228}19228                     nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_ae6598da29d403889020ccd47a2c07cc4}{resize}}(nval);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19229}19229                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19230}19230 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19231}19231                   \textcolor{comment}{// Now read the actual values}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19232}19232                   nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_accb033ab8ed4f96331014f7c4cd131f9}{read\_values\_from\_vector}}(receive\_data, count);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19233}19233                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19234}19234               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19235}19235             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19236}19236 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19237}19237             \textcolor{comment}{// Now add internal data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19238}19238             el\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_af4db27d80c24979a9cb822203ff77557}{read\_internal\_data\_values\_from\_vector}}(receive\_data, count);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19239}19239           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19240}19240         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19241}19241       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19242}19242     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19243}19243 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19244}19244     \textcolor{comment}{// Now that this is done, we need to synchronise dofs to get}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19245}19245     \textcolor{comment}{// the halo element and node values correct}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19246}19246     \textcolor{keywordtype}{bool} do\_halos = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19247}19247     \textcolor{keywordtype}{bool} do\_external\_halos = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19248}19248     this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a1ccef4e26a7788424780da7555cdc772}{synchronise\_dofs}}(do\_halos, do\_external\_halos);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19249}19249 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19250}19250     \textcolor{comment}{// Now rebuild global mesh if required}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19251}19251     \textcolor{keywordtype}{unsigned} n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19252}19252     \textcolor{keywordflow}{if} (n\_mesh != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19253}19253     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19254}19254       \textcolor{keywordtype}{bool} do\_halos = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19255}19255       \textcolor{keywordtype}{bool} do\_external\_halos = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19256}19256       this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a1ccef4e26a7788424780da7555cdc772}{synchronise\_dofs}}(do\_halos, do\_external\_halos);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19257}19257       \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19258}19258     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19259}19259   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19260}19260 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19261}19261 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19262}19262   \textcolor{comment}{//==========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19263}19263 \textcolor{comment}{  /// Load balance helper routine: Get data to be sent to other}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19264}19264 \textcolor{comment}{  /// processors during load balancing and other information about}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19265}19265 \textcolor{comment}{  /// re-\/distribution.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19266}19266 \textcolor{comment}{  /// -\/ target\_domain\_for\_local\_non\_halo\_element: Input, generated by METIS.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19267}19267 \textcolor{comment}{  ///   target\_domain\_for\_local\_non\_halo\_element[e] contains the number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19268}19268 \textcolor{comment}{  ///   of the domain [0,1,...,nproc-\/1] to which non-\/halo element e on THE}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19269}19269 \textcolor{comment}{  ///   CURRENT PROCESSOR ONLY has been assigned. The order of the non-\/halo}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19270}19270 \textcolor{comment}{  ///   elements is the same as in the Problem's mesh, with the halo}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19271}19271 \textcolor{comment}{  ///   elements being skipped.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19272}19272 \textcolor{comment}{  /// -\/ send\_n: Output, number of data to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19273}19273 \textcolor{comment}{  /// -\/ send\_data: Output, storage for all values to be sent to all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19274}19274 \textcolor{comment}{  /// -\/ send\_displacement: Output, start location within send\_data for data to}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19275}19275 \textcolor{comment}{  ///   be sent to each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19276}19276 \textcolor{comment}{  /// -\/ max\_refinement\_level\_overall: Output, max. refinement level of any}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19277}19277 \textcolor{comment}{  ///   element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19278}19278 \textcolor{comment}{}  \textcolor{comment}{//==========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19279}\mbox{\hyperlink{classoomph_1_1Problem_ad150d0fa8f2e2ccff79f8ecd78cc1343}{19279}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ad150d0fa8f2e2ccff79f8ecd78cc1343}{Problem::get\_data\_to\_be\_sent\_during\_load\_balancing}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19280}19280     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& target\_domain\_for\_local\_non\_halo\_element,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19281}19281     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}}\& send\_n,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19282}19282     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& send\_data,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19283}19283     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}}\& send\_displacement,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19284}19284     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& old\_domain\_for\_base\_element,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19285}19285     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& new\_domain\_for\_base\_element,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19286}19286     \textcolor{keywordtype}{unsigned}\& max\_refinement\_level\_overall)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19287}19287   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19288}19288     \textcolor{comment}{// Communicator info}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19289}19289     \mbox{\hyperlink{classoomph_1_1OomphCommunicator}{OomphCommunicator}}* comm\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19290}19290     \textcolor{keyword}{const} \textcolor{keywordtype}{int} n\_proc = comm\_pt-\/>nproc();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19291}19291     \textcolor{keyword}{const} \textcolor{keywordtype}{int} my\_rank = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19292}19292 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19293}19293     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19294}19294     \textcolor{comment}{// Overall strategy: Loop over all elements (in structured meshes),}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19295}19295     \textcolor{comment}{// identify their corresponding root elements and move all associated}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19296}19296     \textcolor{comment}{// leaves together, collecting the leaves in batches.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19297}19297     \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19298}19298 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19299}19299     \textcolor{comment}{// Map to store whether the root element has been visited yet}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19300}19300     std::map<RefineableElement*, bool> root\_el\_done;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19301}19301 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19302}19302 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19303}19303 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19304}19304     \textcolor{comment}{// Map for checking if all elements associated with same root}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19305}19305     \textcolor{comment}{// have the same target processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19306}19306     std::map<RefineableElement*, unsigned> target\_plus\_one\_for\_root;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19307}19307 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19308}19308 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19309}19309 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19310}19310     \textcolor{comment}{// Storage for maximum refinement level}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19311}19311     \textcolor{keywordtype}{unsigned} max\_refinement\_level = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19312}19312 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19313}19313     \textcolor{comment}{// Storage for (vector of) elements associated with target domain}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19314}19314     \textcolor{comment}{// (stored in map for sparsity): element\_for\_processor[d][e] is pointer}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19315}19315     \textcolor{comment}{// to e-\/th element that's supposed to move onto processor (domain) d.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19316}19316     std::map<unsigned, Vector<GeneralisedElement*>> element\_for\_processor;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19317}19317 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19318}19318     \textcolor{comment}{// Storage for the number of elements in a specified batch of leaf}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19319}19319     \textcolor{comment}{// elements, all of which are associated with the same root/base element:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19320}19320     \textcolor{comment}{// nelement\_batch\_for\_processor[d][j] is the number of (leaf)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19321}19321     \textcolor{comment}{// elements (all associated with the same root) to be moved together to}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19322}19322     \textcolor{comment}{// domain/processor d, in the j-\/th batch of elements.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19323}19323     std::map<unsigned, Vector<unsigned>> nelement\_batch\_for\_processor;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19324}19324 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19325}19325     \textcolor{comment}{// Storage for the unique number of the root element (in the unrefined}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19326}19326     \textcolor{comment}{// base mesh) whose leaves are moved together in a batch:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19327}19327     \textcolor{comment}{// base\_element\_for\_element\_batch\_for\_processo[d][j] is the number of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19328}19328     \textcolor{comment}{// unique number of the root element (in the unrefined}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19329}19329     \textcolor{comment}{// base mesh) of all leaf elements (associated with that root),}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19330}19330     \textcolor{comment}{// to be moved together to domain/processor d, in the j-\/th batch of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19331}19331     \textcolor{comment}{// elements.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19332}19332     std::map<unsigned, Vector<unsigned>>}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19333}19333       base\_element\_for\_element\_batch\_for\_processor;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19334}19334 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19335}19335     \textcolor{comment}{// Record old and new domains for non-\/halo root elements (will be}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19336}19336     \textcolor{comment}{// communicated globally). Initialise to -\/1 so we can use max}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19337}19337     \textcolor{comment}{// to extract the right one via MPI\_Allreduce.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19338}19338     \textcolor{comment}{// NOTE: We communicate these globally to facilitate distribution}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19339}19339     \textcolor{comment}{//       of refinement pattern. While the data itself can be}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19340}19340     \textcolor{comment}{//       sent point-\/to-\/point for non-\/halo elements,}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19341}19341     \textcolor{comment}{//       mesh refinement information also needs to be sent for}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19342}19342     \textcolor{comment}{//       halo elements which aren't known yet.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19343}19343     \textcolor{keywordtype}{unsigned} n\_base\_element = \mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19344}19344     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} old\_domain\_for\_base\_element\_local(n\_base\_element, -\/1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19345}19345     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} new\_domain\_for\_base\_element\_local(n\_base\_element, -\/1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19346}19346 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19347}19347     \textcolor{comment}{// Loop over all non-\/halo elements on current processor and identify roots}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19348}19348     \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19349}19349     \textcolor{comment}{// All leaf elements in associated tree (must!) get moved together}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19350}19350     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19351}19351     \textcolor{keywordtype}{unsigned} count\_non\_halo\_el = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19352}19352     \textcolor{comment}{// Get the number of submeshs, if there are no submeshes, then}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19353}19353     \textcolor{comment}{// increase the counter so that the loop below also work for the only}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19354}19354     \textcolor{comment}{// one mesh in the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19355}19355     \textcolor{keywordtype}{unsigned} n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19356}19356     \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19357}19357     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19358}19358       n\_mesh = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19359}19359     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19360}19360     \textcolor{comment}{// We need to know if there are structure meshes (with elements) as}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19361}19361     \textcolor{comment}{// part of the problem in order to perform (or not) the proper}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19362}19362     \textcolor{comment}{// communications}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19363}19363     \textcolor{keywordtype}{bool} are\_there\_structured\_meshes = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19364}19364     \textcolor{comment}{// Go for the nonhalo elements only in the TreeBaseMeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19365}19365     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19366}19366     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19367}19367       \textcolor{comment}{// Only work with structured meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19368}19368       \mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}* sub\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19369}19369         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19370}19370       \textcolor{keywordflow}{if} (!(sub\_mesh\_pt != 0))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19371}19371       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19372}19372         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nele = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19373}19373         \textcolor{keywordflow}{if} (nele > 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19374}19374         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19375}19375           \textcolor{comment}{// Change the flag to indicate that there are structured meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19376}19376           \textcolor{comment}{// (with elements, because we may have meshes with face}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19377}19377           \textcolor{comment}{// elements and therefore zero elements at this point)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19378}19378           are\_there\_structured\_meshes = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19379}19379         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19380}19380 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19381}19381         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nele; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19382}19382         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19383}19383           \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* el\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19384}19384           \textcolor{keywordflow}{if} (!el\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a0d9869eaf7d6e104c1e465b0d3cd6a9b}{is\_halo}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19385}19385           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19386}19386             \textcolor{comment}{// New non-\/halo: Where is this element supposed to go to?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19387}19387             \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19388}19388             \textcolor{keywordtype}{unsigned} target\_domain =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19389}19389               target\_domain\_for\_local\_non\_halo\_element[count\_non\_halo\_el];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19390}19390 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19391}19391             \textcolor{comment}{// Bump up counter for non-\/halo elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19392}19392             count\_non\_halo\_el++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19393}19393 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19394}19394             \textcolor{comment}{// Is it a root element? (It is, trivially, if it's not refineable)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19395}19395             \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19396}19396             \mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}* ref\_el\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19397}19397               \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(el\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19398}19398             \textcolor{keywordflow}{if} (ref\_el\_pt == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19399}19399             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19400}19400               \textcolor{comment}{// Not refineable so add element itself}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19401}19401               element\_for\_processor[target\_domain].push\_back(el\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19402}19402 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19403}19403               \textcolor{comment}{// Number of elements associated with this root/base}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19404}19404               \textcolor{comment}{// element (just the element itself)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19405}19405               nelement\_batch\_for\_processor[target\_domain].push\_back(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19406}19406 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19407}19407               \textcolor{comment}{// This is the unique base/root element number in unrefined mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19408}19408               \textcolor{keywordtype}{unsigned} element\_number\_in\_base\_mesh =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19409}19409                 \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}[el\_pt];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19410}19410 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19411}19411               \textcolor{keywordflow}{if} (element\_number\_in\_base\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19412}19412               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19413}19413                 \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Base\_mesh\_element\_number\_plus\_one[...]=0"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19414}19414                                     OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19415}19415                                     OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19416}19416               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19417}19417 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19418}19418               element\_number\_in\_base\_mesh -\/= 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19419}19419               base\_element\_for\_element\_batch\_for\_processor[target\_domain]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19420}19420                 .push\_back(element\_number\_in\_base\_mesh);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19421}19421 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19422}19422 \textcolor{comment}{              /// Where do I come from, where do I go to?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19423}19423 \textcolor{comment}{}              old\_domain\_for\_base\_element\_local[element\_number\_in\_base\_mesh] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19424}19424                 my\_rank;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19425}19425               new\_domain\_for\_base\_element\_local[element\_number\_in\_base\_mesh] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19426}19426                 target\_domain;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19427}19427             \} \textcolor{comment}{// if (ref\_el\_pt==0)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19428}19428             \textcolor{comment}{// It's not a root element so we package its leaves into a batch}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19429}19429             \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19430}19430             \textcolor{comment}{// of elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19431}19431             \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19432}19432             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19433}19433             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19434}19434               \textcolor{comment}{// Get the root element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19435}19435               \mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}* root\_el\_pt = ref\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_a8bbcee798e87bd7e5d88273c71500f76}{root\_element\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19436}19436 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19437}19437               \textcolor{comment}{// Has this root been visited yet?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19438}19438               \textcolor{keywordflow}{if} (!root\_el\_done[root\_el\_pt])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19439}19439               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19440}19440                 \textcolor{comment}{// Now we've done it}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19441}19441                 root\_el\_done[root\_el\_pt] = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19442}19442 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19443}19443                 \textcolor{comment}{// Unique number of root element in base mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19444}19444                 \textcolor{keywordtype}{unsigned} element\_number\_in\_base\_mesh =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19445}19445                   \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}[root\_el\_pt];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19446}19446 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19447}19447                 \textcolor{keywordflow}{if} (element\_number\_in\_base\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19448}19448                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19449}19449                   \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19450}19450                     \textcolor{stringliteral}{"{}Base\_mesh\_element\_number\_plus\_one[...]=0"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19451}19451                     OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19452}19452                     OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19453}19453                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19454}19454 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19455}19455                 element\_number\_in\_base\_mesh -\/= 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19456}19456 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19457}19457 \textcolor{comment}{                /// Where do I come from, where do I go to?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19458}19458 \textcolor{comment}{}                old\_domain\_for\_base\_element\_local[element\_number\_in\_base\_mesh] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19459}19459                   my\_rank;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19460}19460                 new\_domain\_for\_base\_element\_local[element\_number\_in\_base\_mesh] =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19461}19461                   target\_domain;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19462}19462 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19463}19463 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19464}19464                 \textcolor{comment}{// Store target domain associated with this root element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19465}19465                 \textcolor{comment}{// (offset by one) to allow checking that all elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19466}19466                 \textcolor{comment}{// with the same root move to the same processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19467}19467                 target\_plus\_one\_for\_root[root\_el\_pt] = target\_domain + 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19468}19468 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19469}19469 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19470}19470                 \textcolor{comment}{// Package all leaves into batch of elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19471}19471                 \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Tree*>}} all\_leaf\_nodes\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19472}19472                 root\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_a4b783f4e5b6aeed83d49e478510d614f}{tree\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Tree_accfbeb9178ce92a8a51e3a15293a86d1}{stick\_leaves\_into\_vector}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19473}19473                   all\_leaf\_nodes\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19474}19474 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19475}19475                 \textcolor{comment}{// Number of leaves}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19476}19476                 \textcolor{keywordtype}{unsigned} n\_leaf = all\_leaf\_nodes\_pt.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19477}19477 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19478}19478                 \textcolor{comment}{// Number of elements associated with this root/base element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19479}19479                 \textcolor{comment}{// (all the leaves)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19480}19480                 nelement\_batch\_for\_processor[target\_domain].push\_back(n\_leaf);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19481}19481 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19482}19482                 \textcolor{comment}{// Store the unique base/root element number in unrefined mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19483}19483                 base\_element\_for\_element\_batch\_for\_processor[target\_domain]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19484}19484                   .push\_back(element\_number\_in\_base\_mesh);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19485}19485 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19486}19486                 \textcolor{comment}{// Loop over leaves}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19487}19487                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_leaf = 0; i\_leaf < n\_leaf; i\_leaf++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19488}19488                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19489}19489                   \textcolor{comment}{// Add element object at leaf}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19490}19490                   \mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}* leaf\_el\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19491}19491                     all\_leaf\_nodes\_pt[i\_leaf]-\/>object\_pt();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19492}19492                   element\_for\_processor[target\_domain].push\_back(leaf\_el\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19493}19493 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19494}19494                   \textcolor{comment}{// Monitor/update maximum refinement level}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19495}19495                   \textcolor{keywordtype}{unsigned} level = all\_leaf\_nodes\_pt[i\_leaf]-\/>level();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19496}19496                   \textcolor{keywordflow}{if} (level > max\_refinement\_level)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19497}19497                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19498}19498                     max\_refinement\_level = level;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19499}19499                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19500}19500                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19501}19501               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19502}19502 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19503}19503 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19504}19504               \textcolor{comment}{// Root element has already been visited}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19505}19505               \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19506}19506               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19507}19507                 \textcolor{comment}{// We don't have to do anything with this element since it's}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19508}19508                 \textcolor{comment}{// already been processed earlier, but check that it's scheduled}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19509}19509                 \textcolor{comment}{// to go onto the same processor as its root.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19510}19510                 \textcolor{keywordflow}{if} ((target\_plus\_one\_for\_root[root\_el\_pt] -\/ 1) != target\_domain)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19511}19511                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19512}19512                   std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19513}19513                   error\_message}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19514}19514                     << \textcolor{stringliteral}{"{}All elements associated with same root must have "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19515}19515                     << \textcolor{stringliteral}{"{}same target. during load balancing\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19516}19516                   \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19517}19517                                       OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19518}19518                                       OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19519}19519                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19520}19520               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19521}19521 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19522}19522             \} \textcolor{comment}{// else if (ref\_el\_pt==0)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19523}19523           \} \textcolor{comment}{// if (!ele\_pt-\/>is\_halo())}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19524}19524         \} \textcolor{comment}{// for (e < nele)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19525}19525       \} \textcolor{comment}{// if (!(sub\_mesh\_pt!=0))}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19526}19526     \} \textcolor{comment}{// for (i\_mesh < n\_mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19527}19527 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19528}19528 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19529}19529     \textcolor{comment}{// Have we processed all target domains?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19530}19530     \textcolor{keywordflow}{if} (target\_domain\_for\_local\_non\_halo\_element.size() != count\_non\_halo\_el)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19531}19531     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19532}19532       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19533}19533       error\_message}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19534}19534         << \textcolor{stringliteral}{"{}Have processed "{}} << count\_non\_halo\_el << \textcolor{stringliteral}{"{} of "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19535}19535         << target\_domain\_for\_local\_non\_halo\_element.size()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19536}19536         << \textcolor{stringliteral}{"{} target domains for local non-\/halo elelemts. \(\backslash\)n "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19537}19537         << \textcolor{stringliteral}{"{}Very Odd -\/-\/ we do (now) strip out the information for elements\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19538}19538         << \textcolor{stringliteral}{"{}that are removed in actions\_before\_distribute()...\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19539}19539       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19540}19540         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19541}19541     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19542}19542 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19543}19543 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19544}19544     \textcolor{comment}{// Determine max. refinement level and origin/destination scheme}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19545}19545     \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19546}19546     \textcolor{comment}{// for all root/base elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19547}19547     \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19548}19548 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19549}19549     \textcolor{comment}{// Allreduce to work out max max refinement level across all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19550}19550     max\_refinement\_level\_overall = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19551}19551 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19552}19552     \textcolor{comment}{// Only perform this communications if necessary (it means if there}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19553}19553     \textcolor{comment}{// are structured meshes as part of the problem)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19554}19554     \textcolor{keywordflow}{if} (are\_there\_structured\_meshes)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19555}19555     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19556}19556       MPI\_Allreduce(\&max\_refinement\_level,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19557}19557                     \&max\_refinement\_level\_overall,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19558}19558                     1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19559}19559                     MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19560}19560                     MPI\_MAX,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19561}19561                     comm\_pt-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19562}19562     \} \textcolor{comment}{// if (are\_there\_structured\_meshes)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19563}19563 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19564}19564     \textcolor{comment}{// Allreduce to tell everybody about the original and new domains}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19565}19565     \textcolor{comment}{// for root elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19566}19566     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} tmp\_old\_domain\_for\_base\_element(n\_base\_element);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19567}19567 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19568}19568     \textcolor{comment}{// Only perform this communications if necessary (it means if there}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19569}19569     \textcolor{comment}{// are structured meshes as part of the problem)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19570}19570     \textcolor{keywordflow}{if} (are\_there\_structured\_meshes)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19571}19571     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19572}19572       MPI\_Allreduce(\&old\_domain\_for\_base\_element\_local[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19573}19573                     \&tmp\_old\_domain\_for\_base\_element[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19574}19574                     n\_base\_element,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19575}19575                     MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19576}19576                     MPI\_MAX,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19577}19577                     comm\_pt-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19578}19578     \} \textcolor{comment}{// if (are\_there\_structured\_meshes)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19579}19579 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19580}19580     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} tmp\_new\_domain\_for\_base\_element(n\_base\_element);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19581}19581     \textcolor{comment}{// Only perform this communications if necessary (it means if there}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19582}19582     \textcolor{comment}{// are structured meshes as part of the problem)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19583}19583     \textcolor{keywordflow}{if} (are\_there\_structured\_meshes)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19584}19584     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19585}19585       MPI\_Allreduce(\&new\_domain\_for\_base\_element\_local[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19586}19586                     \&tmp\_new\_domain\_for\_base\_element[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19587}19587                     n\_base\_element,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19588}19588                     MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19589}19589                     MPI\_MAX,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19590}19590                     comm\_pt-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19591}19591     \} \textcolor{comment}{// if (are\_there\_structured\_meshes)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19592}19592 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19593}19593     \textcolor{comment}{// Copy across (after optional sanity check)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19594}19594     old\_domain\_for\_base\_element.resize(n\_base\_element);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19595}19595     new\_domain\_for\_base\_element.resize(n\_base\_element);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19596}19596     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_base\_element; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19597}19597     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19598}19598 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19599}19599       \textcolor{keywordflow}{if} (tmp\_old\_domain\_for\_base\_element[j] == -\/1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19600}19600       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19601}19601         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19602}19602         error\_message << \textcolor{stringliteral}{"{}Old domain for base element "{}} << j << \textcolor{stringliteral}{"{}: "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19603}19603                       << \mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}[j]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19604}19604                       << \textcolor{stringliteral}{"{}or its incarnation as refineable el: "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19605}19605                       << \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19606}19606                            \mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}[j])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19607}19607                       << \textcolor{stringliteral}{"{} which is of type "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19608}19608                       << \textcolor{keyword}{typeid}(*\mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}[j]).name()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19609}19609                       << \textcolor{stringliteral}{"{} does not\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19610}19610                       << \textcolor{stringliteral}{"{}appear to have been assigned by any processor\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19611}19611         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19612}19612                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19613}19613                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19614}19614       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19615}19615 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19616}19616       old\_domain\_for\_base\_element[j] = tmp\_old\_domain\_for\_base\_element[j];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19617}19617 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19618}19618       \textcolor{keywordflow}{if} (tmp\_new\_domain\_for\_base\_element[j] == -\/1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19619}19619       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19620}19620         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19621}19621         error\_message << \textcolor{stringliteral}{"{}New domain for base element "{}} << j}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19622}19622                       << \textcolor{stringliteral}{"{}which is of type "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19623}19623                       << \textcolor{keyword}{typeid}(*\mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}[j]).name()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19624}19624                       << \textcolor{stringliteral}{"{} does not\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19625}19625                       << \textcolor{stringliteral}{"{}appear to have been assigned by any processor\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19626}19626         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19627}19627                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19628}19628                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19629}19629       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19630}19630 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19631}19631       new\_domain\_for\_base\_element[j] = tmp\_new\_domain\_for\_base\_element[j];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19632}19632     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19633}19633 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19634}19634 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19635}19635     \textcolor{comment}{// Loop over all processors and accumulate data to be sent}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19636}19636     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19637}19637     send\_data.clear();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19638}19638 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19639}19639     \textcolor{comment}{// Only do each node once (per processor!)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19640}19640     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<std::map<Node*, bool>}}> node\_done(n\_proc);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19641}19641 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19642}19642     \textcolor{comment}{// Loop over all processors. NOTE: We include current processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19643}19643     \textcolor{comment}{// since we have to refine local elements too -\/-\/ store their data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19644}19644     \textcolor{comment}{// in same data structure as the one used for off-\/processor elements.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19645}19645     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} rank = 0; rank < n\_proc; rank++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19646}19646     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19647}19647       \textcolor{comment}{// Set the offset for the current processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19648}19648       send\_displacement[rank] = send\_data.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19649}19649 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19650}19650 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19651}19651       \textcolor{comment}{// Check that total number of elements processed matches those}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19652}19652       \textcolor{comment}{// in individual batches}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19653}19653       \textcolor{keywordtype}{unsigned} total\_nel = element\_for\_processor[rank].size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19654}19654 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19655}19655 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19656}19656       \textcolor{comment}{// Counter for number of elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19657}19657       \textcolor{keywordtype}{unsigned} el\_count = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19658}19658 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19659}19659       \textcolor{comment}{// How many baches are there for current rank?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19660}19660       \textcolor{keywordtype}{unsigned} nbatch = nelement\_batch\_for\_processor[rank].size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19661}19661 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19662}19662       \textcolor{comment}{// Add to vector of doubles to save on number of comms}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19663}19663       send\_data.push\_back(\textcolor{keywordtype}{double}(nbatch));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19664}19664 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19665}19665       \textcolor{comment}{// Loop over batches of elemnts associated with same root}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19666}19666       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < nbatch; b++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19667}19667       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19668}19668         \textcolor{comment}{// How many elements are to be sent in this batch?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19669}19669         \textcolor{keywordtype}{unsigned} nel = nelement\_batch\_for\_processor[rank][b];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19670}19670 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19671}19671         \textcolor{comment}{// Get the unique number of the root element in unrefined mesh for}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19672}19672         \textcolor{comment}{// all the elements in this batch}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19673}19673         \textcolor{keywordtype}{unsigned} base\_el\_no =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19674}19674           base\_element\_for\_element\_batch\_for\_processor[rank][b];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19675}19675 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19676}19676         \textcolor{comment}{// Add unsigneds to send data to minimise number of}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19677}19677         \textcolor{comment}{// communications}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19678}19678         send\_data.push\_back(\textcolor{keywordtype}{double}(nel));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19679}19679         send\_data.push\_back(\textcolor{keywordtype}{double}(base\_el\_no));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19680}19680 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19681}19681         \textcolor{comment}{// Loop over batch of elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19682}19682         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nel; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19683}19683         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19684}19684           \textcolor{comment}{// Get element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19685}19685           \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* el\_pt = element\_for\_processor[rank][el\_count];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19686}19686 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19687}19687           \textcolor{comment}{// FE?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19688}19688           \mbox{\hyperlink{classoomph_1_1FiniteElement}{FiniteElement}}* fe\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1FiniteElement}{FiniteElement}}*\textcolor{keyword}{>}(el\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19689}19689           \textcolor{keywordflow}{if} (fe\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19690}19690           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19691}19691             \textcolor{comment}{// Loop over nodes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19692}19692             \textcolor{keywordtype}{unsigned} nnod = fe\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a6219ed269a6d89b5aa14659cce48905a}{nnode}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19693}19693             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < nnod; j++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19694}19694             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19695}19695               \mbox{\hyperlink{classoomph_1_1Node}{Node}}* nod\_pt = fe\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(j);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19696}19696 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19697}19697               \textcolor{comment}{// Reconstruct the nodal values/position from the node's}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19698}19698               \textcolor{comment}{// possible hanging node representation to be on the safe side}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19699}19699               \textcolor{keywordtype}{unsigned} n\_value = nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7e67fc78a2e8a2fd6eb75bd292d42ff8}{nvalue}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19700}19700               \textcolor{keywordtype}{unsigned} nt = nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a9752205c5fb3bb886200b3fae9181e94}{ntstorage}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19701}19701               \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} values(n\_value);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19702}19702               \textcolor{keywordtype}{unsigned} n\_dim = nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_a786c96a8e46eb27a03b2b31f629d41b3}{ndim}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19703}19703               \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} position(n\_dim);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19704}19704 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19705}19705               \textcolor{comment}{// Loop over all history values}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19706}19706               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}} = 0; \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}} < nt; \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19707}19707               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19708}19708                 nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_afcc5cdba40bca251826ae5bee5ca15b4}{value}}(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, values);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19709}19709                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_value; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19710}19710                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19711}19711                   nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Data_a7289ca322725c6fd493970a19474b382}{set\_value}}(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, values[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19712}19712                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19713}19713                 nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_a61c3ad6b319e4d2cce38dc8faae1bfae}{position}}(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, position);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19714}19714                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dim; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19715}19715                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19716}19716                   nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_ab76b4773a65b349f143539e07b6e15e2}{x}}(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) = position[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19717}19717                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19718}19718               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19719}19719 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19720}19720 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19721}19721               \textcolor{comment}{// Has the node already been done for current rank?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19722}19722               \textcolor{keywordflow}{if} (!node\_done[rank][nod\_pt])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19723}19723               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19724}19724                 \textcolor{comment}{// Now it has been done}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19725}19725                 node\_done[rank][nod\_pt] = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19726}19726 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19727}19727                 \textcolor{comment}{// Store number of values (as double) to allow for resizing}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19728}19728                 \textcolor{comment}{// before read (req'd in case we store data that}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19729}19729                 \textcolor{comment}{// got introduced by attaching FaceElements to bulk)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19730}19730                 send\_data.push\_back(\textcolor{keywordtype}{double}(n\_value));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19731}19731 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19732}19732                 \textcolor{comment}{// Check if it's a boundary node}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19733}19733                 \mbox{\hyperlink{classoomph_1_1BoundaryNodeBase}{BoundaryNodeBase}}* bnod\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19734}19734                   \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1BoundaryNodeBase}{BoundaryNodeBase}}*\textcolor{keyword}{>}(nod\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19735}19735 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19736}19736                 \textcolor{comment}{// Not a boundary node}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19737}19737                 \textcolor{keywordflow}{if} (bnod\_pt == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19738}19738                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19739}19739 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19740}19740                   \textcolor{comment}{// Record status for checking}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19741}19741                   send\_data.push\_back(\textcolor{keywordtype}{double}(0));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19742}19742 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19743}19743                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19744}19744                 \textcolor{comment}{// Yes it's a boundary node}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19745}19745                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19746}19746                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19747}19747 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19748}19748                   \textcolor{comment}{// Record status for checking}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19749}19749                   send\_data.push\_back(\textcolor{keywordtype}{double}(1));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19750}19750 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19751}19751                   \textcolor{comment}{// Get pointer to the map of indices associated with}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19752}19752                   \textcolor{comment}{// additional values created by face elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19753}19753                   std::map<unsigned, unsigned>* map\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19754}19754                     bnod\_pt-\/>\mbox{\hyperlink{classoomph_1_1BoundaryNodeBase_a5f73c54dbb9bdfe3538b61117a0cc674}{index\_of\_first\_value\_assigned\_by\_face\_element\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19755}19755 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19756}19756                   \textcolor{comment}{// No additional values created}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19757}19757                   \textcolor{keywordflow}{if} (map\_pt == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19758}19758                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19759}19759                     send\_data.push\_back(\textcolor{keywordtype}{double}(0));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19760}19760                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19761}19761                   \textcolor{comment}{// Created additional values}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19762}19762                   \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19763}19763                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19764}19764                     \textcolor{comment}{// How many?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19765}19765                     send\_data.push\_back(\textcolor{keywordtype}{double}(map\_pt-\/>size()));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19766}19766 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19767}19767                     \textcolor{comment}{// Loop over entries in map and add to send data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19768}19768                     \textcolor{keywordflow}{for} (std::map<unsigned, unsigned>::iterator p =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19769}19769                            map\_pt-\/>begin();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19770}19770                          p != map\_pt-\/>end();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19771}19771                          p++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19772}19772                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19773}19773                       send\_data.push\_back(\textcolor{keywordtype}{double}((*p).first));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19774}19774                       send\_data.push\_back(\textcolor{keywordtype}{double}((*p).second));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19775}19775                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19776}19776                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19777}19777                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19778}19778 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19779}19779                 \textcolor{comment}{// Add the actual values}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19780}19780                 nod\_pt-\/>\mbox{\hyperlink{classoomph_1_1Node_a11400682e1fd2851777234a779e8bf8d}{add\_values\_to\_vector}}(send\_data);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19781}19781               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19782}19782             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19783}19783           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19784}19784 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19785}19785           \textcolor{comment}{// Now add internal data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19786}19786           el\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a3f15bfeb2a705f8acfa529967077bc20}{add\_internal\_data\_values\_to\_vector}}(send\_data);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19787}19787 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19788}19788           \textcolor{comment}{// Bump up counter in long vector of elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19789}19789           el\_count++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19790}19790         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19791}19791       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19792}19792 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19793}19793 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19794}19794 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19795}19795       \textcolor{comment}{// Check that total number of elements matches the total of those}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19796}19796       \textcolor{comment}{// in batches}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19797}19797       \textcolor{keywordflow}{if} (total\_nel != el\_count)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19798}19798       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19799}19799         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19800}19800         error\_message}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19801}19801           << \textcolor{stringliteral}{"{}total\_nel: "{}} << total\_nel << \textcolor{stringliteral}{"{} "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19802}19802           << \textcolor{stringliteral}{"{} doesn't match total number of elements sent in batch: "{}}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19803}19803           << el\_count << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19804}19804         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19805}19805                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19806}19806                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19807}19807       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19808}19808 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19809}19809 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19810}19810       \textcolor{comment}{// Find the number of data added to the vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19811}19811       send\_n[rank] = send\_data.size() -\/ send\_displacement[rank];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19812}19812     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19813}19813   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19814}19814 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19815}19815 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19816}19816   \textcolor{comment}{//==========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19817}19817 \textcolor{comment}{  /// Get flat-\/packed refinement pattern for each root element in current}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19818}19818 \textcolor{comment}{  /// mesh (labeled by unique number of root element in unrefined base mesh).}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19819}19819 \textcolor{comment}{  /// The vector stored for each root element contains the following}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19820}19820 \textcolor{comment}{  /// information:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19821}19821 \textcolor{comment}{  /// -\/ First entry: Number of tree nodes (not just leaves!) in refinement}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19822}19822 \textcolor{comment}{  ///   tree emanating from this root [Zero if root element is not refineable]}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19823}19823 \textcolor{comment}{  /// -\/ Loop over all refinement levels}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19824}19824 \textcolor{comment}{  ///   -\/ Loop over all tree nodes (not just leaves!)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19825}19825 \textcolor{comment}{  ///     -\/ If associated element exists when the mesh has been refined to}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19826}19826 \textcolor{comment}{  ///       this level (either because it has been refined to this level or}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19827}19827 \textcolor{comment}{  ///       because it's less refined): 1}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19828}19828 \textcolor{comment}{  ///       -\/ If the element is to be refined: 1; else: 0}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19829}19829 \textcolor{comment}{  ///     -\/ else (element doesn't exist when mesh is refined to this level}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19830}19830 \textcolor{comment}{  ///       (because it's more refined): 0}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19831}19831 \textcolor{comment}{  ///     .}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19832}19832 \textcolor{comment}{  ///   .}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19833}19833 \textcolor{comment}{  /// .}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19834}19834 \textcolor{comment}{}  \textcolor{comment}{//==========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19835}\mbox{\hyperlink{classoomph_1_1Problem_a09788e9f690067496b6621fae12ba354}{19835}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_a09788e9f690067496b6621fae12ba354}{Problem::get\_flat\_packed\_refinement\_pattern\_for\_load\_balancing}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19836}19836     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& old\_domain\_for\_base\_element,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19837}19837     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& new\_domain\_for\_base\_element,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19838}19838     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& max\_refinement\_level\_overall,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19839}19839     std::map<\textcolor{keywordtype}{unsigned}, \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}>\& flat\_packed\_refinement\_info\_for\_root)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19840}19840   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19841}19841     \textcolor{comment}{// Map to store whether the root element has been visited yet}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19842}19842     std::map<RefineableElement*, bool> root\_el\_done;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19843}19843 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19844}19844     \textcolor{comment}{// Get the number of submeshs, if there are no submeshes, then}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19845}19845     \textcolor{comment}{// increase the counter so that the loop below also work for the only}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19846}19846     \textcolor{comment}{// one mesh in the problem}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19847}19847     \textcolor{keywordtype}{unsigned} n\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19848}19848     \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19849}19849     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19850}19850       n\_mesh = 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19851}19851     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19852}19852     \textcolor{comment}{// Go for the nonhalo elements only in the TreeBaseMeshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19853}19853     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19854}19854     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19855}19855       \textcolor{comment}{// Only work with structured}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19856}19856       \mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}* sub\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19857}19857         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19858}19858       \textcolor{keywordflow}{if} (!(sub\_mesh\_pt != 0))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19859}19859       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19860}19860         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nele\_submesh = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19861}19861         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nele\_submesh; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19862}19862         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19863}19863           \textcolor{comment}{// Get pointer to element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19864}19864           \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* el\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19865}19865 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19866}19866           \textcolor{comment}{// Ignore halos}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19867}19867           \textcolor{keywordflow}{if} (!el\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a0d9869eaf7d6e104c1e465b0d3cd6a9b}{is\_halo}}())}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19868}19868           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19869}19869             \textcolor{comment}{// Is it refineable? No!}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19870}19870             \mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}* ref\_el\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19871}19871               \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(el\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19872}19872             \textcolor{keywordflow}{if} (ref\_el\_pt == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19873}19873             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19874}19874               \textcolor{comment}{// The element is not refineable -\/ stick a zero in refinement\_info}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19875}19875               \textcolor{comment}{// indicating that there are no tree nodes following}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19876}19876               \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}[el\_pt];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19877}19877 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19878}19878               \textcolor{keywordflow}{if} (\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19879}19879               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19880}19880                 \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Base\_mesh\_element\_number\_plus\_one[...]=0"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19881}19881                                     OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19882}19882                                     OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19883}19883               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19884}19884 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19885}19885               \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} -\/= 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19886}19886               flat\_packed\_refinement\_info\_for\_root[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}].push\_back(0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19887}19887             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19888}19888             \textcolor{comment}{// Refineable}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19889}19889             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19890}19890             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19891}19891               \textcolor{comment}{// Get the root element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19892}19892               \mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}* root\_el\_pt = ref\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_a8bbcee798e87bd7e5d88273c71500f76}{root\_element\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19893}19893 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19894}19894               \textcolor{comment}{// Has this root been visited yet?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19895}19895               \textcolor{keywordflow}{if} (!root\_el\_done[root\_el\_pt])}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19896}19896               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19897}19897                 \textcolor{comment}{// Get unique number of root element in base mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19898}19898                 \textcolor{keywordtype}{unsigned} root\_element\_number =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19899}19899                   \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}[root\_el\_pt];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19900}19900 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19901}19901 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19902}19902                 \textcolor{keywordflow}{if} (root\_element\_number == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19903}19903                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19904}19904                   \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19905}19905                     \textcolor{stringliteral}{"{}Base\_mesh\_element\_number\_plus\_one[...]=0"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19906}19906                     OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19907}19907                     OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19908}19908                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19909}19909 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19910}19910                 root\_element\_number -\/= 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19911}19911 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19912}19912                 \textcolor{comment}{// Get all the nodes associated with this root element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19913}19913                 \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Tree*>}} all\_tree\_nodes\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19914}19914                 root\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_a4b783f4e5b6aeed83d49e478510d614f}{tree\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Tree_a2c84b4e4700a825ef0a6ca533b9ae895}{stick\_all\_tree\_nodes\_into\_vector}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19915}19915                   all\_tree\_nodes\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19916}19916 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19917}19917                 \textcolor{comment}{// How many tree nodes are there?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19918}19918                 \textcolor{keywordtype}{unsigned} n\_tree\_nodes = all\_tree\_nodes\_pt.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19919}19919                 flat\_packed\_refinement\_info\_for\_root[root\_element\_number]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19920}19920                   .push\_back(n\_tree\_nodes);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19921}19921 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19922}19922                 \textcolor{comment}{// Loop over all levels}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19923}19923                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} current\_level = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19924}19924                      current\_level < max\_refinement\_level\_overall;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19925}19925                      current\_level++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19926}19926                 \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19927}19927                   \textcolor{comment}{// Loop over all tree nodes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19928}19928                   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_tree\_nodes; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19929}19929                   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19930}19930                     \textcolor{comment}{// What's the level of this tree node?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19931}19931                     \textcolor{keywordtype}{unsigned} level = all\_tree\_nodes\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>level();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19932}19932 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19933}19933                     \textcolor{comment}{// Element exists at this refinement level of the mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19934}19934                     \textcolor{comment}{// if it's at this level or it's at a lower level and a leaf}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19935}19935                     \textcolor{keywordflow}{if} ((level == current\_level) ||}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19936}19936                         ((level < current\_level) \&\&}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19937}19937                          (all\_tree\_nodes\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>is\_leaf())))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19938}19938                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19939}19939                       flat\_packed\_refinement\_info\_for\_root[root\_element\_number]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19940}19940                         .push\_back(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19941}19941 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19942}19942                       \textcolor{comment}{// If it's at this level, and not a leaf, then it will}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19943}19943                       \textcolor{comment}{// need to be refined in the new mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19944}19944                       \textcolor{keywordflow}{if} ((level == current\_level) \&\&}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19945}19945                           (!all\_tree\_nodes\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>is\_leaf()))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19946}19946                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19947}19947                         flat\_packed\_refinement\_info\_for\_root}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19948}19948                           [root\_element\_number]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19949}19949                             .push\_back(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19950}19950                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19951}19951                       \textcolor{comment}{// Element exists at this level and is a leaf so it}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19952}19952                       \textcolor{comment}{// doesn't have to be refined}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19953}19953                       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19954}19954                       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19955}19955                         flat\_packed\_refinement\_info\_for\_root}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19956}19956                           [root\_element\_number]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19957}19957                             .push\_back(0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19958}19958                       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19959}19959                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19960}19960                     \textcolor{comment}{// Element does not exist at this level so it doesn't have}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19961}19961                     \textcolor{comment}{// to be refined}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19962}19962                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19963}19963                     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19964}19964                       flat\_packed\_refinement\_info\_for\_root[root\_element\_number]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19965}19965                         .push\_back(0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19966}19966                     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19967}19967                   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19968}19968                 \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19969}19969                 \textcolor{comment}{// Now we've done it}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19970}19970                 root\_el\_done[root\_el\_pt] = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19971}19971               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19972}19972             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19973}19973 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19974}19974           \} \textcolor{comment}{// if (!el\_pt-\/>is\_halo())}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19975}19975         \} \textcolor{comment}{// for (e < nele\_submesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19976}19976       \} \textcolor{comment}{// if (!(sub\_mesh\_pt!=0))}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19977}19977     \} \textcolor{comment}{// for (i\_mesh < n\_mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19978}19978   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19979}19979 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19980}19980   \textcolor{comment}{//==========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19981}19981 \textcolor{comment}{  /// Load balance helper routine:  Function performs max\_level\_overall}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19982}19982 \textcolor{comment}{  /// successive refinements of the problem's mesh(es) using the following}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19983}19983 \textcolor{comment}{  /// procdure: Given ID of root element, root\_element\_id, and current}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19984}19984 \textcolor{comment}{  /// refinement level, level, the e-\/th entry in}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19985}19985 \textcolor{comment}{  /// refinement\_info\_for\_root\_elements[root\_element\_id][level][e] is equal}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19986}19986 \textcolor{comment}{  /// to 2 if the e-\/th element (using the enumeration when the mesh has been}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19987}19987 \textcolor{comment}{  /// refined to the level-\/th level) is to be refined during the next}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19988}19988 \textcolor{comment}{  /// refinement; it's 1 if it's not to be refined.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19989}19989 \textcolor{comment}{}  \textcolor{comment}{//==========================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19990}\mbox{\hyperlink{classoomph_1_1Problem_ac969abcf440b4f631061e74316391b3a}{19990}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ac969abcf440b4f631061e74316391b3a}{Problem::refine\_distributed\_base\_mesh}}(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19991}19991     \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}>>\& refinement\_info\_for\_root\_elements,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19992}19992     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& max\_level\_overall)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19993}19993   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19994}19994     \textcolor{comment}{// Loop over sub meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19995}19995     \textcolor{keywordtype}{unsigned} n\_sub\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19996}19996     \textcolor{keywordtype}{unsigned} max\_mesh = std::max(n\_sub\_mesh, \textcolor{keywordtype}{unsigned}(1));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19997}19997     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < max\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19998}19998     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l19999}19999       \textcolor{comment}{// Choose the right mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20000}20000       \mbox{\hyperlink{classoomph_1_1Mesh}{Mesh}}* my\_mesh\_pt = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20001}20001       \textcolor{keywordflow}{if} (n\_sub\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20002}20002       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20003}20003         my\_mesh\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20004}20004       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20005}20005       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20006}20006       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20007}20007         my\_mesh\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20008}20008       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20009}20009 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20010}20010       \textcolor{comment}{// Number of elements on this processor -\/-\/ currently all elements}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20011}20011       \textcolor{comment}{// are "{}base"{} elements since the mesh hasn't been refined.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20012}20012       \textcolor{keywordtype}{unsigned} n\_el\_on\_this\_proc = my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20013}20013 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20014}20014       \textcolor{comment}{// Storage for actual refinement pattern:}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20015}20015       \textcolor{comment}{// to\_be\_refined\_on\_this\_proc[level][e] contains the element number}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20016}20016       \textcolor{comment}{// of the e-\/th element that is to refined at the level-\/th refinement level}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20017}20017       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<unsigned>}}> to\_be\_refined\_on\_this\_proc(max\_level\_overall);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20018}20018 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20019}20019       \textcolor{comment}{// Count, at each level, the total number of elements in the mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20020}20020       \textcolor{comment}{// (we can accumulate this because we know that elements are}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20021}20021       \textcolor{comment}{// enumerated tree by tree).}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20022}20022       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} el\_count\_on\_this\_proc(max\_level\_overall, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20023}20023 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20024}20024       \textcolor{comment}{// Loop over levels where refinement is taking place}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20025}20025       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} level = 0; level < max\_level\_overall; level++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20026}20026       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20027}20027         \textcolor{comment}{// Loop over roots = unrefined elements on this processor in order.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20028}20028         \textcolor{comment}{// Note that this loops over the trees in unique order}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20029}20029         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_el\_on\_this\_proc; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20030}20030         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20031}20031           \textcolor{comment}{// Get the (root) element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20032}20032           \mbox{\hyperlink{classoomph_1_1FiniteElement}{FiniteElement}}* el\_pt = my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a479059b0964826a8cee6eb506b57268a}{finite\_element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20033}20033 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20034}20034           \textcolor{comment}{// What is its unique number in the base mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20035}20035           \textcolor{keywordtype}{unsigned} root\_el\_no = \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}[el\_pt];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20036}20036 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20037}20037           \textcolor{keywordflow}{if} (root\_el\_no == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20038}20038           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20039}20039             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Base\_mesh\_element\_number\_plus\_one[...]=0"{}},}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20040}20040                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20041}20041                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20042}20042           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20043}20043 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20044}20044           root\_el\_no -\/= 1;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20045}20045 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20046}20046           \textcolor{comment}{// Number of refinements to be performed starting from current}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20047}20047           \textcolor{comment}{// root element}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20048}20048           \textcolor{keywordtype}{unsigned} n\_refinements =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20049}20049             refinement\_info\_for\_root\_elements[root\_el\_no].size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20050}20050 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20051}20051           \textcolor{comment}{// Perform refinement?}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20052}20052           \textcolor{keywordflow}{if} (level < n\_refinements)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20053}20053           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20054}20054             \textcolor{comment}{// Loop over elements at this level}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20055}20055             \textcolor{keywordtype}{unsigned} n\_el =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20056}20056               refinement\_info\_for\_root\_elements[root\_el\_no][level].size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20057}20057             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} ee = 0; ee < n\_el; ee++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20058}20058             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20059}20059               \textcolor{comment}{// Refinement code 2: Element is to be refined at this}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20060}20060               \textcolor{comment}{// level}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20061}20061               \textcolor{keywordflow}{if} (refinement\_info\_for\_root\_elements[root\_el\_no][level][ee] == 2)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20062}20062               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20063}20063                 to\_be\_refined\_on\_this\_proc[level].push\_back(}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20064}20064                   el\_count\_on\_this\_proc[level]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20065}20065                 el\_count\_on\_this\_proc[level]++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20066}20066               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20067}20067               \textcolor{comment}{// Refinement code 1: Element should not be refined at this}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20068}20068               \textcolor{comment}{// level -\/-\/ keep going}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20069}20069               \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (refinement\_info\_for\_root\_elements[root\_el\_no][level]}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20070}20070                                                         [ee] == 1)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20071}20071               \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20072}20072                 el\_count\_on\_this\_proc[level]++;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20073}20073               \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20074}20074             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20075}20075           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20076}20076 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20077}20077         \} \textcolor{comment}{// end of loop over elements on proc; all of which should be root}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20078}20078       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20079}20079 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20080}20080       \textcolor{comment}{// Now do the actual refinement}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20081}20081       \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* ref\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20082}20082         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}*\textcolor{keyword}{>}(my\_mesh\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20083}20083       \textcolor{keywordflow}{if} (ref\_mesh\_pt != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20084}20084       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20085}20085         ref\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a77c2eb2c650ba34c79cf3b156204ee3b}{refine\_base\_mesh}}(to\_be\_refined\_on\_this\_proc);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20086}20086       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20087}20087     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20088}20088 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20089}20089     \textcolor{comment}{// Rebuild global mesh after refinement}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20090}20090     \textcolor{keywordflow}{if} (n\_sub\_mesh != 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20091}20091     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20092}20092       \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20093}20093       \mbox{\hyperlink{classoomph_1_1Problem_ac0a0e649f36b4a7ce992888c323d1571}{rebuild\_global\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20094}20094     \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20095}20095   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20096}20096 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20097}20097 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20098}20098   \textcolor{comment}{//====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20099}20099 \textcolor{comment}{  /// Helper function to re-\/setup the Base\_mesh enumeration}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20100}20100 \textcolor{comment}{  /// (used during load balancing) after pruning.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20101}20101 \textcolor{comment}{}  \textcolor{comment}{//====================================================================}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20102}\mbox{\hyperlink{classoomph_1_1Problem_ab5f60ebc552c00ee681776bc7fa61203}{20102}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Problem_ab5f60ebc552c00ee681776bc7fa61203}{Problem::setup\_base\_mesh\_info\_after\_pruning}}()}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20103}20103   \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20104}20104     \textcolor{comment}{// Storage for number of processors and current processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20105}20105     \textcolor{keywordtype}{int} n\_proc = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20106}20106     \textcolor{keywordtype}{int} my\_rank = this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20107}20107 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20108}20108     \textcolor{comment}{// Loop over sub meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20109}20109     \textcolor{keywordtype}{unsigned} n\_sub\_mesh = \mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20110}20110     \textcolor{keywordtype}{unsigned} max\_mesh = std::max(n\_sub\_mesh, \textcolor{keywordtype}{unsigned}(1));}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20111}20111     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < max\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20112}20112     \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20113}20113       \textcolor{comment}{// Choose the right mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20114}20114       \mbox{\hyperlink{classoomph_1_1Mesh}{Mesh}}* my\_mesh\_pt = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20115}20115       \textcolor{keywordflow}{if} (n\_sub\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20116}20116       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20117}20117         my\_mesh\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20118}20118       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20119}20119       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20120}20120       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20121}20121         my\_mesh\_pt = \mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20122}20122       \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20123}20123 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20124}20124       \textcolor{comment}{// Only work with structured meshes}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20125}20125       \mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}* sub\_mesh\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20126}20126         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1TriangleMeshBase}{TriangleMeshBase}}*\textcolor{keyword}{>}(my\_mesh\_pt);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20127}20127       \textcolor{keywordflow}{if} (!(sub\_mesh\_pt != 0))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20128}20128       \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20129}20129         \textcolor{comment}{// Storage for number of data to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20130}20130         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} send\_n(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20131}20131 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20132}20132         \textcolor{comment}{// Storage for all values to be sent to all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20133}20133         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} send\_data;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20134}20134 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20135}20135         \textcolor{comment}{// Start location within send\_data for data to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20136}20136         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} send\_displacement(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20137}20137 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20138}20138         \textcolor{comment}{// Loop over all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20139}20139         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} rank = 0; rank < n\_proc; rank++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20140}20140         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20141}20141           \textcolor{comment}{// Set the offset for the current processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20142}20142           send\_displacement[rank] = send\_data.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20143}20143 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20144}20144           \textcolor{comment}{// Don't bother to do anything if the processor in the loop is the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20145}20145           \textcolor{comment}{// current processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20146}20146           \textcolor{keywordflow}{if} (rank != my\_rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20147}20147           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20148}20148             \textcolor{comment}{// Get root haloed elements with that processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20149}20149             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<GeneralisedElement*>}} root\_haloed\_elements\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20150}20150               my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af3a189ee201ee53814703fd8b9cbd4c7}{root\_haloed\_element\_pt}}(rank);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20151}20151             \textcolor{keywordtype}{unsigned} nel = root\_haloed\_elements\_pt.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20152}20152 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20153}20153             \textcolor{comment}{// Store element numbers for send}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20154}20154             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nel; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20155}20155             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20156}20156               \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* el\_pt = root\_haloed\_elements\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20157}20157               send\_data.push\_back(\mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}[el\_pt]);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20158}20158             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20159}20159           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20160}20160 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20161}20161           \textcolor{comment}{// Find the number of data added to the vector}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20162}20162           send\_n[rank] = send\_data.size() -\/ send\_displacement[rank];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20163}20163         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20164}20164 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20165}20165         \textcolor{comment}{// Storage for the number of data to be received from each processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20166}20166         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} receive\_n(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20167}20167 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20168}20168         \textcolor{comment}{// Now send numbers of data to be sent between all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20169}20169         MPI\_Alltoall(\&send\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20170}20170                      1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20171}20171                      MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20172}20172                      \&receive\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20173}20173                      1,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20174}20174                      MPI\_INT,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20175}20175                      this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20176}20176 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20177}20177         \textcolor{comment}{// We now prepare the data to be received}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20178}20178         \textcolor{comment}{// by working out the displacements from the received data}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20179}20179         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} receive\_displacement(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20180}20180         \textcolor{keywordtype}{int} receive\_data\_count = 0;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20181}20181         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} rank = 0; rank < n\_proc; ++rank)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20182}20182         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20183}20183           \textcolor{comment}{// Displacement is number of data received so far}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20184}20184           receive\_displacement[rank] = receive\_data\_count;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20185}20185           receive\_data\_count += receive\_n[rank];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20186}20186         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20187}20187 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20188}20188         \textcolor{comment}{// Now resize the receive buffer for all data from all processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20189}20189         \textcolor{comment}{// Make sure that it has a size of at least one}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20190}20190         \textcolor{keywordflow}{if} (receive\_data\_count == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20191}20191         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20192}20192           ++receive\_data\_count;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20193}20193         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20194}20194         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} receive\_data(receive\_data\_count);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20195}20195 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20196}20196         \textcolor{comment}{// Make sure that the send buffer has size at least one}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20197}20197         \textcolor{comment}{// so that we don't get a segmentation fault}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20198}20198         \textcolor{keywordflow}{if} (send\_data.size() == 0)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20199}20199         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20200}20200           send\_data.resize(1);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20201}20201         \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20202}20202 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20203}20203         \textcolor{comment}{// Now send the data between all the processors}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20204}20204         MPI\_Alltoallv(\&send\_data[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20205}20205                       \&send\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20206}20206                       \&send\_displacement[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20207}20207                       MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20208}20208                       \&receive\_data[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20209}20209                       \&receive\_n[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20210}20210                       \&receive\_displacement[0],}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20211}20211                       MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20212}20212                       this-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20213}20213 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20214}20214         \textcolor{comment}{// Now use the received data to update the halo element numbers in}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20215}20215         \textcolor{comment}{// base mesh}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20216}20216         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} send\_rank = 0; send\_rank < n\_proc; send\_rank++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20217}20217         \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20218}20218           \textcolor{comment}{// Don't bother to do anything for the processor corresponding to the}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20219}20219           \textcolor{comment}{// current processor or if no data were received from this processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20220}20220           \textcolor{keywordflow}{if} ((send\_rank != my\_rank) \&\& (receive\_n[send\_rank] != 0))}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20221}20221           \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20222}20222             \textcolor{comment}{// Counter for the data within the large array}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20223}20223             \textcolor{keywordtype}{unsigned} count = receive\_displacement[send\_rank];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20224}20224 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20225}20225             \textcolor{comment}{// Get root halo elements with that processor}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20226}20226             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<GeneralisedElement*>}} root\_halo\_elements\_pt =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20227}20227               my\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_aac59ed936ae4bd781007d2e6d872ce67}{root\_halo\_element\_pt}}(send\_rank);}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20228}20228             \textcolor{keywordtype}{unsigned} nel = root\_halo\_elements\_pt.size();}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20229}20229 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20230}20230             \textcolor{comment}{// Read in element numbers}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20231}20231             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nel; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20232}20232             \{}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20233}20233               \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* el\_pt = root\_halo\_elements\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20234}20234               \textcolor{keywordtype}{unsigned} el\_number\_plus\_one = receive\_data[count++];}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20235}20235               \mbox{\hyperlink{classoomph_1_1Problem_acbdc545bf83974cef38c9dbfff0d2120}{Base\_mesh\_element\_number\_plus\_one}}[el\_pt] = el\_number\_plus\_one;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20236}20236               \mbox{\hyperlink{classoomph_1_1Problem_a74ce6267ea12fd59903b88e316283b6a}{Base\_mesh\_element\_pt}}[el\_number\_plus\_one -\/ 1] = el\_pt;}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20237}20237             \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20238}20238           \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20239}20239 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20240}20240         \} \textcolor{comment}{// End of data is received}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20241}20241 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20242}20242       \} \textcolor{comment}{// if (!(sub\_mesh\_pt!=0))}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20243}20243 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20244}20244     \} \textcolor{comment}{// for (i\_mesh<max\_mesh)}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20245}20245   \}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20246}20246 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20247}20247 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20248}20248 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20249}20249 \textcolor{comment}{  /// Instantiation of public flag to allow suppression of warning}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20250}20250 \textcolor{comment}{  /// messages re reading in unstructured meshes during restart.}}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20251}20251 \textcolor{comment}{}  \textcolor{keywordtype}{bool} \mbox{\hyperlink{classoomph_1_1Problem_a223a45fe6b1c80ee0109037b63e162f9}{Problem::Suppress\_warning\_about\_actions\_before\_read\_unstructured\_meshes}} =}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20252}20252     \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20253}20253 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20254}20254 }
\DoxyCodeLine{\Hypertarget{problem_8cc_source_l20255}20255 \} \textcolor{comment}{// namespace oomph}}

\end{DoxyCode}
