\hypertarget{eigen__solver_8cc_source}{}\doxysection{eigen\+\_\+solver.\+cc}
\label{eigen__solver_8cc_source}\index{eigen\_solver.cc@{eigen\_solver.cc}}
\mbox{\hyperlink{eigen__solver_8cc}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00001}00001 \textcolor{comment}{// LIC// ====================================================================}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00002}00002 \textcolor{comment}{// LIC// This file forms part of oomph-\/lib, the object-\/oriented,}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00003}00003 \textcolor{comment}{// LIC// multi-\/physics finite-\/element library, available}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00004}00004 \textcolor{comment}{// LIC// at http://www.oomph-\/lib.org.}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00005}00005 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00006}00006 \textcolor{comment}{// LIC// Copyright (C) 2006-\/2022 Matthias Heil and Andrew Hazel}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00007}00007 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00008}00008 \textcolor{comment}{// LIC// This library is free software; you can redistribute it and/or}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00009}00009 \textcolor{comment}{// LIC// modify it under the terms of the GNU Lesser General Public}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00010}00010 \textcolor{comment}{// LIC// License as published by the Free Software Foundation; either}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00011}00011 \textcolor{comment}{// LIC// version 2.1 of the License, or (at your option) any later version.}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00012}00012 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00013}00013 \textcolor{comment}{// LIC// This library is distributed in the hope that it will be useful,}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00014}00014 \textcolor{comment}{// LIC// but WITHOUT ANY WARRANTY; without even the implied warranty of}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00015}00015 \textcolor{comment}{// LIC// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00016}00016 \textcolor{comment}{// LIC// Lesser General Public License for more details.}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00017}00017 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00018}00018 \textcolor{comment}{// LIC// You should have received a copy of the GNU Lesser General Public}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00019}00019 \textcolor{comment}{// LIC// License along with this library; if not, write to the Free Software}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00020}00020 \textcolor{comment}{// LIC// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00021}00021 \textcolor{comment}{// LIC// 02110-\/1301  USA.}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00022}00022 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00023}00023 \textcolor{comment}{// LIC// The authors may be contacted at oomph-\/lib@maths.man.ac.uk.}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00024}00024 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00025}00025 \textcolor{comment}{// LIC//====================================================================}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00026}00026 \textcolor{comment}{// Non-\/inline functions for the eigensolvers}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00027}00027 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00028}00028 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00029}00029 \textcolor{preprocessor}{\#include "{}mpi.h"{}}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00030}00030 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00031}00031 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00032}00032 \textcolor{comment}{// Include cfortran.h and the header for the FORTRAN ARPACK routines}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00033}00033 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{cfortran_8h}{cfortran.h}}"{}}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00034}00034 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{arpack_8h}{arpack.h}}"{}}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00035}00035 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{lapack__qz_8h}{lapack\_qz.h}}"{}}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00036}00036 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00037}00037 \textcolor{comment}{// Oomph-\/lib headers}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00038}00038 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{eigen__solver_8h}{eigen\_solver.h}}"{}}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00039}00039 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{linear__solver_8h}{linear\_solver.h}}"{}}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00040}00040 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{problem_8h}{problem.h}}"{}}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00041}00041 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00042}00042 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00043}00043 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceoomph}{oomph}}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00044}00044 \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00045}00045   \textcolor{comment}{//===============================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00046}00046 \textcolor{comment}{  /// Constructor, set default values and set the initial}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00047}00047 \textcolor{comment}{  /// linear solver to be superlu}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00048}00048 \textcolor{comment}{}  \textcolor{comment}{//===============================================================}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00049}\mbox{\hyperlink{classoomph_1_1ARPACK_aef258a621d2ba000382d8e0cc9118e8d}{00049}}   \mbox{\hyperlink{classoomph_1_1ARPACK_aef258a621d2ba000382d8e0cc9118e8d}{ARPACK::ARPACK}}()}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00050}00050     : \mbox{\hyperlink{classoomph_1_1EigenSolver}{EigenSolver}}(),}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00051}00051       Spectrum(1),}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00052}00052       NArnoldi(30),}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00053}00053       Small(true),}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00054}00054       Compute\_eigenvectors(true)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00055}00055   \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00056}00056     \mbox{\hyperlink{classoomph_1_1ARPACK_ad6d487dfc1f84d8008e52fc87d83c644}{Default\_linear\_solver\_pt}} = \mbox{\hyperlink{classoomph_1_1ARPACK_a647a45676349ba86abd5d2ff9aff022d}{Linear\_solver\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1SuperLUSolver}{SuperLUSolver}};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00057}00057   \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00058}00058 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00059}00059   \textcolor{comment}{//===============================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00060}00060 \textcolor{comment}{  /// Destructor, delete the default linear solver}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00061}00061 \textcolor{comment}{}  \textcolor{comment}{//===============================================================}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00062}\mbox{\hyperlink{classoomph_1_1ARPACK_a67b999708483787f4211a15feb71ed11}{00062}}   \mbox{\hyperlink{classoomph_1_1ARPACK_a67b999708483787f4211a15feb71ed11}{ARPACK::\string~ARPACK}}()}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00063}00063   \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00064}00064     \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1ARPACK_ad6d487dfc1f84d8008e52fc87d83c644}{Default\_linear\_solver\_pt}};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00065}00065   \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00066}00066 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00067}00067 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00068}00068   \textcolor{comment}{//==========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00069}00069 \textcolor{comment}{  /// Use ARPACK to solve an eigen problem that is assembled by elements in}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00070}00070 \textcolor{comment}{  /// a mesh in a Problem object.}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00071}00071 \textcolor{comment}{}  \textcolor{comment}{//==========================================================================}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00072}\mbox{\hyperlink{classoomph_1_1ARPACK_ac644213623ea3d91a42cf1ea4608cdf3}{00072}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1ARPACK_ac644213623ea3d91a42cf1ea4608cdf3}{ARPACK::solve\_eigenproblem}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00073}00073                                   \textcolor{keyword}{const} \textcolor{keywordtype}{int}\& n\_eval,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00074}00074                                   \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<std::complex<double>>\& eigenvalue,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00075}00075                                   \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& eigenvector)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00076}00076   \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00077}00077     \textcolor{keywordtype}{bool} Verbose = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00078}00078 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00079}00079     \textcolor{comment}{// Control parameters}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00080}00080     \textcolor{keywordtype}{int} ido = 0; \textcolor{comment}{// Reverse communication flag}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00081}00081     \textcolor{keywordtype}{char} bmat[2]; \textcolor{comment}{// Specifies the type of matrix on the RHS}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00082}00082     \textcolor{comment}{// Must be 'I' for standard eigenvalue problem}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00083}00083     \textcolor{comment}{//        'G' for generalised eigenvalue problem}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00084}00084     \textcolor{keywordtype}{int} n; \textcolor{comment}{// Dimension of the problem}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00085}00085     \textcolor{keywordtype}{char} which[3]; \textcolor{comment}{// Set which eigenvalues are required.}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00086}00086     \textcolor{keywordtype}{int} nev; \textcolor{comment}{// Number of eigenvalues desired}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00087}00087     \textcolor{keywordtype}{double} tol = 0.0; \textcolor{comment}{// Stopping criteria}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00088}00088     \textcolor{keywordtype}{int} ncv; \textcolor{comment}{// Number of columns of the matrix V (Dimension of Arnoldi}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00089}00089              \textcolor{comment}{// subspace)}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00090}00090     \textcolor{keywordtype}{int} iparam[11] = \{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0\}; \textcolor{comment}{// Control parameters}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00091}00091     \textcolor{comment}{// Pointers to starting locations in the workspace vectors}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00092}00092     \textcolor{keywordtype}{int} ipntr[14] = \{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0\};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00093}00093     \textcolor{keywordtype}{int} info =}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00094}00094       0; \textcolor{comment}{// Setting to zero gives random initial guess for vector to start}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00095}00095     \textcolor{comment}{// Arnoldi iteration}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00096}00096 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00097}00097     \textcolor{comment}{// Set up the sizes of the matrix}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00098}00098     n = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}(); \textcolor{comment}{// Total size of matrix}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00099}00099     nev = n\_eval; \textcolor{comment}{// Number of desired eigenvalues}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00100}00100     ncv = \mbox{\hyperlink{classoomph_1_1ARPACK_a2f430dc8c1a8d890a90a95bdd66e97cc}{NArnoldi}} < n ? \mbox{\hyperlink{classoomph_1_1ARPACK_a2f430dc8c1a8d890a90a95bdd66e97cc}{NArnoldi}} : n; \textcolor{comment}{// Number of Arnoldi vectors allowed}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00101}00101                                        \textcolor{comment}{// Maximum possible value is max}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00102}00102                                        \textcolor{comment}{// dimension of matrix}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00103}00103 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00104}00104     \textcolor{comment}{// If we don't have enough Arnoldi vectors to compute the desired number}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00105}00105     \textcolor{comment}{// of eigenvalues then complain}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00106}00106     \textcolor{keywordflow}{if} (nev > ncv)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00107}00107     \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00108}00108       std::ostringstream warning\_stream;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00109}00109       warning\_stream << \textcolor{stringliteral}{"{}Number of requested eigenvalues "{}} << nev << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00110}00110                      << \textcolor{stringliteral}{"{}is greater than the number of Arnoldi vectors:"{}} << ncv}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00111}00111                      << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00112}00112       \textcolor{comment}{// Increase the number of Arnoldi vectors}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00113}00113       ncv = nev + 10;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00114}00114       \textcolor{keywordflow}{if} (ncv > n)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00115}00115       \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00116}00116         ncv = n;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00117}00117       \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00118}00118 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00119}00119       warning\_stream << \textcolor{stringliteral}{"{}Increasing number of Arnoldi vectors to "{}} << ncv}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00120}00120                      << \textcolor{stringliteral}{"{}\(\backslash\)n but you may want to increase further using\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00121}00121                      << \textcolor{stringliteral}{"{}ARPACK::narnoldi()\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00122}00122                      << \textcolor{stringliteral}{"{}which will also get rid of this warning.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00123}00123 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00124}00124       \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00125}00125         warning\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00126}00126     \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00127}00127 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00128}00128     \textcolor{comment}{// Allocate some workspace}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00129}00129     \textcolor{keywordtype}{int} lworkl = 3 * ncv * ncv + 6 * ncv;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00130}00130 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00131}00131     \textcolor{comment}{// Array that holds the final set of Arnoldi basis vectors}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00132}00132     \textcolor{keywordtype}{double}** v = \textcolor{keyword}{new} \textcolor{keywordtype}{double}*;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00133}00133     *v = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[ncv * n];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00134}00134     \textcolor{comment}{// Leading dimension of v (n)}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00135}00135     \textcolor{keywordtype}{int} ldv = n;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00136}00136 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00137}00137     \textcolor{comment}{// Residual vector}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00138}00138     \textcolor{keywordtype}{double}* resid = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[n];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00139}00139     \textcolor{comment}{// Workspace vector}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00140}00140     \textcolor{keywordtype}{double}* workd = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[3 * n];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00141}00141     \textcolor{comment}{// Workspace vector}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00142}00142     \textcolor{keywordtype}{double}* workl = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[lworkl];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00143}00143 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00144}00144     bmat[0] = \textcolor{charliteral}{'G'};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00145}00145     \textcolor{comment}{// If we require eigenvalues to the left of the shift}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00146}00146     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1ARPACK_aa92552280868d74242f71c6f98db79e8}{Small}})}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00147}00147     \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00148}00148       which[0] = \textcolor{charliteral}{'S'};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00149}00149     \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00150}00150     \textcolor{comment}{// Otherwise we require eigenvalues to the right of the shift}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00151}00151     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00152}00152     \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00153}00153       which[0] = \textcolor{charliteral}{'L'};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00154}00154     \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00155}00155 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00156}00156     \textcolor{comment}{// Which part of the eigenvalue interests us}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00157}00157     \textcolor{keywordflow}{switch} (\mbox{\hyperlink{classoomph_1_1ARPACK_a212ff2ad05b73b8f1e4f0d8d10733015}{Spectrum}})}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00158}00158     \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00159}00159         \textcolor{comment}{// Imaginary part}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00160}00160       \textcolor{keywordflow}{case} -\/1:}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00161}00161         which[1] = \textcolor{charliteral}{'I'};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00162}00162         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00163}00163 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00164}00164         \textcolor{comment}{// Magnitude}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00165}00165       \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00166}00166         which[1] = \textcolor{charliteral}{'M'};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00167}00167         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00168}00168 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00169}00169         \textcolor{comment}{// Real part}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00170}00170       \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00171}00171         which[1] = \textcolor{charliteral}{'R'};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00172}00172         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00173}00173 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00174}00174       \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00175}00175         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00176}00176         error\_stream}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00177}00177           << \textcolor{stringliteral}{"{}Spectrum is set to an invalid value. It must be 0, 1 or -\/1\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00178}00178           << \textcolor{stringliteral}{"{}Not "{}} << \mbox{\hyperlink{classoomph_1_1ARPACK_a212ff2ad05b73b8f1e4f0d8d10733015}{Spectrum}} << std::endl;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00179}00179 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00180}00180         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00181}00181           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00182}00182     \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00183}00183 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00184}00184     \textcolor{comment}{//     \%-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\%}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00185}00185     \textcolor{comment}{//     | This program uses exact shifts with respect to    |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00186}00186     \textcolor{comment}{//     | the current Hessenberg matrix (IPARAM(1) = 1).    |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00187}00187     \textcolor{comment}{//     | IPARAM(3) specifies the maximum number of Arnoldi |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00188}00188     \textcolor{comment}{//     | iterations allowed.  Mode 3 of DNAUPD is used     |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00189}00189     \textcolor{comment}{//     | (IPARAM(7) = 3). All these options can be changed |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00190}00190     \textcolor{comment}{//     | by the user. For details see the documentation in |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00191}00191     \textcolor{comment}{//     | DNAUPD.                                           |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00192}00192     \textcolor{comment}{//     \%-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\%}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00193}00193 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00194}00194     \textcolor{keywordtype}{int} ishifts = 1;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00195}00195     \textcolor{keywordtype}{int} maxitr = 300;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00196}00196     \textcolor{keywordtype}{int} mode = 3; \textcolor{comment}{// M is symetric and semi-\/definite}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00197}00197 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00198}00198     iparam[0] = ishifts; \textcolor{comment}{// Exact shifts wrt Hessenberg matrix H}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00199}00199     iparam[2] = maxitr; \textcolor{comment}{// Maximum number of allowed iterations}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00200}00200     iparam[3] = 1; \textcolor{comment}{// Bloacksize to be used in the recurrence}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00201}00201     iparam[6] = mode; \textcolor{comment}{// Mode is shift and invert in real arithmetic}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00202}00202 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00203}00203     \textcolor{comment}{// Real and imaginary parts of the shift}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00204}00204     \textcolor{keywordtype}{double} sigmar = \mbox{\hyperlink{classoomph_1_1EigenSolver_ab0ead9f50f12f8d6acf9be4521de95a1}{Sigma\_real}}, sigmai = 0.0;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00205}00205 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00206}00206     \textcolor{comment}{// TEMPORARY}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00207}00207     \textcolor{comment}{// only use non distributed matrice and vectors}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00208}00208     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} dist(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), n, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00209}00209     this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ac5340bac40b9559b0378037b57005203}{build\_distribution}}(dist);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00210}00210 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00211}00211     \textcolor{comment}{// Before we get into the Arnoldi loop solve the shifted matrix problem}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00212}00212     \textcolor{comment}{// Allocated Row compressed matrices for the mass matrix and shifted main}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00213}00213     \textcolor{comment}{// matrix}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00214}00214     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}} M(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()), AsigmaM(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00215}00215 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00216}00216     \textcolor{comment}{// Assemble the matrices}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00217}00217     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a17e2d84700ac43c1db1d68143790ae5c}{get\_eigenproblem\_matrices}}(M, AsigmaM, sigmar);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00218}00218 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00219}00219     \textcolor{comment}{// Allocate storage for the vectors to be used in matrix vector products}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00220}00220     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} rhs(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00221}00221     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} x(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00222}00222 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00223}00223 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00224}00224     \textcolor{keywordtype}{bool} LOOP\_FLAG = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00225}00225     \textcolor{keywordtype}{bool} First = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00226}00226 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00227}00227     \textcolor{comment}{// Enable resolves for the linear solver}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00228}00228     \mbox{\hyperlink{classoomph_1_1ARPACK_a647a45676349ba86abd5d2ff9aff022d}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3000ebd9becb3468d8a6a821a9cc0cd9}{enable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00229}00229 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00230}00230     \textcolor{comment}{// Do not report the time taken}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00231}00231     \mbox{\hyperlink{classoomph_1_1ARPACK_a647a45676349ba86abd5d2ff9aff022d}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a91ffe51f3de82dad1a110c099f256d73}{disable\_doc\_time}}();}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00232}00232 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00233}00233     \textcolor{keywordflow}{do}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00234}00234     \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00235}00235       \textcolor{comment}{//        \%-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\%}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00236}00236       \textcolor{comment}{//        | Repeatedly call the routine DNAUPD and take |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00237}00237       \textcolor{comment}{//        | actions indicated by parameter IDO until    |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00238}00238       \textcolor{comment}{//        | either convergence is indicated or maxitr   |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00239}00239       \textcolor{comment}{//        | has been exceeded.                          |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00240}00240       \textcolor{comment}{//        \%-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\%}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00241}00241       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00242}00242 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00243}00243       DNAUPD(ido,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00244}00244              bmat,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00245}00245              n,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00246}00246              which,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00247}00247              nev,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00248}00248              tol,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00249}00249              resid,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00250}00250              ncv,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00251}00251              v,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00252}00252              ldv,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00253}00253              iparam,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00254}00254              ipntr,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00255}00255              workd,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00256}00256              workl,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00257}00257              lworkl,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00258}00258              info);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00259}00259 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00260}00260       \textcolor{keywordflow}{if} (ido == -\/1)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00261}00261       \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00262}00262         \textcolor{comment}{//           \%-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\%}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00263}00263         \textcolor{comment}{//           | Perform matrix vector multiplication      |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00264}00264         \textcolor{comment}{//           |                y <-\/-\/-\/ OP*x                |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00265}00265         \textcolor{comment}{//           | The user should supply his/her own        |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00266}00266         \textcolor{comment}{//           | matrix vector multiplication routine here |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00267}00267         \textcolor{comment}{//           | that takes workd(ipntr(1)) as the input   |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00268}00268         \textcolor{comment}{//           | vector, and return the matrix vector      |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00269}00269         \textcolor{comment}{//           | product to workd(ipntr(2)).               |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00270}00270         \textcolor{comment}{//           \%-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\%}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00271}00271         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00272}00272 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00273}00273         \textcolor{comment}{// Firstly multiply by mx}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00274}00274         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00275}00275         \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00276}00276           x[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = workd[ipntr[0] -\/ 1 + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00277}00277         \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00278}00278         M.multiply(x, rhs);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00279}00279 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00280}00280         \textcolor{comment}{// Now solve the system}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00281}00281         \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} temp(rhs);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00282}00282         \textcolor{keywordflow}{if} (First)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00283}00283         \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00284}00284           \mbox{\hyperlink{classoomph_1_1ARPACK_a647a45676349ba86abd5d2ff9aff022d}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a15ce22542b74ed1826ea485edacbeb6e}{solve}}(\&AsigmaM, temp, rhs);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00285}00285           First = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00286}00286         \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00287}00287         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00288}00288         \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00289}00289           \mbox{\hyperlink{classoomph_1_1ARPACK_a647a45676349ba86abd5d2ff9aff022d}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(temp, rhs);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00290}00290         \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00291}00291         temp.\mbox{\hyperlink{classoomph_1_1DoubleVector_af1677445056759263b1b076966e7bfae}{clear}}();}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00292}00292         \textcolor{comment}{// AsigmaM.lubksub(rhs);}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00293}00293         \textcolor{comment}{// Put the solution into the workspace}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00294}00294         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00295}00295         \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00296}00296           workd[ipntr[1] -\/ 1 + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = rhs[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00297}00297         \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00298}00298 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00299}00299         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00300}00300       \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00301}00301       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ido == 1)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00302}00302       \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00303}00303         \textcolor{comment}{// Already done multiplication by Mx}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00304}00304         \textcolor{comment}{// Need to load the rhs vector}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00305}00305         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00306}00306         \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00307}00307           rhs[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = workd[ipntr[2] -\/ 1 + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00308}00308         \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00309}00309         \textcolor{comment}{// Now solve the system}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00310}00310         \textcolor{comment}{// AsigmaM.lubksub(rhs);}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00311}00311         \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} temp(rhs);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00312}00312         \textcolor{keywordflow}{if} (First)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00313}00313         \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00314}00314           \mbox{\hyperlink{classoomph_1_1ARPACK_a647a45676349ba86abd5d2ff9aff022d}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a15ce22542b74ed1826ea485edacbeb6e}{solve}}(\&AsigmaM, temp, rhs);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00315}00315           First = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00316}00316         \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00317}00317         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00318}00318         \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00319}00319           \mbox{\hyperlink{classoomph_1_1ARPACK_a647a45676349ba86abd5d2ff9aff022d}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(temp, rhs);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00320}00320         \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00321}00321         \textcolor{comment}{// Put the solution into the workspace}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00322}00322         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00323}00323         \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00324}00324           workd[ipntr[1] -\/ 1 + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = rhs[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00325}00325         \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00326}00326         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00327}00327       \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00328}00328       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ido == 2)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00329}00329       \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00330}00330         \textcolor{comment}{// Need to multiply by mass matrix}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00331}00331         \textcolor{comment}{// Vector<double> x(n);}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00332}00332         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00333}00333         \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00334}00334           x[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = workd[ipntr[0] -\/ 1 + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00335}00335         \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00336}00336         M.multiply(x, rhs);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00337}00337 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00338}00338         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00339}00339         \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00340}00340           workd[ipntr[1] -\/ 1 + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = rhs[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00341}00341         \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00342}00342         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00343}00343       \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00344}00344 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00345}00345       \textcolor{keywordflow}{if} (info < 0)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00346}00346       \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00347}00347         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}ERROR"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00348}00348         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Error with \_naupd, info = '"{}} << info << std::endl;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00349}00349         \textcolor{keywordflow}{if} (info == -\/7)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00350}00350         \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00351}00351           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Not enough memory "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00352}00352         \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00353}00353       \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00354}00354 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00355}00355       \textcolor{comment}{//        \%-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\%}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00356}00356       \textcolor{comment}{//        | No fatal errors occurred.                 |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00357}00357       \textcolor{comment}{//        | Post-\/Process using DNEUPD.                |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00358}00358       \textcolor{comment}{//        |                                           |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00359}00359       \textcolor{comment}{//        | Computed eigenvalues may be extracted.    |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00360}00360       \textcolor{comment}{//        |                                           |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00361}00361       \textcolor{comment}{//        | Eigenvectors may also be computed now if  |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00362}00362       \textcolor{comment}{//        | desired.  (indicated by rvec = .true.)    |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00363}00363       \textcolor{comment}{//        \%-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\%}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00364}00364       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00365}00365       LOOP\_FLAG = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00366}00366     \} \textcolor{keywordflow}{while} (LOOP\_FLAG);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00367}00367 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00368}00368     \textcolor{comment}{// Report any problems}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00369}00369     \textcolor{keywordflow}{if} (info == 1)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00370}00370     \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00371}00371       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Maximum number of iterations reached."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00372}00372     \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00373}00373     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (info == 3)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00374}00374     \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00375}00375       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}No shifts could be applied during implicit Arnoldi "{}}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00376}00376                  << \textcolor{stringliteral}{"{}update, try increasing NCV. "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00377}00377     \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00378}00378 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00379}00379     \textcolor{comment}{// Disable resolves for the linear solver}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00380}00380     \mbox{\hyperlink{classoomph_1_1ARPACK_a647a45676349ba86abd5d2ff9aff022d}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_ad61c63af94c5961830bd9807225a48d6}{disable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00381}00381 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00382}00382     \textcolor{comment}{// Compute Ritz or Schur vectors, if desired}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00383}00383     \textcolor{keywordtype}{int} rvec = \mbox{\hyperlink{classoomph_1_1ARPACK_af8a6dba4dca423fd67488e34970886df}{Compute\_eigenvectors}};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00384}00384     \textcolor{comment}{// Specify the form of the basis computed}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00385}00385     \textcolor{keywordtype}{char} howmany[2];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00386}00386     howmany[0] = \textcolor{charliteral}{'A'};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00387}00387     \textcolor{comment}{// Find out the number of converged eigenvalues}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00388}00388     \textcolor{keywordtype}{int} nconv = iparam[4];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00389}00389 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00390}00390     \textcolor{comment}{// Note that there is an error (feature) in ARPACK that}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00391}00391     \textcolor{comment}{// means in certain cases, if we request eigenvectors,}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00392}00392     \textcolor{comment}{// consequent Schur factorization of the matrix spanned}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00393}00393     \textcolor{comment}{// by the Arnoldi vectors leads to more converged eigenvalues}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00394}00394     \textcolor{comment}{// than reported by DNAPUD. This is a pain because it}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00395}00395     \textcolor{comment}{// causes a segmentation fault and in every case that I've found}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00396}00396     \textcolor{comment}{// the eigenvalues/vectors are not those desired.}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00397}00397     \textcolor{comment}{// At the moment, I'm just going to leave it, but I note}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00398}00398     \textcolor{comment}{// the problem here to remind myself about it.}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00399}00399 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00400}00400     \textcolor{comment}{// Array to select which Ritz vectors are computed}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00401}00401     \textcolor{keywordtype}{int} select[ncv];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00402}00402     \textcolor{comment}{// Array that holds the real part of the eigenvalues}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00403}00403     \textcolor{keywordtype}{double}* eval\_real = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[nconv + 1];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00404}00404     \textcolor{comment}{// Array that holds the imaginary part of the eigenvalues}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00405}00405     \textcolor{keywordtype}{double}* eval\_imag = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[nconv + 1];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00406}00406 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00407}00407     \textcolor{comment}{// Workspace}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00408}00408     \textcolor{keywordtype}{double}* workev = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[3 * ncv];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00409}00409     \textcolor{comment}{// Array to hold the eigenvectors}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00410}00410     \textcolor{keywordtype}{double}** z = \textcolor{keyword}{new} \textcolor{keywordtype}{double}*;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00411}00411     *z = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[(nconv + 1) * n];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00412}00412 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00413}00413     \textcolor{comment}{// Error flag}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00414}00414     \textcolor{keywordtype}{int} ierr;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00415}00415 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00416}00416     DNEUPD(rvec,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00417}00417            howmany,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00418}00418            select,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00419}00419            eval\_real,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00420}00420            eval\_imag,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00421}00421            z,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00422}00422            ldv,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00423}00423            sigmar,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00424}00424            sigmai,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00425}00425            workev,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00426}00426            bmat,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00427}00427            n,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00428}00428            which,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00429}00429            nev,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00430}00430            tol,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00431}00431            resid,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00432}00432            ncv,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00433}00433            v,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00434}00434            ldv,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00435}00435            iparam,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00436}00436            ipntr,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00437}00437            workd,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00438}00438            workl,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00439}00439            lworkl,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00440}00440            ierr);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00441}00441     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00442}00442     \textcolor{comment}{//        \%-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\%}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00443}00443     \textcolor{comment}{//        | The real part of the eigenvalue is returned   |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00444}00444     \textcolor{comment}{//        | in the first column of the two dimensional    |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00445}00445     \textcolor{comment}{//        | array D, and the imaginary part is returned   |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00446}00446     \textcolor{comment}{//        | in the second column of D.  The corresponding |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00447}00447     \textcolor{comment}{//        | eigenvectors are returned in the first NEV    |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00448}00448     \textcolor{comment}{//        | columns of the two dimensional array V if     |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00449}00449     \textcolor{comment}{//        | requested.  Otherwise, an orthogonal basis    |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00450}00450     \textcolor{comment}{//        | for the invariant subspace corresponding to   |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00451}00451     \textcolor{comment}{//        | the eigenvalues in D is returned in V.        |}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00452}00452     \textcolor{comment}{//        \%-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\%}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00453}00453 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00454}00454     \textcolor{keywordflow}{if} (ierr != 0)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00455}00455     \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00456}00456       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Error with \_neupd, info = "{}} << ierr << std::endl;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00457}00457     \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00458}00458     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00459}00459     \textcolor{comment}{// Print the output anyway}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00460}00460     \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00461}00461       \textcolor{comment}{// Resize the eigenvalue output vector}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00462}00462       eigenvalue.resize(nconv);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00463}00463       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < nconv; j++)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00464}00464       \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00465}00465         \textcolor{comment}{// Turn the output from ARPACK into a complex number}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00466}00466         std::complex<double> eigen(eval\_real[j], eval\_imag[j]);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00467}00467         \textcolor{comment}{// Add the eigenvalues to the output vector}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00468}00468         eigenvalue[j] = eigen;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00469}00469       \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00470}00470 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00471}00471       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1ARPACK_af8a6dba4dca423fd67488e34970886df}{Compute\_eigenvectors}})}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00472}00472       \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00473}00473         \textcolor{comment}{// Load the eigenvectors}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00474}00474         eigenvector.resize(nconv);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00475}00475         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < nconv; j++)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00476}00476         \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00477}00477           eigenvector[j].build(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00478}00478           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00479}00479           \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00480}00480             eigenvector[j][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = z[0][j * n + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00481}00481           \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00482}00482         \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00483}00483       \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00484}00484       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00485}00485       \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00486}00486         eigenvector.resize(0);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00487}00487       \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00488}00488 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00489}00489       \textcolor{comment}{// Report the information}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00490}00490       \textcolor{keywordflow}{if} (Verbose)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00491}00491       \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00492}00492         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{} ARPACK "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00493}00493         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{} ====== "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00494}00494         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{} Size of the matrix is "{}} << n << std::endl;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00495}00495         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{} The number of Ritz values requested is "{}} << nev}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00496}00496                    << std::endl;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00497}00497         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{} The number of Arnoldi vectors generated (NCV) is "{}}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00498}00498                    << ncv << std::endl;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00499}00499         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{} What portion of the spectrum: "{}} << which << std::endl;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00500}00500         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{} The number of converged Ritz values is "{}} << nconv}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00501}00501                    << std::endl;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00502}00502         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00503}00503           << \textcolor{stringliteral}{"{} The number of Implicit Arnoldi update iterations taken is "{}}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00504}00504           << iparam[2] << std::endl;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00505}00505         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{} The number of OP*x is "{}} << iparam[8] << std::endl;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00506}00506         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{} The convergence criterion is "{}} << tol << std::endl;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00507}00507       \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00508}00508     \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00509}00509 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00510}00510     \textcolor{comment}{// Clean up the allocated memory}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00511}00511     \textcolor{keyword}{delete}[] * z;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00512}00512     *z = 0;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00513}00513     \textcolor{keyword}{delete} z;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00514}00514     z = 0;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00515}00515     \textcolor{keyword}{delete}[] workev;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00516}00516     workev = 0;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00517}00517     \textcolor{keyword}{delete}[] eval\_imag;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00518}00518     eval\_imag = 0;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00519}00519     \textcolor{keyword}{delete}[] eval\_real;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00520}00520     eval\_real = 0;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00521}00521 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00522}00522     \textcolor{comment}{// Clean up the memory}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00523}00523     \textcolor{keyword}{delete}[] workl;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00524}00524     workl = 0;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00525}00525     \textcolor{keyword}{delete}[] workd;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00526}00526     workd = 0;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00527}00527     \textcolor{keyword}{delete}[] resid;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00528}00528     resid = 0;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00529}00529     \textcolor{keyword}{delete}[] * v;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00530}00530     *v = 0;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00531}00531     \textcolor{keyword}{delete} v;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00532}00532     v = 0;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00533}00533   \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00534}00534 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00535}00535 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00536}00536   \textcolor{comment}{//==========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00537}00537 \textcolor{comment}{  /// Use LAPACK to solve an eigen problem that is assembled by elements in}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00538}00538 \textcolor{comment}{  /// a mesh in a Problem object.}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00539}00539 \textcolor{comment}{}  \textcolor{comment}{//==========================================================================}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00540}\mbox{\hyperlink{classoomph_1_1LAPACK__QZ_ae1efb27c494ea6fb0ce1267233c78f74}{00540}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1LAPACK__QZ_ae1efb27c494ea6fb0ce1267233c78f74}{LAPACK\_QZ::solve\_eigenproblem}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00541}00541                                      \textcolor{keyword}{const} \textcolor{keywordtype}{int}\& n\_eval,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00542}00542                                      \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<std::complex<double>>\& eigenvalue,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00543}00543                                      \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& eigenvector)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00544}00544   \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00545}00545     \textcolor{comment}{// Some character identifiers for use in the LAPACK routine}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00546}00546     \textcolor{comment}{// Do not calculate the left eigenvectors}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00547}00547     \textcolor{keywordtype}{char} no\_eigvecs[2] = \textcolor{stringliteral}{"{}N"{}};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00548}00548     \textcolor{comment}{// Do caculate the eigenvectors}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00549}00549     \textcolor{keywordtype}{char} eigvecs[2] = \textcolor{stringliteral}{"{}V"{}};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00550}00550 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00551}00551     \textcolor{comment}{// Get the dimension of the matrix}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00552}00552     \textcolor{keywordtype}{int} n = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}(); \textcolor{comment}{// Total size of matrix}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00553}00553 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00554}00554     \textcolor{comment}{// Initialise a padding integer}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00555}00555     \textcolor{keywordtype}{int} padding = 0;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00556}00556     \textcolor{comment}{// If the dimension of the matrix is even, then pad the arrays to}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00557}00557     \textcolor{comment}{// make the size odd. This somehow sorts out a strange run-\/time behaviour}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00558}00558     \textcolor{comment}{// identified by Rich Hewitt.}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00559}00559     \textcolor{keywordflow}{if} (n \% 2 == 0)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00560}00560     \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00561}00561       padding = 1;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00562}00562     \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00563}00563 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00564}00564     \textcolor{comment}{// Get the real and imaginary parts of the shift}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00565}00565     \textcolor{keywordtype}{double} sigmar = \mbox{\hyperlink{classoomph_1_1EigenSolver_ab0ead9f50f12f8d6acf9be4521de95a1}{Sigma\_real}}; \textcolor{comment}{// sigmai = 0.0;}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00566}00566 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00567}00567     \textcolor{comment}{// Actual size of matrix that will be allocated}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00568}00568     \textcolor{keywordtype}{int} padded\_n = n + padding;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00569}00569 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00570}00570     \textcolor{comment}{// Storage for the matrices in the packed form required by the LAPACK}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00571}00571     \textcolor{comment}{// routine}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00572}00572     \textcolor{keywordtype}{double}* M = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[padded\_n * padded\_n];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00573}00573     \textcolor{keywordtype}{double}* A = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[padded\_n * padded\_n];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00574}00574 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00575}00575     \textcolor{comment}{// TEMPORARY}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00576}00576     \textcolor{comment}{// only use non-\/distributed matrices and vectors}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00577}00577     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} dist(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), n, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00578}00578     this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ac5340bac40b9559b0378037b57005203}{build\_distribution}}(dist);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00579}00579 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00580}00580     \textcolor{comment}{// Enclose in a separate scope so that memory is cleaned after assembly}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00581}00581     \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00582}00582       \textcolor{comment}{// Allocated Row compressed matrices for the mass matrix and shifted main}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00583}00583       \textcolor{comment}{// matrix}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00584}00584       \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}} temp\_M(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()),}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00585}00585         temp\_AsigmaM(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00586}00586 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00587}00587       \textcolor{comment}{// Assemble the matrices}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00588}00588       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a17e2d84700ac43c1db1d68143790ae5c}{get\_eigenproblem\_matrices}}(temp\_M, temp\_AsigmaM, sigmar);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00589}00589 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00590}00590       \textcolor{comment}{// Now convert these matrices into the appropriate packed form}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00591}00591       \textcolor{keywordtype}{unsigned} index = 0;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00592}00592       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n; ++\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00593}00593       \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00594}00594         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < n; ++j)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00595}00595         \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00596}00596           M[index] = temp\_M(j, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00597}00597           A[index] = temp\_AsigmaM(j, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00598}00598           ++index;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00599}00599         \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00600}00600         \textcolor{comment}{// If necessary pad the columns with zeros}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00601}00601         \textcolor{keywordflow}{if} (padding)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00602}00602         \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00603}00603           M[index] = 0.0;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00604}00604           A[index] = 0.0;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00605}00605           ++index;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00606}00606         \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00607}00607       \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00608}00608       \textcolor{comment}{// No need to pad the final row because it is never accessed by the}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00609}00609       \textcolor{comment}{// routine.}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00610}00610     \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00611}00611 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00612}00612     \textcolor{comment}{// Temporary eigenvalue storage}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00613}00613     \textcolor{keywordtype}{double}* alpha\_r = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[n];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00614}00614     \textcolor{keywordtype}{double}* alpha\_i = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[n];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00615}00615     \textcolor{keywordtype}{double}* beta = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[n];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00616}00616     \textcolor{comment}{// Temporary eigenvector storage}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00617}00617     \textcolor{keywordtype}{double}* vec\_left = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[1];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00618}00618     \textcolor{keywordtype}{double}* vec\_right = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[n * n];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00619}00619 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00620}00620     \textcolor{comment}{// Workspace for the LAPACK routine}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00621}00621     std::vector<double> work(1, 0.0);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00622}00622     \textcolor{comment}{// Info flag for the LAPACK routine}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00623}00623     \textcolor{keywordtype}{int} info = 0;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00624}00624 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00625}00625     \textcolor{comment}{// Call FORTRAN LAPACK to get the required workspace}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00626}00626     \textcolor{comment}{// Note the use of the padding flag}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00627}00627     LAPACK\_DGGEV(no\_eigvecs,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00628}00628                  eigvecs,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00629}00629                  n,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00630}00630                  \&A[0],}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00631}00631                  padded\_n,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00632}00632                  \&M[0],}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00633}00633                  padded\_n,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00634}00634                  alpha\_r,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00635}00635                  alpha\_i,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00636}00636                  beta,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00637}00637                  vec\_left,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00638}00638                  1,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00639}00639                  vec\_right,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00640}00640                  n,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00641}00641                  \&work[0],}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00642}00642                  -\/1,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00643}00643                  info);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00644}00644 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00645}00645     \textcolor{comment}{// Get the amount of requires workspace}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00646}00646     \textcolor{keywordtype}{int} required\_workspace = (int)work[0];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00647}00647     \textcolor{comment}{// If we need it}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00648}00648     work.resize(required\_workspace);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00649}00649 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00650}00650     \textcolor{comment}{// call FORTRAN LAPACK again with the optimum workspace}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00651}00651     LAPACK\_DGGEV(no\_eigvecs,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00652}00652                  eigvecs,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00653}00653                  n,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00654}00654                  \&A[0],}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00655}00655                  padded\_n,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00656}00656                  \&M[0],}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00657}00657                  padded\_n,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00658}00658                  alpha\_r,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00659}00659                  alpha\_i,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00660}00660                  beta,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00661}00661                  vec\_left,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00662}00662                  1,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00663}00663                  vec\_right,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00664}00664                  n,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00665}00665                  \&work[0],}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00666}00666                  required\_workspace,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00667}00667                  info);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00668}00668 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00669}00669     \textcolor{comment}{// Now resize storage for the eigenvalues and eigenvectors}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00670}00670     \textcolor{comment}{// We get them all!}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00671}00671     eigenvalue.resize(n);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00672}00672     eigenvector.resize(n);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00673}00673 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00674}00674     \textcolor{comment}{// Now convert the output into our format}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00675}00675     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n; ++\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00676}00676     \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00677}00677       \textcolor{comment}{// N.B. This is naive and dangerous according to the documentation}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00678}00678       \textcolor{comment}{// beta could be very small giving over or under flow}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00679}00679       \textcolor{comment}{// Remember to fix the shift back again}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00680}00680       eigenvalue[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = std::complex<double>(sigmar + alpha\_r[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] / beta[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}],}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00681}00681                                            alpha\_i[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] / beta[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00682}00682 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00683}00683       \textcolor{comment}{// Resize the eigenvector  storage}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00684}00684       eigenvector[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].build(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00685}00685       \textcolor{comment}{// Load up the eigenvector (assume that it's real)}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00686}00686       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < n; ++k)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00687}00687       \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00688}00688         eigenvector[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}][k] = vec\_right[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} * n + k];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00689}00689       \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00690}00690     \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00691}00691 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00692}00692     \textcolor{comment}{// Delete all allocated storage}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00693}00693     \textcolor{keyword}{delete}[] vec\_right;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00694}00694     \textcolor{keyword}{delete}[] vec\_left;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00695}00695     \textcolor{keyword}{delete}[] beta;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00696}00696     \textcolor{keyword}{delete}[] alpha\_r;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00697}00697     \textcolor{keyword}{delete}[] alpha\_i;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00698}00698     \textcolor{keyword}{delete}[] A;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00699}00699     \textcolor{keyword}{delete}[] M;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00700}00700   \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00701}00701 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00702}00702 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00703}00703   \textcolor{comment}{//==========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00704}00704 \textcolor{comment}{  /// Use LAPACK to solve a complex eigen problem specified by the given}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00705}00705 \textcolor{comment}{  /// matrices.}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00706}00706 \textcolor{comment}{}  \textcolor{comment}{//==========================================================================}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00707}\mbox{\hyperlink{classoomph_1_1LAPACK__QZ_aaebeec8c3d313982d20ebce117d51665}{00707}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1LAPACK__QZ_aaebeec8c3d313982d20ebce117d51665}{LAPACK\_QZ::find\_eigenvalues}}(}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00708}00708     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1ComplexMatrixBase}{ComplexMatrixBase}}\& A,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00709}00709     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1ComplexMatrixBase}{ComplexMatrixBase}}\& M,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00710}00710     \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<std::complex<double>>\& eigenvalue,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00711}00711     \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<std::complex<double>>>\& eigenvector)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00712}00712   \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00713}00713     \textcolor{comment}{// Some character identifiers for use in the LAPACK routine}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00714}00714     \textcolor{comment}{// Do not calculate the left eigenvectors}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00715}00715     \textcolor{keywordtype}{char} no\_eigvecs[2] = \textcolor{stringliteral}{"{}N"{}};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00716}00716     \textcolor{comment}{// Do caculate the eigenvectors}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00717}00717     \textcolor{keywordtype}{char} eigvecs[2] = \textcolor{stringliteral}{"{}V"{}};}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00718}00718 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00719}00719     \textcolor{comment}{// Get the dimension of the matrix}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00720}00720     \textcolor{keywordtype}{int} n = A.\mbox{\hyperlink{classoomph_1_1ComplexMatrixBase_adcbdf19bc82c61c0a4fbfd8c8de97b3b}{nrow}}(); \textcolor{comment}{// Total size of matrix}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00721}00721 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00722}00722     \textcolor{comment}{// Storage for the matrices in the packed form required by the LAPACK}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00723}00723     \textcolor{comment}{// routine}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00724}00724     \textcolor{keywordtype}{double}* M\_linear = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[2 * n * n];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00725}00725     \textcolor{keywordtype}{double}* A\_linear = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[2 * n * n];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00726}00726 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00727}00727     \textcolor{comment}{// Now convert the matrices into the appropriate packed form}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00728}00728     \textcolor{keywordtype}{unsigned} index = 0;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00729}00729     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n; ++\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00730}00730     \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00731}00731       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < n; ++j)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00732}00732       \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00733}00733         M\_linear[index] = M(j, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}).real();}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00734}00734         A\_linear[index] = A(j, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}).real();}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00735}00735         ++index;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00736}00736         M\_linear[index] = M(j, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}).imag();}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00737}00737         A\_linear[index] = A(j, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}).imag();}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00738}00738         ++index;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00739}00739       \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00740}00740     \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00741}00741 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00742}00742     \textcolor{comment}{// Temporary eigenvalue storage}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00743}00743     \textcolor{keywordtype}{double}* alpha = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[2 * n];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00744}00744     \textcolor{keywordtype}{double}* beta = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[2 * n];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00745}00745     \textcolor{comment}{// Temporary eigenvector storage}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00746}00746     \textcolor{keywordtype}{double}* vec\_left = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[2];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00747}00747     \textcolor{keywordtype}{double}* vec\_right = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[2 * n * n];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00748}00748 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00749}00749     \textcolor{comment}{// Workspace for the LAPACK routine}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00750}00750     std::vector<double> work(2, 0.0);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00751}00751     std::vector<double> rwork(8 * n, 0.0);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00752}00752 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00753}00753     \textcolor{comment}{// Info flag for the LAPACK routine}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00754}00754     \textcolor{keywordtype}{int} info = 0;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00755}00755 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00756}00756     \textcolor{comment}{// Call FORTRAN LAPACK to get the required workspace}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00757}00757     \textcolor{comment}{// Note the use of the padding flag}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00758}00758     LAPACK\_ZGGEV(no\_eigvecs,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00759}00759                  eigvecs,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00760}00760                  n,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00761}00761                  \&A\_linear[0],}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00762}00762                  n,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00763}00763                  \&M\_linear[0],}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00764}00764                  n,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00765}00765                  alpha,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00766}00766                  beta,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00767}00767                  vec\_left,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00768}00768                  1,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00769}00769                  vec\_right,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00770}00770                  n,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00771}00771                  \&work[0],}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00772}00772                  -\/1,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00773}00773                  \&rwork[0],}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00774}00774                  info);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00775}00775 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00776}00776     \textcolor{comment}{// Get the amount of requires workspace}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00777}00777     \textcolor{keywordtype}{int} required\_workspace = (int)work[0];}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00778}00778     \textcolor{comment}{// If we need it}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00779}00779     work.resize(2 * required\_workspace);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00780}00780 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00781}00781     \textcolor{comment}{// call FORTRAN LAPACK again with the optimum workspace}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00782}00782     LAPACK\_ZGGEV(no\_eigvecs,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00783}00783                  eigvecs,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00784}00784                  n,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00785}00785                  \&A\_linear[0],}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00786}00786                  n,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00787}00787                  \&M\_linear[0],}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00788}00788                  n,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00789}00789                  alpha,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00790}00790                  beta,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00791}00791                  vec\_left,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00792}00792                  1,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00793}00793                  vec\_right,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00794}00794                  n,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00795}00795                  \&work[0],}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00796}00796                  required\_workspace,}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00797}00797                  \&rwork[0],}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00798}00798                  info);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00799}00799 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00800}00800     \textcolor{comment}{// Now resize storage for the eigenvalues and eigenvectors}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00801}00801     \textcolor{comment}{// We get them all!}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00802}00802     eigenvalue.resize(n);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00803}00803     eigenvector.resize(n);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00804}00804 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00805}00805     \textcolor{comment}{// Now convert the output into our format}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00806}00806     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n; ++\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00807}00807     \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00808}00808       \textcolor{comment}{// We have temporary complex numbers}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00809}00809       std::complex<double> num(alpha[2 * \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}], alpha[2 * \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + 1]);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00810}00810       std::complex<double> den(beta[2 * \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}], beta[2 * \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + 1]);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00811}00811 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00812}00812       \textcolor{comment}{// N.B. This is naive and dangerous according to the documentation}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00813}00813       \textcolor{comment}{// beta could be very small giving over or under flow}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00814}00814       eigenvalue[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = num / den;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00815}00815 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00816}00816       \textcolor{comment}{// Resize the eigenvector storage}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00817}00817       eigenvector[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].resize(n);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00818}00818       \textcolor{comment}{// Load up the eigenvector (assume that it's real)}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00819}00819       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < n; ++k)}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00820}00820       \{}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00821}00821         eigenvector[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}][k] = std::complex<double>(}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00822}00822           vec\_right[2 * \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} * n + 2 * k], vec\_right[2 * \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} * n + 2 * k + 1]);}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00823}00823       \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00824}00824     \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00825}00825 }
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00826}00826     \textcolor{comment}{// Delete all allocated storage}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00827}00827     \textcolor{keyword}{delete}[] vec\_right;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00828}00828     \textcolor{keyword}{delete}[] vec\_left;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00829}00829     \textcolor{keyword}{delete}[] beta;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00830}00830     \textcolor{keyword}{delete}[] alpha;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00831}00831     \textcolor{keyword}{delete}[] A\_linear;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00832}00832     \textcolor{keyword}{delete}[] M\_linear;}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00833}00833   \}}
\DoxyCodeLine{\Hypertarget{eigen__solver_8cc_source_l00834}00834 \} \textcolor{comment}{// namespace oomph}}

\end{DoxyCode}
