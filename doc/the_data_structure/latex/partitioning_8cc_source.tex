\hypertarget{partitioning_8cc_source}{}\doxysection{partitioning.\+cc}
\label{partitioning_8cc_source}\index{partitioning.cc@{partitioning.cc}}
\mbox{\hyperlink{partitioning_8cc}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00001}00001 \textcolor{comment}{// LIC// ====================================================================}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00002}00002 \textcolor{comment}{// LIC// This file forms part of oomph-\/lib, the object-\/oriented,}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00003}00003 \textcolor{comment}{// LIC// multi-\/physics finite-\/element library, available}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00004}00004 \textcolor{comment}{// LIC// at http://www.oomph-\/lib.org.}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00005}00005 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00006}00006 \textcolor{comment}{// LIC// Copyright (C) 2006-\/2022 Matthias Heil and Andrew Hazel}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00007}00007 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00008}00008 \textcolor{comment}{// LIC// This library is free software; you can redistribute it and/or}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00009}00009 \textcolor{comment}{// LIC// modify it under the terms of the GNU Lesser General Public}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00010}00010 \textcolor{comment}{// LIC// License as published by the Free Software Foundation; either}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00011}00011 \textcolor{comment}{// LIC// version 2.1 of the License, or (at your option) any later version.}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00012}00012 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00013}00013 \textcolor{comment}{// LIC// This library is distributed in the hope that it will be useful,}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00014}00014 \textcolor{comment}{// LIC// but WITHOUT ANY WARRANTY; without even the implied warranty of}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00015}00015 \textcolor{comment}{// LIC// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00016}00016 \textcolor{comment}{// LIC// Lesser General Public License for more details.}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00017}00017 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00018}00018 \textcolor{comment}{// LIC// You should have received a copy of the GNU Lesser General Public}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00019}00019 \textcolor{comment}{// LIC// License along with this library; if not, write to the Free Software}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00020}00020 \textcolor{comment}{// LIC// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00021}00021 \textcolor{comment}{// LIC// 02110-\/1301  USA.}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00022}00022 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00023}00023 \textcolor{comment}{// LIC// The authors may be contacted at oomph-\/lib@maths.man.ac.uk.}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00024}00024 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00025}00025 \textcolor{comment}{// LIC//====================================================================}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00026}00026 \textcolor{preprocessor}{\#include <float.h>}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00027}00027 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00028}00028 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{partitioning_8h}{partitioning.h}}"{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00029}00029 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{mesh_8h}{mesh.h}}"{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00030}00030 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{refineable__mesh_8h}{refineable\_mesh.h}}"{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00031}00031 \textcolor{comment}{// Include to fill in additional\_setup\_shared\_node\_scheme() function}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00032}00032 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{refineable__mesh_8template_8cc}{refineable\_mesh.template.cc}}"{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00033}00033 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00034}00034 \textcolor{preprocessor}{\#ifdef OOMPH\_TRANSITION\_TO\_VERSION\_3}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00035}00035 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00036}00036 \textcolor{comment}{// for the new METIS API, need to use symbols defined in the standard header}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00037}00037 \textcolor{comment}{// which aren't available in the current frozen (old) version of METIS}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00038}00038 \textcolor{comment}{// Version 3 will (presumably) have this header in the include path as standard}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00039}00039 \textcolor{preprocessor}{\#include "{}metis.h"{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00040}00040 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00041}00041 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00042}00042 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00043}00043 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceoomph}{oomph}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00044}00044 \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00045}00045   \textcolor{comment}{//====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00046}00046 \textcolor{comment}{  /// Namespace for METIS graph partitioning routines}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00047}00047 \textcolor{comment}{}  \textcolor{comment}{//====================================================================}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00048}\mbox{\hyperlink{namespaceoomph_1_1METIS}{00048}}   \textcolor{keyword}{namespace }METIS}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00049}00049   \{\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00050}00050 \textcolor{comment}{    /// Default function that translates spatial}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00051}00051 \textcolor{comment}{    /// error into weight for METIS partitioning (unit weight regardless}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00052}00052 \textcolor{comment}{    /// of input).}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00053}\mbox{\hyperlink{namespaceoomph_1_1METIS_af5633647d4ff099648151db2d7d0a1e5}{00053}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{namespaceoomph_1_1METIS_af5633647d4ff099648151db2d7d0a1e5}{default\_error\_to\_weight\_fct}}(\textcolor{keyword}{const} \textcolor{keywordtype}{double}\& spatial\_error,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00054}00054                                      \textcolor{keyword}{const} \textcolor{keywordtype}{double}\& max\_error,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00055}00055                                      \textcolor{keyword}{const} \textcolor{keywordtype}{double}\& min\_error,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00056}00056                                      \textcolor{keywordtype}{int}\& weight)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00057}00057     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00058}00058       weight = 1;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00059}00059     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00060}00060 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00061}00061 \textcolor{comment}{    /// Function pointer to to function that translates spatial}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00062}00062 \textcolor{comment}{    /// error into weight for METIS partitioning.}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00063}\mbox{\hyperlink{namespaceoomph_1_1METIS_af21fbb8dba025be51b3e27c1822243a5}{00063}} \textcolor{comment}{}    \mbox{\hyperlink{namespaceoomph_1_1METIS_aec228e35df8426d16639b961fcf98df1}{ErrorToWeightFctPt}} \mbox{\hyperlink{namespaceoomph_1_1METIS_af21fbb8dba025be51b3e27c1822243a5}{Error\_to\_weight\_fct\_pt}} = \&\mbox{\hyperlink{namespaceoomph_1_1METIS_af5633647d4ff099648151db2d7d0a1e5}{default\_error\_to\_weight\_fct}};}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00064}00064 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00065}00065   \} \textcolor{comment}{// namespace METIS}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00066}00066 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00067}00067 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00068}00068   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00069}00069 \textcolor{comment}{  /// Partition mesh uniformly by dividing elements}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00070}00070 \textcolor{comment}{  /// equally over the partitions, in the order}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00071}00071 \textcolor{comment}{  /// in which they are returned by problem.}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00072}00072 \textcolor{comment}{  /// On return, element\_domain[ielem] contains the number}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00073}00073 \textcolor{comment}{  /// of the domain [0,1,...,ndomain-\/1] to which}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00074}00074 \textcolor{comment}{  /// element ielem has been assigned.}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00075}00075 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00076}\mbox{\hyperlink{namespaceoomph_1_1METIS_a58831157b0cfadc57485c3de01df7d78}{00076}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{namespaceoomph_1_1METIS_a58831157b0cfadc57485c3de01df7d78}{METIS::uniform\_partition\_mesh}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* problem\_pt,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00077}00077                                      \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& ndomain,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00078}00078                                      \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& element\_domain)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00079}00079   \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00080}00080     \textcolor{comment}{// Number of elements}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00081}00081     \textcolor{keywordtype}{unsigned} nelem = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00082}00082 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00083}00083 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00084}00084     \textcolor{keywordflow}{if} (nelem != element\_domain.size())}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00085}00085     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00086}00086       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00087}00087       error\_stream << \textcolor{stringliteral}{"{}element\_domain Vector has wrong length "{}} << nelem << \textcolor{stringliteral}{"{} "{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00088}00088                    << element\_domain.size() << std::endl;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00089}00089 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00090}00090       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00091}00091         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00092}00092     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00093}00093 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00094}00094 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00095}00095 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00096}00096     \textcolor{comment}{// Uniform partitioning}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00097}00097     \textcolor{keywordtype}{unsigned} nel\_per\_domain = int(\textcolor{keywordtype}{float}(nelem) / \textcolor{keywordtype}{float}(ndomain));}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00098}00098     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} ielem = 0; ielem < nelem; ielem++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00099}00099     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00100}00100       \textcolor{keywordtype}{unsigned} idomain = unsigned(\textcolor{keywordtype}{float}(ielem) / \textcolor{keywordtype}{float}(nel\_per\_domain));}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00101}00101       element\_domain[ielem] = idomain;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00102}00102     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00103}00103   \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00104}00104 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00105}00105 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00106}00106   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00107}00107 \textcolor{comment}{  /// Use METIS to assign each element to a domain.}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00108}00108 \textcolor{comment}{  /// On return, element\_domain[ielem] contains the number}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00109}00109 \textcolor{comment}{  /// of the domain [0,1,...,ndomain-\/1] to which}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00110}00110 \textcolor{comment}{  /// element ielem has been assigned.}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00111}00111 \textcolor{comment}{  /// -\/ objective=0: minimise edgecut.}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00112}00112 \textcolor{comment}{  /// -\/ objective=1: minimise total communications volume.}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00113}00113 \textcolor{comment}{  /// .}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00114}00114 \textcolor{comment}{  /// Partioning is based on dual graph of mesh.}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00115}00115 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00116}\mbox{\hyperlink{namespaceoomph_1_1METIS_aa3c7e4be46d6148cc60f43354127fc94}{00116}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{namespaceoomph_1_1METIS_aa3c7e4be46d6148cc60f43354127fc94}{METIS::partition\_mesh}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* problem\_pt,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00117}00117                              \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& ndomain,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00118}00118                              \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& objective,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00119}00119                              \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& element\_domain)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00120}00120   \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00121}00121     \textcolor{comment}{// Global mesh}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00122}00122     \mbox{\hyperlink{classoomph_1_1Mesh}{Mesh}}* mesh\_pt = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00123}00123 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00124}00124     \textcolor{comment}{// Number of elements}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00125}00125     \textcolor{keywordtype}{unsigned} nelem = mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00126}00126 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00127}00127 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00128}00128     \textcolor{keywordflow}{if} (nelem != element\_domain.size())}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00129}00129     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00130}00130       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00131}00131       error\_stream << \textcolor{stringliteral}{"{}element\_domain Vector has wrong length "{}} << nelem << \textcolor{stringliteral}{"{} "{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00132}00132                    << element\_domain.size() << std::endl;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00133}00133 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00134}00134       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00135}00135         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00136}00136     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00137}00137 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00138}00138 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00139}00139     \textcolor{comment}{// Setup dual graph}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00140}00140     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00141}00141 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00142}00142     \textcolor{comment}{// Start timer}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00143}00143     clock\_t cpu\_start = clock();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00144}00144 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00145}00145     \textcolor{comment}{// Container to collect all elements associated with given global eqn number}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00146}00146     std::map<unsigned, std::set<unsigned>> elements\_connected\_with\_global\_eqn;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00147}00147 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00148}00148     \textcolor{comment}{// Container for all unique global eqn numbers}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00149}00149     std::set<unsigned> all\_global\_eqns;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00150}00150 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00151}00151     \textcolor{comment}{// Loop over all elements}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00152}00152     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nelem; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00153}00153     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00154}00154       \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* el\_pt = mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00155}00155 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00156}00156       \textcolor{comment}{// Add all global eqn numbers}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00157}00157       \textcolor{keywordtype}{unsigned} ndof = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00158}00158       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < ndof; j++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00159}00159       \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00160}00160         \textcolor{comment}{// Get global eqn number}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00161}00161         \textcolor{keywordtype}{unsigned} eqn\_number = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(j);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00162}00162         elements\_connected\_with\_global\_eqn[eqn\_number].insert(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00163}00163         all\_global\_eqns.insert(eqn\_number);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00164}00164       \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00165}00165     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00166}00166 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00167}00167     \textcolor{comment}{// Now reverse the lookup scheme to find out all elements}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00168}00168     \textcolor{comment}{// that are connected because they share the same global eqn}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00169}00169     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<std::set<unsigned>}}> connected\_elements(nelem);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00170}00170 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00171}00171     \textcolor{comment}{// Counter for total number of entries in connected\_elements structure}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00172}00172     \textcolor{keywordtype}{unsigned} count = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00173}00173 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00174}00174     \textcolor{comment}{// Loop over all global eqns}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00175}00175     \textcolor{keywordflow}{for} (std::set<unsigned>::iterator it = all\_global\_eqns.begin();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00176}00176          it != all\_global\_eqns.end();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00177}00177          it++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00178}00178     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00179}00179       \textcolor{comment}{// Get set of elements connected with this data item}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00180}00180       std::set<unsigned> elements = elements\_connected\_with\_global\_eqn[*it];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00181}00181 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00182}00182       \textcolor{comment}{// Double loop over connnected elements: Everybody's connected to}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00183}00183       \textcolor{comment}{// everybody}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00184}00184       \textcolor{keywordflow}{for} (std::set<unsigned>::iterator it1 = elements.begin();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00185}00185            it1 != elements.end();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00186}00186            it1++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00187}00187       \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00188}00188         \textcolor{keywordflow}{for} (std::set<unsigned>::iterator it2 = elements.begin();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00189}00189              it2 != elements.end();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00190}00190              it2++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00191}00191         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00192}00192           \textcolor{keywordflow}{if} ((*it1) != (*it2))}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00193}00193           \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00194}00194             connected\_elements[(*it1)].insert(*it2);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00195}00195           \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00196}00196         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00197}00197       \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00198}00198     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00199}00199 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00200}00200 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00201}00201     \textcolor{comment}{// Now convert into C-\/style packed array for interface with METIS}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00202}00202     \textcolor{keywordtype}{int}* xadj = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nelem + 1];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00203}00203     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} adjacency\_vector;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00204}00204 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00205}00205     \textcolor{comment}{// Reserve (too much) space}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00206}00206     adjacency\_vector.reserve(count);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00207}00207 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00208}00208     \textcolor{comment}{// Initialise counters}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00209}00209     \textcolor{keywordtype}{unsigned} ientry = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00210}00210 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00211}00211     \textcolor{comment}{// Loop over all elements}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00212}00212     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nelem; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00213}00213     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00214}00214       \textcolor{comment}{// First entry for current element}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00215}00215       xadj[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = ientry;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00216}00216 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00217}00217       \textcolor{comment}{// Loop over elements that are connected to current element}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00218}00218       \textcolor{keyword}{typedef} std::set<unsigned>::iterator IT;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00219}00219       \textcolor{keywordflow}{for} (IT it = connected\_elements[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}].begin();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00220}00220            it != connected\_elements[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}].end();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00221}00221            it++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00222}00222       \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00223}00223         \textcolor{comment}{// Copy into adjacency array}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00224}00224         adjacency\_vector.push\_back(*it);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00225}00225 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00226}00226         \textcolor{comment}{// We've just made another entry}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00227}00227         ientry++;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00228}00228       \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00229}00229 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00230}00230       \textcolor{comment}{// Entry after last entry for current element:}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00231}00231       xadj[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} + 1] = ientry;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00232}00232     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00233}00233 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00234}00234     \textcolor{comment}{// End timer}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00235}00235     clock\_t cpu\_end = clock();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00236}00236 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00237}00237     \textcolor{comment}{// Doc}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00238}00238     \textcolor{keywordtype}{double} cpu0 = double(cpu\_end -\/ cpu\_start) / CLOCKS\_PER\_SEC;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00239}00239     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00240}00240       << \textcolor{stringliteral}{"{}CPU time for setup of METIS data structures            [nelem="{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00241}00241       << nelem << \textcolor{stringliteral}{"{}]: "{}} << cpu0 << \textcolor{stringliteral}{"{} sec"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00242}00242 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00243}00243 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00244}00244     \textcolor{comment}{// Call METIS graph partitioner}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00245}00245     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00246}00246 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00247}00247     \textcolor{comment}{// Start timer}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00248}00248     cpu\_start = clock();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00249}00249 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00250}00250     \textcolor{comment}{// Number of vertices in graph}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00251}00251     \textcolor{keywordtype}{int} nvertex = nelem;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00252}00252 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00253}00253     \textcolor{comment}{// No vertex weights}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00254}00254     \textcolor{keywordtype}{int}* vwgt = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00255}00255 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00256}00256     \textcolor{comment}{// No edge weights}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00257}00257     \textcolor{keywordtype}{int}* adjwgt = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00258}00258 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00259}00259     \textcolor{comment}{// Flag indicating that graph isn't weighted: 0; vertex weights only: 2}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00260}00260     \textcolor{comment}{// Note that wgtflag==2 requires nodal weights to be stored in vwgt.}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00261}00261     \textcolor{keywordtype}{int} wgtflag = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00262}00262 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00263}00263     \textcolor{comment}{// Use C-\/style numbering (first array entry is zero)}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00264}00264     \textcolor{keywordtype}{int} numflag = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00265}00265 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00266}00266     \textcolor{comment}{// Number of desired partitions}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00267}00267     \textcolor{keywordtype}{int} nparts = ndomain;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00268}00268 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00269}00269     \textcolor{comment}{// Use default options}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00270}00270     \textcolor{keywordtype}{int}* options = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[10];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00271}00271     options[0] = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00272}00272 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00273}00273 \textcolor{preprocessor}{\#ifdef OOMPH\_TRANSITION\_TO\_VERSION\_3}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00274}00274     \textcolor{keywordflow}{switch} (objective)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00275}00275     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00276}00276       \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00277}00277         \textcolor{comment}{// Edge-\/cut minimization}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00278}00278         options[0] = METIS\_OBJTYPE\_CUT;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00279}00279         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00280}00280 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00281}00281       \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00282}00282         \textcolor{comment}{// communication volume minimisation}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00283}00283         options[0] = METIS\_OBJTYPE\_VOL;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00284}00284         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00285}00285 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00286}00286       \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00287}00287         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00288}00288         error\_stream << \textcolor{stringliteral}{"{}Wrong objective for METIS. objective = "{}} << objective}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00289}00289                      << std::endl;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00290}00290 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00291}00291         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00292}00292           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00293}00293     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00294}00294 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00295}00295 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00296}00296     \textcolor{comment}{// Number of cut edges in graph}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00297}00297     \textcolor{keywordtype}{int}* edgecut = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nelem];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00298}00298 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00299}00299     \textcolor{comment}{// Array containing the partition information}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00300}00300     \textcolor{keywordtype}{int}* part = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nelem];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00301}00301 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00302}00302     \textcolor{comment}{// Can we get an error estimate?}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00303}00303 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00304}00304     \textcolor{keywordtype}{unsigned} n\_mesh = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_accc4e5a46953800933f07ae6bd67860e}{nsub\_mesh}}();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00305}00305 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00306}00306     \textcolor{keywordflow}{if} (n\_mesh == 0)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00307}00307     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00308}00308       \mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(mesh\_pt);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00309}00309       \textcolor{keywordflow}{if} (mmesh\_pt != 0)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00310}00310       \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00311}00311         \textcolor{comment}{// Bias distribution?}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00312}00312         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1METIS_af21fbb8dba025be51b3e27c1822243a5}{Error\_to\_weight\_fct\_pt}} != \&\mbox{\hyperlink{namespaceoomph_1_1METIS_af5633647d4ff099648151db2d7d0a1e5}{default\_error\_to\_weight\_fct}})}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00313}00313         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00314}00314           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00315}00315             << \textcolor{stringliteral}{"{}Biasing element distribution via spatial error estimate\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00316}00316 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00317}00317           \textcolor{comment}{// Adjust flag and provide storage for weights}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00318}00318           wgtflag = 2;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00319}00319           vwgt = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nelem];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00320}00320 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00321}00321           \textcolor{comment}{// Get error for all elements}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00322}00322           \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} elemental\_error(nelem);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00323}00323           mmesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a867aa4599846ac39bb0086fdb5eed470}{spatial\_error\_estimator\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1ErrorEstimator_a3b12c5d2579360a08b6b6298cea8b142}{get\_element\_errors}}(}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00324}00324             mesh\_pt, elemental\_error);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00325}00325 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00326}00326           \textcolor{keywordtype}{double} max\_error =}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00327}00327             *(std::max\_element(elemental\_error.begin(), elemental\_error.end()));}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00328}00328           \textcolor{keywordtype}{double} min\_error =}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00329}00329             *(std::min\_element(elemental\_error.begin(), elemental\_error.end()));}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00330}00330 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00331}00331           \textcolor{comment}{// Bias weights}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00332}00332           \textcolor{keywordtype}{int} weight = 1;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00333}00333           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nelem; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00334}00334           \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00335}00335             \textcolor{comment}{// Translate error into weight}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00336}00336             \mbox{\hyperlink{namespaceoomph_1_1METIS_af21fbb8dba025be51b3e27c1822243a5}{Error\_to\_weight\_fct\_pt}}(}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00337}00337               elemental\_error[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}], max\_error, min\_error, weight);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00338}00338             vwgt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = weight;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00339}00339           \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00340}00340         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00341}00341       \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00342}00342     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00343}00343     \textcolor{keywordflow}{else} \textcolor{comment}{// There are submeshes}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00344}00344     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00345}00345       \textcolor{comment}{// Are any of the submeshes refineable?}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00346}00346       \textcolor{keywordtype}{bool} refineable\_submesh\_exists = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00347}00347       \textcolor{comment}{// Vector to store "{}start and end point"{} for loops in submeshes}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00348}00348       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} loop\_helper(n\_mesh + 1);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00349}00349       loop\_helper[0] = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00350}00350 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00351}00351       \textcolor{comment}{// Loop over submeshes}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00352}00352       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00353}00353       \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00354}00354         \textcolor{comment}{// Store the end of the loop}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00355}00355         loop\_helper[i\_mesh + 1] =}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00356}00356           problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh)-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}() + loop\_helper[i\_mesh];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00357}00357 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00358}00358         \mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00359}00359           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh));}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00360}00360         \textcolor{keywordflow}{if} (mmesh\_pt != 0)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00361}00361         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00362}00362           refineable\_submesh\_exists = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00363}00363         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00364}00364       \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00365}00365 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00366}00366       \textcolor{comment}{// If a refineable submesh exists}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00367}00367       \textcolor{keywordflow}{if} (refineable\_submesh\_exists)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00368}00368       \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00369}00369         \textcolor{comment}{// Bias distribution?}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00370}00370         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1METIS_af21fbb8dba025be51b3e27c1822243a5}{Error\_to\_weight\_fct\_pt}} != \&\mbox{\hyperlink{namespaceoomph_1_1METIS_af5633647d4ff099648151db2d7d0a1e5}{default\_error\_to\_weight\_fct}})}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00371}00371         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00372}00372           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00373}00373             << \textcolor{stringliteral}{"{}Biasing element distribution via spatial error estimate\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00374}00374 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00375}00375           \textcolor{comment}{// Adjust flag and provide storage for weights}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00376}00376           wgtflag = 2;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00377}00377           vwgt = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nelem];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00378}00378 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00379}00379           \textcolor{comment}{// Loop over submeshes}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00380}00380           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_mesh = 0; i\_mesh < n\_mesh; i\_mesh++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00381}00381           \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00382}00382             \mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}* mmesh\_pt =}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00383}00383               \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableMeshBase}{RefineableMeshBase}}*\textcolor{keyword}{>}(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh));}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00384}00384             \textcolor{keywordflow}{if} (mmesh\_pt != 0)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00385}00385             \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00386}00386               \textcolor{comment}{// Get error for all elements}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00387}00387               \textcolor{keywordtype}{unsigned} nsub\_elem =}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00388}00388                 loop\_helper[i\_mesh + 1] -\/ loop\_helper[i\_mesh];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00389}00389               \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} elemental\_error(nsub\_elem);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00390}00390               mmesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a867aa4599846ac39bb0086fdb5eed470}{spatial\_error\_estimator\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1ErrorEstimator_a3b12c5d2579360a08b6b6298cea8b142}{get\_element\_errors}}(}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00391}00391                 problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(i\_mesh), elemental\_error);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00392}00392 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00393}00393               \textcolor{keywordtype}{double} max\_error = *(std::max\_element(elemental\_error.begin(),}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00394}00394                                                     elemental\_error.end()));}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00395}00395               \textcolor{keywordtype}{double} min\_error = *(std::min\_element(elemental\_error.begin(),}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00396}00396                                                     elemental\_error.end()));}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00397}00397 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00398}00398               \textcolor{comment}{// Bias weights}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00399}00399               \textcolor{keywordtype}{int} weight = 1;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00400}00400               \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{namespaceoomph_1_1CumulativeTimings_aeafe5cb81741d54561e4b62572a1e3df}{start}} = loop\_helper[i\_mesh];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00401}00401               \textcolor{keywordtype}{unsigned} end = loop\_helper[i\_mesh + 1];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00402}00402               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = \mbox{\hyperlink{namespaceoomph_1_1CumulativeTimings_aeafe5cb81741d54561e4b62572a1e3df}{start}}; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < end; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00403}00403               \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00404}00404                 \textcolor{keywordtype}{unsigned} error\_index = \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} -\/ \mbox{\hyperlink{namespaceoomph_1_1CumulativeTimings_aeafe5cb81741d54561e4b62572a1e3df}{start}};}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00405}00405                 \textcolor{comment}{// Translate error into weight}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00406}00406                 \mbox{\hyperlink{namespaceoomph_1_1METIS_af21fbb8dba025be51b3e27c1822243a5}{Error\_to\_weight\_fct\_pt}}(}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00407}00407                   elemental\_error[error\_index], max\_error, min\_error, weight);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00408}00408                 vwgt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = weight;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00409}00409               \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00410}00410             \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00411}00411             \textcolor{keywordflow}{else} \textcolor{comment}{// This mesh is not refineable}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00412}00412             \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00413}00413               \textcolor{comment}{// There's no error estimator, so use the default weight}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00414}00414               \textcolor{keywordtype}{int} weight = 1;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00415}00415               \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{namespaceoomph_1_1CumulativeTimings_aeafe5cb81741d54561e4b62572a1e3df}{start}} = loop\_helper[i\_mesh];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00416}00416               \textcolor{keywordtype}{unsigned} end = loop\_helper[i\_mesh + 1];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00417}00417               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = \mbox{\hyperlink{namespaceoomph_1_1CumulativeTimings_aeafe5cb81741d54561e4b62572a1e3df}{start}}; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < end; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00418}00418               \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00419}00419                 vwgt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = weight;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00420}00420               \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00421}00421             \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00422}00422           \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00423}00423         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00424}00424       \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00425}00425     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00426}00426 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00427}00427 \textcolor{preprocessor}{\#ifdef OOMPH\_TRANSITION\_TO\_VERSION\_3}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00428}00428 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00429}00429     \textcolor{comment}{// Call partitioner}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00430}00430     \mbox{\hyperlink{namespaceoomph_a86e73012a914a19df3d849e1c6f4b9a1}{METIS\_PartGraphKway}}(\&nvertex,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00431}00431                         xadj,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00432}00432                         \&adjacency\_vector[0],}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00433}00433                         vwgt,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00434}00434                         adjwgt,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00435}00435                         \&wgtflag,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00436}00436                         \&numflag,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00437}00437                         \&nparts,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00438}00438                         options,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00439}00439                         edgecut,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00440}00440                         part);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00441}00441 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00442}00442     \textcolor{comment}{// original code to delete in version 3}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00443}00443 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00444}00444     \textcolor{comment}{// Call partitioner}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00445}00445     \textcolor{keywordflow}{if} (objective == 0)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00446}00446     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00447}00447       \textcolor{comment}{// Partition with the objective of minimising the edge cut}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00448}00448       \mbox{\hyperlink{namespaceoomph_a86e73012a914a19df3d849e1c6f4b9a1}{METIS\_PartGraphKway}}(\&nvertex,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00449}00449                           xadj,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00450}00450                           \&adjacency\_vector[0],}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00451}00451                           vwgt,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00452}00452                           adjwgt,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00453}00453                           \&wgtflag,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00454}00454                           \&numflag,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00455}00455                           \&nparts,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00456}00456                           options,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00457}00457                           edgecut,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00458}00458                           part);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00459}00459     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00460}00460     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (objective == 1)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00461}00461     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00462}00462       \textcolor{comment}{// Partition with the objective of minimising the total communication}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00463}00463       \textcolor{comment}{// volume}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00464}00464       \mbox{\hyperlink{namespaceoomph_abf5fe3c38b4c12aad8fdfd89b05599bd}{METIS\_PartGraphVKway}}(\&nvertex,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00465}00465                            xadj,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00466}00466                            \&adjacency\_vector[0],}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00467}00467                            vwgt,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00468}00468                            adjwgt,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00469}00469                            \&wgtflag,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00470}00470                            \&numflag,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00471}00471                            \&nparts,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00472}00472                            options,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00473}00473                            edgecut,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00474}00474                            part);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00475}00475     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00476}00476     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00477}00477     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00478}00478       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00479}00479       error\_stream << \textcolor{stringliteral}{"{}Wrong objective for METIS. objective = "{}} << objective}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00480}00480                    << std::endl;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00481}00481 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00482}00482       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00483}00483         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00484}00484     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00485}00485 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00486}00486 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00487}00487 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00488}00488     std::vector<bool> done(nparts, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00489}00489 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00490}00490 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00491}00491     \textcolor{comment}{// Copy across}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00492}00492     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nelem; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00493}00493     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00494}00494       element\_domain[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = part[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00495}00495 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00496}00496       done[part[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]] = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00497}00497 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00498}00498     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00499}00499 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00500}00500 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00501}00501 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00502}00502     \textcolor{comment}{// Check}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00503}00503     std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00504}00504     \textcolor{keywordtype}{bool} shout = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00505}00505     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < nparts; p++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00506}00506     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00507}00507       \textcolor{keywordflow}{if} (!done[p])}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00508}00508       \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00509}00509         shout = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00510}00510         error\_stream << \textcolor{stringliteral}{"{}No elements on processor "{}} << p}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00511}00511                      << \textcolor{stringliteral}{"{}when trying to partition "{}} << nelem << \textcolor{stringliteral}{"{}elements over "{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00512}00512                      << nparts << \textcolor{stringliteral}{"{} processors!\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00513}00513       \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00514}00514     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00515}00515     \textcolor{keywordflow}{if} (shout)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00516}00516     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00517}00517       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00518}00518         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00519}00519     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00520}00520 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00521}00521 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00522}00522 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00523}00523     \textcolor{comment}{// End timer}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00524}00524     cpu\_end = clock();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00525}00525 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00526}00526     \textcolor{comment}{// Doc}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00527}00527     \textcolor{keywordtype}{double} cpu1 = double(cpu\_end -\/ cpu\_start) / CLOCKS\_PER\_SEC;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00528}00528     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00529}00529       << \textcolor{stringliteral}{"{}CPU time for METIS mesh partitioning                   [nelem="{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00530}00530       << nelem << \textcolor{stringliteral}{"{}]: "{}} << cpu1 << \textcolor{stringliteral}{"{} sec"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00531}00531 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00532}00532 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00533}00533     \textcolor{comment}{// Cleanup}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00534}00534     \textcolor{keyword}{delete}[] xadj;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00535}00535     \textcolor{keyword}{delete}[] part;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00536}00536     \textcolor{keyword}{delete}[] edgecut;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00537}00537     \textcolor{keyword}{delete}[] options;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00538}00538   \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00539}00539 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00540}00540 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00541}00541 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00542}00542 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00543}00543 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00544}00544   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00545}00545 \textcolor{comment}{  /// Use METIS to assign each element in an already-\/distributed mesh}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00546}00546 \textcolor{comment}{  /// to a domain. On return, element\_domain\_on\_this\_proc[e] contains the number}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00547}00547 \textcolor{comment}{  /// of the domain [0,1,...,ndomain-\/1] to which non-\/halo element e on THE}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00548}00548 \textcolor{comment}{  /// CURRENT PROCESSOR ONLY has been assigned. The order of the non-\/halo}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00549}00549 \textcolor{comment}{  /// elements is the same as in the Problem's mesh, with the halo}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00550}00550 \textcolor{comment}{  /// elements being skipped.}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00551}00551 \textcolor{comment}{  /// Objective:}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00552}00552 \textcolor{comment}{  /// -\/ objective=0: minimise edgecut.}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00553}00553 \textcolor{comment}{  /// -\/ objective=1: minimise total communications volume.}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00554}00554 \textcolor{comment}{  /// .}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00555}00555 \textcolor{comment}{  /// The partioning is based on the dof graph of the complete mesh by}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00556}00556 \textcolor{comment}{  /// taking into}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00557}00557 \textcolor{comment}{  /// account which global equation numbers are affected by each element and}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00558}00558 \textcolor{comment}{  /// connecting elements which affect the same global equation number.}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00559}00559 \textcolor{comment}{  /// Partitioning is done such that all elements associated with the}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00560}00560 \textcolor{comment}{  /// same tree root move together. Non-\/refineable elements are}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00561}00561 \textcolor{comment}{  /// treated as their own root elements. If the optional boolean}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00562}00562 \textcolor{comment}{  /// flag is set to true (it defaults to false) each processor}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00563}00563 \textcolor{comment}{  /// assigns a dumb-\/but-\/repeatable equidistribution of its non-\/halo}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00564}00564 \textcolor{comment}{  /// elements over the domains and outputs the input that would have}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00565}00565 \textcolor{comment}{  /// gone into METIS in the file metis\_input\_for\_validation.dat}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00566}00566 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00567}\mbox{\hyperlink{namespaceoomph_1_1METIS_a9d95103cfa79d38f80b3b0a6db949701}{00567}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{namespaceoomph_1_1METIS_a9d95103cfa79d38f80b3b0a6db949701}{METIS::partition\_distributed\_mesh}}(}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00568}00568     \mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* problem\_pt,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00569}00569     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& objective,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00570}00570     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& element\_domain\_on\_this\_proc,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00571}00571     \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& bypass\_metis)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00572}00572   \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00573}00573     \textcolor{comment}{// Start timer}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00574}00574     clock\_t cpu\_start = clock();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00575}00575 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00576}00576     \textcolor{comment}{// Communicator}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00577}00577     \mbox{\hyperlink{classoomph_1_1OomphCommunicator}{OomphCommunicator}}* comm\_pt = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00578}00578 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00579}00579     \textcolor{comment}{// Number of processors / domains}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00580}00580     \textcolor{keywordtype}{unsigned} n\_proc = comm\_pt-\/>nproc();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00581}00581     \textcolor{keywordtype}{unsigned} my\_rank = comm\_pt-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00582}00582 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00583}00583     \textcolor{comment}{// Global mesh}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00584}00584     \mbox{\hyperlink{classoomph_1_1Mesh}{Mesh}}* mesh\_pt = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00585}00585 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00586}00586     \textcolor{comment}{// Total number of elements (halo and nonhalo) on this proc}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00587}00587     \textcolor{keywordtype}{unsigned} n\_elem = mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00588}00588 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00589}00589     \textcolor{comment}{// Get elemental assembly times}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00590}00590     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} elemental\_assembly\_time =}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00591}00591       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ac5eb0ed2c07c8d0c5d6246394d335c73}{elemental\_assembly\_time}}();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00592}00592 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00593}00593 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00594}00594     \textcolor{keywordtype}{unsigned} n = elemental\_assembly\_time.size();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00595}00595     \textcolor{keywordflow}{if} ((n != 0) \&\& (n != n\_elem))}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00596}00596     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00597}00597       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00598}00598       error\_stream << \textcolor{stringliteral}{"{}Number of elements doesn't match the \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00599}00599                    << \textcolor{stringliteral}{"{}number of elemental assembly times: "{}} << n\_elem << \textcolor{stringliteral}{"{} "{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00600}00600                    << n << std::endl;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00601}00601       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00602}00602         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00603}00603     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00604}00604 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00605}00605 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00606}00606     \textcolor{comment}{// Can we base load balancing on assembly times?}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00607}00607     \textcolor{keywordtype}{bool} can\_load\_balance\_on\_assembly\_times = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00608}00608     \textcolor{keywordflow}{if} (elemental\_assembly\_time.size() != 0)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00609}00609     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00610}00610       can\_load\_balance\_on\_assembly\_times = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00611}00611     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00612}00612 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00613}00613     \textcolor{comment}{// Storage for global eqn numbers on current processor}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00614}00614     std::set<unsigned> global\_eqns\_on\_this\_proc;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00615}00615 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00616}00616     \textcolor{comment}{// Storage for pointers to root elements that are connected with given}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00617}00617     \textcolor{comment}{// eqn number -\/-\/ assembled on local processor}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00618}00618     std::map<unsigned, std::set<GeneralisedElement*>>}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00619}00619       root\_elements\_connected\_with\_global\_eqn\_on\_this\_proc;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00620}00620 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00621}00621     \textcolor{comment}{// Storage for long sequence of equation numbers as encountered}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00622}00622     \textcolor{comment}{// by the root elements on this processor}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00623}00623     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} eqn\_numbers\_with\_root\_elements\_on\_this\_proc;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00624}00624 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00625}00625     \textcolor{comment}{// Reserve number of elements x average/estimate (?) for number of dofs}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00626}00626     \textcolor{comment}{// per element}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00627}00627     eqn\_numbers\_with\_root\_elements\_on\_this\_proc.reserve(n\_elem * 9);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00628}00628 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00629}00629     \textcolor{comment}{// Storage for the number of eqn numbers associated with each}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00630}00630     \textcolor{comment}{// root element on this processors -\/-\/ once this and the previous}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00631}00631     \textcolor{comment}{// container have been collected from all processors we're}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00632}00632     \textcolor{comment}{// able to reconstruct which root element (in the nominal "{}global"{} mesh)}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00633}00633     \textcolor{comment}{// is connected with which global equations}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00634}00634     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} number\_of\_dofs\_for\_root\_element;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00635}00635     number\_of\_dofs\_for\_root\_element.reserve(n\_elem);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00636}00636 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00637}00637     \textcolor{comment}{// Ditto for number of "{}leaf"{} elements connected with each root}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00638}00638     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} number\_of\_non\_halo\_elements\_for\_root\_element;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00639}00639     number\_of\_non\_halo\_elements\_for\_root\_element.reserve(n\_elem);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00640}00640 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00641}00641     \textcolor{comment}{// Ditto for total assembly time of "{}leaf"{} elements connected with each root}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00642}00642     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} total\_assembly\_time\_for\_root\_element;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00643}00643     total\_assembly\_time\_for\_root\_element.reserve(n\_elem);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00644}00644 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00645}00645     \textcolor{comment}{// Map storing the number of the root elements on this processor}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00646}00646     \textcolor{comment}{// (offset by one to bypass the zero default).}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00647}00647     std::map<GeneralisedElement*, unsigned> root\_el\_number\_plus\_one;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00648}00648 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00649}00649     \textcolor{comment}{// Loop over non-\/halo elements on this processor}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00650}00650     \textcolor{keywordtype}{int} number\_of\_root\_elements = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00651}00651     \textcolor{keywordtype}{unsigned} number\_of\_non\_halo\_elements = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00652}00652     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_elem; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00653}00653     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00654}00654       \textcolor{keywordtype}{double} el\_assembly\_time = 0.0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00655}00655       \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* el\_pt = mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00656}00656       \textcolor{keywordflow}{if} (!el\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a0d9869eaf7d6e104c1e465b0d3cd6a9b}{is\_halo}}())}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00657}00657       \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00658}00658         \textcolor{keywordflow}{if} (can\_load\_balance\_on\_assembly\_times)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00659}00659         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00660}00660           el\_assembly\_time = elemental\_assembly\_time[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00661}00661         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00662}00662 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00663}00663         \textcolor{comment}{// Get the associated root element which is either...}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00664}00664         \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* root\_el\_pt = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00665}00665         \mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}* ref\_el\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(el\_pt);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00666}00666         \textcolor{keywordflow}{if} (ref\_el\_pt != 0)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00667}00667         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00668}00668           \textcolor{comment}{//...the actual root element}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00669}00669           root\_el\_pt = ref\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_a8bbcee798e87bd7e5d88273c71500f76}{root\_element\_pt}}();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00670}00670         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00671}00671         \textcolor{comment}{// ...or the element itself}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00672}00672         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00673}00673         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00674}00674           root\_el\_pt = el\_pt;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00675}00675         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00676}00676 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00677}00677         \textcolor{comment}{// Have we already encountered this root element?}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00678}00678         \textcolor{comment}{// (offset of one to bypass the default return of zero)}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00679}00679         \textcolor{keywordtype}{bool} already\_encountered = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00680}00680         \textcolor{keywordtype}{unsigned} root\_el\_number = root\_el\_number\_plus\_one[root\_el\_pt];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00681}00681         \textcolor{keywordflow}{if} (root\_el\_number\_plus\_one[root\_el\_pt] == 0)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00682}00682         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00683}00683           \textcolor{comment}{// This is a new one}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00684}00684           already\_encountered = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00685}00685 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00686}00686           \textcolor{comment}{// Give it a number}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00687}00687           number\_of\_root\_elements++;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00688}00688           root\_el\_number\_plus\_one[root\_el\_pt] = number\_of\_root\_elements;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00689}00689 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00690}00690           \textcolor{comment}{// Remove offset}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00691}00691           root\_el\_number = number\_of\_root\_elements -\/ 1;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00692}00692         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00693}00693         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00694}00694         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00695}00695           \textcolor{comment}{// We've already visited this one before...}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00696}00696           already\_encountered = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00697}00697 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00698}00698           \textcolor{comment}{// Remove offset}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00699}00699           root\_el\_number -\/= 1;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00700}00700         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00701}00701 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00702}00702 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00703}00703         \textcolor{comment}{// Get global equation numbers of actual element}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00704}00704         \textcolor{keywordtype}{unsigned} n\_dof = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00705}00705         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00706}00706         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00707}00707           \textcolor{keywordtype}{unsigned} eqn\_no = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00708}00708 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00709}00709           \textcolor{comment}{// Record which root elements are connected with this eqn number}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00710}00710           root\_elements\_connected\_with\_global\_eqn\_on\_this\_proc[eqn\_no].insert(}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00711}00711             root\_el\_pt);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00712}00712 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00713}00713           \textcolor{comment}{// Record all global eqn numbers on this processor}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00714}00714           global\_eqns\_on\_this\_proc.insert(eqn\_no);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00715}00715 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00716}00716           \textcolor{comment}{// Add eqn number of the current element to the long sequence}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00717}00717           \textcolor{comment}{// of eqn numbers}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00718}00718           eqn\_numbers\_with\_root\_elements\_on\_this\_proc.push\_back(eqn\_no);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00719}00719         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00720}00720 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00721}00721         \textcolor{comment}{// Now record how many equations are associated with the current}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00722}00722         \textcolor{comment}{// non-\/halo element}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00723}00723         \textcolor{keywordflow}{if} (already\_encountered)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00724}00724         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00725}00725           number\_of\_dofs\_for\_root\_element[root\_el\_number] += n\_dof;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00726}00726           number\_of\_non\_halo\_elements\_for\_root\_element[root\_el\_number]++;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00727}00727           total\_assembly\_time\_for\_root\_element[root\_el\_number] +=}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00728}00728             el\_assembly\_time;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00729}00729         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00730}00730         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00731}00731         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00732}00732           number\_of\_dofs\_for\_root\_element.push\_back(n\_dof);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00733}00733           number\_of\_non\_halo\_elements\_for\_root\_element.push\_back(1);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00734}00734           total\_assembly\_time\_for\_root\_element.push\_back(el\_assembly\_time);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00735}00735         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00736}00736 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00737}00737         \textcolor{comment}{// Bump up number of non-\/halos}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00738}00738         number\_of\_non\_halo\_elements++;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00739}00739       \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00740}00740     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00741}00741 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00742}00742     \textcolor{comment}{// Tell everybody how many root elements}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00743}00743     \textcolor{comment}{// are on each processor}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00744}00744     \textcolor{keywordtype}{unsigned} root\_processor = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00745}00745     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} number\_of\_root\_elements\_on\_each\_proc(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00746}00746     MPI\_Allgather(\&number\_of\_root\_elements,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00747}00747                   1,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00748}00748                   MPI\_INT,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00749}00749                   \&number\_of\_root\_elements\_on\_each\_proc[0],}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00750}00750                   1,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00751}00751                   MPI\_INT,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00752}00752                   comm\_pt-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00753}00753 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00754}00754 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00755}00755     \textcolor{comment}{// In the big sequence of concatenated root elements (enumerated}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00756}00756     \textcolor{comment}{// individually on the various processors) where do the root elements from a}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00757}00757     \textcolor{comment}{// given processor start? Also figure out how many root elements there are}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00758}00758     \textcolor{comment}{// in total by summing up their numbers}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00759}00759     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} start\_index(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00760}00760     \textcolor{keywordtype}{unsigned} total\_number\_of\_root\_elements = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00761}00761     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_proc = 0; i\_proc < n\_proc; i\_proc++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00762}00762     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00763}00763       total\_number\_of\_root\_elements +=}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00764}00764         number\_of\_root\_elements\_on\_each\_proc[i\_proc];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00765}00765       \textcolor{keywordflow}{if} (i\_proc != 0)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00766}00766       \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00767}00767         start\_index[i\_proc] = total\_number\_of\_root\_elements -\/}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00768}00768                               number\_of\_root\_elements\_on\_each\_proc[i\_proc];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00769}00769       \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00770}00770       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00771}00771       \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00772}00772         start\_index[0] = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00773}00773       \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00774}00774     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00775}00775 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00776}00776 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00777}00777     \textcolor{comment}{// How many global equations are held on this processor?}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00778}00778     \textcolor{keywordtype}{int} n\_eqns\_on\_this\_proc =}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00779}00779       eqn\_numbers\_with\_root\_elements\_on\_this\_proc.size();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00780}00780 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00781}00781     \textcolor{comment}{// Gather this information for all processors:}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00782}00782     \textcolor{comment}{// n\_eqns\_on\_each\_proc[iproc] now contains the number of global}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00783}00783     \textcolor{comment}{// equations held on processor iproc.}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00784}00784     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} n\_eqns\_on\_each\_proc(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00785}00785     MPI\_Allgather(\&n\_eqns\_on\_this\_proc,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00786}00786                   1,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00787}00787                   MPI\_INT,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00788}00788                   \&n\_eqns\_on\_each\_proc[0],}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00789}00789                   1,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00790}00790                   MPI\_INT,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00791}00791                   comm\_pt-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00792}00792 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00793}00793 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00794}00794     \textcolor{comment}{// In the big sequence of equation numbers from the root elements}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00795}00795     \textcolor{comment}{// (enumerated individually on the various processors) where do the}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00796}00796     \textcolor{comment}{// equation numbers associated with the root elements from a given}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00797}00797     \textcolor{comment}{// processor start? Also figure out how long the sequence of equation}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00798}00798     \textcolor{comment}{// numbers is}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00799}00799     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} start\_eqns\_index(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00800}00800     \textcolor{keywordtype}{unsigned} total\_n\_eqn = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00801}00801     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_proc = 0; i\_proc < n\_proc; i\_proc++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00802}00802     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00803}00803       total\_n\_eqn += n\_eqns\_on\_each\_proc[i\_proc];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00804}00804       \textcolor{keywordflow}{if} (i\_proc != 0)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00805}00805       \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00806}00806         start\_eqns\_index[i\_proc] = total\_n\_eqn -\/ n\_eqns\_on\_each\_proc[i\_proc];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00807}00807       \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00808}00808       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00809}00809       \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00810}00810         start\_eqns\_index[0] = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00811}00811       \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00812}00812     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00813}00813 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00814}00814 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00815}00815     \textcolor{comment}{// Big vector that contains the number of dofs for each root element}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00816}00816     \textcolor{comment}{// (concatenated in processor-\/by-\/processor order)}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00817}00817     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} number\_of\_dofs\_for\_global\_root\_element(}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00818}00818       total\_number\_of\_root\_elements);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00819}00819     \textcolor{comment}{// Create at least one entry so we don't get a seg fault below}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00820}00820     \textcolor{keywordflow}{if} (number\_of\_dofs\_for\_root\_element.size() == 0)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00821}00821     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00822}00822       number\_of\_dofs\_for\_root\_element.resize(1);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00823}00823     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00824}00824     MPI\_Gatherv(}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00825}00825       \&number\_of\_dofs\_for\_root\_element[0], \textcolor{comment}{// pointer to first entry in}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00826}00826                                            \textcolor{comment}{// vector to be gathered on root}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00827}00827       number\_of\_root\_elements, \textcolor{comment}{// Number of entries to be sent}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00828}00828                                \textcolor{comment}{// from current processor}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00829}00829       MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00830}00830       \&number\_of\_dofs\_for\_global\_root\_element[0], \textcolor{comment}{// Target -\/-\/ this will}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00831}00831                                                   \textcolor{comment}{// store the concatenated}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00832}00832                                                   \textcolor{comment}{// vectors sent from}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00833}00833                                                   \textcolor{comment}{// everywhere}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00834}00834       \&number\_of\_root\_elements\_on\_each\_proc[0], \textcolor{comment}{// Pointer to}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00835}00835                                                 \textcolor{comment}{// vector containing}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00836}00836                                                 \textcolor{comment}{// the length of the}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00837}00837                                                 \textcolor{comment}{// vectors received}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00838}00838                                                 \textcolor{comment}{// from elsewhere}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00839}00839       \&start\_index[0], \textcolor{comment}{// "{}offset"{} for storage of vector received}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00840}00840                        \textcolor{comment}{// from various processors in the global}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00841}00841                        \textcolor{comment}{// concatenated vector stored on root}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00842}00842       MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00843}00843       root\_processor,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00844}00844       comm\_pt-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00845}00845 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00846}00846 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00847}00847     \textcolor{comment}{// ditto for number of non-\/halo elements associated with root element}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00848}00848     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} number\_of\_non\_halo\_elements\_for\_global\_root\_element(}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00849}00849       total\_number\_of\_root\_elements);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00850}00850 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00851}00851     \textcolor{comment}{// Create at least one entry so we don't get a seg fault below}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00852}00852     \textcolor{keywordflow}{if} (number\_of\_non\_halo\_elements\_for\_root\_element.size() == 0)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00853}00853     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00854}00854       number\_of\_non\_halo\_elements\_for\_root\_element.resize(1);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00855}00855     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00856}00856     MPI\_Gatherv(\&number\_of\_non\_halo\_elements\_for\_root\_element[0],}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00857}00857                 \textcolor{comment}{// pointer to first entry in}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00858}00858                 \textcolor{comment}{// vector to be gathered on root}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00859}00859                 number\_of\_root\_elements, \textcolor{comment}{// Number of entries to be sent}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00860}00860                                          \textcolor{comment}{// from current processor}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00861}00861                 MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00862}00862                 \&number\_of\_non\_halo\_elements\_for\_global\_root\_element[0],}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00863}00863                 \textcolor{comment}{// Target -\/-\/ this will}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00864}00864                 \textcolor{comment}{// store the concatenated}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00865}00865                 \textcolor{comment}{// vectors sent from}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00866}00866                 \textcolor{comment}{// everywhere}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00867}00867                 \&number\_of\_root\_elements\_on\_each\_proc[0], \textcolor{comment}{// Pointer to}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00868}00868                                                           \textcolor{comment}{// vector containing}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00869}00869                                                           \textcolor{comment}{// the length of the}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00870}00870                                                           \textcolor{comment}{// vectors received}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00871}00871                                                           \textcolor{comment}{// from elsewhere}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00872}00872                 \&start\_index[0], \textcolor{comment}{// "{}offset"{} for storage of vector received}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00873}00873                                  \textcolor{comment}{// from various processors in the global}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00874}00874                                  \textcolor{comment}{// concatenated vector stored on root}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00875}00875                 MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00876}00876                 root\_processor,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00877}00877                 comm\_pt-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00878}00878 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00879}00879 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00880}00880     \textcolor{comment}{// ditto for assembly times elements associated with root element}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00881}00881     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} total\_assembly\_time\_for\_global\_root\_element(}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00882}00882       total\_number\_of\_root\_elements);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00883}00883 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00884}00884     \textcolor{comment}{// Create at least one entry so we don't get a seg fault below}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00885}00885     \textcolor{keywordflow}{if} (total\_assembly\_time\_for\_root\_element.size() == 0)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00886}00886     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00887}00887       total\_assembly\_time\_for\_root\_element.resize(1);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00888}00888     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00889}00889     MPI\_Gatherv(\&total\_assembly\_time\_for\_root\_element[0],}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00890}00890                 \textcolor{comment}{// pointer to first entry in}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00891}00891                 \textcolor{comment}{// vector to be gathered on root}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00892}00892                 number\_of\_root\_elements, \textcolor{comment}{// Number of entries to be sent}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00893}00893                                          \textcolor{comment}{// from current processor}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00894}00894                 MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00895}00895                 \&total\_assembly\_time\_for\_global\_root\_element[0],}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00896}00896                 \textcolor{comment}{// Target -\/-\/ this will}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00897}00897                 \textcolor{comment}{// store the concatenated}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00898}00898                 \textcolor{comment}{// vectors sent from}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00899}00899                 \textcolor{comment}{// everywhere}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00900}00900                 \&number\_of\_root\_elements\_on\_each\_proc[0], \textcolor{comment}{// Pointer to}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00901}00901                                                           \textcolor{comment}{// vector containing}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00902}00902                                                           \textcolor{comment}{// the length of the}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00903}00903                                                           \textcolor{comment}{// vectors received}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00904}00904                                                           \textcolor{comment}{// from elsewhere}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00905}00905                 \&start\_index[0], \textcolor{comment}{// "{}offset"{} for storage of vector received}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00906}00906                                  \textcolor{comment}{// from various processors in the global}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00907}00907                                  \textcolor{comment}{// concatenated vector stored on root}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00908}00908                 MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00909}00909                 root\_processor,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00910}00910                 comm\_pt-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00911}00911 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00912}00912 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00913}00913     \textcolor{comment}{// Big vector to store the long sequence of global equation numbers}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00914}00914     \textcolor{comment}{// associated with the long sequence of root elements}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00915}00915     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} eqn\_numbers\_with\_root\_elements(total\_n\_eqn);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00916}00916 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00917}00917     \textcolor{comment}{// Create at least one entry so we don't get a seg fault below}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00918}00918     \textcolor{keywordflow}{if} (eqn\_numbers\_with\_root\_elements\_on\_this\_proc.size() == 0)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00919}00919     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00920}00920       eqn\_numbers\_with\_root\_elements\_on\_this\_proc.resize(1);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00921}00921     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00922}00922     MPI\_Gatherv(\&eqn\_numbers\_with\_root\_elements\_on\_this\_proc[0],}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00923}00923                 n\_eqns\_on\_this\_proc,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00924}00924                 MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00925}00925                 \&eqn\_numbers\_with\_root\_elements[0],}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00926}00926                 \&n\_eqns\_on\_each\_proc[0],}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00927}00927                 \&start\_eqns\_index[0],}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00928}00928                 MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00929}00929                 root\_processor,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00930}00930                 comm\_pt-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00931}00931 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00932}00932     \textcolor{comment}{// Doc}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00933}00933     clock\_t cpu\_end = clock();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00934}00934 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00935}00935     \textcolor{keywordtype}{double} cpu0 = double(cpu\_end -\/ cpu\_start) / CLOCKS\_PER\_SEC;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00936}00936     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00937}00937       << \textcolor{stringliteral}{"{}CPU time for global setup of METIS data structures [nroot\_elem="{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00938}00938       << total\_number\_of\_root\_elements << \textcolor{stringliteral}{"{}]: "{}} << cpu0 << \textcolor{stringliteral}{"{} sec"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00939}00939 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00940}00940 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00941}00941     \textcolor{comment}{// Now the root processor has gathered all the data needed to establish}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00942}00942     \textcolor{comment}{// the root element connectivity (as in the serial case) so use METIS}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00943}00943     \textcolor{comment}{// to determine "{}partitioning"{} for non-\/uniformly refined mesh}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00944}00944     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00945}00945 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00946}00946     \textcolor{comment}{// Vector to store target domain for each of the root elements (concatenated}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00947}00947     \textcolor{comment}{// in processor-\/by-\/processor order)}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00948}00948     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} root\_element\_domain(total\_number\_of\_root\_elements, 0);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00949}00949     \textcolor{keywordflow}{if} (my\_rank == root\_processor) \textcolor{comment}{//-\/-\/}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00950}00950     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00951}00951       \textcolor{comment}{// Start timer}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00952}00952       clock\_t cpu\_start = clock();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00953}00953 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00954}00954       \textcolor{comment}{// Repeat the steps used in the serial code: Storage for}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00955}00955       \textcolor{comment}{// the global equations (on root processor)}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00956}00956       std::set<unsigned> all\_global\_eqns\_root\_processor;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00957}00957 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00958}00958       \textcolor{comment}{// Set of root elements (as enumerated in the processor-\/by-\/processor}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00959}00959       \textcolor{comment}{// order) associated with given global equation number}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00960}00960       std::map<unsigned, std::set<unsigned>>}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00961}00961         root\_elements\_connected\_with\_global\_eqn\_on\_root\_processor;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00962}00962 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00963}00963       \textcolor{comment}{// Retrace the steps of the serial code: Who's connected with who}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00964}00964       \textcolor{keywordtype}{unsigned} count\_all = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00965}00965       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < total\_number\_of\_root\_elements; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00966}00966       \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00967}00967         \textcolor{keywordtype}{unsigned} n\_eqn\_no = number\_of\_dofs\_for\_global\_root\_element[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00968}00968         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_eqn\_no; n++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00969}00969         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00970}00970           \textcolor{keywordtype}{unsigned} eqn\_no = eqn\_numbers\_with\_root\_elements[count\_all];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00971}00971           count\_all++;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00972}00972           root\_elements\_connected\_with\_global\_eqn\_on\_root\_processor[eqn\_no]}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00973}00973             .insert(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00974}00974           all\_global\_eqns\_root\_processor.insert(eqn\_no);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00975}00975         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00976}00976       \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00977}00977 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00978}00978       \textcolor{comment}{// Number of domains}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00979}00979       \textcolor{keywordtype}{unsigned} ndomain = n\_proc;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00980}00980 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00981}00981       \textcolor{comment}{// Now reverse the lookup scheme to find out all root elements}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00982}00982       \textcolor{comment}{// that are connected because they share the same global eqn}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00983}00983       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<std::set<unsigned>}}> connected\_root\_elements(}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00984}00984         total\_number\_of\_root\_elements);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00985}00985 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00986}00986       \textcolor{comment}{// Counter for total number of entries in connected\_root\_elements}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00987}00987       \textcolor{comment}{// structure}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00988}00988       \textcolor{keywordtype}{unsigned} count = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00989}00989 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00990}00990       \textcolor{comment}{// Loop over all global eqns}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00991}00991       \textcolor{keywordflow}{for} (std::set<unsigned>::iterator it =}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00992}00992              all\_global\_eqns\_root\_processor.begin();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00993}00993            it != all\_global\_eqns\_root\_processor.end();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00994}00994            it++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00995}00995       \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00996}00996         \textcolor{comment}{// Get set of root elements connected with this data item}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00997}00997         std::set<unsigned> root\_elements =}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00998}00998           root\_elements\_connected\_with\_global\_eqn\_on\_root\_processor[*it];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l00999}00999 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01000}01000         \textcolor{comment}{// Double loop over connnected root elements: Everybody's connected to}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01001}01001         \textcolor{comment}{// everybody}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01002}01002         \textcolor{keywordflow}{for} (std::set<unsigned>::iterator it1 = root\_elements.begin();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01003}01003              it1 != root\_elements.end();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01004}01004              it1++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01005}01005         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01006}01006           \textcolor{keywordflow}{for} (std::set<unsigned>::iterator it2 = root\_elements.begin();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01007}01007                it2 != root\_elements.end();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01008}01008                it2++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01009}01009           \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01010}01010             \textcolor{keywordflow}{if} ((*it1) != (*it2))}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01011}01011             \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01012}01012               connected\_root\_elements[(*it1)].insert(*it2);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01013}01013             \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01014}01014           \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01015}01015         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01016}01016       \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01017}01017 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01018}01018       \textcolor{comment}{// End timer}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01019}01019       clock\_t cpu\_end = clock();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01020}01020 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01021}01021       \textcolor{comment}{// Doc}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01022}01022       \textcolor{keywordtype}{double} cpu0b = double(cpu\_end -\/ cpu\_start) / CLOCKS\_PER\_SEC;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01023}01023       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}CPU time for setup of connected elements (load balance) "{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01024}01024                     \textcolor{stringliteral}{"{}[nroot\_elem="{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01025}01025                  << total\_number\_of\_root\_elements << \textcolor{stringliteral}{"{}]: "{}} << cpu0b << \textcolor{stringliteral}{"{} sec"{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01026}01026                  << std::endl;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01027}01027 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01028}01028       \textcolor{comment}{// Now convert into C-\/style packed array for interface with METIS}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01029}01029       cpu\_start = clock();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01030}01030       \textcolor{keywordtype}{int}* xadj = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[total\_number\_of\_root\_elements + 1];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01031}01031       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} adjacency\_vector;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01032}01032 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01033}01033       \textcolor{comment}{// Reserve (too much) space}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01034}01034       adjacency\_vector.reserve(count);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01035}01035 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01036}01036       \textcolor{comment}{// Initialise counters}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01037}01037       \textcolor{keywordtype}{unsigned} ientry = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01038}01038 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01039}01039       \textcolor{comment}{// Loop over all elements}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01040}01040       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < total\_number\_of\_root\_elements; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01041}01041       \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01042}01042         \textcolor{comment}{// First entry for current element}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01043}01043         xadj[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = ientry;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01044}01044 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01045}01045         \textcolor{comment}{// Loop over elements that are connected to current element}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01046}01046         \textcolor{keyword}{typedef} std::set<unsigned>::iterator IT;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01047}01047         \textcolor{keywordflow}{for} (IT it = connected\_root\_elements[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}].begin();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01048}01048              it != connected\_root\_elements[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}].end();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01049}01049              it++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01050}01050         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01051}01051           \textcolor{comment}{// Copy into adjacency array}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01052}01052           adjacency\_vector.push\_back(*it);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01053}01053 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01054}01054           \textcolor{comment}{// We've just made another entry}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01055}01055           ientry++;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01056}01056         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01057}01057 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01058}01058         \textcolor{comment}{// Entry after last entry for current element:}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01059}01059         xadj[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} + 1] = ientry;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01060}01060       \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01061}01061 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01062}01062       \textcolor{comment}{// End timer}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01063}01063       cpu\_end = clock();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01064}01064 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01065}01065       \textcolor{comment}{// Doc}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01066}01066       \textcolor{keywordtype}{double} cpu0 = double(cpu\_end -\/ cpu\_start) / CLOCKS\_PER\_SEC;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01067}01067       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}CPU time for setup of METIS data structures (load "{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01068}01068                     \textcolor{stringliteral}{"{}balance) [nroot\_elem="{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01069}01069                  << total\_number\_of\_root\_elements << \textcolor{stringliteral}{"{}]: "{}} << cpu0 << \textcolor{stringliteral}{"{} sec"{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01070}01070                  << std::endl;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01071}01071 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01072}01072 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01073}01073       \textcolor{comment}{// Call METIS graph partitioner}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01074}01074       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01075}01075 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01076}01076       \textcolor{comment}{// Start timer}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01077}01077       cpu\_start = clock();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01078}01078 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01079}01079       \textcolor{comment}{// Number of vertices in graph}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01080}01080       \textcolor{keywordtype}{int} nvertex = total\_number\_of\_root\_elements;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01081}01081 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01082}01082       \textcolor{comment}{// No vertex weights}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01083}01083       \textcolor{keywordtype}{int}* vwgt = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01084}01084 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01085}01085       \textcolor{comment}{// No edge weights}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01086}01086       \textcolor{keywordtype}{int}* adjwgt = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01087}01087 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01088}01088       \textcolor{comment}{// Flag indicating that graph isn't weighted: 0; vertex weights only: 2}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01089}01089       \textcolor{comment}{// Note that wgtflag==2 requires nodal weights to be stored in vwgt.}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01090}01090       \textcolor{keywordtype}{int} wgtflag = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01091}01091 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01092}01092       \textcolor{comment}{// Use C-\/style numbering (first array entry is zero)}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01093}01093       \textcolor{keywordtype}{int} numflag = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01094}01094 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01095}01095       \textcolor{comment}{// Number of desired partitions}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01096}01096       \textcolor{keywordtype}{int} nparts = ndomain;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01097}01097 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01098}01098       \textcolor{comment}{// Use default options}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01099}01099       \textcolor{keywordtype}{int}* options = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[10];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01100}01100       options[0] = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01101}01101 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01102}01102 \textcolor{preprocessor}{\#ifdef OOMPH\_TRANSITION\_TO\_VERSION\_3}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01103}01103       \textcolor{keywordflow}{switch} (objective)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01104}01104       \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01105}01105         \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01106}01106           \textcolor{comment}{// Edge-\/cut minimization}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01107}01107           options[0] = METIS\_OBJTYPE\_CUT;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01108}01108           \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01109}01109 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01110}01110         \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01111}01111           \textcolor{comment}{// communication volume minimisation}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01112}01112           options[0] = METIS\_OBJTYPE\_VOL;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01113}01113           \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01114}01114 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01115}01115         \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01116}01116           std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01117}01117           error\_stream << \textcolor{stringliteral}{"{}Wrong objective for METIS. objective = "{}} << objective}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01118}01118                        << std::endl;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01119}01119 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01120}01120           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01121}01121                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01122}01122                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01123}01123       \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01124}01124 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01125}01125 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01126}01126       \textcolor{comment}{// Number of cut edges in graph}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01127}01127       \textcolor{keywordtype}{int}* edgecut = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[total\_number\_of\_root\_elements];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01128}01128 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01129}01129       \textcolor{comment}{// Array containing the partition information}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01130}01130       \textcolor{keywordtype}{int}* part = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[total\_number\_of\_root\_elements];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01131}01131 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01132}01132       \textcolor{comment}{// Now bias distribution by giving each root element}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01133}01133       \textcolor{comment}{// a weight equal to the number of elements associated with it}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01134}01134 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01135}01135       \textcolor{comment}{// Adjust flag and provide storage for weights}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01136}01136       wgtflag = 2;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01137}01137       vwgt = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[total\_number\_of\_root\_elements];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01138}01138 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01139}01139 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01140}01140       \textcolor{comment}{// Load balance based on assembly times of all leaf}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01141}01141       \textcolor{comment}{// elements associated with root}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01142}01142       \textcolor{keywordflow}{if} (can\_load\_balance\_on\_assembly\_times)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01143}01143       \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01144}01144         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Basing distribution on assembly times of elements\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01145}01145 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01146}01146         \textcolor{comment}{// Normalise}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01147}01147         \textcolor{keywordtype}{double} min\_time = *(}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01148}01148           std::min\_element(total\_assembly\_time\_for\_global\_root\_element.begin(),}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01149}01149                            total\_assembly\_time\_for\_global\_root\_element.end()));}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01150}01150 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01151}01151         \textcolor{keywordflow}{if} (min\_time == 0.0)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01152}01152         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01153}01153           std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01154}01154           error\_stream << \textcolor{stringliteral}{"{}Minimum assemble time for element is zero!\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01155}01155           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01156}01156                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01157}01157                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01158}01158         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01159}01159 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01160}01160 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01161}01161         \textcolor{comment}{// Bypass METIS (usually for validation) and use made-\/up but}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01162}01162         \textcolor{comment}{// repeatable timings}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01163}01163         \textcolor{keywordflow}{if} (bypass\_metis)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01164}01164         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01165}01165           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < total\_number\_of\_root\_elements; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01166}01166           \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01167}01167             vwgt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}};}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01168}01168           \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01169}01169         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01170}01170         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01171}01171         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01172}01172           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < total\_number\_of\_root\_elements; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01173}01173           \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01174}01174             \textcolor{comment}{// Use assembly times (relative to minimum) as weight}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01175}01175             vwgt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] =}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01176}01176               int(total\_assembly\_time\_for\_global\_root\_element[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] / min\_time);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01177}01177           \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01178}01178         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01179}01179       \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01180}01180       \textcolor{comment}{// Load balanced based on number of leaf elements associated with}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01181}01181       \textcolor{comment}{// root}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01182}01182       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01183}01183       \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01184}01184         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Basing distribution on number of elements\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01185}01185         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < total\_number\_of\_root\_elements; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01186}01186         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01187}01187           vwgt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = number\_of\_non\_halo\_elements\_for\_global\_root\_element[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01188}01188         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01189}01189       \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01190}01190 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01191}01191       \textcolor{comment}{// Bypass METIS (usually for validation)}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01192}01192       \textcolor{keywordflow}{if} (bypass\_metis)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01193}01193       \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01194}01194         \textcolor{comment}{// Simple repeatable partition: Equidistribute root element}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01195}01195         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < total\_number\_of\_root\_elements; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01196}01196         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01197}01197           \textcolor{comment}{// Simple repeatable partition: Equidistribute elements on each}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01198}01198           \textcolor{comment}{// processor}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01199}01199           part[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = (n\_proc -\/ 1) -\/}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01200}01200                     \textcolor{keywordtype}{unsigned}(\textcolor{keywordtype}{double}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}) / double(total\_number\_of\_root\_elements) *}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01201}01201                              double(n\_proc));}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01202}01202         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01203}01203 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01204}01204         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01205}01205           << \textcolor{stringliteral}{"{}Bypassing METIS for validation purposes.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01206}01206           << \textcolor{stringliteral}{"{}Appending input for metis in metis\_input\_for\_validation.dat\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01207}01207         std::ofstream outfile;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01208}01208         outfile.open(\textcolor{stringliteral}{"{}metis\_input\_for\_validation.dat"{}}, std::ios\_base::app);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01209}01209 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01210}01210         \textcolor{comment}{// Dump out relevant input to metis}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01211}01211         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < total\_number\_of\_root\_elements + 1; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01212}01212         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01213}01213           outfile << xadj[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] << std::endl;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01214}01214         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01215}01215         \textcolor{keywordtype}{unsigned} n = adjacency\_vector.size();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01216}01216         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01217}01217         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01218}01218           outfile << adjacency\_vector[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] << std::endl;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01219}01219         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01220}01220         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < total\_number\_of\_root\_elements; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01221}01221         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01222}01222           outfile << vwgt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] << std::endl;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01223}01223         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01224}01224         outfile.close();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01225}01225       \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01226}01226       \textcolor{comment}{// Actually use METIS (good but not always repeatable!)}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01227}01227       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01228}01228       \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01229}01229 \textcolor{preprocessor}{\#ifdef OOMPH\_TRANSITION\_TO\_VERSION\_3}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01230}01230 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01231}01231         \mbox{\hyperlink{namespaceoomph_a86e73012a914a19df3d849e1c6f4b9a1}{METIS\_PartGraphKway}}(\&nvertex,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01232}01232                             xadj,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01233}01233                             \&adjacency\_vector[0],}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01234}01234                             vwgt,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01235}01235                             adjwgt,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01236}01236                             \&wgtflag,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01237}01237                             \&numflag,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01238}01238                             \&nparts,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01239}01239                             options,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01240}01240                             edgecut,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01241}01241                             part);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01242}01242 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01243}01243         \textcolor{comment}{// for old version of METIS; these two functions have been merged}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01244}01244         \textcolor{comment}{// in the new METIS API}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01245}01245 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01246}01246         \textcolor{keywordflow}{if} (objective == 0)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01247}01247         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01248}01248           \textcolor{comment}{// Partition with the objective of minimising the edge cut}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01249}01249           \mbox{\hyperlink{namespaceoomph_a86e73012a914a19df3d849e1c6f4b9a1}{METIS\_PartGraphKway}}(\&nvertex,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01250}01250                               xadj,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01251}01251                               \&adjacency\_vector[0],}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01252}01252                               vwgt,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01253}01253                               adjwgt,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01254}01254                               \&wgtflag,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01255}01255                               \&numflag,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01256}01256                               \&nparts,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01257}01257                               options,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01258}01258                               edgecut,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01259}01259                               part);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01260}01260         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01261}01261         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (objective == 1)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01262}01262         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01263}01263           \textcolor{comment}{// Partition with the objective of minimising the total communication}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01264}01264           \textcolor{comment}{// volume}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01265}01265           \mbox{\hyperlink{namespaceoomph_abf5fe3c38b4c12aad8fdfd89b05599bd}{METIS\_PartGraphVKway}}(\&nvertex,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01266}01266                                xadj,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01267}01267                                \&adjacency\_vector[0],}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01268}01268                                vwgt,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01269}01269                                adjwgt,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01270}01270                                \&wgtflag,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01271}01271                                \&numflag,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01272}01272                                \&nparts,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01273}01273                                options,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01274}01274                                edgecut,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01275}01275                                part);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01276}01276         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01277}01277 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01278}01278       \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01279}01279 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01280}01280       \textcolor{comment}{// Copy across}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01281}01281       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} total\_weight\_on\_proc(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01282}01282       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < total\_number\_of\_root\_elements; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01283}01283       \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01284}01284         root\_element\_domain[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = part[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01285}01285         total\_weight\_on\_proc[part[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]] += vwgt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01286}01286       \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01287}01287 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01288}01288       \textcolor{comment}{// Document success of partitioning}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01289}01289       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_proc; j++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01290}01290       \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01291}01291         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Total weight on proc "{}} << j << \textcolor{stringliteral}{"{} is "{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01292}01292                    << total\_weight\_on\_proc[j] << std::endl;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01293}01293       \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01294}01294 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01295}01295       \textcolor{comment}{// Doc}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01296}01296       \textcolor{keywordtype}{double} cpu1 = double(cpu\_end -\/ cpu\_start) / CLOCKS\_PER\_SEC;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01297}01297       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}CPU time for METIS mesh partitioning [nroot\_elem="{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01298}01298                  << total\_number\_of\_root\_elements << \textcolor{stringliteral}{"{}]: "{}} << cpu1 << \textcolor{stringliteral}{"{} sec"{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01299}01299                  << std::endl;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01300}01300 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01301}01301       \textcolor{comment}{// Cleanup}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01302}01302       \textcolor{keyword}{delete}[] xadj;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01303}01303       \textcolor{keyword}{delete}[] part;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01304}01304       \textcolor{keyword}{delete}[] vwgt;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01305}01305       \textcolor{keyword}{delete}[] edgecut;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01306}01306       \textcolor{keyword}{delete}[] options;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01307}01307     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01308}01308 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01309}01309     \textcolor{comment}{// Now scatter things back to processors: root\_element\_domain[] contains}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01310}01310     \textcolor{comment}{// the target domain for all elements (concatenated in processor-\/by}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01311}01311     \textcolor{comment}{// processor order on the root processor). Distribute this back}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01312}01312     \textcolor{comment}{// to the processors so that root\_element\_domain\_on\_this\_proc[e] contains}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01313}01313     \textcolor{comment}{// the target domain for root element e (in whatever order the processor}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01314}01314     \textcolor{comment}{// decided to line up its root elements).}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01315}01315     cpu\_start = clock();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01316}01316     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} root\_element\_domain\_on\_this\_proc(number\_of\_root\_elements);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01317}01317 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01318}01318     \textcolor{comment}{// Create at least one entry so we don't get a seg fault below}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01319}01319     \textcolor{keywordflow}{if} (root\_element\_domain\_on\_this\_proc.size() == 0)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01320}01320     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01321}01321       root\_element\_domain\_on\_this\_proc.resize(1);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01322}01322     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01323}01323     MPI\_Scatterv(\&root\_element\_domain[0],}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01324}01324                  \&number\_of\_root\_elements\_on\_each\_proc[0],}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01325}01325                  \&start\_index[0],}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01326}01326                  MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01327}01327                  \&root\_element\_domain\_on\_this\_proc[0],}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01328}01328                  number\_of\_root\_elements,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01329}01329                  MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01330}01330                  root\_processor,}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01331}01331                  comm\_pt-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01332}01332 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01333}01333 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01334}01334     \textcolor{comment}{// Now translate back into target domain for the actual (non-\/root)}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01335}01335     \textcolor{comment}{// elements}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01336}01336     element\_domain\_on\_this\_proc.resize(number\_of\_non\_halo\_elements);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01337}01337     \textcolor{keywordtype}{unsigned} count\_non\_halo = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01338}01338     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_elem; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01339}01339     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01340}01340       \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* el\_pt = mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01341}01341       \textcolor{keywordflow}{if} (!el\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a0d9869eaf7d6e104c1e465b0d3cd6a9b}{is\_halo}}())}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01342}01342       \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01343}01343         \textcolor{comment}{// Get the associated root element which is either...}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01344}01344         \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* root\_el\_pt = 0;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01345}01345         \mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}* ref\_el\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(el\_pt);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01346}01346         \textcolor{keywordflow}{if} (ref\_el\_pt != 0)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01347}01347         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01348}01348           \textcolor{comment}{//...the actual root element}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01349}01349           root\_el\_pt = ref\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_a8bbcee798e87bd7e5d88273c71500f76}{root\_element\_pt}}();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01350}01350         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01351}01351         \textcolor{comment}{// ...or the element itself}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01352}01352         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01353}01353         \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01354}01354           root\_el\_pt = el\_pt;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01355}01355         \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01356}01356 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01357}01357         \textcolor{comment}{// Recover the root element number (offset by one)}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01358}01358         \textcolor{keywordtype}{unsigned} root\_el\_number = root\_el\_number\_plus\_one[root\_el\_pt] -\/ 1;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01359}01359 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01360}01360         \textcolor{comment}{// Copy target domain across from root element}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01361}01361         element\_domain\_on\_this\_proc[count\_non\_halo] =}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01362}01362           root\_element\_domain\_on\_this\_proc[root\_el\_number];}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01363}01363 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01364}01364         \textcolor{comment}{// Bump up counter for non-\/root elements}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01365}01365         count\_non\_halo++;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01366}01366       \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01367}01367     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01368}01368 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01369}01369 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01370}01370 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01371}01371     \textcolor{keywordflow}{if} (count\_non\_halo != number\_of\_non\_halo\_elements)}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01372}01372     \{}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01373}01373       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01374}01374       error\_stream << \textcolor{stringliteral}{"{}Non-\/halo counts don't match: "{}} << count\_non\_halo << \textcolor{stringliteral}{"{} "{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01375}01375                    << number\_of\_non\_halo\_elements << std::endl;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01376}01376 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01377}01377       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01378}01378         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01379}01379     \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01380}01380 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01381}01381 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01382}01382     \textcolor{comment}{// End timer}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01383}01383     cpu\_end = clock();}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01384}01384 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01385}01385     \textcolor{comment}{// Doc}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01386}01386     \textcolor{keywordtype}{double} cpu2 = double(cpu\_end -\/ cpu\_start) / CLOCKS\_PER\_SEC;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01387}01387     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}CPU time for communication of partition to all processors "{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01388}01388                   \textcolor{stringliteral}{"{}[nroot\_elem="{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01389}01389                << total\_number\_of\_root\_elements << \textcolor{stringliteral}{"{}]: "{}} << cpu2 << \textcolor{stringliteral}{"{} sec"{}}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01390}01390                << std::endl;}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01391}01391   \}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01392}01392 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01393}01393 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01394}01394 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01395}01395 }
\DoxyCodeLine{\Hypertarget{partitioning_8cc_source_l01396}01396 \} \textcolor{comment}{// namespace oomph}}

\end{DoxyCode}
